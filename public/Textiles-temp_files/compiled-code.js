/*
 Paper.js v0.11.8 - The Swiss Army Knife of Vector Graphics Scripting.
 http://paperjs.org/

 Copyright (c) 2011 - 2016, Juerg Lehni & Jonathan Puckey
 http://scratchdisk.com/ & http://jonathanpuckey.com/

 Distributed under the MIT license. See LICENSE file for details.

 All rights reserved.

 Date: Wed Oct 17 17:00:54 2018 +0200

**

 Straps.js - Class inheritance library with support for bean-style accessors

 Copyright (c) 2006 - 2016 Juerg Lehni
 http://scratchdisk.com/

 Distributed under the MIT license.

**

 Acorn.js
 http://marijnhaverbeke.nl/acorn/

 Acorn is a tiny, fast JavaScript parser written in JavaScript,
 created by Marijn Haverbeke and released under an MIT license.

 https://mths.be/codepointat v0.2.0 by @mathias */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};var OS_TYPE="Unknown",BROWSER_TYPE="Unknown",BROWSER_VERSION="Unknown";
-1!=window.navigator.userAgent.indexOf("Windows NT 6.2")&&(OS_TYPE="Windows 8");-1!=window.navigator.userAgent.indexOf("Windows NT 6.1")&&(OS_TYPE="Windows 7");-1!=window.navigator.userAgent.indexOf("Windows NT 6.0")&&(OS_TYPE="Windows Vista");-1!=window.navigator.userAgent.indexOf("Windows NT 5.1")&&(OS_TYPE="Windows XP");-1!=window.navigator.userAgent.indexOf("Windows NT 5.0")&&(OS_TYPE="Windows 2000");-1!=window.navigator.userAgent.indexOf("Mac")&&(OS_TYPE="Mac/iOS");
-1!=window.navigator.userAgent.indexOf("X11")&&(OS_TYPE="UNIX");-1!=window.navigator.userAgent.indexOf("Linux")&&(OS_TYPE="Linux");
function BrowserInfo(){var a=navigator.userAgent,b=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(b[1])){var c=/\brv[ :]+(\d+)/g.exec(a)||[];return{name:"explorer",version:c[1]||""}}if("Chrome"===b[1]&&(c=a.match(/\bOPR\/(\d+)/),null!=c))return{name:"opera",version:c[1]};b=b[2]?[b[1],b[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(c=a.match(/version\/(\d+)/i))&&b.splice(1,1,c[1]);return{name:b[0].toLowerCase(),version:b[1]}}
var browserInfo=BrowserInfo();BROWSER_TYPE=browserInfo.name;BROWSER_VERSION=parseInt(browserInfo.version);var DEVICE_WITH_TOUCH_EVENTS="ontouchstart"in window;window.DISABLE_TOUCH_EVENTS&&(DEVICE_WITH_TOUCH_EVENTS=!1);var TRANSFER_DATA=null;function SetTransferData(a){TRANSFER_DATA=a}function GetTransferData(){return TRANSFER_DATA}var CLIPBOARD_DATA=null;function SetClipboardData(a){CLIPBOARD_DATA=a}function GetClipboardData(){return CLIPBOARD_DATA}
String.prototype.splice=function(a,b,c){c=c||"";return this.slice(0,a)+c+this.slice(a+Math.abs(b))};function GetObjectClassName(a){return"object"!=typeof a||null===a?!1:/(\w+)\(/.exec(a.constructor.toString())[1]}Node.prototype.isChildOf=function(a){for(var b=this;void 0!=b&&null!=b&&"BODY"!=b.tagName.toUpperCase();){if(b==a)return!0;b=b.parentNode}return!1};
Node.prototype.getParentInGrandParent=function(a){return this.parentNode==a?this:null!==this.parentNode?this.parentNode.getParentInGrandParent(a):null};Node.prototype.getElementOrParentElementByAttribute=function(a,b){return this.hasAttribute?this.hasAttribute(a)&&this.getAttribute(a)==b?this:null!=this.parentNode?this.parentNode.getElementOrParentElementByAttribute(a,b):null:null};
Node.prototype.getElementOrParentElementByAttributeName=function(a){return this.hasAttribute?this.hasAttribute(a)?this:null!=this.parentNode?this.parentNode.getElementOrParentElementByAttributeName(a):null:null};Node.prototype.getParentElementById=function(a){return this.parentNode.id==a?this.parentNode:null!==this.parentNode?this.parentNode.getParentElementById(a):null};
Node.prototype.getParentElementByNodeName=function(a){return null!==this.parentNode?this.parentNode.nodeName==a?this.parentNode:this.parentNode.getParentElementByNodeName(a):null};Node.prototype.getParentElementByClass=function(a){return this.parentNode.classList.contains(a)?this.parentNode:null!==this.parentNode?this.parentNode.getParentElementByClass(a):null};Node.prototype.removeChildren=function(a){for(;this.firstChild;)a&&a(this.firstChild),this.removeChild(this.firstChild)};
Element.prototype.selectAllTextInElement=function(){var a=document.createRange();a.selectNodeContents(this);var b=window.getSelection();b.removeAllRanges();b.addRange(a)};Element.prototype.isHidden=function(){return null===this.offsetParent};
InitControllers=function(a,b){a=a||document;for(var c,d,e=a.querySelectorAll("*[controller-class]"),f=[],g=0;g<e.length;g++){c=e[g];for(var h=c.getAttribute("controller-class").split(","),k=0;k<h.length;k++)d=h[k],window[d]?c.connectController(window[d],b):c.hasAttribute("controller-class-url")?(d=c.getAttribute("controller-class-url"),c.removeAttribute("controller-class-url"),console.log("----carico js: "+d),IncludeJS(d,function(){InitControllers(a,b)},!0)):f.push({element:c,className:"/* class constructor */\nfunction "+
d+"(_e)\n{\n/* constructor code */\n};\n\n_ = "+d+".prototype;"})}if(0<f.length)for(g=0;g<f.length;g++)console.warn("Undefined class/controllers for:",f[g].element),console.log(f[g].className);return e};
Node.prototype.connectController=function(a,b){if(this.connectedControllers)for(var c=0;c<this.connectedControllers.length;c++){if(this.connectedControllers[c]==a){console.warn("controller already exists");return}}else this.connectedControllers=[];for(var d in a.prototype)"constructor"!=d&&(this[d]&&console.warn('The methods "'+d+'" already exists in',this),this[d]=a.prototype[d]);a.call(this,b||{});this.connectedControllers.push(a);return this};
Node.prototype.connectEvents=function(a,b){function c(){document.activeElement!=document.lastActiveElement&&this.select();document.lastActiveElement=this}a=a||this;var d,e=this.querySelectorAll("[event]"),f=b||{},g=[];this.hasAttribute("event")&&(e=[].slice.call(e,0),e.push(this));for(var h=0;h<e.length;h++){var k=e[h];if(""!=k.getAttribute("event")){var l=k.getAttribute("event").split(",");if(0<l.length){for(var n=0;n<l.length;n++){var m=l[n].split(":");var y=m[0].trim();m=m[1].trim();(d=a[m])?ConnectEvent(y,
k,d,a):g.push("_."+m+" = function(_e){\n};")}k.hasAttribute("name")&&(f[k.getAttribute("name")]=k);"INPUT"==k.nodeName&&"text"==k.getAttribute("type")&&ConnectEvent("click",k,c)}}}0<g.length&&(console.warn("Undefined event listeners in element/controller:",a),console.warn(g.join("\n\n")));return f};
function CreateUniqueIDI(a){a=a||"IDI";window.COUNTER_IDI=window.COUNTER_IDI||0;window.COUNTER_IDI++;var b=46656*Math.random()|0,c=46656*Math.random()|0;b=("000"+b.toString(36)).slice(-3);c=("000"+c.toString(36)).slice(-3);return a+"_"+window.COUNTER_IDI+b+c}function GetElementId(a,b){if(a.hasAttribute("id")&&""!==a.getAttribute("id"))return a.getAttribute("id");if(b){var c="TEMP_"+(new Date).getTime();a.setAttribute("id",c);return c}return null}
function SelectElement(a,b){b=b||"radio";if("radio"==b){if(a.parentElement.hasAttribute("id")&&""!=a.parentElement.getAttribute("id"))var c=a.parentElement.getAttribute("id");else c="TEMP_"+(new Date).getTime(),a.parentElement.setAttribute("id",c);c=a.parentElement.querySelectorAll("#"+c+">.selected");for(var d=0,e=c.length;d<e;d++)c[d].classList.remove("selected");a.classList.add("selected")}else"check"==b&&a.classList.toggle("selected");if(a.parentElement.onChildrenSelection)a.parentElement.onChildrenSelection(a)}
function DeselectElements(a){for(var b=0,c=a.length;b<c;b++)a[b].classList.remove("selected")}
function ShowElement(a,b,c){b=b||"radio";if("radio"==b){a.parentNode.hasAttribute("id")?(b=a.parentNode.getAttribute("id"),b=a.parentNode.parentNode.querySelectorAll("#"+b+">.showed")):b=a.parentNode.querySelectorAll(".showed");for(var d=0,e=b.length;d<e;d++)b[d].classList.remove("showed");a.classList.add("showed")}else"check"==b?a.classList.toggle("showed"):"always"==b&&a.classList.add("showed");if(a.onShow)a.onShow();c&&(a.style.left=c.x+"px",a.style.top=c.y+"px");return a}
function HideElements(a){for(var b=0,c=a.length;b<c;b++)a[b].classList.remove("showed")}function FlipElement(a,b){b=b||2E3;a.classList.add("flip");setTimeout(function(){a.classList.remove("flip")},b)}Event.prototype.preventPropagation=function(){this.preventDefault&&this.preventDefault();this.stopPropagation&&this.stopPropagation();return!1};
Event.prototype.responseToJSON=function(){var a=this.target;try{return window.JSON.parse(a.responseText)}catch(b){return console.error(b+"\nresponse: "+a.responseText),!1}};
KeyboardEvent.CODES={keyCode_0:48,keyCode_1:49,keyCode_2:50,keyCode_3:51,keyCode_4:52,keyCode_5:53,keyCode_6:54,keyCode_7:55,keyCode_8:56,keyCode_9:57,keyCode_PLUS_A:187,keyCode_PLUS_B:107,keyCode_MINUS_A:189,keyCode_MINUS_B:109,keyCode_A:65,keyCode_B:66,keyCode_C:67,keyCode_D:68,keyCode_E:69,keyCode_F:70,keyCode_G:71,keyCode_H:72,keyCode_I:73,keyCode_L:76,keyCode_M:77,keyCode_N:78,keyCode_P:80,keyCode_R:82,keyCode_S:83,keyCode_T:84,keyCode_V:86,keyCode_Z:90,keyCode_X:88,keyCode_SPACE:32,keyCode_ESC:27,
keyCode_f5:116,keyCode_backspace:8,keyCode_delete:46,keyCode_arrowLeft:37,keyCode_arrowUp:38,keyCode_arrowRight:39,keyCode_arrowDown:40,keyCode_pageUp:33,keyCode_pageDown:34,keyCode_end:35,keyCode_home:36,keyCode_tab:9,keyCode_space:32,keyCode_enter:13,keyCode_esc:27};
Event.prototype.getMousePoint=function(){var a={x:0,y:0};if(DEVICE_WITH_TOUCH_EVENTS)0<this.targetTouches.length&&(a.x=this.targetTouches[0].pageX,a.y=this.targetTouches[0].pageY);else if(this)if(this.pageX||this.pageY)a.x=this.pageX,a.y=this.pageY;else if(this.layerX||this.layerY)a.x=this.layerX,a.y=this.layerY;else if(this.clientX||this.clientY)a.x=this.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a.y=this.clientY+document.body.scrollTop+document.documentElement.scrollTop;
return a};function DrawData(a,b,c,d,e,f){!0!==f&&b.removeChildren();for(var g=document.createDocumentFragment(),h=a.length,k=0;k<h;k++){var l=a[k];d&&(l=d(l));f=l.templateElement?l.templateElement.cloneNode(!0):c.cloneNode(!0);l.id&&f.setAttribute("id",l.id);f.data=l;BindData(l,f);g.appendChild(f);e&&e(f)}b.appendChild(g)}
function BindData(a,b,c){c=c||"name";b=b.querySelectorAll("["+c+"]");for(var d,e,f=b.length,g=0;g<f;g++){d=b[g];e=d.getAttribute(c);e=a[e];if(null===e||void 0===e)e="";if(d.onBindData)d.onBindData(a);else switch(d.nodeName){case "INPUT":"radio"===d.type||"checkbox"===d.type?d.checked=e==d.value:d.value=e;break;case "SELECT":d.value=e;break;case "DIV":case "LI":case "SPAN":d.hasAttribute("type")?"checkbox"==d.getAttribute("type")&&(!0===e?d.classList.add("selected"):d.classList.remove("selected")):
d.innerHTML=e;break;case "TEXTAREA":d.value=e;break;case "A":d.setAttribute("href",e);break;case "IMG":d.setAttribute("src",e)}}}
function SendAndLoad(a,b,c,d,e,f,g,h,k){var l=new XMLHttpRequest;d&&(l.onload=d);e&&(l.onerror=e);f&&(l.onprogress=f);g&&(l.upload.onprogress=g);h&&(l.onabort=h);b=b||"GET";d="";if(c)if("string"===typeof c||c instanceof String||c instanceof FormData||c instanceof Blob)d=c;else if(c instanceof HTMLFormElement)d=new FormData(c);else{d=new FormData;for(var n in c)d.append(n,c[n])}l.open(b,a,!0);k&&k(l);l.send(d);return l}
function GetUrlVars(a){a=a||window.location.href;var b={};decodeURIComponent(a).replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,d,e){console.log("key: "+d);console.log("value: "+e);b[d]=e});return b}
function WriteTemplate_OLD(a,b){a instanceof Function&&(a=a.toString(),a=a.substring(a.indexOf("/*")+2,a.lastIndexOf("*/")));var c=document.createElement("span");c.innerHTML=a;if(document.currentScript)var d=document.currentScript;else d=document.getElementsByTagName("script"),d=d[d.length-1];for(var e=d.parentElement;c.children.length;)e.appendChild(c.children[0]);!1!==b&&e.removeChild(d)}
function WriteTemplate(a,b){a instanceof Function&&(a=a.toString(),a=a.substring(a.indexOf("/*")+2,a.lastIndexOf("*/")));var c=document.createElement("span");c.innerHTML=a;if(document.currentScript)var d=document.currentScript;else d=document.getElementsByTagName("script"),d=d[d.length-1];for(b=b||d.parentElement;c.children.length;)b.appendChild(c.children[0]);d.parentElement.removeChild(d)}
function IncludeCSS(a,b,c){if(document.head.querySelector('link[href="'+a+'"]'))b&&b();else{var d=document.getElementsByTagName("head")[0],e=document.createElement("link");e.setAttribute("rel","stylesheet");e.setAttribute("type","text/css");e.setAttribute("href",a);d.appendChild(e);"undefined"!==typeof e.addEventListener&&(b&&e.addEventListener("load",b,!1),c&&e.addEventListener("error",c,!1))}}
function IsScriptAlreadyIncluded(a){for(var b=document.getElementsByTagName("script"),c=0;c<b.length;c++)if(b[c].getAttribute("src")==a)return!0;return!1}
function IncludeJS(a,b,c){if(!c||!IsScriptAlreadyIncluded(a)){c=document.getElementsByTagName("head")[0];var d=document.createElement("script");d.src=a;d.type="text/javascript";void 0!=b&&null!=b&&(d.readyState?d.onreadystatechange=function(a){if("loaded"==d.readyState||"complete"==d.readyState)d.onreadystatechange=null,b(d)}:d.onload=function(a){d.loaded=!0;b(d)});c.appendChild(d);return d}}function RequireJS(a){document.write('<script src="'+a+'" type="text/javascript">\x3c/script>')}
function Extends(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.superConstructor=b;a.superClass=b.prototype}function BindFunction(a,b){b||console.log(errore);return function(){return b.apply(a,arguments)}}
function ConnectEvent(a,b,c,d,e){if(b){b instanceof Array||b instanceof NodeList||(b=[b]);c=d?BindFunction(d,c):c;e=e||!1;for(var f=b.length,g=0;g<f;g++)if(d=b[g],d.addEventListener){if(DEVICE_WITH_TOUCH_EVENTS)switch(a){case "mousedown":a="touchstart";break;case "mousemove":a="touchmove";break;case "mouseup":a="touchend"}d.addEventListener(a,c,e)}else d.attachEvent?d.attachEvent("on"+a,c):d["on"+a]=c;return c}console.warn("Can't connect the event:"+a+" with the function",c)}
function DisconnectEvent(a,b,c,d){b.length||(b=[b]);for(var e,f=b.length,g=0;g<f;g++)if(e=b[g],e.removeEventListener){if(DEVICE_WITH_TOUCH_EVENTS)switch(a){case "mousedown":a="touchstart";break;case "mousemove":a="touchmove";break;case "mouseup":a="touchend"}e.removeEventListener(a,c,d)}else e.attachEvent?e.detachEvent("on"+a,c):e["on"+a]=null}GetObjectByStringPath=function(a,b){for(var c=b.split("."),d=0,e=c.length;d<e;++d){var f=c[d];if(f in a)a=a[f];else return null}return a};
Array.prototype.clone=function(){return this.slice(0)};Array.prototype.add=Array.prototype.push;Array.prototype.addAt=function(a,b){this.splice(b,0,a)};Array.prototype.replaceAt=function(a,b){var c=this[b];this.splice(b,1,a);return c};Array.prototype.remove=function(a){var b=this.indexOf(a);return-1<b?(this.splice(b,1),a):null};Array.prototype.removeAt=function(a){var b=this[a];this.splice(a,1);return b};Array.prototype.sortOn=function(a){this.sort(function(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:0})};
Node.prototype.remove=function(){return this.parentNode.removeChild(this)};Node.prototype.removeChildren=function(){for(;this.firstChild;)this.removeChild(this.firstChild)};Node.prototype.cloneChildrenTo=function(a){var b,c=this.children.length;for(b=0;b<c;b++)a.appendChild(this.children[b].cloneNode(!0))};Node.prototype.appendChildren=function(a){a=[].slice.call(a,0);for(var b=a.length,c=0;c<b;c++)console.log(" _elementList[i]",a[c]),this.appendChild(a[c]);return a};
Node.prototype.insertChildrenBeforeElement=function(a,b){for(var c=a.length,d=0;d<c;d++)this.insertBefore(a[d],b)};Node.prototype.findCDATANode=function(){for(var a=0;a<this.childNodes.length;a++)if("#cdata-section"===this.childNodes[a].nodeName)return this.childNodes[a]};Node.prototype.setIndex=function(a){a||(a=0);a>=this.parentNode.children.length-1?this.parentNode.appendChild(this):this.parentNode.insertBefore(this,this.parentNode.children[a])};Node.prototype.bringToFront=function(){this.parentNode.appendChild(this)};
Node.prototype.sendToBack=function(){this.parentNode.insertBefore(this,this.parentNode.childNodes[0])};Node.prototype.bringUp=function(){this.nextElementSibling&&(this.nextElementSibling.nextElementSibling?this.parentNode.insertBefore(this,this.nextElementSibling.nextElementSibling):this.parentNode.appendChild(this))};Node.prototype.sendDown=function(){this.previousElementSibling&&this.parentNode.insertBefore(this,this.previousElementSibling)};
Node.prototype.getIndex=function(){for(var a=this,b=0;a=a.previousElementSibling;)++b;return b};NodeList.prototype.indexOf=function(a){for(var b=0;a=a.previousSibling;)1===a.nodeType&&++b;return b};Element.prototype.setAttributeElementList=function(a,b,c){if(0!=a.length){var d,e=a.length;if("string"===typeof b){var f=b;for(d=0;d<e;d++)a[d].setAttribute(f,c)}else if(b instanceof Object)for(d=0;d<e;d++)for(f in b)c=b[f],null==c||void 0==c?a[d].removeAttribute(f):a[d].setAttribute(f,c)}};
Element.prototype.getGlobalPosition=function(){for(var a=this,b=0,c=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{x:b,y:c}};Element.prototype.globalToLocal=function(a){var b=this.getGlobalPosition();return{x:a.x-b.x,y:a.y-b.y}};Element.prototype.getPosition=function(){return{x:this.offsetLeft,y:this.offsetTop}};Element.prototype.setPosition=function(a,b,c){c=c||"px";this.style.left=a+c;this.style.top=b+c};
Element.prototype.setPositionX=function(a,b){this.style.left=a+(b||"px")};Element.prototype.setPositionY=function(a,b){this.style.top=a+(b||"px")};Element.prototype.getSize=function(){return{x:this.offsetWidth,y:this.offsetHeight}};Element.prototype.setSize=function(a,b,c){c=c||"px";this.style.width=a+c;this.style.height=b+c};Element.prototype.setSizeX=function(a,b){this.style.width=a+(b||"px")};Element.prototype.setSizeY=function(a,b){this.style.height=a+(b||"px")};
Element.prototype.setTransform=function(a,b){el.style.Transform=a;el.style.MozTransform=a;el.style.msTransform=a;el.style.OTransform=a;el.style.webkitTransform=a;void 0!=b&&(el.style.TransformOrigin=b,el.style.MozTransformOrigin=b,el.style.msTransformOrigin=b,el.style.OTransformOrigin=b,el.style.webkitTransformOrigin=b)};Math.evalExpression=function(a){return a};
function PathInfo(a){var b=a.split("/");a=b[b.length-1];var c="";1<b.length&&(b.pop(),c=b.join("/"));b=a.split(".");var d=b[0],e="";1<b.length&&(e=b.pop(),d=b.join("."));return{dir:c,fileName:a,fileNameNoExtension:d,fileExtension:e}}
function GetRelativeFilePathFromBaseFilePath(a,b){console.log("_basePath",a);console.log("_absolutePath",b);for(var c=a.split("/"),d=b.split("/"),e=b.split("/"),f=0;f<c.length&&f!=d.length;f++)c[f]==d[f]?e.shift():e.unshift("..");e.shift();c=e.join("/");console.log("relativePath",c);return c}
function GetAbsoluteFilePathFromBaseFilePath(a,b){var c=a.split("/");c.pop();var d=b.split("../");if(1<d.length)for(var e=0;e<d.length;e++)d.shift(),c.pop();c=c.concat(d).join("/");console.log("absolute path",c);return c}
function BrowserLanguage(){var a=window.navigator.languages?window.navigator.languages[0]:null;a=a||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage;-1!==a.indexOf("-")&&(a=a.split("-")[0]);-1!==a.indexOf("_")&&(a=a.split("_")[0]);return a}function SetCookie(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString()}else c="";document.cookie=a+"="+b+c+"; path=/"}
function GetCookie(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null}function EraseCookie(a){SetCookie(a,"",-1)}
ClosureCompiler=function(){var a="// ==ClosureCompiler==\n// @output_file_name janvas_minified.js\n// @compilation_level SIMPLE_OPTIMIZATIONS\n";for(var b=document.head.querySelectorAll("script[src]:not([no-compile])"),c=(new Date).getTime(),d=0;d<b.length;d++)a+="// @code_url "+b[d].src+"?timestamp="+c+"\n";console.log(a+"// ==/ClosureCompiler==\n")};function Localizer(){this.strings={};this.strings_to_translate={}}_=Localizer.prototype;_.setStrings=function(a){this.strings=a};
_.translate=function(a,b){if(this.strings[a]){var c=this.strings[a];if(b){var d;for(d in b){var e=new RegExp(d,"g");c=c.replace(e,b[d])}}}else console.log("traduzione non trovata! "+a),this.strings_to_translate[a]="to translate",c=a;return c};_.printToTranslate=function(){console.log("---------- to translate ----------");for(var a in this.strings_to_translate)"to translate"==this.strings_to_translate[a]&&console.log(a);console.log("----------------------------------")};
_.localizeContents=function(a){a=a||document;for(var b,c=a.querySelectorAll("[data-translate]"),d=c.length,e=0;e<d;e++)b=c[e],a=b.getAttribute("data-translate"),0<a.length?this.strings[a]?(b.innerHTML=this.strings[a],console.log(a,this.strings[a])):this.strings_to_translate[a]="to translate":(a=String(b.innerHTML).trim(),this.strings[a]?(b.innerHTML=this.strings[a],b.setAttribute("data-translate",a)):this.strings_to_translate[a]="to translate")};
_.localizeAttributes=function(a,b){a=a||"title";b=b||document;for(var c,d,e=b.querySelectorAll("[data-translate-"+a+"]"),f=e.length,g=0;g<f;g++)d=e[g],c=d.getAttribute("data-translate-"+a),0<c.length?this.strings[c]?d.setAttribute(a,this.strings[c]):this.strings_to_translate[c]="to translate":(c=d.getAttribute(a),this.strings[c]?(d.setAttribute(a,this.strings[c]),d.setAttribute("data-translate-"+a,c)):this.strings_to_translate[c]="to translate")};
_.loadStrings=function(a,b){IncludeJS(a);var c=this;window.onLoadLanguageStrings=function(a){console.log("onLoadLanguageStrings",a);c.setStrings(a);c.localizeContents();c.localizeAttributes();b&&b()}};function GlobalMouse(){this.mouseDownPt={x:0,y:0};this.mouseUpPt={x:0,y:0};this.mouseMovePt={x:0,y:0};this.isDragAction=this.isMouseButtonPressed=!1;this.lastMouseUpTime;this.snapValue=5;this.globalMouseTargetDelegate=null;this.initEventListeners()}_=GlobalMouse.prototype;
_.initEventListeners=function(){var a=document.getElementsByTagName("html")[0];ConnectEvent("mousedown",a,this.onMouseDown,this,!0);ConnectEvent("mousemove",a,this.onMouseMove,this,!0);ConnectEvent("mouseup",a,this.onMouseUp,this,!0)};
_.onMouseDown=function(a){this.lastMouseDownTime=(new Date).getTime();Event.isMouseHold=Event.isDoubleClick=!1;this.mouseDownPt=a.getMousePoint();this.mouseMovePt.x=this.mouseDownPt.x;this.mouseMovePt.y=this.mouseDownPt.y;if(!(a.srcElement instanceof HTMLUListElement)&&(this.isMouseButtonPressed=!0,this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseDown))this.globalMouseTargetDelegate.onGlobalMouseDown(a)};
_.onMouseUp=function(a){this.mouseUpPt=a.getMousePoint();if(this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseUp)this.globalMouseTargetDelegate.onGlobalMouseUp(a);var b=(new Date).getTime();if(250>b-this.lastMouseUpTime&&(Event.isDoubleClick=!0,this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseDoubleClick))this.globalMouseTargetDelegate.onGlobalMouseDoubleClick(a);if(250<b-this.lastMouseDownTime&&(Event.isMouseHold=!0,this.globalMouseTargetDelegate&&
this.globalMouseTargetDelegate.onGlobalMouseHold))this.globalMouseTargetDelegate.onGlobalMouseHold(a);this.lastMouseUpTime=b;this.isMouseButtonPressed=!1;if(this.isDragAction)this.onEndDrag(a);this.resetState()};
_.onMouseMove=function(a){this.mouseMovePt=a.getMousePoint();if(this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseMove)this.globalMouseTargetDelegate.onGlobalMouseMove(a);if(this.isMouseButtonPressed)if(this.isDragAction)this.onDrag(a);else this.distanceFromPoints(this.mouseMovePt,this.mouseDownPt)>this.snapValue&&this.startDrag(a)};_.startDrag=function(a){this.isDragAction=!0;this.onStartDrag(a)};
_.onStartDrag=function(a){if(this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseStartDrag)return this.globalMouseTargetDelegate.onGlobalMouseStartDrag(a),console.log("onStartDrag",a),window.TouchEvent&&a instanceof TouchEvent?void 0:a.preventPropagation()};
_.onEndDrag=function(a){if(this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseEndDrag)return this.globalMouseTargetDelegate.onGlobalMouseEndDrag(a),window.TouchEvent&&a instanceof TouchEvent?void 0:a.preventPropagation()};_.onDrag=function(a){if(this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseDrag)return this.globalMouseTargetDelegate.onGlobalMouseDrag(a),window.TouchEvent&&a instanceof TouchEvent?void 0:a.preventPropagation()};_.onMouseWheel=function(a){};
_.resetState=function(){this.isMouseButtonPressed=this.isDragAction=!1;this.globalMouseTargetDelegate=null};_.isTextEditing=function(){var a=document.activeElement;return"INPUT"==a.nodeName||"TEXTAREA"==a.nodeName||"text"==a.nodeName||a.hasAttribute("contenteditable")?!0:!1};_.distanceFromPoints=function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)};var GMOUSE=new GlobalMouse;function UndoRedoHistory(){this.redoList=[];this.undoList=[];this.currentUndoID=-1}
UndoRedoHistory.prototype.addUndoRedoActions=function(a,b){a||(console.log("UndoRedoHistory undoAction azione nulla"),console.log(a));b||(console.log("UndoRedoHistory redoAction azione nulla"),console.log(b));this.currentUndoID<this.undoList.length-1&&(this.undoList.splice(this.currentUndoID+1),this.redoList.splice(this.currentUndoID+1));this.undoList.push(a);this.redoList.push(b);this.currentUndoID=this.undoList.length-1};
UndoRedoHistory.prototype.undo=function(){-1<this.currentUndoID&&(this.undoList[this.currentUndoID]||(console.log(this.currentUndoID),console.log(this.undoList)),console.log("UndoRedoHistory.prototype.undo",this.undoList[this.currentUndoID]),this.undoList[this.currentUndoID].execute(),this.currentUndoID--)};
UndoRedoHistory.prototype.redo=function(){this.currentUndoID<this.undoList.length-1&&(this.currentUndoID++,this.redoList[this.currentUndoID]||(console.log(this.currentUndoID),console.log(this.redoList)),console.log("UndoRedoHistory.prototype.redo",this.redoList[this.currentUndoID]),this.redoList[this.currentUndoID].execute())};
function LocalFileSystem(){this.objectUrlList={};this.inputFile=document.createElement("input");this.inputFile.type="file";this.inputFile.callback=null;this.inputFile.addEventListener("change",function(a){this.callback(a);this.value=null},!1)}_=LocalFileSystem.prototype;_.chooseLocalFile=function(a){this.inputFile.setAttribute("accept",a);this.inputFile.click()};
_.saveLocalFile=function(a,b,c){c=c||"text/plain";var d=document.createElement("a");a=a.split(".")[0]+"."+{"image/png":"png","image/jpeg":"jpg","image/svg+xml":"svg","text/csv;charset=utf-8;":"csv"}[c];d.download=a;"image/png"==c||"image/jpeg"==c?d.href=b:(d.href=window.URL.createObjectURL(new Blob([b],{type:c})),d.dataset.downloadurl=[c,d.download,d.href].join(":"));d.click()};
_.getDirEntryContent=function(a,b){function c(a){console.log("FileSystem API error code: "+a.code)}(function(d){function e(d){d.length?(f=f.concat(Array.prototype.slice.call(d||[],0)),g.readEntries(e,c)):(f.sort(),a.items=f,b(f))}var f=[],g=d.createReader();g.readEntries(e,c)})(a)};_.getFileEntryAsObjectURL=function(a,b){var c=this;a.file(function(d){d=window.URL.createObjectURL(d);c.objectUrlList[a.fullPath]=d;b(d)})};
_.readXMLFile=function(a,b){var c=new FileReader;c.onload=function(a){console.log(a.target.result);a=(new DOMParser).parseFromString(a.target.result,"image/svg+xml").documentElement;console.log("xmlDocument",a);b(a)};c.readAsText(a)};_.readImageFile=function(a,b){if(a&&window.File&&window.FileReader&&window.FileList&&window.Blob){var c=new FileReader;c.onload=function(a){b(a.target.result)};c.readAsDataURL(a)}};
String.prototype.parseSqlTimestamp=function(){var a=this.split(/[- :]/);return new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5])};String.prototype.parseFloats=function(a){a=a||/\s+/;var b=[];a=this.split(a);for(var c,d=0,e=a.length;d<e;d++)c=parseFloat(a[d]),isNaN(c)?console.warn("error NaN String.prototype.parseFloats id:"+d+" value:"+a[d]):b.push(c);return b};
String.prototype.parseIntegers=function(a){a=a||/\s+/;var b=[];a=this.split(a);for(var c,d=0,e=a.length;d<e;d++)c=parseInt(a[d]),isNaN(c)?console.warn("error NaN String.prototype.parseIntegers id:"+d+" value:"+a[d]):b.push(c);return b};String.prototype.containsWords=function(a,b){b=b||"AND";var c,d=a.length,e=this.split(/\s+/);if("AND"==b){for(c=0;c<d;c++)if(-1==e.indexOf(a[c]))return!1;return!0}if("OR"==b){for(c=0;c<d;c++)if(-1==e.indexOf(a[c]))return!0;return!1}};
String.prototype.isValidFileName=function(){return""==this||/[^a-z0-9\.\s\-_]/gi.test(this)?!1:!0};Number.prototype.formatMoney=function(a,b,c){var d=this;a=isNaN(a=Math.abs(a))?2:a;b=void 0==b?".":b;c=void 0==c?",":c;var e=0>d?"-":"",f=parseInt(d=Math.abs(+d||0).toFixed(a))+"",g=3<(g=f.length)?g%3:0;return e+(g?f.substr(0,g)+c:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+c)+(a?b+Math.abs(d-f).toFixed(a).slice(2):"")};function ContextPanels(a){a.appRef&&(this.appRef=a.appRef);this.initEvents()}
_=ContextPanels.prototype;_.initEvents=function(){ConnectEvent("mouseout",this,this.onExitFromContextPanels);ConnectEvent("dragleave",this,this.onDragLeaveFromContextPanels);ConnectEvent("click",this,this.onClickOnContextPanels)};
_.showContextPanel=function(a,b,c){a=this.querySelector("#"+a);console.log("showContextPanel",a);a&&(ShowElement(a),b=GMOUSE.mouseMovePt.x+(b||-12),c=GMOUSE.mouseMovePt.y+(c||-12),b+a.offsetWidth+20>document.body.offsetWidth&&(b=document.body.offsetWidth-a.offsetWidth-20),c+a.offsetHeight+20>document.body.offsetHeight&&(c=document.body.offsetHeight-a.offsetHeight-20),a.style.left=b+"px",a.style.top=c+"px",this.classList.add("modal-mode"))};
_.hideAllContextPanel=function(){console.log("hideAllContextPanel");HideElements(this.children);this.classList.remove("modal-mode")};_.onClickOnContextPanels=function(a){this.parentElement.querySelector("#CONTEXT_PANELS>.showed").classList.contains("close-on-click")?this.hideAllContextPanel():a.target==this&&this.hideAllContextPanel()};
_.onExitFromContextPanels=function(a){this.classList.contains("modal-mode")?a.target.classList.contains("close-on-exit")&&a.relatedTarget==this&&this.hideAllContextPanel():(console.log("---------------------------------"),console.log("_e.target",a.target),console.log("_e.relatedTarget",a.relatedTarget))};_.onDragLeaveFromContextPanels=function(a){this.hideAllContextPanel()};
function Panel(a){a.x&&this.setPositionX(a.x);a.y&&this.setPositionY(a.y);a.width&&this.setSizeX(a.width);a.height&&this.setSizeY(a.height);!1===a.closable&&this.classList.add("no-closable");!1===a.collapsable&&this.classList.add("no-collapsable");!1===a.resizable&&this.classList.add("no-resizable");!1===a.fullScreen&&this.classList.add("no-full-screen");a.appRef&&(this.appRef=a.appRef);this.idPanel=this.getIndex();this.panelRepository=null;this.initEvents()}_=Panel.prototype;
_.initEvents=function(a){a=GetElementId(this,!0);ConnectEvent("mousedown",this,this.placeInFront,this);ConnectEvent("mousedown",this.parentElement.querySelector("#"+a+" > .head"),this.onClickOnHead,this);ConnectEvent("click",this.parentElement.querySelector("#"+a+" > .close-button"),this.close,this);ConnectEvent("click",this.parentElement.querySelector("#"+a+" > .collapse-button"),this.onClickOnCollapseButton,this);ConnectEvent("click",this.parentElement.querySelector("#"+a+" > .full-screen-button"),
this.onClickOnFullScreenButton,this);ConnectEvent("mousedown",this.parentElement.querySelector("#"+a+" > .resize-button"),this.onMouseDownOnResizeButton,this)};_.setTitle=function(a){this.querySelector(".head>.title").innerHTML=a};
_.close=function(a){if(a&&a.altKey)for(var b=this.parentElement.querySelectorAll("div.panel"),c=0;c<b.length;c++)a=b[c],a.classList.contains("no-closable")||a.close(null);else this.panelRepository?this.panelRepository.insertBefore(this,this.panelRepository.childNodes[this.idPanel+1]):this.classList.contains("closed")||(this.onClose(),this.classList.add("closed"),this.classList.contains("modal")&&this.parentElement.classList.remove("showed"))};
_.onGlobalMouseStartDrag=function(){if(this.parentElement.classList.contains("panel-repository")){this.panelRepository=this.parentElement;var a=window.getComputedStyle(this);this.expand();var b=parseFloat(a.width);a=parseFloat(a.height);this.dragOffset={x:b/2,y:13};this.setPosition(GMOUSE.mouseMovePt.x,GMOUSE.mouseMovePt.y);this.setSize(b,a);document.querySelector("#FLOATING_WINDOWS").appendChild(this);this.placeInFront()}};_.onClose=function(){};
_.onClickOnFullScreenButton=function(){this.classList.remove("collapsed");this.classList.toggle("full-screen")};_.open=function(a){if(this.classList.contains("closed")){this.classList.contains("modal")&&this.parentElement.classList.add("showed");this.onOpen();this.classList.remove("closed");if(1==a){a=window.innerWidth;var b=window.innerHeight,c=this.getSize();this.setPosition(a/2-c.x/2,b/2-c.y/2)}this.placeInFront()}};_.onOpen=function(){};
_.placeInFront=function(a){this.parentNode.maxLevel||(this.parentNode.maxLevel=1);this.parentNode.maxLevel++;this.style.zIndex=this.parentNode.maxLevel};_.expand=function(){this.classList.remove("collapsed");this.onExpand()};_.collapse=function(){this.classList.add("collapsed");this.onCollapse()};
_.onClickOnHead=function(){this.dragAction="DRAG_WIN";var a=this.getPosition();this.dragOffset={x:0,y:0};this.dragOffset.x=GMOUSE.mouseMovePt.x-a.x;this.dragOffset.y=GMOUSE.mouseMovePt.y-a.y;GMOUSE.globalMouseTargetDelegate=this};_.onMouseDownOnResizeButton=function(){this.dragAction="RESIZE_WIN";var a=this.getPosition(),b=this.getSize();this.dragOffset={x:0,y:0};this.dragOffset.x=a.x+b.x-GMOUSE.mouseMovePt.x;this.dragOffset.y=a.y+b.y-GMOUSE.mouseMovePt.y;GMOUSE.globalMouseTargetDelegate=this};
_.onClickOnCollapseButton=function(){this.classList.contains("collapsed")?this.expand():this.collapse()};_.onExpand=function(){console.log("onExpand")};_.onCollapse=function(){};_.onGlobalMouseDoubleClick=function(a){console.log(a.target);if(a.target.classList.contains("title"))this.onClickOnCollapseButton()};_.onGlobalMouseEndDrag=function(){this.dragAction=GMOUSE.globalMouseTargetDelegate=null};
_.onGlobalMouseDrag=function(a){if("DRAG_WIN"==this.dragAction){a=GMOUSE.mouseMovePt.x-this.dragOffset.x;var b=GMOUSE.mouseMovePt.y-this.dragOffset.y;1>a&&(a=1);1>b&&(b=1);var c=window.innerWidth,d=window.innerHeight,e=this.getSize();a+e.x>c&&(a=c-e.x);b+e.y>d&&(b=d-e.y);this.setPosition(a,b)}else"RESIZE_WIN"==this.dragAction&&(a=this.getPosition(),this.setSize(GMOUSE.mouseMovePt.x-a.x+this.dragOffset.x,GMOUSE.mouseMovePt.y-a.y+this.dragOffset.y))};Extends(Progress_panel,Panel);
function Progress_panel(a){Progress_panel.superConstructor.call(this,a);this.appRef=a.appRef;this.progressBar=this.querySelector("#BAR");this.progressLabel=this.querySelector("#LABEL");this.progressInfo="progress state";this.loaded=this.total=0;this.progressBar.max=100;this.uploadBytePerSeconds=2E4;this.progressListenerList=[]}_=Progress_panel.prototype;_.reset=function(){this.loaded=this.total=0;this.progressListenerList=[]};_.onClose=function(){this.reset()};
_.open=function(a){Progress_panel.superClass.open.call(this,a);this.setPositionY(50)};_.setProgressInfo=function(a){this.progressInfo=a};_.setProgressBarValue=function(a){this.progressLabel.innerHTML=this.progressInfo+" "+a+"%";this.progressBar.value=a};_.setProgressValues=function(a,b){if(0!=a){var c=Math.round(b/a*100);this.setProgressBarValue(c);100==c?(this.close(),this.reset()):this.open(!0)}};
_.onLoadingProgress=function(a){a.lengthComputable&&(-1==this.progressListenerList.indexOf(a.target)&&(this.progressListenerList.push(a.target),this.total+=a.total,a.target.lastLoaded=0),this.loaded+=a.loaded-a.target.lastLoaded,a.target.lastLoaded=a.loaded,this.setProgressValues(this.total,this.loaded))};_.startVirtualProgress=function(a){this.progressState="progress";this.loaded=0;this.total=a;this.startVirtualProgressTime=(new Date).getTime();this.onVirtualProgress()};
_.endVirtualProgress=function(){this.progressState="end";this.endVirtualProgressTime=(new Date).getTime();this.uploadBytePerSeconds=this.total/((this.endVirtualProgressTime-this.startVirtualProgressTime)/200);this.setProgressBarValue(100);var a=this;setTimeout(function(){a.close();a.reset()},500)};
_.onVirtualProgress=function(){if("progress"==this.progressState){this.loaded+this.uploadBytePerSeconds<this.total?this.loaded+=this.uploadBytePerSeconds:(this.loaded-=this.uploadBytePerSeconds,0>this.loaded&&(this.loaded=0));this.setProgressValues(this.total,this.loaded);var a=this;setTimeout(function(){a.onVirtualProgress()},200)}};function Modal_dialog(a){a.appRef&&(this.appRef=a.appRef);this.connectEvents();this.callback_CANCEL=this.callback_OK=null}_=Modal_dialog.prototype;
_.setIcon=function(a){this.querySelector(".icon").className="icon "+a};_.setTitle=function(a){this.querySelector(".title").innerHTML=a};_.setDescription=function(a){this.querySelector(".description").innerHTML=a};_.close=function(){this.classList.remove("showed")};_.open=function(a,b,c,d){this.setTitle(a);this.setDescription(b);this.callback_OK=c;this.callback_CANCEL=d;this.classList.add("showed")};_.onClick_ok=function(a){this.close();this.callback_OK&&this.callback_OK();this.validTextPattern=null};
_.onClick_cancel=function(a){this.close();this.callback_CANCEL&&this.callback_CANCEL()};_.onChange_promptValue=function(a){console.log("onChange_promptValue",a)};_.onKeyPress_promptValue=function(a){};_.onKeyUp_promptValue=function(a){if(13==a.keyCode)return this.onClick_ok(a),!1;this.inputPattern&&(a.target.value=a.target.value.match(this.inputPattern))};_.getPromptValue=function(a){return this.querySelector(".prompt-value").value};
_.setPromptValue=function(a,b,c){var d=this.querySelector(".prompt-value");this.inputPattern=c||null;d.setAttribute("placeholder",b||"");d.value=a;d.select()};
function TreeView(){this.selectedNodeClassName="selected";this.expandedNodeClassName="expanded";this.dragOverNodeClassName="dragOver";this.dropNotAllowed="no-drop";this.selectedNodes=[];this.lastMouseUpTime=this.lastMouseDownTime=null;this.urlService="";this.loadingState=this.serviceVars=null;this.enableNodeNameEditing=this.enableNodeDrop=this.enableNodeDrag=!1;this.createEventHandlers()}_=TreeView.prototype;
_.createEventHandlers=function(){ConnectEvent("mousedown",this,this.onMouseDown,this);ConnectEvent("mouseup",this,this.onMouseUp,this);ConnectEvent("click",this,this.onMouseClick,this)};_.onMouseDown=function(a){this.lastMouseDownTime=(new Date).getTime()};_.onMouseUp=function(a){if("LI"==a.target.parentElement.nodeName){if("A"!=a.target.nodeName&&"DIV"==a.target.nodeName){if(this.isMouseHold())this.onMouseHoldOnNode(a);if(this.isDoubleClick())this.onDoubleClickOnNodeName(a)}3==a.which&&this.showNodeContextMenu(a)}};
_.onMouseClick=function(a){if("LI"===a.target.parentElement.nodeName){var b=a.target.parentElement;"A"===a.target.nodeName?this.expandOrCollapseNode(b):"DIV"===a.target.nodeName&&this.selectNode(a.target.parentElement)}else this.deselectAllNodes()};_.isMouseHold=function(){return 250<(new Date).getTime()-this.lastMouseDownTime?!0:!1};_.onMouseHoldOnNode=function(a){-1<this.selectedNodes.indexOf(a.target.parentElement)&&this.editNodeName(a.target)};
_.isDoubleClick=function(){var a=(new Date).getTime();if(250>a-this.lastMouseUpTime)return!0;this.lastMouseUpTime=a;return!1};_.onDoubleClickOnNodeName=function(a){this.expandOrCollapseNode(a.target.parentNode)};_.getDropableNodeTarget=function(a){return a.target.getElementOrParentElementByAttribute("dropable","true")};_.onDragOverNode=function(a){var b=this.getDropableNodeTarget(a);b&&b.classList.add(this.dragOverNodeClassName);a.stopPropagation();a.preventDefault()};
_.onDragLeaveNode=function(a){var b=this.getDropableNodeTarget(a);b&&b.classList.remove(this.dragOverNodeClassName);a.stopPropagation();a.preventDefault()};_.onDragStartNode=function(a){SetTransferData(a.target);a.altKey||(a.dataTransfer.effectAllowed="move");a.stopPropagation()};_.onDropOnNode=function(a){console.log("onDropOnNode treeview",a);var b=this.getDropableNodeTarget(a);this.onDragAndDropEnd(GetTransferData(),b);this.onDragLeaveNode(a);a.stopPropagation();a.preventDefault()};
_.onDragAndDropEnd=function(a,b){console.log("onDragAndDropEnd")};_.moveNodes=function(a,b){a.parentNode.removeChild(a);this.getNodeElement_ul(b).appendChild(a)};_.disableDraggableNodes=function(){for(var a=this.querySelectorAll('li[draggable="true"]'),b=0;b<a.length;b++)a[b].setAttribute("draggable","disabled")};_.enableDraggableNodes=function(){for(var a=this.querySelectorAll('li[draggable="disabled"]'),b=0;b<a.length;b++)a[b].setAttribute("draggable","true")};
_.editSelectedNodeName=function(){0!=this.selectedNodes.length&&this.editNodeName(this.selectedNodes[0].querySelector("div"))};_.getNodeName=function(a){return a.querySelector("div").textContent};
_.editNodeName=function(a){if(!0===this.enableNodeNameEditing){this.disableDraggableNodes();var b=a.textContent;a.removeChildren();var c=document.createElement("input");c.setAttribute("type","text");c.setAttribute("class","inputNodeName");c.setAttribute("value",b);c.previousValue=b;var d=this;ConnectEvent("change",c,function(a){this.blur()});ConnectEvent("blur",c,function(b){console.log("onBlur",this);this.value!=this.previousValue&&(a.innerHTML=d.onEndEditNodeName(this));a.innerHTML=this.value});
a.appendChild(c);c.focus()}};_.onEndEditNodeName=function(a){this.enableDraggableNodes()};_.showNodeContextMenu=function(a){};_.expandOrCollapseNode=function(a){a.classList.contains(this.expandedNodeClassName)?this.collapseNode(a):this.expandNode(a)};_.expandNode=function(a){var b=this.getNodeElement_ul(a);if(!b)return null;a.classList.add(this.expandedNodeClassName);return b};_.collapseNode=function(a){a.classList.remove(this.expandedNodeClassName)};
_.loadNodeChildren=function(a,b,c){var d=null;a&&(d=this.getNodeElement_ul(a));d||(d=this);d.removeChildren();this.showLoadingState();var e=this;console.log("this.urlService",this.urlService);console.log("this.serviceVars",this.serviceVars);SendAndLoad(b,"POST",c,function(a){a=a.target;console.log(a.responseText);a=window.JSON.parse(a.responseText);e.onLoadNodeChildren(a,d)})};_.onLoadNodeChildren=function(a,b){this.hideLoadingState();this.drawData(b,a)};
_.drawData=function(a,b,c){for(var d,e=0;e<b.length;e++)d=b[e],c=this.createTreeViewNode(d.itemType+"_icon16x16",d.itemTitle,null,d.hasChildren),c.setAttribute("itemType",d.itemType),c.setAttribute("id",d.id),c.data=d,a.appendChild(c),this.onNodeAdded(c)};
_.onNodeAdded=function(a){this.enableNodeDrag&&(a.draggable=!0,a.ondragstart=BindFunction(this,this.onDragStartNode));this.enableNodeDrop&&(a.setAttribute("dropable","true"),a.ondrop=BindFunction(this,this.onDropOnNode),a.ondragover=BindFunction(this,this.onDragOverNode),a.ondragleave=BindFunction(this,this.onDragLeaveNode))};_.getNodeElement_ul=function(a){return a.getElementsByTagName("ul")[0]};_.getSelecteNodes=function(){return this.selectedNodes};
_.selectNode=function(a){this.deselectAllNodes();this.selectedNodes.push(a);a.classList.add(this.selectedNodeClassName)};_.deselectNode=function(a){var b=this.selectedNodes.indexOf(a);-1!=b&&(this.selectedNodes.splice(b,1),a.classList.remove(this.selectedNodeClassName))};_.deselectAllNodes=function(){for(var a=this.selectedNodes.length,b=0;b<a;b++)this.selectedNodes[b].classList.remove(this.selectedNodeClassName);this.selectedNodes=[]};
_.createTreeViewNode=function(a,b,c,d){var e=document.createElement("li");c&&e.setAttribute("title",c);c=document.createElement("div");-1<a.indexOf(".jpg")?c.setAttribute("style",'background-image: url("'+a+'");'):c.className=a;c.appendChild(document.createTextNode(b));e.appendChild(c);1==d&&(a=document.createElement("ul"),e.appendChild(a));a=document.createElement("a");e.appendChild(a);return e};_.showLoadingState=function(){this.loadingState&&this.loadingState.classList.remove("hidden")};
_.hideLoadingState=function(){this.loadingState&&this.loadingState.classList.add("hidden")};Extends(LocalFileSystem_panel,Panel);
function LocalFileSystem_panel(a){LocalFileSystem_panel.superConstructor.call(this,a);this.fullPathDisplay=this.querySelector(".full-path-display");this.fullPathDisplay.addEventListener("dragover",function(a){a.preventDefault()});this.fullPathDisplay.addEventListener("dragleave",function(a){a.preventDefault()});a.fullPathDisplay=this.fullPathDisplay;this.treeView=this.querySelector(".treeView").connectController(LocalFileSystem_treeView,a);ConnectEvent("drop",this,this.onDrop_Folder,this)}_=LocalFileSystem_panel.prototype;
_.onDrop_Folder=function(a){this.treeView.data=a.dataTransfer.items[0].webkitGetAsEntry();console.log("this.treeView.data",this.treeView.data);this.treeView.loadNodeContent(null)};Extends(LocalFileSystem_treeView,TreeView);function LocalFileSystem_treeView(a){LocalFileSystem_treeView.superConstructor.call(this);this.appRef=a.appRef;this.fullPathDisplay=a.fullPathDisplay;this.data={};this.enableNodeDrag=!0}_=LocalFileSystem_treeView.prototype;
_.selectNode=function(a){LocalFileSystem_treeView.superClass.selectNode.call(this,a);this.fullPathDisplay.innerHTML=a.data.fullPath};_.deselectAllNodes=function(){LocalFileSystem_treeView.superClass.deselectAllNodes.call(this);this.fullPathDisplay.innerHTML=this.data.fullPath};_.expandNode=function(a){a.data.isDirectory&&(console.log("expandNode",a.data),a.classList.add(this.expandedNodeClassName),this.loadNodeContent(a))};
_.loadNodeContent=function(a){var b=this;LOCAL_FILE_SYSTEM.getDirEntryContent(a?a.data:this.data,function(){b.drawNodeContent(a)})};_.drawJsonSymbolList=function(a){for(var b,c=[],d=0;d<a.length;d++)b=a[d],c.push({urlPreview:b.fullPath});console.log(JSON.stringify(c))};
_.drawNodeContent=function(a){if(a){var b=this.getNodeElement_ul(a);a=a.data}else b=this,a=this.data;this.fullPathDisplay.innerHTML=a.fullPath;b.innerHTML="";if(a.items){for(var c,d,e=0;e<a.items.length;e++)c=a.items[e],c.parent=a,c.isDirectory?(d=this.createTreeViewNode("dir_icon16x16",c.name,c.fullPath,!0),d.setAttribute("itemType","dir")):(c.fileExtension=PathInfo(c.name).fileExtension,d=this.createTreeViewNode(c.fileExtension+"_icon16x16",c.name,c.fullPath,!1),d.setAttribute("itemType",c.fileExtension)),
d.data=c,b.appendChild(d),this.onNodeAdded(d);this.drawJsonSymbolList(a.items);this.hideLoadingState()}};_.onDoubleClickOnNodeName=function(a){a=a.target.parentNode;if(a.data.isDirectory)this.expandOrCollapseNode(a);else this.onDoubleClickOnDocument(a.data)};
function ColorPicker(){this.hsv={h:0,s:1,v:1};this.alpha=1;this.hue_panel=this.querySelector("#HUE_PANEL");this.hue_point=this.hue_panel.querySelector("#POINT");this.saturation_panel=this.querySelector("#SATURATION_PANEL");this.saturation_point=this.saturation_panel.querySelector("#POINT");this.alpha_panel=this.querySelector("#ALPHA_PANEL");this.alpha_point=this.alpha_panel.querySelector("#POINT");this.hexColor_input=this.querySelector("#HEX_COLOR_INPUT");this.colorView=this.querySelector("#COLOR_VIEW");
this.alphaGradientStopColorList=this.parentElement.querySelectorAll("#ALPHA_GRADIENT stop");this.saturationPanel=this.querySelector("#SATURATION_PANEL rect");this.onChangeStartFunction=this.onChangeFunction=this.onChangeEndFunction=null;this.connectEvents();this.update()}_=ColorPicker.prototype;_.onChangeStart=function(){if(this.onChangeStartFunction)this.onChangeStartFunction(this)};_.onChange=function(){if(this.onChangeFunction)this.onChangeFunction(this)};_.onChangeEnd=function(){if(this.onChangeEndFunction)this.onChangeEndFunction(this)};
_.onMouseDown_alphaPanel=function(a){this.onChangeStart();this.mouseEventTo_alphaPanel(a);this.mousePanelTarget=this.alpha_panel;GMOUSE.globalMouseTargetDelegate=this};_.onMouseDown_huePanel=function(a){this.onChangeStart();this.mouseEventTo_huePanel(a);this.mousePanelTarget=this.hue_panel;GMOUSE.globalMouseTargetDelegate=this};
_.onMouseDown_saturationPanel=function(a){this.onChangeStart();this.mouseEventTo_saturationPanel(a);this.mousePanelTarget=this.saturation_panel;GMOUSE.globalMouseTargetDelegate=this};_.mouseEventTo_alphaPanel=function(a){a=this.alpha_panel.screenToLocal(GMOUSE.mouseMovePt.x,GMOUSE.mouseMovePt.y);0>a.x&&(a.x=0);150<a.x&&(a.x=150);this.alpha=a.x/150;this.update()};
_.mouseEventTo_huePanel=function(a){a=this.hue_panel.screenToLocal(GMOUSE.mouseMovePt.x,GMOUSE.mouseMovePt.y);0>a.x&&(a.x=0);150<a.x&&(a.x=150);this.hsv.h=a.x/150;0==this.hsv.s&&(this.hsv.s=1);0==this.hsv.v&&(this.hsv.v=1);this.update()};_.mouseEventTo_saturationPanel=function(a){a=this.saturation_panel.screenToLocal(GMOUSE.mouseMovePt.x,GMOUSE.mouseMovePt.y);0>a.x&&(a.x=0);150<a.x&&(a.x=150);0>a.y&&(a.y=0);150<a.y&&(a.y=150);this.hsv.v=a.x/150;this.hsv.s=1-a.y/150;this.update()};
_.onGlobalMouseDrag=function(a){this.mousePanelTarget==this.hue_panel?this.mouseEventTo_huePanel(a):this.mousePanelTarget==this.saturation_panel?this.mouseEventTo_saturationPanel(a):this.mousePanelTarget==this.alpha_panel&&this.mouseEventTo_alphaPanel(a);this.onChange()};_.onGlobalMouseUp=function(a){this.onChangeEnd()};_.getColorAsHex=function(){var a=ColorUtils.hsvToRgb(this.hsv.h,this.hsv.s,this.hsv.v);return ColorUtils.rgbToHex(a.r,a.g,a.b)};
_.getColorAsRGBA=function(){var a=ColorUtils.hsvToRgb(this.hsv.h,this.hsv.s,this.hsv.v);a.a=this.alpha;return a};_.setColor=function(a,b){var c=ColorUtils.parseColorString(a);this.alpha=b||c.a;this.hsv=ColorUtils.rgbToHsv(c.r,c.g,c.b);this.update()};_.setOnChangeEvents=function(a,b,c){this.onChangeFunction=b;this.onChangeStartFunction=c;this.onChangeEndFunction=a};_.onChange_hexValue=function(a){this.setColor(this.hexColor_input.value,1);this.onChangeEnd()};
_.update=function(a){this.saturation_point.placeAt(150*this.hsv.v,150*(1-this.hsv.s));this.hue_point.placeAt(150*this.hsv.h,10);this.alpha_point.placeAt(150*this.alpha,10);a=ColorUtils.hsvToRgb(this.hsv.h,this.hsv.s,this.hsv.v);var b=ColorUtils.rgbToHex(a.r,a.g,a.b);this.hexColor_input.style.color=65>(100*a.r+100*a.g+100*a.b)/3?"#FFFFFF":"#000000";this.hexColor_input.value=b;this.colorView.setAttribute("fill",b);this.alphaGradientStopColorList[0].setAttribute("stop-color",b);this.alphaGradientStopColorList[1].setAttribute("stop-color",
b);a=ColorUtils.hsvToRgb(this.hsv.h,1,1);b=ColorUtils.rgbToHex(a.r,a.g,a.b);this.saturationPanel.setAttribute("fill",b)};var GoogleAuth;function onLoadGAPI(){gapi.load("client:auth2",initGoogleAuth)}function initGoogleAuth(a){console.log("initGoogleAuth");gapi.client.init({discoveryDocs:[DISCOVERY_URL],clientId:CLIENT_ID,scope:SCOPE}).then(function(){GoogleAuth=gapi.auth2.getAuthInstance();a&&GoogleAuth.isSignedIn.listen(a);updateSigninStatus()})}
function isGoogleUserSignedIn(){return GoogleAuth?GoogleAuth.currentUser.get().hasGrantedScopes(SCOPE):!1}function googleUserSignIn(a){GoogleAuth.isSignedIn.listen(a);GoogleAuth.signIn()}function googleUserSignOut(a){isGoogleUserSignedIn()&&GoogleAuth.signOut().then(a)}function refreshGoogleUserToken(a){console.log("refreshGoogleUserToken");GoogleAuth.isSignedIn.listen(a);GoogleAuth.currentUser.get().reloadAuthResponse().then(a,function(){alert("error")})}
function isGoogleUserTokenExpired(){var a=GoogleAuth.currentUser.get().getAuthResponse(),b=(new Date).getTime();console.log("isGoogleUserTokenExpired",b>a.expires_at);return b>a.expires_at?!0:!1}function updateSigninStatus(){isGoogleUserSignedIn()?console.log("You are currently signed in and have granted access to this app."):console.log("You have not authorized this app or you are signed out.")}
function whenGoogleUserWillBeAuthorizedCall(a){function b(b){console.log("onUserSignInResponse",b);a()}function c(b){console.log("onRefreshTokenResponse",b);a()}isGoogleUserSignedIn()?isGoogleUserTokenExpired()?refreshGoogleUserToken(c):a():googleUserSignIn(b)}function GDriveFileSystem_service(){}_=GDriveFileSystem_service.prototype;
_.getDirContent=function(a,b,c){function d(a,b){return a.name<b.name?-1:a.name>b.name?1:0}function e(c){c=c.result.files;a.items=c;for(var e=0;e<c.length;e++){var f=c[e];console.log("item",f);f.parent=a;f.fullPath=a.fullPath+"/"+f.name;"application/vnd.google-apps.folder"==f.mimeType&&(f.isDirectory=!0)}c.sort(d);b(a)}function f(a){console.error("Error: Dir content not available!",a);c&&c(a)}whenGoogleUserWillBeAuthorizedCall(function(){var b="'"+a.id+"' in parents and trashed = false";"sharedWithMe"==
a.id&&(b="sharedWithMe");gapi.client.drive.files.list({pageSize:1E3,fields:"nextPageToken, files(id,name,mimeType,modifiedTime,size,parents,iconLink,thumbnailLink,webContentLink,webViewLink,shared)",q:b}).then(e,f)})};
_.getFileContent=function(a,b,c,d){whenGoogleUserWillBeAuthorizedCall(function(){var e=GoogleAuth.currentUser.get().getAuthResponse().access_token,f=new XMLHttpRequest;f.open("GET","https://www.googleapis.com/drive/v3/files/"+a.id+"?alt=media",!0);f.setRequestHeader("Authorization","Bearer "+e);f.onload=function(a){b(a)};f.onerror=function(a){console.error("Error: File content not available!",a);c&&c(a)};if(d){var g={target:f,total:a.size,loaded:0,lengthComputable:!0};f.onprogress=function(a){g.loaded=
a.loaded;console.log("progressEvent",g);d(g)}}f.send()})};_.createDir=function(a,b,c,d){function e(a){c(a)}function f(a){console.error("Error: Dir not created!",a);d&&d(a)}whenGoogleUserWillBeAuthorizedCall(function(){gapi.client.drive.files.create({resource:{name:a,mimeType:"application/vnd.google-apps.folder",parents:[b]},fields:"id"}).then(e,f)})};
_.renameFile=function(a,b,c,d){function e(a){c(a)}function f(a){console.error("Error: File not renamed!",a);d&&d(a)}whenGoogleUserWillBeAuthorizedCall(function(){gapi.client.drive.files.update({resource:{name:b},fileId:a}).then(e,f)})};
_.moveFile=function(a,b,c,d){function e(a){c(a)}function f(a){console.error("Error: File not moved!",a);d&&d(a)}whenGoogleUserWillBeAuthorizedCall(function(){gapi.client.drive.files.update({fileId:a.id,addParents:b.id,removeParents:a.parent.id,fields:"id, parents"}).then(e,f)})};
_.deleteFile=function(a,b,c){function d(a){b(a)}function e(a){console.error("Error: File not deleted!",a);c&&c(a)}whenGoogleUserWillBeAuthorizedCall(function(){gapi.client.drive.files["delete"]({fileId:a.id,fields:"id"}).then(d,e)})};
_.getFileInFolder=function(a,b,c,d){function e(a){c(a)}function f(a){console.error("Error: on check for file in folder !",a);d&&d(a)}whenGoogleUserWillBeAuthorizedCall(function(){gapi.client.drive.files.list({pageSize:1,fields:"files(id,name,mimeType,modifiedTime,size,parents)",q:"'"+b+"' in parents and name = '"+a+"' and trashed = false"}).then(e,f)})};
_.updateFileContent=function(a,b,c,d,e,f,g){whenGoogleUserWillBeAuthorizedCall(function(){var g=GoogleAuth.currentUser.get().getAuthResponse().access_token,k=new XMLHttpRequest;k.responseType="json";k.onreadystatechange=function(){k.readyState!=XMLHttpRequest.DONE?console.log("onreadystatechange",k):!k.response||k.response.error?e(k):d(k.response)};k.open("PATCH","https://www.googleapis.com/upload/drive/v3/files/"+a+"?uploadType=media");k.setRequestHeader("Authorization","Bearer "+g);k.setRequestHeader("Content-Type",
b);k.upload.addEventListener("progress",function(a){f(a)},!1);k.send(c)})};_.createFile=function(a,b,c,d,e,f){a=a||"root";whenGoogleUserWillBeAuthorizedCall(function(){gapi.client.drive.files.create({name:c,parents:[a],mimeType:b}).then(function(a){console.log("createFile onSuccess",a);d(a)},function(a){e&&e(a)})})};Extends(GDriveBase_panel,Panel);
function GDriveBase_panel(a){GDriveBase_panel.superConstructor.call(this,a);this.loadingState=this.querySelector(".progress_icon");this.fileListDisplay=this.querySelector(".file-list");this.fullPathDisplay=this.querySelector(".full-path-display");this.fileListViewTemplate=document.querySelector(".templates .fileListViewTemplate");this.fileGridViewTemplate=document.querySelector(".templates .fileGridViewTemplate");this.activeFileViewTemplate=this.fileListViewTemplate;this.validFileExtensionList=this.onClickCancelCallback=
this.onClickOkCallback=null;this.service=GDRIVE_SERVICE;this.data={};this.data.id="root";this.data.fullPath="gdrive";this.currentDirData=this.data;ConnectEvent("mousedown",this.fileListDisplay,this.onMouseDownOnFileList,this);ConnectEvent("mouseup",this.fileListDisplay,this.onMouseUpOnFileList,this)}_=GDriveBase_panel.prototype;_.onMouseDownOnFileList=function(a){a.target.data&&(SelectElement(a.target),this.lastMouseDownTime=(new Date).getTime())};
_.onMouseUpOnFileList=function(a){if(a.target.data){if(this.isMouseHold())this.onMouseHoldOnFileView(a);if(this.isDoubleClick())this.onDoubleClickOnFileView(a)}};_.isMouseHold=function(){return 250<(new Date).getTime()-this.lastMouseDownTime?!0:!1};_.onMouseHoldOnFileView=function(a){this.editFileName(a.target)};_.isDoubleClick=function(){var a=(new Date).getTime();if(250>a-this.lastMouseUpTime)return!0;this.lastMouseUpTime=a;return!1};
_.onDoubleClickOnFileView=function(a){a.target.data.isDirectory&&this.loadDirContent(a.target.data)};_.showLoadingState=function(){this.loadingState&&this.loadingState.classList.remove("hidden")};_.hideLoadingState=function(){this.loadingState&&this.loadingState.classList.add("hidden")};_.onClick_ok=function(a){if(this.onClickOkCallback)this.onClickOkCallback()};_.onClick_cancel=function(a){if(this.onClickCancelCallback)this.onClickCancelCallback();this.close()};
_.onClick_gotoParentDir=function(a){this.currentDirData.parent&&this.loadDirContent(this.currentDirData.parent)};_.isValidFileType=function(a){a=PathInfo(a.name).fileExtension;return-1<this.validFileExtensionList.indexOf(a)?!0:!1};_.validateFileNameExtension=function(a){a=PathInfo(a);console.log("PathInfo",a);if(""==a.fileExtension||-1==this.validFileExtensionList.indexOf(a.fileExtension))a.fileExtension=this.validFileExtensionList[0];return a.fileNameNoExtension+"."+a.fileExtension};
_.loadDirContent=function(a){var b=this;GDRIVE_SERVICE.getDirContent(a,function(a){b.hideLoadingState();b.drawDirContent(a)});this.showLoadingState()};
_.drawDirContent=function(a){function b(a){if(a.data.isDirectory)var b=a.data.shared?"sharedDir_icon16x16":"dir_icon16x16";else if(b=PathInfo(a.data.name).fileExtension+"_icon16x16",a.data.size){var c=a.querySelector(".file-size");var d=a.data.size;d=1E9<d?(d/1E9).toPrecision(3)+" GB":1E6<d?(d/1E6).toPrecision(3)+" MB":1E3<d?(d/1E3).toPrecision(3)+" KB":d+" byte";c.innerHTML=d}a.querySelector(".thumbnail").classList.add(b);b=(new Date(a.data.modifiedTime)).toLocaleString().split(",")[0];a.querySelector(".modified-date").innerHTML=
b}function c(a){var b=a.querySelector(".thumbnail");a.data.isDirectory?b.classList.add("folder"):b.setAttribute("style",'background-color:white; background-image: url("'+a.data.thumbnailLink+'");')}this.currentDirData=a||this.currentDirData;this.fullPathDisplay.innerHTML=this.currentDirData.fullPath;this.fileListDisplay.innerHTML="";this.currentDirData.items&&(this.activeFileViewTemplate==this.fileListViewTemplate?DrawData(this.currentDirData.items,this.fileListDisplay,this.activeFileViewTemplate,
null,b):this.activeFileViewTemplate==this.fileGridViewTemplate&&DrawData(this.currentDirData.items,this.fileListDisplay,this.activeFileViewTemplate,null,c))};_.onClick_itemList=function(a){SelectElement(a.target);this.activeFileViewTemplate=this.fileListViewTemplate;this.drawDirContent()};_.onClick_itemGrid=function(a){SelectElement(a.target);this.activeFileViewTemplate=this.fileGridViewTemplate;this.drawDirContent()};_.onClick_createDir=function(a){this.createDir(a)};
_.onClick_removeSelectedFile=function(a){this.removeFile()};_.onClick_reloadCurrentDir=function(a){this.loadDirContent(this.currentDirData)};_.onClick_gotoGDriveDir=function(a){this.data={};this.data.id="root";this.data.fullPath="gdrive";this.currentDirData=this.data;this.loadDirContent(this.currentDirData)};_.onClick_gotoSharedWithMeDir=function(a){this.data={};this.data.id="sharedWithMe";this.data.fullPath="sharedWithMe";this.currentDirData=this.data;this.loadDirContent(this.currentDirData)};
_.editFileName=function(a){var b=a.querySelector('[ name="name"]');a=b.textContent;b.removeChildren();var c=document.createElement("input");c.setAttribute("type","text");c.setAttribute("value",a);c.previousValue=a;var d=this;ConnectEvent("change",c,function(a){this.blur()});ConnectEvent("blur",c,function(a){this.value!=this.previousValue&&(b.innerHTML=d.onEndEditFileName(this));b.innerHTML=this.value});b.appendChild(c);c.focus()};
_.onEndEditFileName=function(a){var b=a.parentElement.parentElement;console.log("onEndEditFileName element_li",b);if("LI"==b.nodeName){var c=a.value;console.log("element_input.value",a.value);console.log("element_input.parentElement",a.parentElement);c.isValidFileName()?(console.log("element_li.data.name",b.data.name),this.renameFile(c,b)):(a.value=b.data.name,console.log("file name non valido"),console.log("ripristino il nome con:",b.data.name))}};
_.renameFile=function(a,b){function c(a){e.hideLoadingState();e.onFileRenamed(b)}function d(){h.innerHTML=f;e.hideLoadingState();e.appRef.alertModalDialog.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occurred during the rename file operation."))}var e=this,f=b.data.name,g=b.data.parent;console.log("_newFileName",a);console.log("_element_li",b);var h=b.querySelector('[ name="name"]');GDRIVE_SERVICE.getFileInFolder(a,g.id,function(k){0<k.result.files.length?(e.appRef.alertModalDialog.open(LOCALIZER.translate("Error"),
LOCALIZER.translate("The folder")+' "'+g.name+'" '+LOCALIZER.translate("already contains a file named")+": "+a),h.innerHTML=f,e.hideLoadingState()):GDRIVE_SERVICE.renameFile(b.data.id,a,c,d)});this.showLoadingState()};
_.onFileRenamed=function(a){var b=a.querySelector('[ name="name"]').textContent,c=a.data.fullPath.split("/");c.pop();c=c.join("/")+"/"+b;a.data.name=b;a.data.fullPath=c;console.log("element_li.data",a.data);a.data.isDirectory||(a.data.fileExtension=b.split(".").pop(),b=this.appRef.getActiveDocument(),b.idFile&&b.idFile==a.data.id&&this.appRef.setDocumentTitle(a.data.name))};
_.createDir=function(a){function b(){var a=l;0<g&&(a+=" "+g);return a}function c(){k.hideLoadingState();k.loadDirContent(k.currentDirData)}function d(){k.appRef.alertModalDialog.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The directory was not created, the server has generated an error."));k.hideLoadingState()}function e(a){0<a.result.files.length?(g++,f()):GDRIVE_SERVICE.createDir(b(),h.id,c,d)}function f(){10<g||GDRIVE_SERVICE.getFileInFolder(b(),h.id,e)}var g=0,h=this.currentDirData,
k=this,l=LOCALIZER.translate("new directory");g=0;f();this.showLoadingState()};
_.removeFile=function(){var a=this.fileListDisplay.querySelectorAll(".selected");if(0==a.length)this.appRef.alertModalDialog.open(LOCALIZER.translate("Message"),LOCALIZER.translate("Please select the file you want to remove."));else{var b=a[0],c=this;this.appRef.confirmModalDialog.open("Remove file","Are you sure want to remove the file/folder: "+b.data.fullPath,function(){GDRIVE_SERVICE.deleteFile(b.data,function(a){console.log("onRemoveFile",a);c.hideLoadingState();b.remove()},function(){c.hideLoadingState();
c.appRef.alertModalDialog.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occurred during the remove file operation."))});c.showLoadingState()})}};Extends(GDriveOpen_panel,GDriveBase_panel);function GDriveOpen_panel(a){GDriveOpen_panel.superConstructor.call(this,a);this.connectEvents()}_=GDriveOpen_panel.prototype;
_.open=function(a,b,c,d){GDriveOpen_panel.superClass.open.call(this,!0);this.validFileExtensionList=b;this.fullPath=a||"root";this.onClickOkCallback=c;this.onClickCancelCallback=d;this.loadDirContent(this.currentDirData)};_.onClick_open=function(a){this.openSelectedDocument()};_.onDoubleClickOnFileView=function(a){a.target.data.isDirectory?this.loadDirContent(a.target.data):this.openSelectedDocument(a.target.data)};
_.openSelectedDocument=function(){var a=this.fileListDisplay.querySelector(".selected").data;if(this.appRef.getActiveDocument().idFile==a.id)return this.appRef.alertModalDialog.open(LOCALIZER.translate("Message"),LOCALIZER.translate("The file is already open.")),!1;this.isValidFileType(a)?(this.close(),this.appRef.loadDocumentFromGoogleDrive(a)):this.appRef.alertModalDialog.open(LOCALIZER.translate("Unsupported file type"),LOCALIZER.translate("You can open only: "+this.validFileExtensionList.join(",")))};
Extends(GDriveSave_panel,GDriveBase_panel);function GDriveSave_panel(a){GDriveSave_panel.superConstructor.call(this,a);this.fileNameInputField=this.querySelector(".file-name-display input");this.connectEvents()}_=GDriveSave_panel.prototype;_.open=function(a,b,c,d,e){GDriveSave_panel.superClass.open.call(this,!0);this.validFileExtensionList=c;this.fileNameInputField.value=this.validateFileNameExtension(b);this.fullPath=a||"root";this.onClickOkCallback=d;this.onClickCancelCallback=e;this.loadDirContent(this.currentDirData)};
_.onChange_fileNameInputField=function(a){this.fileNameInputField.value=this.validateFileNameExtension(this.fileNameInputField.value)};_.getTargetFileFullPath=function(a){return this.currentDirData.fullPath+"/"+this.fileNameInputField.value};_.onMouseDownOnFileList=function(a){GDriveSave_panel.superClass.onMouseDownOnFileList.call(this,a);a.target.data&&!a.target.data.isDirectory&&(this.fileNameInputField.value=a.target.data.name)};
_.saveData=function(a,b,c){function d(){k.close();l.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The file was not saved, try again."))}function e(){c({idFile:m,fileName:h.fileNameInputField.value})}function f(a){k.onLoadingProgress(a)}function g(c){c?(m=c,GDRIVE_SERVICE.updateFileContent(c,b,a,e,d,f,!0)):GDRIVE_SERVICE.createFile(h.currentDirData.id,b,h.fileNameInputField.value,function(c){console.log("onFileCreateSuccess",c);m=c.result.id;c.result&&c.result.id&&GDRIVE_SERVICE.updateFileContent(m,
b,a,e,d,f)},function(){k.close();l.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The file was not saved, try again."))},!0)}var h=this,k=this.appRef.progressPanel,l=this.appRef.alertModalDialog,n=this.appRef.confirmModalDialog,m=null;GDRIVE_SERVICE.getFileInFolder(h.fileNameInputField.value,h.currentDirData.id,function(a){0<a.result.files.length?a.result.files[0].isDirectory?(k.close(),l.open(LOCALIZER.translate("Error"),LOCALIZER.translate("A folder named:")+" "+h.fileNameInputField.value+
" "+LOCALIZER.translate("can't be replaced by a file!"))):n.open(LOCALIZER.translate("File exists"),LOCALIZER.translate("The folder")+' "'+h.currentDirData.name+'" '+LOCALIZER.translate("already contains a file named")+' "'+h.fileNameInputField.value+'".\n'+LOCALIZER.translate("Do you want to replace it?"),function(){g(a.result.files[0].id)}):g()});h.close();k.setProgressBarValue(1);k.open(!0)};Extends(GDriveImport_panel,GDriveBase_panel);
function GDriveImport_panel(a){GDriveImport_panel.superConstructor.call(this,a);this.connectEvents()}_=GDriveImport_panel.prototype;_.open=function(a,b,c,d){GDriveImport_panel.superClass.open.call(this,!0);this.validFileExtensionList=b;this.fullPath=a||"root";this.onClickOkCallback=c;this.onClickCancelCallback=d;this.loadDirContent(this.currentDirData)};_.onClick_import=function(a){this.importSelectedFile()};
_.onDoubleClickOnFileView=function(a){a.target.data.isDirectory?this.loadDirContent(a.target.data):this.importSelectedFile(a.target.data)};_.importSelectedFile=function(){var a=this.fileListDisplay.querySelector(".selected").data;this.isValidFileType(a)?(this.close(),this.appRef.importFileFromGoogleDrive(a)):this.appRef.alertModalDialog.open(LOCALIZER.translate("Unsupported file type"),LOCALIZER.translate("You can import only: "+this.validFileExtensionList.join(",")))};
SVGPathElement.prototype.getPathData&&SVGPathElement.prototype.setPathData||function(){var a={Z:"Z",M:"M",L:"L",C:"C",Q:"Q",A:"A",H:"H",V:"V",S:"S",T:"T",z:"Z",m:"m",l:"l",c:"c",q:"q",a:"a",h:"h",v:"v",s:"s",t:"t"},b=function(a){this._string=a;this._currentIndex=0;this._endIndex=this._string.length;this._prevCommand=null;this._skipOptionalSpaces()},c=-1!==window.navigator.userAgent.indexOf("MSIE ");b.prototype={parseSegment:function(){var b=this._string[this._currentIndex],c=a[b]?a[b]:null;if(null===
c){if(null===this._prevCommand)return null;c=("+"===b||"-"===b||"."===b||"0"<=b&&"9">=b)&&"Z"!==this._prevCommand?"M"===this._prevCommand?"L":"m"===this._prevCommand?"l":this._prevCommand:null;if(null===c)return null}else this._currentIndex+=1;this._prevCommand=c;b=null;var d=c.toUpperCase();"H"===d||"V"===d?b=[this._parseNumber()]:"M"===d||"L"===d||"T"===d?b=[this._parseNumber(),this._parseNumber()]:"S"===d||"Q"===d?b=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()]:
"C"===d?b=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()]:"A"===d?b=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseArcFlag(),this._parseArcFlag(),this._parseNumber(),this._parseNumber()]:"Z"===d&&(this._skipOptionalSpaces(),b=[]);return null===b||0<=b.indexOf(null)?null:{type:c,values:b}},hasMoreData:function(){return this._currentIndex<this._endIndex},peekSegmentType:function(){var b=this._string[this._currentIndex];
return a[b]?a[b]:null},initialCommandIsMoveTo:function(){if(!this.hasMoreData())return!0;var a=this.peekSegmentType();return"M"===a||"m"===a},_isCurrentSpace:function(){var a=this._string[this._currentIndex];return" ">=a&&(" "===a||"\n"===a||"\t"===a||"\r"===a||"\f"===a)},_skipOptionalSpaces:function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex+=1;return this._currentIndex<this._endIndex},_skipOptionalSpacesOrDelimiter:function(){if(this._currentIndex<this._endIndex&&
!this._isCurrentSpace()&&","!==this._string[this._currentIndex])return!1;this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","===this._string[this._currentIndex]&&(this._currentIndex+=1,this._skipOptionalSpaces());return this._currentIndex<this._endIndex},_parseNumber:function(){var a=0,b=0,c=1,d=0,e=1,f=1,g=this._currentIndex;this._skipOptionalSpaces();this._currentIndex<this._endIndex&&"+"===this._string[this._currentIndex]?this._currentIndex+=1:this._currentIndex<this._endIndex&&"-"===
this._string[this._currentIndex]&&(this._currentIndex+=1,e=-1);if(this._currentIndex===this._endIndex||("0">this._string[this._currentIndex]||"9"<this._string[this._currentIndex])&&"."!==this._string[this._currentIndex])return null;for(var h=this._currentIndex;this._currentIndex<this._endIndex&&"0"<=this._string[this._currentIndex]&&"9">=this._string[this._currentIndex];)this._currentIndex+=1;if(this._currentIndex!==h)for(var k=this._currentIndex-1,l=1;k>=h;)b+=l*(this._string[k]-0),--k,l*=10;if(this._currentIndex<
this._endIndex&&"."===this._string[this._currentIndex]){this._currentIndex+=1;if(this._currentIndex>=this._endIndex||"0">this._string[this._currentIndex]||"9"<this._string[this._currentIndex])return null;for(;this._currentIndex<this._endIndex&&"0"<=this._string[this._currentIndex]&&"9">=this._string[this._currentIndex];)c*=10,d+=(this._string.charAt(this._currentIndex)-0)/c,this._currentIndex+=1}if(this._currentIndex!==g&&this._currentIndex+1<this._endIndex&&("e"===this._string[this._currentIndex]||
"E"===this._string[this._currentIndex])&&"x"!==this._string[this._currentIndex+1]&&"m"!==this._string[this._currentIndex+1]){this._currentIndex+=1;"+"===this._string[this._currentIndex]?this._currentIndex+=1:"-"===this._string[this._currentIndex]&&(this._currentIndex+=1,f=-1);if(this._currentIndex>=this._endIndex||"0">this._string[this._currentIndex]||"9"<this._string[this._currentIndex])return null;for(;this._currentIndex<this._endIndex&&"0"<=this._string[this._currentIndex]&&"9">=this._string[this._currentIndex];)a*=
10,a+=this._string[this._currentIndex]-0,this._currentIndex+=1}b=(b+d)*e;a&&(b*=Math.pow(10,f*a));if(g===this._currentIndex)return null;this._skipOptionalSpacesOrDelimiter();return b},_parseArcFlag:function(){if(this._currentIndex>=this._endIndex)return null;var a=this._string[this._currentIndex];this._currentIndex+=1;if("0"===a)a=0;else if("1"===a)a=1;else return null;this._skipOptionalSpacesOrDelimiter();return a}};var d=SVGPathElement.prototype.setAttribute,e=SVGPathElement.prototype.removeAttribute;
$jscomp.initSymbol();var f=window.Symbol?Symbol():"__cachedPathData";$jscomp.initSymbol();var g=window.Symbol?Symbol():"__cachedNormalizedPathData",h=function(a,b,c,d,e,f,g,k,l,Ba){var m=function(a,b,c){return{x:a*Math.cos(c)-b*Math.sin(c),y:a*Math.sin(c)+b*Math.cos(c)}},n=Math.PI*g/180,p=[];if(Ba){var y=Ba[0];k=Ba[1];var P=Ba[2];var E=Ba[3]}else{b=m(a,b,-n);a=b.x;b=b.y;d=m(c,d,-n);c=d.x;d=d.y;y=(a-c)/2;P=(b-d)/2;E=y*y/(e*e)+P*P/(f*f);1<E&&(E=Math.sqrt(E),e*=E,f*=E);E=e*e;var v=f*f;k=(k===l?-1:1)*
Math.sqrt(Math.abs((E*v-E*P*P-v*y*y)/(E*P*P+v*y*y)));P=k*e*P/f+(a+c)/2;E=k*-f*y/e+(b+d)/2;y=Math.asin(parseFloat(((b-E)/f).toFixed(9)));k=Math.asin(parseFloat(((d-E)/f).toFixed(9)));a<P&&(y=Math.PI-y);c<P&&(k=Math.PI-k);0>y&&(y=2*Math.PI+y);0>k&&(k=2*Math.PI+k);l&&y>k&&(y-=2*Math.PI);!l&&k>y&&(k-=2*Math.PI)}if(Math.abs(k-y)>120*Math.PI/180){p=k;v=c;var Ia=d;k=l&&k>y?y+120*Math.PI/180:y+120*Math.PI/180*-1;c=P+e*Math.cos(k);d=E+f*Math.sin(k);p=h(c,d,v,Ia,e,f,g,0,l,[k,p,P,E])}g=Math.tan((k-y)/4);e=4/
3*e*g;g*=4/3*f;f=[a,b];a=[a+e*Math.sin(y),b-g*Math.cos(y)];e=[c+e*Math.sin(k),d-g*Math.cos(k)];c=[c,d];a[0]=2*f[0]-a[0];a[1]=2*f[1]-a[1];if(Ba)return[a,e,c].concat(p);p=[a,e,c].concat(p);Ba=[];for(c=0;c<p.length;c+=3)e=m(p[c][0],p[c][1],n),f=m(p[c+1][0],p[c+1][1],n),d=m(p[c+2][0],p[c+2][1],n),Ba.push([e.x,e.y,f.x,f.y,d.x,d.y]);return Ba},k=function(a){var b=[],c=null,d=null,e=null,f=null;a.forEach(function(a){var g=a.type;if("M"===g){g=a.values[0];var h=a.values[1];b.push({type:"M",values:[g,h]});
e=g;f=h;c=g;d=h}else if("m"===g)g=c+a.values[0],h=d+a.values[1],b.push({type:"M",values:[g,h]}),e=g,f=h,c=g,d=h;else if("L"===g)g=a.values[0],h=a.values[1],b.push({type:"L",values:[g,h]}),c=g,d=h;else if("l"===g)g=c+a.values[0],h=d+a.values[1],b.push({type:"L",values:[g,h]}),c=g,d=h;else if("C"===g){var k=a.values[0],m=a.values[1],l=a.values[2],n=a.values[3];g=a.values[4];h=a.values[5];b.push({type:"C",values:[k,m,l,n,g,h]});c=g;d=h}else if("c"===g)k=c+a.values[0],m=d+a.values[1],l=c+a.values[2],
n=d+a.values[3],g=c+a.values[4],h=d+a.values[5],b.push({type:"C",values:[k,m,l,n,g,h]}),c=g,d=h;else if("Q"===g)k=a.values[0],m=a.values[1],g=a.values[2],h=a.values[3],b.push({type:"Q",values:[k,m,g,h]}),c=g,d=h;else if("q"===g)k=c+a.values[0],m=d+a.values[1],g=c+a.values[2],h=d+a.values[3],b.push({type:"Q",values:[k,m,g,h]}),c=g,d=h;else if("A"===g)g=a.values[5],h=a.values[6],b.push({type:"A",values:[a.values[0],a.values[1],a.values[2],a.values[3],a.values[4],g,h]}),c=g,d=h;else if("a"===g)g=c+a.values[5],
h=d+a.values[6],b.push({type:"A",values:[a.values[0],a.values[1],a.values[2],a.values[3],a.values[4],g,h]}),c=g,d=h;else if("H"===g)g=a.values[0],b.push({type:"H",values:[g]}),c=g;else if("h"===g)g=c+a.values[0],b.push({type:"H",values:[g]}),c=g;else if("V"===g)h=a.values[0],b.push({type:"V",values:[h]}),d=h;else if("v"===g)h=d+a.values[0],b.push({type:"V",values:[h]}),d=h;else if("S"===g)l=a.values[0],n=a.values[1],g=a.values[2],h=a.values[3],b.push({type:"S",values:[l,n,g,h]}),c=g,d=h;else if("s"===
g)l=c+a.values[0],n=d+a.values[1],g=c+a.values[2],h=d+a.values[3],b.push({type:"S",values:[l,n,g,h]}),c=g,d=h;else if("T"===g)g=a.values[0],h=a.values[1],b.push({type:"T",values:[g,h]}),c=g,d=h;else if("t"===g)g=c+a.values[0],h=d+a.values[1],b.push({type:"T",values:[g,h]}),c=g,d=h;else if("Z"===g||"z"===g)b.push({type:"Z",values:[]}),c=e,d=f});return b},l=function(a){var b=[],c=null,d=null,e=null,f=null,g=null,k=null,l=null;a.forEach(function(a){if("M"===a.type){var m=a.values[0],n=a.values[1];b.push({type:"M",
values:[m,n]});k=m;l=n;f=m;g=n}else if("C"===a.type){var p=a.values[0],y=a.values[1],E=a.values[2],K=a.values[3];m=a.values[4];n=a.values[5];b.push({type:"C",values:[p,y,E,K,m,n]});d=E;e=K;f=m;g=n}else if("L"===a.type)m=a.values[0],n=a.values[1],b.push({type:"L",values:[m,n]}),f=m,g=n;else if("H"===a.type)m=a.values[0],b.push({type:"L",values:[m,g]}),f=m;else if("V"===a.type)n=a.values[0],b.push({type:"L",values:[f,n]}),g=n;else if("S"===a.type){E=a.values[0];K=a.values[1];m=a.values[2];n=a.values[3];
if("C"===c||"S"===c){var v=f+(f-d);var P=g+(g-e)}else v=f,P=g;b.push({type:"C",values:[v,P,E,K,m,n]});d=E;e=K;f=m;g=n}else if("T"===a.type)m=a.values[0],n=a.values[1],"Q"===c||"T"===c?(p=f+(f-d),y=g+(g-e)):(p=f,y=g),v=f+2*(p-f)/3,P=g+2*(y-g)/3,b.push({type:"C",values:[v,P,m+2*(p-m)/3,n+2*(y-n)/3,m,n]}),d=p,e=y,f=m,g=n;else if("Q"===a.type)p=a.values[0],y=a.values[1],m=a.values[2],n=a.values[3],v=f+2*(p-f)/3,P=g+2*(y-g)/3,b.push({type:"C",values:[v,P,m+2*(p-m)/3,n+2*(y-n)/3,m,n]}),d=p,e=y,f=m,g=n;
else if("A"===a.type)if(p=Math.abs(a.values[0]),y=Math.abs(a.values[1]),E=a.values[2],K=a.values[3],v=a.values[4],m=a.values[5],n=a.values[6],0===p||0===y)b.push({type:"C",values:[f,g,m,n,m,n]}),f=m,g=n;else{if(f!==m||g!==n)h(f,g,m,n,p,y,E,K,v).forEach(function(a){b.push({type:"C",values:a})}),f=m,g=n}else"Z"===a.type&&(b.push(a),f=k,g=l);c=a.type});return b};SVGPathElement.prototype.setAttribute=function(a,b){"d"===a&&(this[f]=null,this[g]=null);d.call(this,a,b)};SVGPathElement.prototype.removeAttribute=
function(a,b){"d"===a&&(this[f]=null,this[g]=null);e.call(this,a)};SVGPathElement.prototype.getPathData=function(a){var c;if((c=this.getAttribute("d")||"")&&0!==c.length){c=new b(c);var d=[];if(c.initialCommandIsMoveTo())for(;c.hasMoreData();){var e=c.parseSegment();if(null===e)break;else d.push(e)}c=d}else c=[];a||(a={normalize:!0});return a&&a.normalize?l(k(c)):c};SVGPathElement.prototype.setPathData=function(a){if(0===a.length)c?this.setAttribute("d",""):this.removeAttribute("d");else{for(var b=
"",d=0,e=a.length;d<e;d+=1){var f=a[d];0<d&&(b+=" ");b+=f.type;f.values&&0<f.values.length&&(b+=" "+f.values.join(" "))}this.setAttribute("d",b)}};SVGRectElement.prototype.getPathData=function(a){var b=this.x.baseVal.value,c=this.y.baseVal.value,d=this.width.baseVal.value,e=this.height.baseVal.value,f=this.hasAttribute("rx")?this.rx.baseVal.value:this.ry.baseVal.value,g=this.hasAttribute("ry")?this.ry.baseVal.value:this.rx.baseVal.value;f>d/2&&(f=d/2);g>e/2&&(g=e/2);b=[{type:"M",values:[b+f,c]},{type:"H",
values:[b+d-f]},{type:"A",values:[f,g,0,0,1,b+d,c+g]},{type:"V",values:[c+e-g]},{type:"A",values:[f,g,0,0,1,b+d-f,c+e]},{type:"H",values:[b+f]},{type:"A",values:[f,g,0,0,1,b,c+e-g]},{type:"V",values:[c+g]},{type:"A",values:[f,g,0,0,1,b+f,c]},{type:"Z",values:[]}];b=b.filter(function(a){return"A"!==a.type||0!==a.values[0]&&0!==a.values[1]?!0:!1});a&&!0===a.normalize&&(b=l(b));return b};SVGCircleElement.prototype.getPathData=function(a){var b=this.cx.baseVal.value,c=this.cy.baseVal.value,d=this.r.baseVal.value;
b=[{type:"M",values:[b+d,c]},{type:"A",values:[d,d,0,0,1,b,c+d]},{type:"A",values:[d,d,0,0,1,b-d,c]},{type:"A",values:[d,d,0,0,1,b,c-d]},{type:"A",values:[d,d,0,0,1,b+d,c]},{type:"Z",values:[]}];a&&!0===a.normalize&&(b=l(b));return b};SVGEllipseElement.prototype.getPathData=function(a){var b=this.cx.baseVal.value,c=this.cy.baseVal.value,d=this.rx.baseVal.value,e=this.ry.baseVal.value;b=[{type:"M",values:[b+d,c]},{type:"A",values:[d,e,0,0,1,b,c+e]},{type:"A",values:[d,e,0,0,1,b-d,c]},{type:"A",values:[d,
e,0,0,1,b,c-e]},{type:"A",values:[d,e,0,0,1,b+d,c]},{type:"Z",values:[]}];a&&!0===a.normalize&&(b=l(b));return b};SVGLineElement.prototype.getPathData=function(){return[{type:"M",values:[this.x1.baseVal.value,this.y1.baseVal.value]},{type:"L",values:[this.x2.baseVal.value,this.y2.baseVal.value]}]};SVGPolylineElement.prototype.getPathData=function(){for(var a=[],b=0;b<this.points.numberOfItems;b+=1){var c=this.points.getItem(b);a.push({type:0===b?"M":"L",values:[c.x,c.y]})}return a};SVGPolygonElement.prototype.getPathData=
function(){for(var a=[],b=0;b<this.points.numberOfItems;b+=1){var c=this.points.getItem(b);a.push({type:0===b?"M":"L",values:[c.x,c.y]})}a.push({type:"Z",values:[]});return a}}();
var paper=function(a,b){a=a||require("./node/self.js");var c=a.window,d=a.document,e=new function(){function a(a,b,e,f,g){function B(d,B){B=B||(B=h(b,d))&&(B.get?B:B.value);"string"===typeof B&&"#"===B[0]&&(B=a[B.substring(1)]||B);var F="function"===typeof B,t=B,w=g||F&&!B.base?B&&B.get?d in a:a[d]:null,x;g&&w||(F&&w&&(B.base=w),F&&!1!==f&&(x=d.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(M[x[3].toLowerCase()+x[4]]=x[2]),t&&!F&&t.get&&"function"===typeof t.get&&c.isPlainObject(t)||(t={value:t,writable:!0}),
(h(a,d)||{configurable:!0}).configurable&&(t.configurable=!0,t.enumerable=null!=e?e:!x),k(a,d,t))}var M={};if(b){for(var F in b)b.hasOwnProperty(F)&&!d.test(F)&&B(F);for(F in M){var x=M[F],da=a["set"+x];x=a["get"+x]||da&&a["is"+x];!x||!0!==f&&0!==x.length||B(F,{get:x,set:da})}}return a}function c(){for(var a=0,b=arguments.length;a<b;a++){var c=arguments[a];c&&m(this,c)}return this}var d=/^(statics|enumerable|beans|preserve)$/,e=[],f=e.slice,g=Object.create,h=Object.getOwnPropertyDescriptor,k=Object.defineProperty,
ma=e.forEach||function(a,b){for(var c=0,d=this.length;c<d;c++)a.call(b,this[c],c,this)},l=function(a,b){for(var c in this)this.hasOwnProperty(c)&&a.call(b,this[c],c,this)},m=Object.assign||function(a){for(var b=1,c=arguments.length;b<c;b++){var d=arguments[b],e;for(e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a},$b=function(a,b,c){if(a){var d=h(a,"length");(d&&"number"===typeof d.value?ma:l).call(a,b,c=c||a)}return c};return a(c,{inject:function(b){if(b){var c=!0===b.statics?b:b.statics,d=b.beans,
e=b.preserve;c!==b&&a(this.prototype,b,b.enumerable,d,e);a(this,c,null,d,e)}c=1;for(d=arguments.length;c<d;c++)this.inject(arguments[c]);return this},extend:function(){for(var b=this,c,d,e=0,f,h=arguments.length;e<h&&(!c||!d);e++)f=arguments[e],c=c||f.initialize,d=d||f.prototype;c=c||function(){b.apply(this,arguments)};d=c.prototype=d||g(this.prototype);k(d,"constructor",{value:c,writable:!0,configurable:!0});a(c,this);arguments.length&&this.inject.apply(c,arguments);c.base=b;return c}}).inject({enumerable:!1,
initialize:c,set:c,inject:function(){for(var b=0,c=arguments.length;b<c;b++){var d=arguments[b];d&&a(this,d,d.enumerable,d.beans,d.preserve)}return this},extend:function(){var a=g(this);return a.inject.apply(a,arguments)},each:function(a,b){return $b(this,a,b)},clone:function(){return new this.constructor(this)},statics:{set:m,each:$b,create:g,define:k,describe:h,clone:function(a){return m(new a.constructor,a)},isPlainObject:function(a){return(a=null!=a&&a.constructor)&&(a===Object||a===c||"Object"===
a.name)},pick:function(a,c){return a!==b?a:c},slice:function(a,b,c){return f.call(a,b,c)}}})};"undefined"!==typeof module&&(module.exports=e);e.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+e.each(this,function(a,b){if(!/^_/.test(b)){var c=typeof a;this.push(b+": "+("number"===c?k.instance.number(a):"string"===c?"'"+a+"'":a))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(a){return e.importJSON(a,
this)},exportJSON:function(a){return e.exportJSON(this,a)},toJSON:function(){return e.serialize(this)},set:function(a,b){a&&e.filter(this,a,b,this._prioritize);return this}},{beans:!1,statics:{exports:{},extend:function Db(){var a=Db.base.apply(this,arguments),b=a.prototype._class;b&&!e.exports[b]&&(e.exports[b]=a);return a},equals:function(a,b){if(a===b)return!0;if(a&&a.equals)return a.equals(b);if(b&&b.equals)return b.equals(a);if(a&&b&&"object"===typeof a&&"object"===typeof b){if(Array.isArray(a)&&
Array.isArray(b)){var c=a.length;if(c!==b.length)return!1;for(;c--;)if(!e.equals(a[c],b[c]))return!1}else{var d=Object.keys(a);c=d.length;if(c!==Object.keys(b).length)return!1;for(;c--;){var f=d[c];if(!b.hasOwnProperty(f)||!e.equals(a[f],b[f]))return!1}}return!0}return!1},read:function(a,c,d,f){if(this===e)return d=this.peek(a,c),a.__index++,d;var g=this.prototype,h=g._readIndex,k=c||h&&a.__index||0,ma=a.length;c=a[k];f=f||ma-k;if(c instanceof this||d&&d.readNull&&null==c&&1>=f)return h&&(a.__index=
k+1),c&&d&&d.clone?c.clone():c;c=e.create(g);h&&(c.__read=!0);c=c.initialize.apply(c,0<k||k+f<ma?e.slice(a,k,k+f):a)||c;if(h){a.__index=k+c.__read;if(d=c.__filtered)a.__filtered=d,c.__filtered=b;c.__read=b}return c},peek:function(a,b){return a[a.__index=b||a.__index||0]},remain:function(a){return a.length-(a.__index||0)},readList:function(a,b,c,d){var e=[],f;b=b||0;for(d=d?b+d:a.length;b<d;b++)e.push(Array.isArray(f=a[b])?this.read(f,0,c):this.read(a,b,c,1));return e},readNamed:function(a,c,d,f,g){var h=
this.getNamed(a,c),k=h!==b;if(k){var ma=a.__filtered;ma||(ma=a.__filtered=e.create(a[0]),ma.__unfiltered=a[0]);ma[c]=b}return this.read(k?[h]:a,d,f,g)},getNamed:function(a,c){var d=a[0];a._hasObject===b&&(a._hasObject=1===a.length&&e.isPlainObject(d));if(a._hasObject)return c?d[c]:a.__filtered||d},hasNamed:function(a,b){return!!this.getNamed(a,b)},filter:function(a,c,d,e){function f(e){if(!(d&&e in d||xa&&e in xa)){var f=c[e];f!==b&&(a[e]=f)}}if(e){for(var g={},h=0,ma,k=e.length;h<k;h++)(ma=e[h])in
c&&(f(ma),g[ma]=!0);var xa=g}Object.keys(c.__unfiltered||c).forEach(f);return a},isPlainValue:function(a,b){return e.isPlainObject(a)||Array.isArray(a)||b&&"string"===typeof a},serialize:function(a,b,c,d){b=b||{};var f=!d;f&&(b.formatter=new k(b.precision),d={length:0,definitions:{},references:{},add:function(a,b){var c="#"+a._id,d=this.references[c];if(!d){this.length++;d=b.call(a);var e=a._class;e&&d[0]!==e&&d.unshift(e);this.definitions[c]=d;d=this.references[c]=[c]}return d}});if(a&&a._serialize){var g=
a._serialize(b,d);b=a._class;!b||a._compactSerialize||!f&&c||g[0]===b||g.unshift(b)}else if(Array.isArray(a)){g=[];for(var h=0,ma=a.length;h<ma;h++)g[h]=e.serialize(a[h],b,c,d)}else if(e.isPlainObject(a)){g={};var xa=Object.keys(a);h=0;for(ma=xa.length;h<ma;h++){var Eb=xa[h];g[Eb]=e.serialize(a[Eb],b,c,d)}}else g="number"===typeof a?b.formatter.number(a,b.precision):a;return f&&0<d.length?[["dictionary",d.definitions],g]:g},deserialize:function(a,b,c,d,f){var g=a,h=!c,ma=h&&a&&a.length&&"dictionary"===
a[0][0];c=c||{};if(Array.isArray(a)){d=a[0];var k="dictionary"===d;if(1==a.length&&/^#/.test(d))return c.dictionary[d];d=e.exports[d];g=[];for(var xa=d?1:0,Eb=a.length;xa<Eb;xa++)g.push(e.deserialize(a[xa],b,c,k,ma));d&&(a=g,g=b?b(d,a,h||f):new d(a))}else if(e.isPlainObject(a))for(k in g={},d&&(c.dictionary=g),a)g[k]=e.deserialize(a[k],b,c);return ma?g[1]:g},exportJSON:function(a,b){var c=e.serialize(a,b);return b&&0==b.asString?c:JSON.stringify(c)},importJSON:function(a,b){return e.deserialize("string"===
typeof a?JSON.parse(a):a,function(a,c,d){var f=(d=d&&b&&b.constructor===a)?b:e.create(a.prototype);if(1===c.length&&f instanceof Q&&(d||!(f instanceof $a))){var g=c[0];e.isPlainObject(g)&&(g.insert=!1)}(d?f.set:a).apply(f,c);d&&(b=null);return f})},push:function(a,b){var c=b.length;if(4096>c)a.push.apply(a,b);else{var d=a.length;a.length+=c;for(var e=0;e<c;e++)a[d+e]=b[e]}return a},splice:function(a,c,d,f){var g=c&&c.length,h=d===b;d=h?a.length:d;d>a.length&&(d=a.length);for(var k=0;k<g;k++)c[k]._index=
d+k;if(h)return e.push(a,c),[];k=[d,f];c&&e.push(k,c);c=a.splice.apply(a,k);k=0;for(f=c.length;k<f;k++)c[k]._index=b;k=d+g;for(f=a.length;k<f;k++)a[k]._index=k;return c},capitalize:function(a){return a.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},camelize:function(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase()})},hyphenate:function(a){return a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var f={on:function(a,b){if("string"!==typeof a)e.each(a,function(a,b){this.on(b,
a)},this);else{var c=this._eventTypes;c=c&&c[a];var d=this._callbacks=this._callbacks||{};d=d[a]=d[a]||[];-1===d.indexOf(b)&&(d.push(b),c&&c.install&&1===d.length&&c.install.call(this,a))}return this},off:function(a,b){if("string"!==typeof a)e.each(a,function(a,b){this.off(b,a)},this);else{var c=this._eventTypes;c=c&&c[a];var d=this._callbacks&&this._callbacks[a],f;d&&(!b||-1!==(f=d.indexOf(b))&&1===d.length?(c&&c.uninstall&&c.uninstall.call(this,a),delete this._callbacks[a]):-1!==f&&d.splice(f,1));
return this}},once:function(a,b){return this.on(a,function(){b.apply(this,arguments);this.off(a,b)})},emit:function(a,b){var c=this._callbacks&&this._callbacks[a];if(!c)return!1;var d=e.slice(arguments,1),f=b&&b.target&&!b.currentTarget;c=c.slice();f&&(b.currentTarget=this);for(var g=0,h=c.length;g<h;g++)if(0==c[g].apply(this,d)){b&&b.stop&&b.stop();break}f&&delete b.currentTarget;return!0},responds:function(a){return!(!this._callbacks||!this._callbacks[a])},attach:"#on",detach:"#off",fire:"#emit",
_installEvents:function(a){var b=this._eventTypes,c=this._callbacks;a=a?"install":"uninstall";if(b)for(var d in c)if(0<c[d].length){var e=b[d];(e=e&&e[a])&&e.call(this,d)}},statics:{inject:function xa(a){var b=a._events;if(b){var c={};e.each(b,function(b,d){var f="string"===typeof b,g=f?b:d,h=e.capitalize(g),k=g.substring(2).toLowerCase();c[k]=f?{}:b;g="_"+g;a["get"+h]=function(){return this[g]};a["set"+h]=function(a){var b=this[g];b&&this.off(k,b);if(a)this.on(k,a);this[g]=a}});a._eventTypes=c}return xa.base.apply(this,
arguments)}}},g=e.extend({_class:"PaperScope",initialize:function xa(){fa=this;this.settings=new e({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0});this.project=null;this.projects=[];this.tools=[];this._id=xa._id++;xa._scopes[this._id]=this;var b=xa.prototype;if(!this.support){var c=ra.getContext(1,1)||{};b.support={nativeDash:"setLineDash"in c||"mozDash"in c,nativeBlendModes:xb.nativeModes};ra.release(c)}if(!this.agent){c=a.navigator.userAgent.toLowerCase();var d=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(c)||
[])[0];d="darwin"===d?"mac":d;var f=b.agent=b.browser={platform:d};d&&(f[d]=!0);c.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv:v?([.\d]+))?/g,function(a,b,c,d,e){f.chrome||(a="opera"===b?d:/^(node|trident)$/.test(b)?e:c,f.version=a,f.versionNumber=parseFloat(a),b="trident"===b?"msie":b,f.name=b,f[b]=!0)});f.chrome&&delete f.webkit;f.atom&&delete f.chrome}},version:"0.11.8",getView:function(){var a=this.project;return a&&a._view},
getPaper:function(){return this},execute:function(a,b){var c=fa.PaperScript.execute(a,this,b);ta.updateFocus();return c},install:function(a){var b=this;e.each(["project","view","tool"],function(c){e.define(a,c,{configurable:!0,get:function(){return b[c]}})});for(var c in this)!/^_/.test(c)&&this[c]&&(a[c]=this[c])},setup:function(a){fa=this;this.project=new Ba(a);return this},createCanvas:function(a,b){return ra.getCanvas(a,b)},activate:function(){fa=this},clear:function(){for(var a=this.projects,
b=this.tools,c=a.length-1;0<=c;c--)a[c].remove();for(c=b.length-1;0<=c;c--)b[c].remove()},remove:function(){this.clear();delete g._scopes[this._id]},statics:new function(){function a(a){a+="Attribute";return function(b,c){return b[a](c)||b[a]("data-paper-"+c)}}return{_scopes:{},_id:0,get:function(a){return this._scopes[a]||null},getAttribute:a("get"),hasAttribute:a("has")}}}),h=e.extend(f,{initialize:function(a){this._scope=fa;this._index=this._scope[this._list].push(this)-1;!a&&this._scope[this._reference]||
this.activate()},activate:function(){if(!this._scope)return!1;var a=this._scope[this._reference];a&&a!==this&&a.emit("deactivate");this._scope[this._reference]=this;this.emit("activate",a);return!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){if(null==this._index)return!1;e.splice(this._scope[this._list],null,this._index,1);this._scope[this._reference]==this&&(this._scope[this._reference]=null);this._scope=null;return!0},getView:function(){return this._scope.getView()}}),
k=e.extend({initialize:function(a){this.precision=e.pick(a,5);this.multiplier=Math.pow(10,this.precision)},number:function(a){return 16>this.precision?Math.round(a*this.multiplier)/this.multiplier:a},pair:function(a,b,c){return this.number(a)+(c||",")+this.number(b)},point:function(a,b){return this.number(a.x)+(b||",")+this.number(a.y)},size:function(a,b){return this.number(a.width)+(b||",")+this.number(a.height)},rectangle:function(a,b){return this.point(a,b)+(b||",")+this.size(a,b)}});k.instance=
new k;var l=new function(){function a(a,b,c){return a<b?b:a>c?c:a}function b(a,b,c){function d(a){var b=134217729*a;b=a-b+b;return[b,a-b]}var e=b*b-a*c,g=b*b+a*c;if(3*f(e)<g){e=d(a);g=d(b);var B=d(c);b*=b;a*=c;e=b-a+(g[0]*g[0]-b+2*g[0]*g[1]+g[1]*g[1]-(e[0]*B[0]-a+e[0]*B[1]+e[1]*B[0]+e[1]*B[1]))}return e}function c(){var a=Math.max.apply(Math,arguments);return a&&(1E-8>a||1E8<a)?h(2,-Math.round(k(a))):0}var d=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,
.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,
.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,
.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],e=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,
.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,
.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],f=Math.abs,g=Math.sqrt,h=Math.pow,k=Math.log2||function(a){return Math.log(a)*Math.LOG2E};return{EPSILON:1E-12,
MACHINE_EPSILON:1.12E-16,CURVETIME_EPSILON:1E-8,GEOMETRIC_EPSILON:1E-7,TRIGONOMETRIC_EPSILON:1E-8,KAPPA:4*(g(2)-1)/3,isZero:function(a){return-1E-12<=a&&1E-12>=a},clamp:a,integrate:function(a,b,c,f){var g=d[f-2],B=e[f-2];c=.5*(c-b);b=c+b;var t=0,h=f+1>>1;for(f=f&1?B[t++]*a(b):0;t<h;){var M=c*g[t];f+=B[t++]*(a(b+M)+a(b-M))}return c*f},findRoot:function(b,c,d,e,g,h,t){for(var B=0;B<h;B++){var M=b(d),F=M/c(d),da=d-F;if(f(F)<t){d=da;break}0<M?(g=d,d=da<=e?.5*(e+g):da):(e=d,d=da>=g?.5*(e+g):da)}return a(d,
e,g)},solveQuadratic:function(d,e,h,da,k,ea){var B=Infinity;if(1E-12>f(d)){if(1E-12>f(e))return 1E-12>f(h)?-1:0;var M=-h/e}else{e*=-.5;var F=b(d,e,h);if(F&&1.12E-16>f(F)){var z=c(f(d),f(e),f(h));z&&(d*=z,e*=z,h*=z,F=b(d,e,h))}-1.12E-16<=F&&(M=0>F?0:g(F),B=e+(0>e?-M:M),0===B?(M=h/d,B=-M):(M=B/d,B=h/B))}d=0;h=null==k;e=k-1E-12;F=ea+1E-12;isFinite(M)&&(h||M>e&&M<F)&&(da[d++]=h?M:a(M,k,ea));B!==M&&isFinite(B)&&(h||B>e&&B<F)&&(da[d++]=h?B:a(B,k,ea));return d},solveCubic:function(b,d,e,da,k,ea,t){function B(a){q=
a;a=b*q;r=a+d;Ja=r*q+e;F=(a+r)*q+Ja;J=Ja*q+da}var M=c(f(b),f(d),f(e),f(da)),F,J;M&&(b*=M,d*=M,e*=M,da*=M);if(1E-12>f(b)){b=d;var r=e;var Ja=da;var q=Infinity}else if(1E-12>f(da))r=d,Ja=e,q=0;else{B(-(d/b)/3);M=J/b;var ma=h(f(M),1/3);M=0>M?-1:1;var A=-F/b;ma=0<A?1.324717957244746*Math.max(ma,g(A)):ma;ma=q-M*ma;if(ma!==q){do B(ma),ma=0===F?q:q-J/F/(1+1.12E-16);while(M*ma>M*q);f(b)*q*q>f(da/q)&&(Ja=-da/q,r=(Ja-e)/q)}}M=l.solveQuadratic(b,r,Ja,k,ea,t);ma=null==ea;isFinite(q)&&(0===M||0<M&&q!==k[0]&&q!==
k[1])&&(ma||q>ea-1E-12&&q<t+1E-12)&&(k[M++]=ma?q:a(q,ea,t));return M}}},n={_id:1,_pools:{},get:function(a){if(a){var b=this._pools[a];b||(b=this._pools[a]={_id:1});return b._id++}return this._id++}},m=e.extend({_class:"Point",_readIndex:!0,initialize:function(a,b){var c=typeof a,d=this.__read,e=0;"number"===c?(c="number"===typeof b,this._set(a,c?b:a),d&&(e=c?2:1)):"undefined"===c||null===a?(this._set(0,0),d&&(e=null===a?1:0)):(c="string"===c?a.split(/[\s,]+/)||[]:a,e=1,Array.isArray(c)?this._set(+c[0],
+(1<c.length?c[1]:c[0])):"x"in c?this._set(c.x||0,c.y||0):"width"in c?this._set(c.width||0,c.height||0):"angle"in c?(this._set(c.length||0,0),this.setAngle(c.angle||0)):(this._set(0,0),e=0));d&&(this.__read=e);return this},set:"#initialize",_set:function(a,b){this.x=a;this.y=b;return this},equals:function(a){return this===a||a&&(this.x===a.x&&this.y===a.y||Array.isArray(a)&&this.x===a[0]&&this.y===a[1])||!1},clone:function(){return new m(this.x,this.y)},toString:function(){var a=k.instance;return"{ x: "+
a.number(this.x)+", y: "+a.number(this.y)+" }"},_serialize:function(a){a=a.formatter;return[a.number(this.x),a.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(a){if(this.isZero()){var b=this._angle||0;this._set(Math.cos(b)*a,Math.sin(b)*a)}else a/=this.getLength(),l.isZero(a)&&this.getAngle(),this._set(this.x*a,this.y*a)},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(a){this.setAngleInRadians.call(this,
a*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var a=m.read(arguments),b=this.getLength()*a.getLength();if(l.isZero(b))return NaN;a=this.dot(a)/b;return Math.acos(-1>a?-1:1<a?1:a)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(a){this._angle=a;if(!this.isZero()){var b=this.getLength();this._set(Math.cos(a)*b,Math.sin(a)*b)}},getQuadrant:function(){return 0<=this.x?
0<=this.y?1:4:0<=this.y?2:3}},{beans:!1,getDirectedAngle:function(){var a=m.read(arguments);return 180*Math.atan2(this.cross(a),this.dot(a))/Math.PI},getDistance:function(){var a=m.read(arguments),b=a.x-this.x;a=a.y-this.y;b=b*b+a*a;return e.read(arguments)?b:Math.sqrt(b)},normalize:function(a){a===b&&(a=1);var c=this.getLength();a=0!==c?a/c:0;c=new m(this.x*a,this.y*a);0<=a&&(c._angle=this._angle);return c},rotate:function(a,b){if(0===a)return this.clone();a=a*Math.PI/180;var c=b?this.subtract(b):
this,d=Math.sin(a),e=Math.cos(a);c=new m(c.x*e-c.y*d,c.x*d+c.y*e);return b?c.add(b):c},transform:function(a){return a?a._transformPoint(this):this},add:function(){var a=m.read(arguments);return new m(this.x+a.x,this.y+a.y)},subtract:function(){var a=m.read(arguments);return new m(this.x-a.x,this.y-a.y)},multiply:function(){var a=m.read(arguments);return new m(this.x*a.x,this.y*a.y)},divide:function(){var a=m.read(arguments);return new m(this.x/a.x,this.y/a.y)},modulo:function(){var a=m.read(arguments);
return new m(this.x%a.x,this.y%a.y)},negate:function(){return new m(-this.x,-this.y)},isInside:function(){return E.read(arguments).contains(this)},isClose:function(){var a=m.read(arguments),b=e.read(arguments);return this.getDistance(a)<=b},isCollinear:function(){var a=m.read(arguments);return m.isCollinear(this.x,this.y,a.x,a.y)},isColinear:"#isCollinear",isOrthogonal:function(){var a=m.read(arguments);return m.isOrthogonal(this.x,this.y,a.x,a.y)},isZero:function(){var a=l.isZero;return a(this.x)&&
a(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(a){return 0<=this.x*(1<a&&4>a?-1:1)&&0<=this.y*(2<a?-1:1)},dot:function(){var a=m.read(arguments);return this.x*a.x+this.y*a.y},cross:function(){var a=m.read(arguments);return this.x*a.y-this.y*a.x},project:function(){var a=m.read(arguments),b=a.isZero()?0:this.dot(a)/a.dot(a);return new m(a.x*b,a.y*b)},statics:{min:function(){var a=m.read(arguments),b=m.read(arguments);return new m(Math.min(a.x,b.x),Math.min(a.y,
b.y))},max:function(){var a=m.read(arguments),b=m.read(arguments);return new m(Math.max(a.x,b.x),Math.max(a.y,b.y))},random:function(){return new m(Math.random(),Math.random())},isCollinear:function(a,b,c,d){return Math.abs(a*d-b*c)<=1E-8*Math.sqrt((a*a+b*b)*(c*c+d*d))},isOrthogonal:function(a,b,c,d){return Math.abs(a*c+b*d)<=1E-8*Math.sqrt((a*a+b*b)*(c*c+d*d))}}},e.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return new m(b(this.x),b(this.y))}},{})),y=m.extend({initialize:function(a,
b,c,d){this._x=a;this._y=b;this._owner=c;this._setter=d},_set:function(a,b,c){this._x=a;this._y=b;if(!c)this._owner[this._setter](this);return this},getX:function(){return this._x},setX:function(a){this._x=a;this._owner[this._setter](this)},getY:function(){return this._y},setY:function(a){this._y=a;this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(a){this._owner._changeSelection(this._getSelection(),a)},_getSelection:function(){return"setPosition"===
this._setter?4:0}}),p=e.extend({_class:"Size",_readIndex:!0,initialize:function(a,b){var c=typeof a,d=this.__read,e=0;"number"===c?(c="number"===typeof b,this._set(a,c?b:a),d&&(e=c?2:1)):"undefined"===c||null===a?(this._set(0,0),d&&(e=null===a?1:0)):(c="string"===c?a.split(/[\s,]+/)||[]:a,e=1,Array.isArray(c)?this._set(+c[0],+(1<c.length?c[1]:c[0])):"width"in c?this._set(c.width||0,c.height||0):"x"in c?this._set(c.x||0,c.y||0):(this._set(0,0),e=0));d&&(this.__read=e);return this},set:"#initialize",
_set:function(a,b){this.width=a;this.height=b;return this},equals:function(a){return a===this||a&&(this.width===a.width&&this.height===a.height||Array.isArray(a)&&this.width===a[0]&&this.height===a[1])||!1},clone:function(){return new p(this.width,this.height)},toString:function(){var a=k.instance;return"{ width: "+a.number(this.width)+", height: "+a.number(this.height)+" }"},_serialize:function(a){a=a.formatter;return[a.number(this.width),a.number(this.height)]},add:function(){var a=p.read(arguments);
return new p(this.width+a.width,this.height+a.height)},subtract:function(){var a=p.read(arguments);return new p(this.width-a.width,this.height-a.height)},multiply:function(){var a=p.read(arguments);return new p(this.width*a.width,this.height*a.height)},divide:function(){var a=p.read(arguments);return new p(this.width/a.width,this.height/a.height)},modulo:function(){var a=p.read(arguments);return new p(this.width%a.width,this.height%a.height)},negate:function(){return new p(-this.width,-this.height)},
isZero:function(){var a=l.isZero;return a(this.width)&&a(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(a,b){return new p(Math.min(a.width,b.width),Math.min(a.height,b.height))},max:function(a,b){return new p(Math.max(a.width,b.width),Math.max(a.height,b.height))},random:function(){return new p(Math.random(),Math.random())}}},e.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return new p(b(this.width),b(this.height))}},
{})),K=p.extend({initialize:function(a,b,c,d){this._width=a;this._height=b;this._owner=c;this._setter=d},_set:function(a,b,c){this._width=a;this._height=b;if(!c)this._owner[this._setter](this);return this},getWidth:function(){return this._width},setWidth:function(a){this._width=a;this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(a){this._height=a;this._owner[this._setter](this)}}),E=e.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(a,
c,d,f){var g=typeof a;if("number"===g){this._set(a,c,d,f);var h=4}else"undefined"===g||null===a?(this._set(0,0,0,0),h=null===a?1:0):1===arguments.length&&(Array.isArray(a)?(this._set.apply(this,a),h=1):a.x!==b||a.width!==b?(this._set(a.x||0,a.y||0,a.width||0,a.height||0),h=1):a.from===b&&a.to===b&&(this._set(0,0,0,0),e.filter(this,a),h=1));if(h===b){g=m.readNamed(arguments,"from");var k=e.peek(arguments);h=g.x;g=g.y;if(k&&k.x!==b||e.hasNamed(arguments,"to")){var l=m.readNamed(arguments,"to");k=l.x-
h;var Pa=l.y-g;0>k&&(h=l.x,k=-k);0>Pa&&(g=l.y,Pa=-Pa)}else Pa=p.read(arguments),k=Pa.width,Pa=Pa.height;this._set(h,g,k,Pa);h=arguments.__index;if(g=arguments.__filtered)this.__filtered=g}this.__read&&(this.__read=h);return this},set:"#initialize",_set:function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d;return this},clone:function(){return new E(this.x,this.y,this.width,this.height)},equals:function(a){var b=e.isPlainValue(a)?E.read(arguments):a;return b===this||b&&this.x===b.x&&this.y===
b.y&&this.width===b.width&&this.height===b.height||!1},toString:function(){var a=k.instance;return"{ x: "+a.number(this.x)+", y: "+a.number(this.y)+", width: "+a.number(this.width)+", height: "+a.number(this.height)+" }"},_serialize:function(a){a=a.formatter;return[a.number(this.x),a.number(this.y),a.number(this.width),a.number(this.height)]},getPoint:function(a){return new (a?m:y)(this.x,this.y,this,"setPoint")},setPoint:function(){var a=m.read(arguments);this.x=a.x;this.y=a.y},getSize:function(a){return new (a?
p:K)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var a=p.read(arguments),b=this._sx,c=this._sy,d=a.width;a=a.height;b&&(this.x+=(this.width-d)*b);c&&(this.y+=(this.height-a)*c);this.width=d;this.height=a;this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(a){if(!this._fw){var b=a-this.x;this.width-=.5===this._sx?2*b:b}this.x=a;this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(a){if(!this._fh){var b=a-this.y;this.height-=.5===this._sy?
2*b:b}this.y=a;this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(a){if(!this._fw){var b=a-this.x;this.width=.5===this._sx?2*b:b}this.x=a-this.width;this._sx=1;this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(a){if(!this._fh){var b=a-this.y;this.height=.5===this._sy?2*b:b}this.y=a-this.height;this._sy=1;this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(a){this._fw||.5===this._sx?this.x=a-this.width/2:(this._sx&&
(this.x+=2*(a-this.x)*this._sx),this.width=2*(a-this.x));this._sx=.5;this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(a){this._fh||.5===this._sy?this.y=a-this.height/2:(this._sy&&(this.y+=2*(a-this.y)*this._sy),this.height=2*(a-this.y));this._sy=.5;this._fh=0},getCenter:function(a){return new (a?m:y)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var a=m.read(arguments);this.setCenterX(a.x);this.setCenterY(a.y);return this},getArea:function(){return this.width*
this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(a){return a&&a.width!==b||4===(Array.isArray(a)?a:arguments).length?this._containsRectangle(E.read(arguments)):this._containsPoint(m.read(arguments))},_containsPoint:function(a){var b=a.x;a=a.y;return b>=this.x&&a>=this.y&&b<=this.x+this.width&&a<=this.y+this.height},_containsRectangle:function(a){var b=a.x,c=a.y;return b>=this.x&&c>=this.y&&b+a.width<=this.x+this.width&&c+a.height<=this.y+this.height},intersects:function(){var a=
E.read(arguments),b=e.read(arguments)||0;return a.x+a.width>this.x-b&&a.y+a.height>this.y-b&&a.x<this.x+this.width+b&&a.y<this.y+this.height+b},intersect:function(){var a=E.read(arguments),b=Math.max(this.x,a.x),c=Math.max(this.y,a.y);return new E(b,c,Math.min(this.x+this.width,a.x+a.width)-b,Math.min(this.y+this.height,a.y+a.height)-c)},unite:function(){var a=E.read(arguments),b=Math.min(this.x,a.x),c=Math.min(this.y,a.y);return new E(b,c,Math.max(this.x+this.width,a.x+a.width)-b,Math.max(this.y+
this.height,a.y+a.height)-c)},include:function(){var a=m.read(arguments),b=Math.min(this.x,a.x),c=Math.min(this.y,a.y);return new E(b,c,Math.max(this.x+this.width,a.x)-b,Math.max(this.y+this.height,a.y)-c)},expand:function(){var a=p.read(arguments),b=a.width;a=a.height;return new E(this.x-b/2,this.y-a/2,this.width+b,this.height+a)},scale:function(a,c){return this.expand(this.width*a-this.width,this.height*(c===b?a:c)-this.height)}},e.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom",
"Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(a,b){var c=a.join(""),d=/^[RL]/.test(c);4<=b&&(a[1]+=d?"Y":"X");var e=a[d?0:1];d=a[d?1:0];var f="get"+e,g="get"+d,h="set"+e,k="set"+d,B="set"+c;this["get"+c]=function(a){return new (a?m:y)(this[f](),this[g](),this,B)};this[B]=function(){var a=m.read(arguments);this[h](a.x);this[k](a.y)}},{beans:!0})),Ia=E.extend({initialize:function(a,b,c,d,e,f){this._set(a,b,c,d,!0);this._owner=e;this._setter=f},_set:function(a,
b,c,d,e){this._x=a;this._y=b;this._width=c;this._height=d;if(!e)this._owner[this._setter](this);return this}},new function(){var a=E.prototype;return e.each(["x","y","width","height"],function(a){var b=e.capitalize(a),c="_"+a;this["get"+b]=function(){return this[c]};this["set"+b]=function(a){this[c]=a;if(!this._dontNotify)this._owner[this._setter](this)}},e.each("Point Size Center Left Top Right Bottom CenterX CenterY TopLeft TopRight BottomLeft BottomRight LeftCenter TopCenter RightCenter BottomCenter".split(" "),
function(b){var c="set"+b;this[c]=function(){this._dontNotify=!0;a[c].apply(this,arguments);this._dontNotify=!1;this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(a){var b=this._owner;b._changeSelection&&b._changeSelection(2,a)}}))}),P=e.extend({_class:"Matrix",initialize:function Pa(a,b){var c=arguments.length,d=!0;6<=c?this._set.apply(this,arguments):1===c||2===c?a instanceof Pa?this._set(a._a,a._b,a._c,a._d,a._tx,a._ty,b):Array.isArray(a)?
this._set.apply(this,b?a.concat([b]):a):d=!1:c?d=!1:this.reset();if(!d)throw Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(a,b,c,d,e,f,g){this._a=a;this._b=b;this._c=c;this._d=d;this._tx=e;this._ty=f;g||this._changed();return this},_serialize:function(a,b){return e.serialize(this.getValues(),a,!0,b)},_changed:function(){var a=this._owner;a&&(a._applyMatrix?a.transform(null,!0):a._changed(25))},clone:function(){return new P(this._a,this._b,this._c,this._d,this._tx,
this._ty)},equals:function(a){return a===this||a&&this._a===a._a&&this._b===a._b&&this._c===a._c&&this._d===a._d&&this._tx===a._tx&&this._ty===a._ty},toString:function(){var a=k.instance;return"[["+[a.number(this._a),a.number(this._c),a.number(this._tx)].join(", ")+"], ["+[a.number(this._b),a.number(this._d),a.number(this._ty)].join(", ")+"]]"},reset:function(a){this._a=this._d=1;this._b=this._c=this._tx=this._ty=0;a||this._changed();return this},apply:function(a,b){var c=this._owner;return c?(c.transform(null,
!0,e.pick(a,!0),b),this.isIdentity()):!1},translate:function(){var a=m.read(arguments),b=a.x;a=a.y;this._tx+=b*this._a+a*this._c;this._ty+=b*this._b+a*this._d;this._changed();return this},scale:function(){var a=m.read(arguments),b=m.read(arguments,0,{readNull:!0});b&&this.translate(b);this._a*=a.x;this._b*=a.x;this._c*=a.y;this._d*=a.y;b&&this.translate(b.negate());this._changed();return this},rotate:function(a){a*=Math.PI/180;var b=m.read(arguments,1),c=b.x,d=b.y;b=Math.cos(a);var e=Math.sin(a),
f=c-c*b+d*e;c=d-c*e-d*b;d=this._a;var g=this._b,h=this._c,B=this._d;this._a=b*d+e*h;this._b=b*g+e*B;this._c=-e*d+b*h;this._d=-e*g+b*B;this._tx+=f*d+c*h;this._ty+=f*g+c*B;this._changed();return this},shear:function(){var a=m.read(arguments),b=m.read(arguments,0,{readNull:!0});b&&this.translate(b);var c=this._a,d=this._b;this._a+=a.y*this._c;this._b+=a.y*this._d;this._c+=a.x*c;this._d+=a.x*d;b&&this.translate(b.negate());this._changed();return this},skew:function(){var a=m.read(arguments),b=m.read(arguments,
0,{readNull:!0}),c=Math.PI/180;a=new m(Math.tan(a.x*c),Math.tan(a.y*c));return this.shear(a,b)},append:function(a,b){if(a){var c=this._a,d=this._b,e=this._c,f=this._d,g=a._a,h=a._c,B=a._b,M=a._d,F=a._tx,da=a._ty;this._a=g*c+B*e;this._c=h*c+M*e;this._b=g*d+B*f;this._d=h*d+M*f;this._tx+=F*c+da*e;this._ty+=F*d+da*f;b||this._changed()}return this},prepend:function(a,b){if(a){var c=this._a,d=this._b,e=this._c,f=this._d,g=this._tx,h=this._ty,B=a._a,M=a._c,F=a._b,da=a._d,k=a._tx,ea=a._ty;this._a=B*c+M*d;
this._c=B*e+M*f;this._b=F*c+da*d;this._d=F*e+da*f;this._tx=B*g+M*h+k;this._ty=F*g+da*h+ea;b||this._changed()}return this},appended:function(a){return this.clone().append(a)},prepended:function(a){return this.clone().prepend(a)},invert:function(){var a=this._a,b=this._b,c=this._c,d=this._d,e=this._tx,f=this._ty,g=a*d-b*c,h=null;g&&!isNaN(g)&&isFinite(e)&&isFinite(f)&&(this._a=d/g,this._b=-b/g,this._c=-c/g,this._d=a/g,this._tx=(c*f-d*e)/g,this._ty=(b*e-a*f)/g,h=this);return h},inverted:function(){return this.clone().invert()},
concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new P(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var a=this._a*this._d-this._c*this._b;return a&&!isNaN(a)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(a,
b,c){return 3>arguments.length?this._transformPoint(m.read(arguments)):this._transformCoordinates(a,b,c)},_transformPoint:function(a,b,c){var d=a.x;a=a.y;b||(b=new m);return b._set(d*this._a+a*this._c+this._tx,d*this._b+a*this._d+this._ty,c)},_transformCoordinates:function(a,b,c){var d=0;for(c*=2;d<c;d+=2){var e=a[d],f=a[d+1];b[d]=e*this._a+f*this._c+this._tx;b[d+1]=e*this._b+f*this._d+this._ty}return b},_transformCorners:function(a){var b=a.x,c=a.y,d=b+a.width;a=c+a.height;b=[b,c,d,c,d,a,b,a];return this._transformCoordinates(b,
b,4)},_transformBounds:function(a,b,c){a=this._transformCorners(a);for(var d=a.slice(0,2),e=d.slice(),f=2;8>f;f++){var g=a[f],h=f&1;g<d[h]?d[h]=g:g>e[h]&&(e[h]=g)}b||(b=new E);return b._set(d[0],d[1],e[0]-d[0],e[1]-d[1],c)},inverseTransform:function(){return this._inverseTransform(m.read(arguments))},_inverseTransform:function(a,b,c){var d=this._a,e=this._b,f=this._c,g=this._d,h=this._tx,B=this._ty,M=d*g-e*f,F=null;M&&!isNaN(M)&&isFinite(h)&&isFinite(B)&&(h=a.x-this._tx,a=a.y-this._ty,b||(b=new m),
F=b._set((h*g-a*f)/M,(a*d-h*e)/M,c));return F},decompose:function(){var a=this._a,b=this._b,c=this._c,d=this._d,e=a*d-b*c,f=Math.sqrt,g=Math.atan2,h=180/Math.PI;if(0!==a||0!==b){var B=f(a*a+b*b);f=Math.acos(a/B)*(0<b?1:-1);e=[B,e/B];a=[g(a*c+b*d,B*B),0]}else 0!==c||0!==d?(B=f(c*c+d*d),f=Math.asin(c/B)*(0<d?1:-1),e=[e/B,B],a=[0,g(a*c+b*d,B*B)]):(f=0,a=e=[0,0]);return{translation:this.getTranslation(),rotation:f*h,scaling:new m(e),skewing:new m(a[0]*h,a[1]*h)}},getValues:function(){return[this._a,this._b,
this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new m(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(a){this.isIdentity()||a.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},e.each("a b c d tx ty".split(" "),function(a){var b=e.capitalize(a),c="_"+a;this["get"+b]=function(){return this[c]};this["set"+b]=function(a){this[c]=a;this._changed()}},{})),
qa=e.extend({_class:"Line",initialize:function(a,b,c,d,e){if(4<=arguments.length){this._px=a;this._py=b;this._vx=c;this._vy=d;var f=e}else this._px=a.x,this._py=a.y,this._vx=b.x,this._vy=b.y,f=c;f||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new m(this._px,this._py)},getVector:function(){return new m(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(a,b){return qa.intersect(this._px,this._py,this._vx,this._vy,a._px,a._py,a._vx,
a._vy,!0,b)},getSide:function(a,b){return qa.getSide(this._px,this._py,this._vx,this._vy,a.x,a.y,!0,b)},getDistance:function(a){return Math.abs(this.getSignedDistance(a))},getSignedDistance:function(a){return qa.getSignedDistance(this._px,this._py,this._vx,this._vy,a.x,a.y,!0)},isCollinear:function(a){return m.isCollinear(this._vx,this._vy,a._vx,a._vy)},isOrthogonal:function(a){return m.isOrthogonal(this._vx,this._vy,a._vx,a._vy)},statics:{intersect:function(a,b,c,d,e,f,g,h,B,M){B||(c-=a,d-=b,g-=
e,h-=f);B=c*h-d*g;if(!l.isZero(B)&&(e=a-e,f=b-f,g=(g*f-h*e)/B,h=(c*f-d*e)/B,B=1+1E-12,M||-1E-12<g&&g<B&&-1E-12<h&&h<B))return M||(g=0>=g?0:1<=g?1:g),new m(a+g*c,b+g*d)},getSide:function(a,b,c,d,e,f,g,h){g||(c-=a,d-=b);a=e-a;b=a*d-(f-b)*c;!h&&l.isZero(b)&&(b=(a*c+a*c)/(c*c+d*d),0<=b&&1>=b&&(b=0));return 0>b?-1:0<b?1:0},getSignedDistance:function(a,b,c,d,e,f,g){g||(c-=a,d-=b);return 0===c?0<d?e-a:a-e:0===d?0>c?f-b:b-f:((e-a)*d-(f-b)*c)/Math.sqrt(c*c+d*d)},getDistance:function(a,b,c,d,e,f,g){return Math.abs(qa.getSignedDistance(a,
b,c,d,e,f,g))}}}),Ba=h.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(a){h.call(this,!0);this._children=[];this._namedChildren={};this._activeLayer=null;this._currentStyle=new pb(null,null,this);this._view=ta.create(this,a||ra.getCanvas(1,1));this._selectionItems={};this._updateVersion=this._selectionCount=0},_serialize:function(a,b){return e.serialize(this._children,a,!0,b)},_changed:function(a,b){if(a&1){var c=this._view;c&&(c._needsUpdate=
!0,!c._requested&&c._autoUpdate&&c.requestUpdate())}if((c=this._changes)&&b){var d=this._changesById,e=b._id,f=d[e];f?f.flags|=a:c.push(d[e]={item:b,flags:a})}},clear:function(){for(var a=this._children,b=a.length-1;0<=b;b--)a[b].remove()},isEmpty:function(){return!this._children.length},remove:function Zb(){if(!Zb.base.call(this))return!1;this._view&&this._view.remove();return!0},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(a){this._currentStyle.set(a)},
getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new $a({project:this,insert:!0})},getSymbolDefinitions:function(){var a=[],b={};this.getItems({"class":ob,match:function(c){c=c._definition;var d=c._id;b[d]||(b[d]=!0,a.push(c));return!1}});return a},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var a=this._selectionItems,b=[],c;for(c in a){var d=
a[c],e=d._selection;e&1&&d.isInserted()?b.push(d):e||this._updateSelection(d)}return b},_updateSelection:function(a){var b=a._id,c=this._selectionItems;a._selection?c[b]!==a&&(this._selectionCount++,c[b]=a):c[b]===a&&(this._selectionCount--,delete c[b])},selectAll:function(){for(var a=this._children,b=0,c=a.length;b<c;b++)a[b].setFullySelected(!0)},deselectAll:function(){var a=this._selectionItems,b;for(b in a)a[b].setFullySelected(!1)},addLayer:function(a){return this.insertLayer(b,a)},insertLayer:function(a,
b){if(b instanceof $a){b._remove(!1,!0);e.splice(this._children,[b],a,0);b._setProject(this,!0);var c=b._name;c&&b.setName(c);this._changes&&b._changed(5);this._activeLayer||(this._activeLayer=b)}else b=null;return b},_insertItem:function(a,c,d){c=this.insertLayer(a,c)||(this._activeLayer||this._insertItem(b,new $a(Q.NO_INSERT),!0)).insertChild(a,c);d&&c.activate&&c.activate();return c},getItems:function(a){return Q._getItems(this,a)},getItem:function(a){return Q._getItems(this,a,null,null,!0)[0]||
null},importJSON:function(a){this.activate();var b=this._activeLayer;return e.importJSON(a,b&&b.isEmpty()&&b)},removeOn:function(a){var b=this._removeSets;if(b){"mouseup"===a&&(b.mousedrag=null);var c=b[a];if(c){for(var d in c){var e=c[d],f;for(f in b){var g=b[f];g&&g!=c&&delete g[e._id]}e.remove()}b[a]=null}}},draw:function(a,b,c){this._updateVersion++;a.save();b.applyToContext(a);var d=this._children;c=new e({offset:new m(0,0),pixelRatio:c,viewMatrix:b.isIdentity()?null:b,matrices:[new P],updateMatrix:!0});
for(var f=0,g=d.length;f<g;f++)d[f].draw(a,c);a.restore();if(0<this._selectionCount){a.save();a.strokeWidth=1;d=this._selectionItems;c=this._scope.settings.handleSize;f=this._updateVersion;for(var h in d)d[h]._drawSelection(a,b,c,d,f);a.restore()}}}),Q=e.extend(f,{statics:{extend:function Xb(a){a._serializeFields&&(a._serializeFields=e.set({},this.prototype._serializeFields,a._serializeFields));return Xb.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,
_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new P,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var a="onMouseDown onMouseUp onMouseDrag onClick onDoubleClick onMouseMove onMouseEnter onMouseLeave".split(" ");return e.each(a,function(a){this._events[a]=
{install:function(a){this.getView()._countItemEvent(a,1)},uninstall:function(a){this.getView()._countItemEvent(a,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:a}})},{initialize:function(){},_initialize:function(a,c){var d=a&&e.isPlainObject(a),f=d&&!0===a.internal,g=this._matrix=new P,h=d&&a.project||fa.project,B=fa.settings;this._id=f?null:n.get();this._parent=
this._index=null;this._applyMatrix=this._canApplyMatrix&&B.applyMatrix;c&&g.translate(c);g._owner=this;this._style=new pb(h._currentStyle,this,h);f||d&&0==a.insert||!(B.insertItems||d&&!0===a.insert)?this._setProject(h):(d&&a.parent||h)._insertItem(b,this,!0);d&&a!==Q.NO_INSERT&&this.set(a,{internal:!0,insert:!0,project:!0,parent:!0});return d},_serialize:function(a,b){function c(c){for(var g in c){var h=f[g];e.equals(h,"leading"===g?1.2*c.fontSize:c[g])||(d[g]=e.serialize(h,a,"data"!==g,b))}}var d=
{},f=this;c(this._serializeFields);this instanceof Ma||c(this._style._defaults);return[this._class,d]},_changed:function(a){var c=this._symbol,d=this._parent||c,e=this._project;a&8&&(this._bounds=this._position=this._decomposed=b);a&16&&(this._globalMatrix=b);d&&a&72&&Q._clearBoundsCache(d);a&2&&Q._clearBoundsCache(this);e&&e._changed(a,this);c&&c._changed(a)},getId:function(){return this._id},getName:function(){return this._name},setName:function(a){this._name&&this._removeNamed();if(a===+a+"")throw Error("Names consisting only of numbers are not supported.");
var c=this._getOwner();if(a&&c){var d=c._children;c=c._namedChildren;(c[a]=c[a]||[]).push(this);a in d||(d[a]=this)}this._name=a||b;this._changed(256)},getStyle:function(){return this._style},setStyle:function(a){this.getStyle().set(a)}},e.each(["locked","visible","blendMode","opacity","guide"],function(a){var b=e.capitalize(a),c="_"+a,d={locked:256,visible:265};this["get"+b]=function(){return this[c]};this["set"+b]=function(b){b!=this[c]&&(this[c]=b,this._changed(d[a]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},
setSelection:function(a){a!==this._selection&&(this._selection=a,a=this._project)&&(a._updateSelection(this),this._changed(257))},_changeSelection:function(a,b){var c=this._selection;this.setSelection(b?c|a:c&~a)},isSelected:function(){if(this._selectChildren)for(var a=this._children,b=0,c=a.length;b<c;b++)if(a[b].isSelected())return!0;return!!(this._selection&1)},setSelected:function(a){if(this._selectChildren)for(var b=this._children,c=0,d=b.length;c<d;c++)b[c].setSelected(a);this._changeSelection(1,
a)},isFullySelected:function(){var a=this._children,b=!!(this._selection&1);if(a&&b){b=0;for(var c=a.length;b<c;b++)if(!a[b].isFullySelected())return!1;return!0}return b},setFullySelected:function(a){var b=this._children;if(b)for(var c=0,d=b.length;c<d;c++)b[c].setFullySelected(a);this._changeSelection(1,a)},isClipMask:function(){return this._clipMask},setClipMask:function(a){if(this._clipMask!=(a=!!a)){if(this._clipMask=a)this.setFillColor(null),this.setStrokeColor(null);this._changed(257);this._parent&&
this._parent._changed(2048)}},getData:function(){this._data||(this._data={});return this._data},setData:function(a){this._data=a},getPosition:function(a){a=a?m:y;var b=this._position||(this._position=this._getPositionFromBounds());return new a(b.x,b.y,this,"setPosition")},setPosition:function(){this.translate(m.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(a){return this._pivot?this._matrix._transformPoint(this._pivot):(a||this.getBounds()).getCenter(!0)},getPivot:function(){var a=
this._pivot;return a?new y(a.x,a.y,this,"setPivot"):null},setPivot:function(){this._pivot=m.read(arguments,0,{clone:!0,readNull:!0});this._position=b}},e.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(a,b){this[b]=function(b){return this.getBounds(b,a)}},{beans:!0,getBounds:function(a,b){var c=b||a instanceof P,d=e.set({},c?b:a,this._boundsOptions);if(!d.stroke||this.getStrokeScaling())d.cacheItem=this;c=this._getCachedBounds(c&&a,d).rect;return arguments.length?
c:new Ia(c.x,c.y,c.width,c.height,this,"setBounds")},setBounds:function(){var a=E.read(arguments),b=this.getBounds(),c=this._matrix,d=new P,e=a.getCenter();d.translate(e);if(a.width!=b.width||a.height!=b.height)c.isInvertible()||(c.set(c._backup||(new P).translate(c.getTranslation())),b=this.getBounds()),d.scale(0!==b.width?a.width/b.width:0,0!==b.height?a.height/b.height:0);e=b.getCenter();d.translate(-e.x,-e.y);this.transform(d)},_getBounds:function(a,b){var c=this._children;if(!c||!c.length)return new E;
Q._updateBoundsCache(this,b.cacheItem);return Q._getBounds(c,a,b)},_getBoundsCacheKey:function(a,b){return[a.stroke?1:0,a.handle?1:0,b?1:0].join("")},_getCachedBounds:function(a,b,c){a=a&&a._orNullIfIdentity();c=b.internal&&!c;var d=b.cacheItem,e=c?null:this._matrix._orNullIfIdentity(),f=d&&(!a||a.equals(e))&&this._getBoundsCacheKey(b,c),g=this._bounds;Q._updateBoundsCache(this._parent||this._symbol,d);if(f&&g&&f in g)return c=g[f],{rect:c.rect.clone(),nonscaling:c.nonscaling};b=this._getBounds(a||
e,b);a=b.rect||b;d=this._style;b=b.nonscaling||d.hasStroke()&&!d.getStrokeScaling();f&&(g||(this._bounds=g={}),g[f]={rect:a.clone(),nonscaling:b,internal:c});return{rect:a,nonscaling:b}},_getStrokeMatrix:function(a,b){var c=this.getStrokeScaling()?null:b&&b.internal?this:this._parent||this._symbol&&this._symbol._item;return(c=c?c.getViewMatrix().invert():a)&&c._shiftless()},statics:{_updateBoundsCache:function(a,b){if(a&&b){var c=b._id,d=a._boundsCache=a._boundsCache||{ids:{},list:[]};d.ids[c]||(d.list.push(b),
d.ids[c]=b)}},_clearBoundsCache:function(a){var c=a._boundsCache;if(c){a._bounds=a._position=a._boundsCache=b;var d=0;c=c.list;for(var e=c.length;d<e;d++){var f=c[d];f!==a&&(f._bounds=f._position=b,f._boundsCache&&Q._clearBoundsCache(f))}}},_getBounds:function(a,b,c){var d=Infinity,e=-d,f=d,g=e,h=!1;c=c||{};for(var F=0,da=a.length;F<da;F++){var k=a[F];if(k._visible&&!k.isEmpty()){k=k._getCachedBounds(b&&b.appended(k._matrix),c,!0);var ea=k.rect;d=Math.min(ea.x,d);f=Math.min(ea.y,f);e=Math.max(ea.x+
ea.width,e);g=Math.max(ea.y+ea.height,g);k.nonscaling&&(h=!0)}}return{rect:isFinite(d)?new E(d,f,e-d,g-f):new E,nonscaling:h}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var a=this._decompose();return a?a.rotation:0},setRotation:function(a){var b=this.getRotation();if(null!=b&&null!=a){var c=this._decomposed;this.rotate(a-b);c&&(c.rotation=a,this._decomposed=c)}},getScaling:function(){var a=
this._decompose();a=a&&a.scaling;return new y(a?a.x:1,a?a.y:1,this,"setScaling")},setScaling:function(){var a=this.getScaling(),b=m.read(arguments,0,{clone:!0,readNull:!0});if(a&&b&&!a.equals(b)){var c=this.getRotation(),d=this._decomposed,e=new P,f=this.getPosition(!0);e.translate(f);c&&e.rotate(c);e.scale(b.x/a.x,b.y/a.y);c&&e.rotate(-c);e.translate(f.negate());this.transform(e);d&&(d.scaling=b,this._decomposed=d)}},getMatrix:function(){return this._matrix},setMatrix:function(){var a=this._matrix;
a.initialize.apply(a,arguments)},getGlobalMatrix:function(a){var b=this._globalMatrix;if(b)for(var c=this._parent,d=[];c;){if(!c._globalMatrix){b=null;c=0;for(var e=d.length;c<e;c++)d[c]._globalMatrix=null;break}d.push(c);c=c._parent}b||(b=this._globalMatrix=this._matrix.clone(),(c=this._parent)&&b.prepend(c.getGlobalMatrix(!0)));return a?b:b.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(a){(this._applyMatrix=
this._canApplyMatrix&&!!a)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(a,b){if(this._project!==a){this._project&&this._installEvents(!1);this._project=a;for(var c=this._children,d=0,e=c&&c.length;d<e;d++)c[d]._setProject(a);b=!0}b&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function ma(a){ma.base.call(this,a);for(var b=this._children,
c=0,d=b&&b.length;c<d;c++)b[c]._installEvents(a)},getLayer:function(){for(var a=this;a=a._parent;)if(a instanceof $a)return a;return null},getParent:function(){return this._parent},setParent:function(a){return a.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(a){this.removeChildren();this.addChildren(a)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-
1]||null},getNextSibling:function(){var a=this._getOwner();return a&&a._children[this._index+1]||null},getPreviousSibling:function(){var a=this._getOwner();return a&&a._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(a){return a===this||a&&this._class===a._class&&this._style.equals(a._style)&&this._matrix.equals(a._matrix)&&this._locked===a._locked&&this._visible===a._visible&&this._blendMode===a._blendMode&&this._opacity===a._opacity&&this._clipMask===a._clipMask&&
this._guide===a._guide&&this._equals(a)||!1},_equals:function(a){return e.equals(this._children,a._children)},clone:function(a){var c=new this.constructor(Q.NO_INSERT),d=this._children,f=e.pick(a?a.insert:b,a===b||!0===a);a=e.pick(a?a.deep:b,!0);d&&c.copyAttributes(this);d&&!a||c.copyContent(this);d||c.copyAttributes(this);f&&c.insertAbove(this);f=this._name;d=this._parent;if(f&&d){d=d._children;a=f;for(var g=1;d[f];)f=a+" "+g++;f!==a&&c.setName(f)}return c},copyContent:function(a){a=a._children;
for(var b=0,c=a&&a.length;b<c;b++)this.addChild(a[b].clone(!1),!0)},copyAttributes:function(a,b){this.setStyle(a._style);for(var c="_locked _visible _blendMode _opacity _clipMask _guide".split(" "),d=0,f=c.length;d<f;d++){var g=c[d];a.hasOwnProperty(g)&&(this[g]=a[g])}b||this._matrix.set(a._matrix,!0);this.setApplyMatrix(a._applyMatrix);this.setPivot(a._pivot);this.setSelection(a._selection);c=a._data;d=a._name;this._data=c?e.clone(c):null;d&&this.setName(d)},rasterize:function(a,c){var d=this.getStrokeBounds(),
f=(a||this.getView().getResolution())/72,g=d.getTopLeft().floor();d=d.getBottomRight().ceil();d=new p(d.subtract(g));var B=new ab(Q.NO_INSERT);if(!d.isZero()){var h=ra.getCanvas(d.multiply(f)),F=h.getContext("2d"),da=(new P).scale(f).translate(g.negate());F.save();da.applyToContext(F);this.draw(F,new e({matrices:[da]}));F.restore();B.setCanvas(h)}B.transform((new P).translate(g.add(d.divide(2))).scale(1/f));(c===b||c)&&B.insertAbove(this);return B},contains:function(){return!!this._contains(this._matrix._inverseTransform(m.read(arguments)))},
_contains:function(a){var b=this._children;if(b){for(var c=b.length-1;0<=c;c--)if(b[c].contains(a))return!0;return!1}return a.isInside(this.getInternalBounds())},isInside:function(){return E.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new aa.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(a,b){return a instanceof Q?0<this._asPathItem().getIntersections(a._asPathItem(),null,b,!0).length:!1}},new function(){function a(){return this._hitTest(m.read(arguments),
Ua.getOptions(arguments))}function b(){var a=m.read(arguments),b=Ua.getOptions(arguments),c=[];this._hitTest(a,e.set({all:c},b));return c}function c(a,b,c,d){var e=this._children;if(e)for(var f=e.length-1;0<=f;f--){var g=e[f];if((g=g!==d&&g._hitTest(a,b,c))&&!b.all)return g}return null}Ba.inject({hitTest:a,hitTestAll:b,_hitTest:c});return{hitTest:a,hitTestAll:b,_hitTestChildren:c}},{_hitTest:function(a,b,c){function d(a){a&&da&&!da(a)&&(a=null);a&&b.all&&b.all.push(a);return a}function f(b,c){var d=
c?x["get"+c]():k.getPosition();if(1>=a.subtract(d).divide(h).length)return new Ua(b,k,{name:c?e.hyphenate(c):b,point:d})}if(this._locked||!this._visible||this._guide&&!b.guides||this.isEmpty())return null;var g=this._matrix;c=c?c.appended(g):this.getGlobalMatrix().prepend(this.getView()._matrix);var h=b._tolerancePadding=new p(aa._getStrokePadding(Math.max(b.tolerance,1E-12),g._shiftless().invert()));a=g._inverseTransform(a);if(!a||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(h.multiply(2))._containsPoint(a))return null;
var F=!(b.guides&&!this._guide||b.selected&&!this.isSelected()||b.type&&b.type!==e.hyphenate(this._class)||b["class"]&&!(this instanceof b["class"])),da=b.match,k=this,ea=b.position,t=b.center,w=b.bounds;if(F&&this._parent&&(ea||t||w)){if(t||w)var x=this.getInternalBounds();var z=ea&&f("position")||t&&f("center","Center");if(!z&&w)for(ea="TopLeft TopRight BottomLeft BottomRight LeftCenter TopCenter RightCenter BottomCenter".split(" "),t=0;8>t&&!z;t++)z=f("bounds",ea[t]);z=d(z)}z||(z=this._hitTestChildren(a,
b,c)||F&&d(this._hitTestSelf(a,b,c,this.getStrokeScaling()?null:c._shiftless().invert()))||null);z&&z.point&&(z.point=g.transform(z.point));return z},_hitTestSelf:function(a,b){if(b.fill&&this.hasFill()&&this._contains(a))return new Ua("fill",this)},matches:function(a,b){function c(a,b){for(var d in a)if(a.hasOwnProperty(d)){var f=a[d],g=b[d];if(e.isPlainObject(f)&&e.isPlainObject(g)){if(!c(f,g))return!1}else if(!e.equals(f,g))return!1}return!0}var d=typeof a;if("object"===d){for(var f in a)if(a.hasOwnProperty(f)&&
!this.matches(f,a[f]))return!1;return!0}if("function"===d)return a(this);if("match"===a)return b(this);d=/^(empty|editable)$/.test(a)?this["is"+e.capitalize(a)]():"type"===a?e.hyphenate(this._class):this[a];if("class"===a){if("function"===typeof b)return this instanceof b;d=this._class}if("function"===typeof b)return!!b(d);if(b){if(b.test)return b.test(d);if(e.isPlainObject(b))return c(b,d)}return e.equals(d,b)},getItems:function(a){return Q._getItems(this,a,this._matrix)},getItem:function(a){return Q._getItems(this,
a,this._matrix,null,!0)[0]||null},statics:{_getItems:function M(a,b,c,d,f){if(!d){var g="object"===typeof b&&b;d=g&&g.overlapping;var B=g&&g.inside,h=d||B,k=h&&E.read([h]);d={items:[],recursive:g&&!1!==g.recursive,inside:!!B,overlapping:!!d,rect:k,path:d&&new aa.Rectangle({rectangle:k,insert:!1})};g&&(b=e.filter({},b,{recursive:!0,inside:!0,overlapping:!0}))}a=a._children;g=d.items;c=(k=d.rect)&&(c||new P);B=0;for(var t=a&&a.length;B<t;B++){var w=a[B],x=c&&c.appended(w._matrix),z=!0;if(k){h=w.getBounds(x);
if(!k.intersects(h))continue;k.contains(h)||d.overlapping&&(h.contains(k)||d.path.intersects(w,x))||(z=!1)}if(z&&w.matches(b)&&(g.push(w),f))break;!1!==d.recursive&&M(w,b,x,d,f);if(f&&0<g.length)break}return g}}},{importJSON:function(a){a=e.importJSON(a,this);return a!==this?this.addChild(a):a},addChild:function(a){return this.insertChild(b,a)},insertChild:function(a,b){var c=b?this.insertChildren(a,[b]):null;return c&&c[0]},addChildren:function(a){return this.insertChildren(this._children.length,
a)},insertChildren:function(a,b){var c=this._children;if(c&&b&&0<b.length){b=e.slice(b);for(var d={},f=b.length-1;0<=f;f--){var g=b[f],h=g&&g._id;!g||d[h]?b.splice(f,1):(g._remove(!1,!0),d[h]=!0)}e.splice(c,b,a,0);c=this._project;d=c._changes;f=0;for(h=b.length;f<h;f++){g=b[f];var da=g._name;g._parent=this;g._setProject(c,!0);da&&g.setName(da);d&&g._changed(5)}this._changed(11)}else b=null;return b},_insertItem:"#insertChild",_insertAt:function(a,b){var c=a&&a._getOwner(),d=a!==this&&c?this:null;
d&&(d._remove(!1,!0),c._insertItem(a._index+b,d));return d},insertAbove:function(a){return this._insertAt(a,1)},insertBelow:function(a){return this._insertAt(a,0)},sendToBack:function(){var a=this._getOwner();return a?a._insertItem(0,this):null},bringToFront:function(){var a=this._getOwner();return a?a._insertItem(b,this):null},appendTop:"#addChild",appendBottom:function(a){return this.insertChild(0,a)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(a){return a._insertItem(b,this)},
copyTo:function(a){return this.clone(!1).addTo(a)},reduce:function(a){var b=this._children;return b&&1===b.length?(a=b[0].reduce(a),this._parent?(a.insertAbove(this),this.remove()):a.remove(),a):this},_removeNamed:function(){var a=this._getOwner();if(a){var b=a._children;a=a._namedChildren;var c=this._name,d=a[c],e=d?d.indexOf(this):-1;-1!==e&&(b[c]==this&&delete b[c],d.splice(e,1),d.length?b[c]=d[0]:delete a[c])}},_remove:function(a,b){var c=this._getOwner(),d=this._project,f=this._index;this._style&&
this._style._dispose();return c?(this._name&&this._removeNamed(),null!=f&&(d._activeLayer===this&&(d._activeLayer=this.getNextSibling()||this.getPreviousSibling()),e.splice(c._children,null,f,1)),this._installEvents(!1),a&&d._changes&&this._changed(5),b&&c._changed(11,this),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(a){(a=a&&a.insertBelow(this))&&this.remove();return a},removeChildren:function(a,b){if(!this._children)return null;a=a||0;b=e.pick(b,
this._children.length);for(var c=e.splice(this._children,null,a,b-a),d=c.length-1;0<=d;d--)c[d]._remove(!0,!1);0<c.length&&this._changed(11);return c},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var a=0,b=this._children.length;a<b;a++)this._children[a]._index=a;this._changed(11)}},isEmpty:function(){var a=this._children;return!a||!a.length},isEditable:function(){for(var a=this;a;){if(!a._visible||a._locked)return!1;a=a._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},
hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(a){function b(a){var b=[];do b.unshift(a);while(a=a._parent);return b}var c=b(this);a=b(a);for(var d=0,e=Math.min(c.length,a.length);d<e;d++)if(c[d]!=a[d])return c[d]._index<a[d]._index?1:-1;return 0},hasChildren:function(){return this._children&&0<this._children.length},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(a){return-1===
this._getOrder(a)},isBelow:function(a){return 1===this._getOrder(a)},isParent:function(a){return this._parent===a},isChild:function(a){return a&&a._parent===this},isDescendant:function(a){for(var b=this;b=b._parent;)if(b===a)return!0;return!1},isAncestor:function(a){return a?a.isDescendant(this):!1},isSibling:function(a){return this._parent===a._parent},isGroupedWith:function(a){for(var b=this._parent;b;){if(b._parent&&/^(Group|Layer|CompoundPath)$/.test(b._class)&&a.isDescendant(b))return!0;b=b._parent}return!1}},
e.each(["rotate","scale","shear","skew"],function(a){var b="rotate"===a;this[a]=function(){var c=(b?e:m).read(arguments),d=m.read(arguments,0,{readNull:!0});return this.transform((new P)[a](c,d||this.getPosition(!0)))}},{translate:function(){var a=new P;return this.transform(a.translate.apply(a,arguments))},transform:function(a,b,c,d){var e=this._matrix,f=a&&!a.isIdentity();b=(b||this._applyMatrix)&&(!e.isIdentity()||f||b&&c&&this._children);if(!f&&!b)return this;if(f){!a.isInvertible()&&e.isInvertible()&&
(e._backup=e.getValues());e.prepend(a,!0);var g=this._style,h=g.getFillColor(!0);g=g.getStrokeColor(!0);h&&h.transform(a);g&&g.transform(a)}b&&(b=this._transformContent(e,c,d))&&((c=this._pivot)&&e._transformPoint(c,c,!0),e.reset(!0),d&&this._canApplyMatrix&&(this._applyMatrix=!0));d=this._bounds;e=this._position;(f||b)&&this._changed(25);if((c=f&&d&&a.decompose())&&c.skewing.isZero()&&0===c.rotation%90){for(var k in d)if(f=d[k],f.nonscaling)delete d[k];else if(b||!f.internal)f=f.rect,a._transformBounds(f,
f);this._bounds=d;if(a=d[this._getBoundsCacheKey(this._boundsOptions||{})])this._position=this._getPositionFromBounds(a.rect)}else f&&e&&this._pivot&&(this._position=a._transformPoint(e,e));return this},_transformContent:function(a,b,c){var d=this._children;if(d){for(var e=0,f=d.length;e<f;e++)d[e].transform(a,!0,b,c);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(m.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(m.read(arguments))},
parentToLocal:function(){return this._matrix._inverseTransform(m.read(arguments))},localToParent:function(){return this._matrix._transformPoint(m.read(arguments))},fitBounds:function(a,b){a=E.read(arguments);var c=this.getBounds(),d=c.height/c.width,e=a.height/a.width;d=(b?d>e:d<e)?a.width/c.width:a.height/c.height;c=new E(new m,new p(c.width*d,c.height*d));c.setCenter(a.getCenter());this.setBounds(c)}}),{_setStyles:function(a,b,c){var d=this._style,e=this._matrix;d.hasFill()&&(a.fillStyle=d.getFillColor().toCanvasStyle(a,
e));if(d.hasStroke()){a.strokeStyle=d.getStrokeColor().toCanvasStyle(a,e);a.lineWidth=d.getStrokeWidth();e=d.getStrokeJoin();var f=d.getStrokeCap(),g=d.getMiterLimit();e&&(a.lineJoin=e);f&&(a.lineCap=f);g&&(a.miterLimit=g);fa.support.nativeDash&&(e=d.getDashArray(),f=d.getDashOffset(),e&&e.length&&("setLineDash"in a?(a.setLineDash(e),a.lineDashOffset=f):(a.mozDash=e,a.mozDashOffset=f)))}d.hasShadow()&&(b=b.pixelRatio||1,b=c._shiftless().prepend((new P).scale(b,b)),c=b.transform(new m(d.getShadowBlur(),
0)),b=b.transform(this.getShadowOffset()),a.shadowColor=d.getShadowColor().toCanvasStyle(a),a.shadowBlur=c.getLength(),a.shadowOffsetX=b.x,a.shadowOffsetY=b.y)},draw:function(a,b,c){this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var d=b.matrices,e=b.viewMatrix,f=this._matrix,g=d[d.length-1].appended(f);if(g.isInvertible()){e=e?e.appended(g):g;d.push(g);b.updateMatrix&&(this._globalMatrix=g);g=this._blendMode;var h=this._opacity,k="normal"===g,ea=xb.nativeModes[g];
k=k&&1===h||b.dontStart||b.clip||(ea||k&&1>h)&&this._canComposite();var t=b.pixelRatio||1;if(!k){var w=this.getStrokeBounds(e);if(!w.width||!w.height){d.pop();return}var x=b.offset;var z=b.offset=w.getTopLeft().floor();var J=a;a=ra.getContext(w.getSize().ceil().add(1).multiply(t));1!==t&&a.scale(t,t)}a.save();c=c?c.appended(f):this._canScaleStroke&&!this.getStrokeScaling(!0)&&e;w=!k&&b.clipItem;var r=!c||w;k?(a.globalAlpha=h,ea&&(a.globalCompositeOperation=g)):r&&a.translate(-z.x,-z.y);r&&(k?f:e).applyToContext(a);
w&&b.clipItem.draw(a,b.extend({clip:!0}));c&&(a.setTransform(t,0,0,t,0,0),(f=b.offset)&&a.translate(-f.x,-f.y));this._draw(a,b,e,c);a.restore();d.pop();b.clip&&!b.dontFinish&&a.clip();k||(xb.process(g,a,J,h,z.subtract(x).multiply(t)),ra.release(a),b.offset=x)}}},_isUpdated:function(a){var b=this._parent;if(b instanceof Ka)return b._isUpdated(a);var c=this._updateVersion===a;!c&&b&&b._visible&&b._isUpdated(a)&&(this._updateVersion=a,c=!0);return c},_drawSelection:function(a,b,c,d,e){var f=this._selection,
g=f&1,B=f&2||g&&this._selectBounds;f&=4;this._drawSelected||(g=!1);if((g||B||f)&&this._isUpdated(e)){var h;e=this.getSelectedColor(!0)||(h=this.getLayer())&&h.getSelectedColor(!0);h=b.appended(this.getGlobalMatrix(!0));b=c/2;a.strokeStyle=a.fillStyle=e?e.toCanvasStyle(a):"#009dec";g&&this._drawSelected(a,h,d);if(f){d=this.getPosition(!0);g=(g=this._parent)?g.localToGlobal(d):d;d=g.x;f=g.y;a.beginPath();a.arc(d,f,b,0,2*Math.PI,!0);a.stroke();e=[[0,-1],[1,0],[0,1],[-1,0]];var k=c+1;for(g=0;4>g;g++){var t=
e[g],w=t[0];t=t[1];a.moveTo(d+w*b,f+t*b);a.lineTo(d+w*k,f+t*k);a.stroke()}}if(B){B=h._transformCorners(this.getInternalBounds());a.beginPath();for(g=0;8>g;g++)a[g?"lineTo":"moveTo"](B[g],B[++g]);a.closePath();a.stroke();for(g=0;8>g;g++)a.fillRect(B[g]-b,B[++g]-b,c,c)}}},_canComposite:function(){return!1}},e.each(["down","drag","up","move"],function(a){this["removeOn"+e.capitalize(a)]=function(){var b={};b[a]=!0;return this.removeOn(b)}},{removeOn:function(a){for(var b in a)if(a[b]){var c="mouse"+
b,d=this._project;d=d._removeSets=d._removeSets||{};d[c]=d[c]||{};d[c][this._id]=this}return this}})),Ma=Q.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(a){this._children=[];this._namedChildren={};this._initialize(a)||this.addChildren(Array.isArray(a)?a:arguments)},_changed:function Yb(a){Yb.base.call(this,a);a&2050&&(this._clipItem=b)},_getClipItem:function(){var a=this._clipItem;if(a===b){a=null;for(var c=this._children,d=0,e=c.length;d<
e;d++)if(c[d]._clipMask){a=c[d];break}this._clipItem=a}return a},isClipped:function(){return!!this._getClipItem()},setClipped:function(a){var b=this.getFirstChild();b&&b.setClipMask(a)},_getBounds:function B(a,b){var c=this._getClipItem();return c?c._getCachedBounds(a&&a.appended(c._matrix),e.set({},b,{stroke:!1})):B.base.call(this,a,b)},_hitTestChildren:function F(a,b,c){var d=this._getClipItem();return(!d||d.contains(a))&&F.base.call(this,a,b,c,d)},_draw:function(a,b){var c=b.clip,d=!c&&this._getClipItem();
b=b.extend({clipItem:d,clip:!1});c?(a.beginPath(),b.dontStart=b.dontFinish=!0):d&&d.draw(a,b.extend({clip:!0}));c=this._children;for(var e=0,f=c.length;e<f;e++){var g=c[e];g!==d&&g.draw(a,b)}}}),$a=Ma.extend({_class:"Layer",initialize:function(){Ma.apply(this,arguments)},_getOwner:function(){return this._parent||null!=this._index&&this._project},isInserted:function B(){return this._parent?B.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),
Ga=Q.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(a,b){this._initialize(a,b)},_equals:function(a){return this._type===a._type&&this._size.equals(a._size)&&e.equals(this._radius,a._radius)},copyContent:function(a){this.setType(a._type);this.setSize(a._size);this.setRadius(a._radius)},getType:function(){return this._type},setType:function(a){this._type=a},getShape:"#getType",setShape:"#setType",getSize:function(){var a=
this._size;return new K(a.width,a.height,this,"setSize")},setSize:function(){var a=p.read(arguments);if(!this._size)this._size=a.clone();else if(!this._size.equals(a)){var b=this._type,c=a.width,d=a.height;"rectangle"===b?this._radius.set(p.min(this._radius,a.divide(2))):"circle"===b?(c=d=(c+d)/2,this._radius=c/2):"ellipse"===b&&this._radius._set(c/2,d/2);this._size._set(c,d);this._changed(9)}},getRadius:function(){var a=this._radius;return"circle"===this._type?a:new K(a.width,a.height,this,"setRadius")},
setRadius:function(a){var b=this._type;if("circle"===b){if(a===this._radius)return;b=2*a;this._radius=a;this._size._set(b,b)}else if(a=p.read(arguments),this._radius){if(this._radius.equals(a))return;this._radius.set(a);"rectangle"===b?(b=p.max(this._size,a.multiply(2)),this._size.set(b)):"ellipse"===b&&this._size._set(2*a.width,2*a.height)}else this._radius=a.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(a){var c=new (aa[e.capitalize(this._type)])({center:new m,size:this._size,
radius:this._radius,insert:!1});c.copyAttributes(this);fa.settings.applyMatrix&&c.setApplyMatrix(!0);(a===b||a)&&c.insertAbove(this);return c},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(a,b,c,d){var e=this._style,f=e.hasFill(),g=e.hasStroke(),B=b.dontFinish||b.clip,h=!d;if(f||g||B){var M=this._type,F=this._radius,r="circle"===M;b.dontStart||a.beginPath();if(h&&r)a.arc(0,0,F,0,2*Math.PI,!0);else{var k=r?F:F.width;F=r?F:F.height;var q=this._size;r=q.width;q=q.height;
h&&"rectangle"===M&&0===k&&0===F?a.rect(-r/2,-q/2,r,q):(h=r/2,M=q/2,r=.44771525016920644*k,q=.44771525016920644*F,r=[-h,-M+F,-h,-M+q,-h+r,-M,-h+k,-M,h-k,-M,h-r,-M,h,-M+q,h,-M+F,h,M-F,h,M-q,h-r,M,h-k,M,-h+k,M,-h+r,M,-h,M-q,-h,M-F],d&&d.transform(r,r,32),a.moveTo(r[0],r[1]),a.bezierCurveTo(r[2],r[3],r[4],r[5],r[6],r[7]),h!==k&&a.lineTo(r[8],r[9]),a.bezierCurveTo(r[10],r[11],r[12],r[13],r[14],r[15]),M!==F&&a.lineTo(r[16],r[17]),a.bezierCurveTo(r[18],r[19],r[20],r[21],r[22],r[23]),h!==k&&a.lineTo(r[24],
r[25]),a.bezierCurveTo(r[26],r[27],r[28],r[29],r[30],r[31]))}a.closePath()}B||!f&&!g||(this._setStyles(a,b,c),f&&(a.fill(e.getFillRule()),a.shadowColor="rgba(0,0,0,0)"),g&&a.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(a,b){var c=(new E(this._size)).setCenter(0,0),d=this._style;d=b.stroke&&d.hasStroke()&&d.getStrokeWidth();a&&(c=a._transformBounds(c));return d?c.expand(aa._getStrokePadding(d,this._getStrokeMatrix(a,b))):c}},new function(){function a(a,
b,c){var d=a._radius;if(!d.isZero()){a=a._size.divide(2);for(var e=1;4>=e;e++){var f=new m(1<e&&4>e?-1:1,2<e?-1:1),g=f.multiply(a),h=g.subtract(f.multiply(d));if((new E(c?g.add(f.multiply(c)):g,h)).contains(b))return{point:h,quadrant:e}}}}function b(a,b,c,d){a=a.divide(b);return(!d||a.isInQuadrant(d))&&1>=a.subtract(a.normalize()).multiply(b).divide(c).length}return{_contains:function Ja(b){if("rectangle"===this._type){var c=a(this,b);return c?1>=b.subtract(c.point).divide(this._radius).getLength():
Ja.base.call(this,b)}return.5>=b.divide(this.size).getLength()},_hitTestSelf:function x(c,d,e,f){var g=!1,h=this._style,B=d.stroke&&h.hasStroke(),t=d.fill&&h.hasFill();if(B||t){t=this._type;g=this._radius;var w=B?h.getStrokeWidth()/2:0;w=d._tolerancePadding.add(aa._getStrokePadding(w,!h.getStrokeScaling()&&f));"rectangle"===t?(h=w.multiply(2),(t=a(this,c,h))?g=b(c.subtract(t.point),g,w,t.quadrant):(t=(new E(this._size)).setCenter(0,0),g=t.expand(h),h=t.expand(h.negate()),g=g._containsPoint(c)&&!h._containsPoint(c))):
g=b(c,g,w)}return g?new Ua(B?"stroke":"fill",this):x.base.apply(this,arguments)}}},{statics:new function(){function a(a,b,c,d,f){b=new Ga(e.getNamed(f),b);b._type=a;b._size=c;b._radius=d;return b}return{Circle:function(){var b=m.readNamed(arguments,"center"),c=e.readNamed(arguments,"radius");return a("circle",b,new p(2*c),c,arguments)},Rectangle:function(){var b=E.readNamed(arguments,"rectangle"),c=p.min(p.readNamed(arguments,"radius"),b.getSize(!0).divide(2));return a("rectangle",b.getCenter(!0),
b.getSize(!0),c,arguments)},Ellipse:function(){var b=Ga._readEllipse(arguments),c=b.radius;return a("ellipse",b.center,c.multiply(2),c,arguments)},_readEllipse:function(a){if(e.hasNamed(a,"radius")){var b=m.readNamed(a,"center");a=p.readNamed(a,"radius")}else a=E.readNamed(a,"rectangle"),b=a.getCenter(!0),a=a.getSize(!0).divide(2);return{center:b,radius:a}}}}}),ab=Q.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},
_prioritize:["crossOrigin"],_smoothing:!0,initialize:function(a,c){if(!this._initialize(a,c!==b&&m.read(arguments,1))){var e="string"===typeof a?d.getElementById(a):a;e?this.setImage(e):this.setSource(a)}this._size||(this._size=new p,this._loaded=!1)},_equals:function(a){return this.getSource()===a.getSource()},copyContent:function(a){var b=a._image,c=a._canvas;b?this._setImage(b):c&&(b=ra.getCanvas(a._size),b.getContext("2d").drawImage(c,0,0),this._setImage(b));this._crossOrigin=a._crossOrigin},
getSize:function(){var a=this._size;return new K(a?a.width:0,a?a.height:0,this,"setSize")},setSize:function(){var a=p.read(arguments);if(!a.equals(this._size))if(0<a.width&&0<a.height){var b=this.getElement();this._setImage(ra.getCanvas(a));b&&this.getContext(!0).drawImage(b,0,0,a.width,a.height)}else this._canvas&&ra.release(this._canvas),this._size=a.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(a){this.setSize(a,this.getHeight())},getHeight:function(){return this._size?
this._size.height:0},setHeight:function(a){this.setSize(this.getWidth(),a)},getLoaded:function(){return this._loaded},isEmpty:function(){var a=this._size;return!a||0===a.width&&0===a.height},getResolution:function(){var a=this._matrix,b=(new m(0,0)).transform(a),c=(new m(1,0)).transform(a).subtract(b);a=(new m(0,1)).transform(a).subtract(b);return new p(72/c.getLength(),72/a.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(a){function b(a){var b=c.getView(),
d=a&&a.type||"load";b&&c.responds(d)&&(fa=b._scope,c.emit(d,new qb(a)))}var c=this;this._setImage(a);this._loaded?setTimeout(b,0):a&&ua.add(a,{load:function(d){c._setImage(a);b(d)},error:b})},_setImage:function(a){this._canvas&&ra.release(this._canvas);a&&a.getContext?(this._image=null,this._canvas=a,this._loaded=!0):(this._image=a,this._canvas=null,this._loaded=!!(a&&a.src&&a.complete));this._size=new p(a?a.naturalWidth||a.width:0,a?a.naturalHeight||a.height:0);this._context=null;this._changed(1033)},
getCanvas:function(){if(!this._canvas){var a=ra.getContext(this._size);try{this._image&&a.drawImage(this._image,0,0),this._canvas=a.canvas}catch(M){ra.release(a)}}return this._canvas},setCanvas:"#setImage",getContext:function(a){this._context||(this._context=this.getCanvas().getContext("2d"));a&&(this._image=null,this._changed(1025));return this._context},setContext:function(a){this._context=a},getSource:function(){var a=this._image;return a&&a.src||this.toDataURL()},setSource:function(b){var c=new a.Image,
d=this._crossOrigin;d&&(c.crossOrigin=d);c.src=b;this.setImage(c)},getCrossOrigin:function(){var a=this._image;return a&&a.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(a){this._crossOrigin=a;var b=this._image;b&&(b.crossOrigin=a)},getSmoothing:function(){return this._smoothing},setSmoothing:function(a){this._smoothing=a;this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var a=E.read(arguments),b=ra.getContext(a.getSize());
b.drawImage(this.getCanvas(),a.x,a.y,a.width,a.height,0,0,a.width,a.height);return b.canvas},getSubRaster:function(){var a=E.read(arguments),b=new ab(Q.NO_INSERT);b._setImage(this.getSubCanvas(a));b.translate(a.getCenter().subtract(this.getSize().divide(2)));b._matrix.prepend(this._matrix);b.insertAbove(this);return b},toDataURL:function(){var a=this._image;a=a&&a.src;return/^data:/.test(a)?a:(a=this.getCanvas())?a.toDataURL.apply(a,arguments):null},drawImage:function(a){var b=m.read(arguments,1);
this.getContext(!0).drawImage(a,b.x,b.y)},getAverageColor:function(a){if(a)if(a instanceof eb){var b=a;var c=a.getBounds()}else"object"===typeof a&&("width"in a?c=new E(a):"x"in a&&(c=new E(a.x-.5,a.y-.5,1,1)));else c=this.getBounds();if(!c)return null;a=Math.min(c.width,32);var d=Math.min(c.height,32),f=ab._sampleContext;f?f.clearRect(0,0,33,33):f=ab._sampleContext=ra.getContext(new p(32));f.save();c=(new P).scale(a/c.width,d/c.height).translate(-c.x,-c.y);c.applyToContext(f);b&&b.draw(f,new e({clip:!0,
matrices:[c]}));this._matrix.applyToContext(f);b=this.getElement();c=this._size;b&&f.drawImage(b,-c.width/2,-c.height/2);f.restore();a=f.getImageData(.5,.5,Math.ceil(a),Math.ceil(d)).data;d=[0,0,0];b=f=0;for(c=a.length;b<c;b+=4){var g=a[b+3];f+=g;g/=255;d[0]+=a[b]*g;d[1]+=a[b+1]*g;d[2]+=a[b+2]*g}for(b=0;3>b;b++)d[b]/=f;return f?Oa.read(d):null},getPixel:function(){var a=m.read(arguments);a=this.getContext().getImageData(a.x,a.y,1,1).data;return new Oa("rgb",[a[0]/255,a[1]/255,a[2]/255],a[3]/255)},
setPixel:function(){var a=m.read(arguments),b=Oa.read(arguments),c=b._convert("rgb");b=b._alpha;var d=this.getContext(!0),e=d.createImageData(1,1),f=e.data;f[0]=255*c[0];f[1]=255*c[1];f[2]=255*c[2];f[3]=null!=b?255*b:255;d.putImageData(e,a.x,a.y)},createImageData:function(){var a=p.read(arguments);return this.getContext().createImageData(a.width,a.height)},getImageData:function(){var a=E.read(arguments);a.isEmpty()&&(a=new E(this._size));return this.getContext().getImageData(a.x,a.y,a.width,a.height)},
setImageData:function(a){var b=m.read(arguments,1);this.getContext(!0).putImageData(a,b.x,b.y)},_getBounds:function(a,b){var c=(new E(this._size)).setCenter(0,0);return a?a._transformBounds(c):c},_hitTestSelf:function(a){if(this._contains(a)){var b=this;return new Ua("pixel",b,{offset:a.add(b._size.divide(2)).round(),color:{get:function(){return b.getPixel(this.offset)}}})}},_draw:function(a,b,c){var d=this.getElement();d&&(a.globalAlpha=this._opacity,this._setStyles(a,b,c),va.setPrefixed(a,"imageSmoothingEnabled",
this._smoothing),a.drawImage(d,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),ob=Q.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(a,c){this._initialize(a,c!==b&&m.read(arguments,1))||this.setDefinition(a instanceof v?a:new v(a))},_equals:function(a){return this._definition===a._definition},copyContent:function(a){this.setDefinition(a._definition)},getDefinition:function(){return this._definition},
setDefinition:function(a){this._definition=a;this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(a,b){var c=this._definition._item;return c._getCachedBounds(c._matrix.prepended(a),b)},_hitTestSelf:function(a,b,c){if(a=this._definition._item._hitTest(a,b,c))a.item=this;return a},_draw:function(a,b){this._definition._item.draw(a,b)}}),v=e.extend({_class:"SymbolDefinition",initialize:function(a,b){this._id=
n.get();this.project=fa.project;a&&this.setItem(a,b)},_serialize:function(a,b){return b.add(this,function(){return e.serialize([this._class,this._item],a,!1,b)})},_changed:function(a){a&8&&Q._clearBoundsCache(this);a&1&&this.project._changed(a)},getItem:function(){return this._item},setItem:function(a,b){a._symbol&&(a=a.clone());this._item&&(this._item._symbol=null);this._item=a;a.remove();a.setSelected(!1);b||a.setPosition(new m);a._symbol=this;this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",
place:function(a){return new ob(this,a)},clone:function(){return new v(this._item.clone(!1))},equals:function(a){return a===this||a&&this._item.equals(a._item)||!1}}),Ua=e.extend({_class:"HitResult",initialize:function(a,b,c){this.type=a;this.item=b;c&&this.inject(c)},statics:{getOptions:function(a){a=a&&e.read(a);return e.set({type:null,tolerance:fa.settings.hitTolerance,fill:!a,stroke:!a,segments:!a,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},a)}}}),T=e.extend({_class:"Segment",
beans:!0,_selection:0,initialize:function(a,c,d,e,f,g){var h=arguments.length;if(0<h)if(null==a||"object"===typeof a)if(1===h&&a&&"point"in a){var w=a.point;var B=a.handleIn;var k=a.handleOut;var F=a.selection}else w=a,B=c,k=d,F=e;else w=[a,c],B=d!==b?[d,e]:null,k=f!==b?[f,g]:null;new wb(w,this,"_point");new wb(B,this,"_handleIn");new wb(k,this,"_handleOut");F&&this.setSelection(F)},_serialize:function(a,b){var c=this._point,d=this._selection;c=d||this.hasHandles()?[c,this._handleIn,this._handleOut]:
c;d&&c.push(d);return e.serialize(c,a,!0,b)},_changed:function(a){var b=this._path;if(b){var c=b._curves,d=this._index,e;c&&(a&&a!==this._point&&a!==this._handleIn||!(e=0<d?c[d-1]:b._closed?c[c.length-1]:null)||e._changed(),a&&a!==this._point&&a!==this._handleOut||!(e=c[d])||e._changed());b._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(m.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(m.read(arguments))},
getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(m.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var a=this._handleIn,b=this._handleOut;return!a.isZero()&&!b.isZero()&&a.isCollinear(b)},clearHandles:function(){this._handleIn._set(0,0);this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(a){var b=this._selection,c=this._path;this._selection=
a=a||0;c&&a!==b&&(c._updateSelection(this,b,a),c._changed(257))},_changeSelection:function(a,b){var c=this._selection;this.setSelection(b?c|a:c&~a)},isSelected:function(){return!!(this._selection&7)},setSelected:function(a){this._changeSelection(7,a)},getIndex:function(){return this._index!==b?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var a=this._path,b=this._index;return a?(0<b&&!a._closed&&b===a._segments.length-1&&b--,a.getCurves()[b]||null):null},getLocation:function(){var a=
this.getCurve();return a?new Da(a,this===a._segment1?0:1):null},getNext:function(){var a=this._path&&this._path._segments;return a&&(a[this._index+1]||this._path._closed&&a[0])||null},smooth:function(a,c,d){a=a||{};var e=a.type,f=a.factor,g=this.getPrevious();a=this.getNext();var h=(g||this)._point,w=this._point,B=(a||this)._point,k=h.getDistance(w),F=w.getDistance(B);if(e&&"catmull-rom"!==e)if("geometric"===e)g&&a&&(a=h.subtract(B),h=f===b?.4:f,w=h*k/(k+F),c||this.setHandleIn(a.multiply(w)),d||this.setHandleOut(a.multiply(w-
h)));else throw Error("Smoothing method '"+e+"' not supported.");else f=f===b?.5:f,k=Math.pow(k,f),e=k*k,F=Math.pow(F,f),f=F*F,!c&&g&&(c=2*f+3*F*k+e,g=3*F*(F+k),this.setHandleIn(0!==g?new m((f*h._x+c*w._x-e*B._x)/g-w._x,(f*h._y+c*w._y-e*B._y)/g-w._y):new m)),!d&&a&&(c=2*e+3*k*F+f,g=3*k*(k+F),this.setHandleOut(0!==g?new m((e*B._x+c*w._x-f*h._x)/g-w._x,(e*B._y+c*w._y-f*h._y)/g-w._y):new m))},getPrevious:function(){var a=this._path&&this._path._segments;return a&&(a[this._index-1]||this._path._closed&&
a[a.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var a=this._path;return a&&this._index===a._segments.length-1||!1},reverse:function(){var a=this._handleIn,b=this._handleOut,c=a.clone();a.set(b);b.set(c)},reversed:function(){return new T(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new T(this._point,this._handleIn,this._handleOut)},equals:function(a){return a===this||
a&&this._class===a._class&&this._point.equals(a._point)&&this._handleIn.equals(a._handleIn)&&this._handleOut.equals(a._handleOut)||!1},toString:function(){var a=["point: "+this._point];this._handleIn.isZero()||a.push("handleIn: "+this._handleIn);this._handleOut.isZero()||a.push("handleOut: "+this._handleOut);return"{ "+a.join(", ")+" }"},transform:function(a){this._transformCoordinates(a,Array(6),!0);this._changed()},interpolate:function(a,b,c){var d=1-c,e=a._point,f=b._point,g=a._handleIn,h=b._handleIn;
b=b._handleOut;a=a._handleOut;this._point._set(d*e._x+c*f._x,d*e._y+c*f._y,!0);this._handleIn._set(d*g._x+c*h._x,d*g._y+c*h._y,!0);this._handleOut._set(d*a._x+c*b._x,d*a._y+c*b._y,!0);this._changed()},_transformCoordinates:function(a,b,c){var d=this._point,e=c&&this._handleIn.isZero()?null:this._handleIn,f=c&&this._handleOut.isZero()?null:this._handleOut,g=d._x,h=d._y,k=2;b[0]=g;b[1]=h;e&&(b[k++]=e._x+g,b[k++]=e._y+h);f&&(b[k++]=f._x+g,b[k++]=f._y+h);a&&(a._transformCoordinates(b,b,k/2),g=b[0],h=
b[1],c?(d._x=g,d._y=h,k=2,e&&(e._x=b[k++]-g,e._y=b[k++]-h),f&&(f._x=b[k++]-g,f._y=b[k++]-h)):(e||(b[k++]=g,b[k++]=h),f||(b[k++]=g,b[k++]=h)));return b}}),wb=m.extend({initialize:function(a,c,d){var e;if(a)if((e=a[0])!==b)var f=a[1];else{var g=a;(e=g.x)===b&&(g=m.read(arguments),e=g.x);f=g.y;g=g.selected}else e=f=0;this._x=e;this._y=f;this._owner=c;c[d]=this;g&&this.setSelected(!0)},_set:function(a,b){this._x=a;this._y=b;this._owner._changed(this);return this},getX:function(){return this._x},setX:function(a){this._x=
a;this._owner._changed(this)},getY:function(){return this._y},setY:function(a){this._y=a;this._owner._changed(this)},isZero:function(){var a=l.isZero;return a(this._x)&&a(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(a){this._owner._changeSelection(this._getSelection(),a)},_getSelection:function(){var a=this._owner;return this===a._point?1:this===a._handleIn?2:this===a._handleOut?4:0}}),H=e.extend({_class:"Curve",beans:!0,initialize:function(a,
b,c,d,e,f,g,h){var t=arguments.length;if(3===t){this._path=a;var w=b;var k=c}else if(t)if(1===t)if("segment1"in a)w=new T(a.segment1),k=new T(a.segment2);else if("point1"in a){var r=a.point1;var B=a.handle1;var q=a.handle2;var F=a.point2}else Array.isArray(a)&&(r=[a[0],a[1]],F=[a[6],a[7]],B=[a[2]-a[0],a[3]-a[1]],q=[a[4]-a[6],a[5]-a[7]]);else 2===t?(w=new T(a),k=new T(b)):4===t?(r=a,B=b,q=c,F=d):8===t&&(r=[a,b],F=[g,h],B=[c-a,d-b],q=[e-g,f-h]);else w=new T,k=new T;this._segment1=w||new T(r,null,B);
this._segment2=k||new T(F,q,null)},_serialize:function(a,b){return e.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],a,!0,b)},_changed:function(){this._length=this._bounds=b},clone:function(){return new H(this._segment1,this._segment2)},toString:function(){var a=["point1: "+this._segment1._point];this._segment1._handleOut.isZero()||a.push("handle1: "+this._segment1._handleOut);this._segment2._handleIn.isZero()||
a.push("handle2: "+this._segment2._handleIn);a.push("point2: "+this._segment2._point);return"{ "+a.join(", ")+" }"},classify:function(){return H.classify(this.getValues())},remove:function(){var a=!1;if(this._path){a=this._segment2;var b=a._handleOut;(a=a.remove())&&this._segment1._handleOut.set(b)}return a},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(m.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(m.read(arguments))},
getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(m.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(m.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index+
1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index-1]||this._path._closed&&a[a.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var a=this._path;return a&&this._segment1._index===a._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(a){this.getPoint1().setSelected(a);
this.getHandle1().setSelected(a);this.getHandle2().setSelected(a);this.getPoint2().setSelected(a)},getValues:function(a){return H.getValues(this._segment1,this._segment2,a)},getPoints:function(){for(var a=this.getValues(),b=[],c=0;8>c;c+=2)b.push(new m(a[c],a[c+1]));return b}},{getLength:function(){null==this._length&&(this._length=H.getLength(this.getValues(),0,1));return this._length},getArea:function(){return H.getArea(this.getValues())},getLine:function(){return new qa(this._segment1._point,this._segment2._point)},
getPart:function(a,b){return new H(H.getPart(this.getValues(),a,b))},getPartLength:function(a,b){return H.getLength(this.getValues(),a,b)},divideAt:function(a){return this.divideAtTime(a&&a.curve===this?a.time:this.getTimeAt(a))},divideAtTime:function(a,b){var c=null;if(1E-8<=a&&.99999999>=a){var d=H.subdivide(this.getValues(),a);c=d[0];var e=d[1],f=b||this.hasHandles();d=this._segment1;var g=this._segment2,h=this._path;f&&(d._handleOut._set(c[2]-c[0],c[3]-c[1]),g._handleIn._set(e[4]-e[6],e[5]-e[7]));
var k=c[6],z=c[7];c=new T(new m(k,z),f&&new m(c[4]-k,c[5]-z),f&&new m(e[2]-k,e[3]-z));h?(h.insert(d._index+1,c),c=this.getNext()):(this._segment2=c,this._changed(),c=new H(c,g))}return c},splitAt:function(a){var b=this._path;return b?b.splitAt(a):null},splitAtTime:function(a){return this.splitAt(this.getLocationAtTime(a))},divide:function(a,c){return this.divideAtTime(a===b?.5:c?a:this.getTimeAt(a))},split:function(a,c){return this.splitAtTime(a===b?.5:c?a:this.getTimeAt(a))},reversed:function(){return new H(this._segment2.reversed(),
this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0);this._segment2._handleIn._set(0,0)},statics:{getValues:function(a,b,c,d){var e=a._point;a=a._handleOut;var f=b._handleIn,g=b._point;b=e.x;e=e.y;var h=g.x;g=g.y;d=d?[b,e,b,e,h,g,h,g]:[b,e,b+a._x,e+a._y,h+f._x,g+f._y,h,g];c&&c._transformCoordinates(d,d,4);return d},subdivide:function(a,c){var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],w=a[5],k=a[6],z=a[7];c===b&&(c=.5);var J=1-c,r=J*d+c*f,B=J*e+c*g,q=J*f+c*h,I=J*g+c*w;h=
J*h+c*k;w=J*w+c*z;g=J*r+c*q;f=J*B+c*I;q=J*q+c*h;I=J*I+c*w;var A=J*g+c*q;J=J*f+c*I;return[[d,e,r,B,g,f,A,J],[A,J,q,I,h,w,k,z]]},getMonoCurves:function(a,b){var c=[],d=b?0:1,e=a[d+0],f=a[d+2],g=a[d+4],h=a[d+6];e>=f===f>=g&&f>=g===g>=h||H.isStraight(a)?c.push(a):(d=[],(e=l.solveQuadratic(3*(f-g)-e+h,2*(e+g)-4*f,f-e,d,1E-8,.99999999))?(d.sort(),f=d[0],g=H.subdivide(a,f),c.push(g[0]),1<e&&(f=(d[1]-f)/(1-f),g=H.subdivide(g[1],f),c.push(g[0])),c.push(g[1])):c.push(a));return c},solveCubic:function(a,b,c,
d,e,f){var g=a[b],h=a[b+2],k=a[b+4];a=a[b+6];b=0;g<c&&a<c&&h<c&&k<c||g>c&&a>c&&h>c&&k>c||(b=3*(h-g),h=3*(k-h)-b,b=l.solveCubic(a-g-b-h,h,b,g-c,d,e,f));return b},getTimeOf:function(a,b){var c=new m(a[0],a[1]),d=new m(a[6],a[7]);if(null===(b.isClose(c,1E-12)?0:b.isClose(d,1E-12)?1:null))for(var e=[b.x,b.y],f=[],g=0;2>g;g++)for(var h=H.solveCubic(a,g,e[g],f,0,1),k=0;k<h;k++){var z=f[k];if(b.isClose(H.getPoint(a,z),1E-7))return z}return b.isClose(c,1E-7)?0:b.isClose(d,1E-7)?1:null},getNearestTime:function(a,
b){function c(c){if(0<=c&&1>=c){var d=b.getDistance(H.getPoint(a,c),!0);if(d<k)return k=d,z=c,!0}}if(H.isStraight(a)){var d=a[0],e=a[1],f=a[6]-d,g=a[7]-e,h=f*f+g*g;if(0===h)return 0;h=((b.x-d)*f+(b.y-e)*g)/h;return 1E-12>h?0:.999999999999<h?1:H.getTimeOf(a,new m(d+h*f,e+h*g))}var k=Infinity,z=0;for(d=0;100>=d;d++)c(d/100);for(d=.005;1E-8<d;)c(z-d)||c(z+d)||(d/=2);return z},getPart:function(a,b,c){var d=b>c;if(d){var e=b;b=c;c=e}0<b&&(a=H.subdivide(a,b)[1]);1>c&&(a=H.subdivide(a,(c-b)/(1-b))[0]);return d?
[a[6],a[7],a[4],a[5],a[2],a[3],a[0],a[1]]:a},isFlatEnough:function(a,b){var c=a[0],d=a[1],e=a[6],f=a[7],g=3*a[2]-2*c-e,h=3*a[3]-2*d-f;c=3*a[4]-2*e-c;d=3*a[5]-2*f-d;return Math.max(g*g,c*c)+Math.max(h*h,d*d)<=16*b*b},getArea:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6];a=a[7];return 3*((a-c)*(d+f)-(h-b)*(e+g)+e*(b-f)-d*(c-g)+a*(f+b/3)-h*(g+c/3))/20},getBounds:function(a){for(var b=a.slice(0,2),c=b.slice(),d=[0,0],e=0;2>e;e++)H._addBounds(a[e],a[e+2],a[e+4],a[e+6],e,0,b,c,d);return new E(b[0],
b[1],c[0]-b[0],c[1]-b[1])},_addBounds:function(a,b,c,d,e,f,g,h,k){function t(a,b){var c=a-b,d=a+b;c<g[e]&&(g[e]=c);d>h[e]&&(h[e]=d)}f/=2;var w=g[e]-f,r=h[e]+f;if(a<w||b<w||c<w||d<w||a>r||b>r||c>r||d>r)if(b<a!=b<d&&c<a!=c<d)t(a,f),t(d,f);else for(w=l.solveQuadratic(3*(b-c)-a+d,2*(a+c)-4*b,b-a,k),t(d,0),r=0;r<w;r++){var x=k[r],q=1-x;1E-8<=x&&.99999999>=x&&t(q*q*q*a+3*q*q*x*b+3*q*x*x*c+x*x*x*d,f)}}}},e.each(["getBounds","getStrokeBounds","getHandleBounds"],function(a){this[a]=function(){this._bounds||
(this._bounds={});var b=this._bounds[a];b||(b=this._bounds[a]=aa[a]([this._segment1,this._segment2],!1,this._path));return b.clone()}},{}),e.each({isStraight:function(a,b,c,d){if(b.isZero()&&c.isZero())return!0;var e=d.subtract(a);if(!e.isZero()&&e.isCollinear(b)&&e.isCollinear(c)){var f=new qa(a,d);if(1E-7>f.getDistance(a.add(b))&&1E-7>f.getDistance(d.add(c)))return a=e.dot(e),b=e.dot(b)/a,c=e.dot(c)/a,0<=b&&1>=b&&0>=c&&-1<=c}return!1},isLinear:function(a,b,c,d){a=d.subtract(a).divide(3);return b.equals(a)&&
c.negate().equals(a)}},function(a,b){this[b]=function(b){var c=this._segment1,d=this._segment2;return a(c._point,c._handleOut,d._handleIn,d._point,b)};this.statics[b]=function(b,c){var d=b[0],e=b[1],f=b[6],g=b[7];return a(new m(d,e),new m(b[2]-d,b[3]-e),new m(b[4]-f,b[5]-g),new m(f,g),c)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(a){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>
(a||0)},isCollinear:function(a){return a&&this.isStraight()&&a.isStraight()&&this.getLine().isCollinear(a.getLine())},isHorizontal:function(){return this.isStraight()&&1E-8>Math.abs(this.getTangentAtTime(.5).y)},isVertical:function(){return this.isStraight()&&1E-8>Math.abs(this.getTangentAtTime(.5).x)}}),{beans:!1,getLocationAt:function(a,b){return this.getLocationAtTime(b?a:this.getTimeAt(a))},getLocationAtTime:function(a){return null!=a&&0<=a&&1>=a?new Da(this,a):null},getTimeAt:function(a,b){return H.getTimeAt(this.getValues(),
a,b)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var a=m.read(arguments);return a.isZero()?[]:H.getTimesWithTangent(this.getValues(),a)},getOffsetAtTime:function(a){return this.getPartLength(0,a)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(m.read(arguments)))},getOffsetOf:function(){var a=this.getLocationOf.apply(this,arguments);return a?a.getOffset():null},getTimeOf:function(){return H.getTimeOf(this.getValues(),m.read(arguments))},getParameterOf:"#getTimeOf",
getNearestLocation:function(){var a=m.read(arguments),b=this.getValues(),c=H.getNearestTime(b,a);b=H.getPoint(b,c);return new Da(this,c,b,null,a.getDistance(b))},getNearestPoint:function(){var a=this.getNearestLocation.apply(this,arguments);return a?a.getPoint():a}},new function(){var a="getPoint getTangent getNormal getWeightedTangent getWeightedNormal getCurvature".split(" ");return e.each(a,function(a){this[a+"At"]=function(b,c){var d=this.getValues();return H[a](d,c?b:H.getTimeAt(d,b))};this[a+
"AtTime"]=function(b){return H[a](this.getValues(),b)}},{statics:{_evaluateMethods:a}})},new function(){function a(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=9*(d-f)+3*(a[6]-b),k=6*(b+f)-12*d,r=3*(d-b),R=9*(e-g)+3*(a[7]-c),q=6*(c+g)-12*e,I=3*(e-c);return function(a){var b=(h*a+k)*a+r;a=(R*a+q)*a+I;return Math.sqrt(b*b+a*a)}}function c(a,b,c,d){if(null==b||0>b||1<b)return null;var e=a[0],f=a[1],g=a[2],h=a[3],k=a[4],r=a[5],R=a[6],q=a[7];a=l.isZero;a(g-e)&&a(h-f)&&(g=e,h=f);a(k-R)&&a(r-q)&&(k=
R,r=q);var I=3*(g-e);a=3*(k-g)-I;var A=R-e-I-a,F=3*(h-f),ea=3*(r-h)-F,da=q-f-F-ea;0===c?(e=0===b?e:1===b?R:((A*b+a)*b+I)*b+e,f=0===b?f:1===b?q:((da*b+ea)*b+F)*b+f):(1E-8>b?(e=I,f=F):.99999999<b?(e=3*(R-k),f=3*(q-r)):(e=(3*A*b+2*a)*b+I,f=(3*da*b+2*ea)*b+F),d&&(0===e&&0===f&&(1E-8>b||.99999999<b)&&(e=k-g,f=r-h),d=Math.sqrt(e*e+f*f))&&(e/=d,f/=d),3===c&&(d=Math.pow(e*e+f*f,1.5),e=0!==d?(e*(6*da*b+2*ea)-f*(6*A*b+2*a))/d:0,f=0));return 2===c?new m(f,-e):new m(e,f)}return{statics:{classify:function(a){function c(a,
c,d){var e=c!==b,f=e&&0<c&&1>c,g=e&&0<d&&1>d;!e||(f||g)&&("loop"!==a||f&&g)||(a="arch",f=g=!1);return{type:a,roots:f||g?f&&g?c<d?[c,d]:[d,c]:[f?c:d]:null}}var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],k=a[5],J=a[6];a=a[7];var r=f*(e-a)+g*(J-d)+d*a-e*J;g=3*(h*(g-e)+k*(d-f)+f*e-g*d);f=g-r;d=f-r+(d*(a-k)+e*(h-J)+J*k-a*h);e=Math.sqrt(d*d+f*f+g*g);h=0!==e?1/e:0;e=l.isZero;d*=h;f*=h;g*=h;if(e(d))return e(f)?c(e(g)?"line":"quadratic"):c("serpentine",g/(3*f));g=3*f*f-4*d*g;if(e(g))return c("cusp",f/(2*d));e=0<g?
Math.sqrt(g/3):Math.sqrt(-g);d*=2;return c(0<g?"serpentine":"loop",(f+e)/d,(f-e)/d)},getLength:function(c,d,e,f){d===b&&(d=0);e===b&&(e=1);return H.isStraight(c)?(1>e&&(c=H.subdivide(c,e)[0],d/=e),0<d&&(c=H.subdivide(c,d)[1]),d=c[6]-c[0],e=c[7]-c[1],Math.sqrt(d*d+e*e)):l.integrate(f||a(c),d,e,Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-d)))))},getTimeAt:function(c,d,e){e===b&&(e=0>d?1:0);if(0===d)return e;var f=Math.abs,g=0<d,h=g?e:0,k=g?1:e,z=a(c);c=H.getLength(c,h,k,z);var J=f(d)-c;if(1E-12>
f(J))return g?k:h;if(1E-12<J)return null;var r=0;return l.findRoot(function(a){r+=l.integrate(z,e,a,Math.max(2,Math.min(16,Math.ceil(32*Math.abs(a-e)))));e=a;return r-d},z,e+d/c,h,k,32,1E-12)},getPoint:function(a,b){return c(a,b,0,!1)},getTangent:function(a,b){return c(a,b,1,!0)},getWeightedTangent:function(a,b){return c(a,b,1,!1)},getNormal:function(a,b){return c(a,b,2,!0)},getWeightedNormal:function(a,b){return c(a,b,2,!1)},getCurvature:function(a,b){return c(a,b,3,!1).x},getPeaks:function(a){var b=
a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=-b+3*d-3*f+a[6];f=3*b-6*d+3*f;b=-3*b+3*d;a=-c+3*e-3*g+a[7];g=3*c-6*e+3*g;c=-3*c+3*e;e=[];l.solveCubic(9*(h*h+a*a),9*(h*f+g*a),2*(f*f+g*g)+3*(b*h+c*a),b*f+g*c,e,1E-8,.99999999);return e.sort()}}}},new function(){function a(a,b,c,d,e,f,g){var h=!g&&c.getPrevious()===e,k=!g&&c!==e&&c.getNext()===e;null!==d&&d>=(h?1E-8:0)&&d<=(k?.99999999:1)&&null!==f&&f>=(k?1E-8:0)&&f<=(h?.99999999:1)&&(c=new Da(c,d,null,g),e=new Da(e,f,null,g),c._intersection=e,e._intersection=
c,b&&!b(c)||Da.insert(a,c,!0))}function b(d,e,f,g,h,k,t,w,x,z,l,m,ea){if(4096<=++x||40<=++w)return x;var r=e[0],q=e[1],J=e[6],A=e[7],R=qa.getSignedDistance,I=R(r,q,J,A,e[2],e[3]),U=R(r,q,J,A,e[4],e[5]),L=0<I*U?.75:4/9,X=L*Math.min(0,I,U);L*=Math.max(0,I,U);var F=R(r,q,J,A,d[0],d[1]),B=R(r,q,J,A,d[2],d[3]),da=R(r,q,J,A,d[4],d[5]);r=R(r,q,J,A,d[6],d[7]);A=[0,F];R=[1/3,B];var M=[2/3,da],Ja=[1,r];q=B-(2*F+r)/3;J=da-(F+2*r)/3;if(0>q*J)A=[[A,R,Ja],[A,M,Ja]];else{var Xa=q/J;A=[2<=Xa?[A,R,Ja]:.5>=Xa?[A,M,
Ja]:[A,R,M,Ja],[A,Ja]]}J=0>(q||J)?A.reverse():A;q=J[0];J=J[1];var V,oa;if(0===I&&0===U&&0===F&&0===B&&0===da&&0===r||null==(V=c(q,J,X,L))||null==(oa=c(q.reverse(),J.reverse(),X,L)))return x;I=z+(l-z)*V;z+=(l-z)*oa;1E-9>Math.max(ea-m,z-I)?(d=(I+z)/2,e=(m+ea)/2,a(h,k,t?g:f,t?e:d,t?f:g,t?d:e)):(d=H.getPart(d,V,oa),.8<oa-V?z-I>ea-m?(V=H.subdivide(d,.5),d=(I+z)/2,x=b(e,V[0],g,f,h,k,!t,w,x,m,ea,I,d),x=b(e,V[1],g,f,h,k,!t,w,x,m,ea,d,z)):(V=H.subdivide(e,.5),e=(m+ea)/2,x=b(V[0],d,g,f,h,k,!t,w,x,m,e,I,z),
x=b(V[1],d,g,f,h,k,!t,w,x,e,ea,I,z)):x=1E-9<=ea-m?b(e,d,g,f,h,k,!t,w,x,m,ea,I,z):b(d,e,f,g,h,k,t,w,x,I,z,m,ea));return x}function c(a,b,c,e){return a[0][1]<c?d(a,!0,c):b[0][1]>e?d(b,!1,e):a[0][0]}function d(a,b,c){for(var d=a[0][0],e=a[0][1],f=1,g=a.length;f<g;f++){var h=a[f][0],k=a[f][1];if(b?k>=c:k<=c)return k===c?h:d+(c-e)*(h-d)/(k-e);d=h;e=k}return null}function f(a,b,c,d,e){var f=l.isZero;if(f(d)&&f(e))return a=H.getTimeOf(a,new m(b,c)),null===a?[]:[a];e=Math.atan2(-e,d);d=Math.sin(e);e=Math.cos(e);
f=[];for(var g=[],h=0;8>h;h+=2){var k=a[h]-b,t=a[h+1]-c;f.push(k*e-t*d,k*d+t*e)}H.solveCubic(f,1,0,g,0,1);return g}function g(b,c,d,e,g,h,k){var t=c[0],w=c[1];t=f(b,t,w,c[6]-t,c[7]-w);w=0;for(var r=t.length;w<r;w++){var x=t[w],q=H.getPoint(b,x);q=H.getTimeOf(c,q);null!==q&&a(g,h,k?e:d,k?q:x,k?d:e,k?x:q)}}function h(b,c,d,e,f,g){var h=qa.intersect(b[0],b[1],b[6],b[7],c[0],c[1],c[6],c[7]);h&&a(f,g,d,H.getTimeOf(b,h),e,H.getTimeOf(c,h))}function k(c,d,e,f,k,t){var w=Math.min,x=Math.max;if(x(c[0],c[2],
c[4],c[6])+1E-12>w(d[0],d[2],d[4],d[6])&&w(c[0],c[2],c[4],c[6])-1E-12<x(d[0],d[2],d[4],d[6])&&x(c[1],c[3],c[5],c[7])+1E-12>w(d[1],d[3],d[5],d[7])&&w(c[1],c[3],c[5],c[7])-1E-12<x(d[1],d[3],d[5],d[7]))if(x=z(c,d))for(w=0;2>w;w++)c=x[w],a(k,t,e,c[0],f,c[1],!0);else{w=H.isStraight(c);x=H.isStraight(d);var r=w&&x,q=w&&!x,J=k.length;(r?h:w||x?g:b)(q?d:c,q?c:d,q?f:e,q?e:f,k,t,q,0,0,0,1,0,1);if(!r||k.length===J)for(w=0;4>w;w++)x=w>>1,r=w&1,J=6*x,q=6*r,J=new m(c[J],c[J+1]),q=new m(d[q],d[q+1]),J.isClose(q,
1E-12)&&a(k,t,e,x,f,r)}return k}function x(b,c,d,e){b=H.classify(b);"loop"===b.type&&(b=b.roots,a(d,e,c,b[0],c,b[1]));return d}function z(a,b){function c(a){var b=a[6]-a[0];a=a[7]-a[1];return b*b+a*a}var d=Math.abs,e=qa.getDistance,f=H.isStraight(a),g=H.isStraight(b),h=f&&g,k=c(a)<c(b),t=k?b:a;k=k?a:b;var w=t[0],x=t[1],r=t[6]-w,z=t[7]-x;if(1E-7>e(w,x,r,z,k[0],k[1],!0)&&1E-7>e(w,x,r,z,k[6],k[7],!0))!h&&1E-7>e(w,x,r,z,t[2],t[3],!0)&&1E-7>e(w,x,r,z,t[4],t[5],!0)&&1E-7>e(w,x,r,z,k[2],k[3],!0)&&1E-7>e(w,
x,r,z,k[4],k[5],!0)&&(f=g=h=!0);else if(h)return null;if(f^g)return null;f=[a,b];e=[];for(g=0;4>g&&2>e.length&&(t=g&1,w=t^1,k=g>>1,w=H.getTimeOf(f[t],new m(f[w][k?6:0],f[w][k?7:1])),null!=w&&(t=t?[k,w]:[w,k],(!e.length||1E-8<d(t[0]-e[0][0])&&1E-8<d(t[1]-e[0][1]))&&e.push(t)),!(2<g)||e.length);g++);2!==e.length?e=null:!h&&(h=H.getPart(a,e[0][0],e[1][0]),f=H.getPart(b,e[0][1],e[1][1]),1E-7<d(f[2]-h[2])||1E-7<d(f[3]-h[3])||1E-7<d(f[4]-h[4])||1E-7<d(f[5]-h[5]))&&(e=null);return e}return{getIntersections:function(a){var b=
this.getValues(),c=a&&a!==this&&a.getValues();return c?k(b,c,this,a,[]):x(b,this,[])},statics:{getOverlaps:z,getIntersections:function(a,b,c,d,f,g){var h=!b;h&&(b=a);for(var t=a.length,w=b.length,r=[],q=[],z,A,m=0;m<w;m++)r[m]=b[m].getValues(f);for(m=0;m<t;m++){f=a[m];var l=h?r[m]:f.getValues(d),J=f.getPath();J!==A&&(A=J,z=[],q.push(z));h&&x(l,f,z,c);for(J=h?m+1:0;J<w;J++){if(g&&z.length)return z;k(l,r[J],f,b[J],z,c)}}z=[];m=0;for(a=q.length;m<a;m++)e.push(z,q[m]);return z},getCurveLineIntersections:f,
getTimesWithTangent:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],t=a[7],w=b.normalize(),x=w.x;w=w.y;k=3*k-9*g+9*e-3*c;t=3*t-9*h+9*f-3*d;g=6*g-12*e+6*c;h=6*h-12*f+6*d;c=3*e-3*c;e=3*f-3*d;f=2*k*w-2*t*x;d=[];Math.abs(f)<l.CURVETIME_EPSILON?(f=k*h-t*g,0!=f&&(x=-(k*e-t*c)/f,0<=x&&1>=x&&d.push(x))):(k=(g*g-4*k*c)*w*w+(-2*g*h+4*t*c+4*k*e)*x*w+(h*h-4*t*e)*x*x,x=g*w-h*x,0<=k&&0!=f&&(k=Math.sqrt(k),w=-(x+k)/f,x=(-x+k)/f,0<=w&&1>=w&&d.push(w),0<=x&&1>=x&&d.push(x)));return d}}}}),Da=e.extend({_class:"CurveLocation",
initialize:function(a,b,c,d,e){if(.99999999<=b){var f=a.getNext();f&&(b=0,a=f)}this._setCurve(a);this._time=b;this._point=c||a.getPointAtTime(b);this._overlap=d;this._distance=e;this._intersection=this._next=this._previous=null},_setCurve:function(a){var b=a._path;this._version=(this._path=b)?b._version:0;this._curve=a;this._segment=null;this._segment1=a._segment1;this._segment2=a._segment2},_setSegment:function(a){this._setCurve(a.getCurve());this._segment=a;this._time=a===this._segment1?0:1;this._point=
a._point.clone()},getSegment:function(){var a=this._segment;if(!a){var b=this.getCurve(),c=this.getTime();0===c?a=b._segment1:1===c?a=b._segment2:null!=c&&(a=b.getPartLength(0,c)<b.getPartLength(c,1)?b._segment1:b._segment2);this._segment=a}return a},getCurve:function(){function a(a){if((a=a&&a.getCurve())&&null!=(c._time=a.getTimeOf(c._point)))return c._setCurve(a),a}var b=this._path,c=this;b&&b._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null);return this._curve||
a(this._segment)||a(this._segment1)||a(this._segment2.getPrevious())},getPath:function(){var a=this.getCurve();return a&&a._path},getIndex:function(){var a=this.getCurve();return a&&a.getIndex()},getTime:function(){var a=this.getCurve(),b=this._time;return a&&null==b?this._time=a.getTimeOf(this._point):b},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var a=this._offset;if(null==a){a=0;var b=this.getPath(),c=this.getIndex();if(b&&null!=c){b=b.getCurves();for(var d=
0;d<c;d++)a+=b[d].getLength()}this._offset=a+=this.getCurveOffset()}return a},getCurveOffset:function(){var a=this._curveOffset;if(null==a){a=this.getCurve();var b=this.getTime();this._curveOffset=a=null!=b&&a&&a.getPartLength(0,b)}return a},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var a=this.getCurve();(a=a&&a.divideAtTime(this.getTime()))&&this._setSegment(a._segment1);return a},split:function(){var a=this.getCurve(),b=
a._path;(a=a&&a.splitAtTime(this.getTime()))&&this._setSegment(b.getLastSegment());return a},equals:function(a,b){var c=this===a;if(!c&&a instanceof Da){var d=this.getCurve(),e=a.getCurve();d=d._path;if(d===e._path){c=Math.abs;e=c(this.getOffset()-a.getOffset());var f=!b&&this._intersection,g=!b&&a._intersection;c=(1E-7>e||d&&1E-7>c(d.getLength()-e))&&(!f&&!g||f&&g&&f.equals(g,!0))}}return c},toString:function(){var a=[],b=this.getPoint(),c=k.instance;b&&a.push("point: "+b);b=this.getIndex();null!=
b&&a.push("index: "+b);b=this.getTime();null!=b&&a.push("time: "+c.number(b));null!=this._distance&&a.push("distance: "+c.number(this._distance));return"{ "+a.join(", ")+" }"},isTouching:function(){var a=this._intersection;if(a&&this.getTangent().isCollinear(a.getTangent())){var b=this.getCurve();a=a.getCurve();return!(b.isStraight()&&a.isStraight()&&b.getLine().intersect(a.getLine()))}return!1},isCrossing:function(){function a(a,b){var c=a.getValues(),d=H.classify(c).roots||H.getPeaks(c),e=d.length;
d=b&&1<e?d[e-1]:0<e?d[0]:.5;m.push(H.getLength(c,b?d:0,b?1:d)/2)}function b(a,b,c){return b<c?a>b&&a<c:a>b||a<c}var c=this._intersection;if(!c)return!1;var d=this.getTime(),e=c.getTime(),f=1E-8<=d&&.99999999>=d,g=1E-8<=e&&.99999999>=e;if(f&&g)return!this.isTouching();var h=this.getCurve(),k=1E-8>d?h.getPrevious():h,z=c.getCurve();c=1E-8>e?z.getPrevious():z;.99999999<d&&(h=h.getNext());.99999999<e&&(z=z.getNext());if(!(k&&h&&c&&z))return!1;var m=[];f||(a(k,!0),a(h,!1));g||(a(c,!0),a(z,!1));var r=this.getPoint(),
l=Math.min.apply(Math,m);d=f?h.getTangentAtTime(d):h.getPointAt(l).subtract(r);k=f?d.negate():k.getPointAt(-l).subtract(r);e=g?z.getTangentAtTime(e):z.getPointAt(l).subtract(r);c=g?e.negate():c.getPointAt(-l).subtract(r);g=k.getAngle();r=d.getAngle();c=c.getAngle();e=e.getAngle();return!!(f?b(g,c,e)^b(r,c,e)&&b(g,e,c)^b(r,e,c):b(c,g,r)^b(e,g,r)&&b(c,r,g)^b(e,r,g))},hasOverlap:function(){return!!this._overlap}},e.each(H._evaluateMethods,function(a){var b=a+"At";this[a]=function(){var a=this.getCurve(),
c=this.getTime();return null!=c&&a&&a[b](c,!0)}},{preserve:!0}),new function(){function a(a,b,c){function d(c,d){for(var f=c+d;-1<=f&&f<=e;f+=d){var g=a[(f%e+e)%e];if(!b.getPoint().isClose(g.getPoint(),1E-7))break;if(b.equals(g))return g}return null}for(var e=a.length,f=0,g=e-1;f<=g;){var h=f+g>>>1,k=a[h],m;if(c&&(m=b.equals(k)?k:d(h,-1)||d(h,1)))return b._overlap&&(m._overlap=m._intersection._overlap=!0),m;var r=b.getPath(),l=k.getPath();0>(r!==l?r._id-l._id:b.getIndex()+b.getTime()-(k.getIndex()+
k.getTime()))?g=h-1:f=h+1}a.splice(f,0,b);return b}return{statics:{insert:a,expand:function(b){for(var c=b.slice(),d=b.length-1;0<=d;d--)a(c,b[d]._intersection,!1);return c}}}}),eb=Q.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(a){if(e.isPlainObject(a)){var b=a.segments;var c=a.pathData}else Array.isArray(a)?b=a:"string"===typeof a&&(c=a);if(b)var d=(c=b[0])&&Array.isArray(c[0]);else c&&(d=1<(c.match(/m/gi)||[]).length||/z\s*\S+/i.test(c));
return new (d?Ka:aa)(a)}},_asPathItem:function(){return this},isClockwise:function(){return 0<=this.getArea()},setClockwise:function(a){this.isClockwise()!=!!a&&this.reverse()},setPathData:function(a){function b(a,b){var c=+d[a];e&&(c+=f[b]);return c}function c(a){return new m(b(a,"x"),b(a+1,"y"))}a=a&&a.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig);var d,e=!1,f=new m,g=new m;this.clear();for(var h=0,k=a&&a.length;h<k;h++){var z=a[h],l=z[0],r=l.toLowerCase();z=(d=z.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&
d.length;e=l===r;"z"!==R||/[mz]/.test(r)||this.moveTo(f);switch(r){case "m":case "l":var R="m"===r;for(l=0;l<z;l+=2)this[R?"moveTo":"lineTo"](f=c(l)),R&&(g=f,R=!1);var q=f;break;case "h":case "v":R="h"===r?"x":"y";f=f.clone();for(l=0;l<z;l++)f[R]=b(l,R),this.lineTo(f);q=f;break;case "c":for(l=0;l<z;l+=6)this.cubicCurveTo(c(l),q=c(l+2),f=c(l+4));break;case "s":for(l=0;l<z;l+=4)this.cubicCurveTo(/[cs]/.test(R)?f.multiply(2).subtract(q):f,q=c(l),f=c(l+2)),R=r;break;case "q":for(l=0;l<z;l+=4)this.quadraticCurveTo(q=
c(l),f=c(l+2));break;case "t":for(l=0;l<z;l+=2)this.quadraticCurveTo(q=/[qt]/.test(R)?f.multiply(2).subtract(q):f,f=c(l)),R=r;break;case "a":for(l=0;l<z;l+=7)this.arcTo(f=c(l+5),new p(+d[l],+d[l+1]),+d[l+2],+d[l+4],+d[l+3]);break;case "z":this.closePath(1E-12),f=g}R=r}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(a){a=a.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(a):{};return a.onPath||!!("evenodd"===this.getFillRule()?a.windingL&1||
a.windingR&1:a.winding)},getIntersections:function(a,b,c,d){var e=this===a||!a,f=this._matrix._orNullIfIdentity();c=e?f:(c||a._matrix)._orNullIfIdentity();return e||this.getBounds(f).intersects(a.getBounds(c),1E-12)?H.getIntersections(this.getCurves(),!e&&a.getCurves(),b,f,c,d):[]},getCrossings:function(a){return this.getIntersections(a,function(a){return a.hasOverlap()||a.isCrossing()})},getNearestLocation:function(){for(var a=m.read(arguments),b=this.getCurves(),c=Infinity,d=null,e=0,f=b.length;e<
f;e++){var g=b[e].getNearestLocation(a);g._distance<c&&(c=g._distance,d=g)}return d},getNearestPoint:function(){var a=this.getNearestLocation.apply(this,arguments);return a?a.getPoint():a},interpolate:function(a,b,c){var d=!this._children,e=d?"_segments":"_children",f=a[e],g=b[e];e=this[e];if(!f||!g||f.length!==g.length)throw Error("Invalid operands in interpolate() call: "+a+", "+b);var h=e.length;b=g.length;if(h<b)for(var k=d?T:aa;h<b;h++)this.add(new k);else if(h>b)this[d?"removeSegments":"removeChildren"](b,
h);for(h=0;h<b;h++)e[h].interpolate(f[h],g[h],c);d&&(this.setClosed(a._closed),this._changed(9))},compare:function(a){var b=!1;if(a){var c=this._children||[this];a=a._children?a._children.slice():[a];var d=c.length,e=a.length,f=[],g=0;b=!0;for(--d;0<=d&&b;d--){var h=c[d];b=!1;for(var k=e-1;0<=k&&!b;k--)h.compare(a[k])&&(f[k]||(f[k]=!0,g++),b=!0)}b=b&&g===e}return b}}),aa=eb.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(a){this._closed=!1;this._segments=[];this._version=
0;var c=Array.isArray(a)?"object"===typeof a[0]?a:arguments:!a||a.size!==b||a.x===b&&a.point===b?null:arguments;c&&0<c.length?this.setSegments(c):(this._curves=b,this._segmentSelection=0,c||"string"!==typeof a||(this.setPathData(a),a=null));this._initialize(!c&&a)},_equals:function(a){return this._closed===a._closed&&e.equals(this._segments,a._segments)},copyContent:function(a){this.setSegments(a._segments);this._closed=a._closed},_changed:function F(a){F.base.call(this,a);if(a&8)if(this._length=
this._area=b,a&32)this._version++;else{if(this._curves){a=0;for(var c=this._curves.length;a<c;a++)this._curves[a]._changed()}}else a&64&&(this._bounds=b)},getStyle:function(){var a=this._parent;return(a instanceof Ka?a:this)._style},getSegments:function(){return this._segments},setSegments:function(a){var c=this.isFullySelected(),d=a&&a.length;this._segmentSelection=this._segments.length=0;this._curves=b;if(d){var e=a[d-1];"boolean"===typeof e&&(this.setClosed(e),d--);this._add(T.readList(a,0,{},
d))}c&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var a=this._curves,b=this._segments;if(!a){var c=this._countCurves();a=this._curves=Array(c);for(var d=0;d<c;d++)a[d]=new H(this,b[d],b[d+1]||b[0])}return a},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var a=this.getCurves();return a[a.length-1]},isClosed:function(){return this._closed},
setClosed:function(a){if(this._closed!=(a=!!a)){this._closed=a;if(this._curves){var b=this._curves.length=this._countCurves();a&&(this._curves[b-1]=new H(this,this._segments[b-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(a,b){function c(b,c){b._transformCoordinates(a,g);z=g[0];l=g[1];if(h)n.push("M"+f.pair(z,l)),h=!1;else if(q=g[2],I=g[3],q===z&&I===l&&A===r&&X===m){if(!c){var d=z-r,e=l-m;n.push(0===d?"v"+f.number(e):0===e?"h"+f.number(d):"l"+f.pair(d,e))}}else n.push("c"+
f.pair(A-r,X-m)+" "+f.pair(q-r,I-m)+" "+f.pair(z-r,l-m));r=z;m=l;A=g[4];X=g[5]}var d=this._segments,e=d.length,f=new k(b),g=Array(6),h=!0,z,l,r,m,q,I,A,X,n=[];if(!e)return"";for(var F=0;F<e;F++)c(d[F]);this._closed&&0<e&&(c(d[0],!0),n.push("z"));return n.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(a){for(var b=this._segments,c=Array(6),d=0,e=b.length;d<e;d++)b[d]._transformCoordinates(a,c,!0);return!0},_add:function(a,b){var c=this._segments,d=this._curves,
f=a.length,g=null==b;b=g?c.length:b;for(var h=0;h<f;h++){var k=a[h];k._path&&(k=a[h]=k.clone());k._path=this;k._index=b+h;k._selection&&this._updateSelection(k,0,k._selection)}if(g)e.push(c,a);else for(c.splice.apply(c,[b,0].concat(a)),h=b+f,g=c.length;h<g;h++)c[h]._index=h;if(d){g=this._countCurves();h=c=0<b&&b+f-1===g?b-1:b;f=Math.min(c+f,g);a._curves&&(d.splice.apply(d,[c,0].concat(a._curves)),h+=a._curves.length);for(;h<f;h++)d.splice(h,0,new H(this,null,null));this._adjustCurves(c,f)}this._changed(41);
return a},_adjustCurves:function(a,b){for(var c=this._segments,d=this._curves,e,f=a;f<b;f++)e=d[f],e._path=this,e._segment1=c[f],e._segment2=c[f+1]||c[0],e._changed();if(e=d[this._closed&&!a?c.length-1:a-1])e._segment2=c[a]||c[0],e._changed();if(e=d[b])e._segment1=c[b],e._changed()},_countCurves:function(){var a=this._segments.length;return!this._closed&&0<a?a-1:a},add:function(a){return 1<arguments.length&&"number"!==typeof a?this._add(T.readList(arguments)):this._add([T.read(arguments)])[0]},insert:function(a,
b){return 2<arguments.length&&"number"!==typeof b?this._add(T.readList(arguments,1),a):this._add([T.read(arguments,1)],a)[0]},addSegment:function(){return this._add([T.read(arguments)])[0]},insertSegment:function(a){return this._add([T.read(arguments,1)],a)[0]},addSegments:function(a){return this._add(T.readList(a))},insertSegments:function(a,b){return this._add(T.readList(b),a)},removeSegment:function(a){return this.removeSegments(a,a+1)[0]||null},removeSegments:function(a,b,c){a=a||0;b=e.pick(b,
this._segments.length);var d=this._segments,f=this._curves,g=d.length,h=d.splice(a,b-a),k=h.length;if(!k)return h;for(var z=0;z<k;z++){var l=h[z];l._selection&&this._updateSelection(l,l._selection,0);l._index=l._path=null}z=a;for(l=d.length;z<l;z++)d[z]._index=z;if(f){a=0<a&&b===g+(this._closed?1:0)?a-1:a;f=f.splice(a,k);for(z=f.length-1;0<=z;z--)f[z]._path=null;c&&(h._curves=f.slice(1));this._adjustCurves(a,a)}this._changed(41);return h},clear:"#removeSegments",hasHandles:function(){for(var a=this._segments,
b=0,c=a.length;b<c;b++)if(a[b].hasHandles())return!0;return!1},clearHandles:function(){for(var a=this._segments,b=0,c=a.length;b<c;b++)a[b].clearHandles()},getLength:function(){if(null==this._length){for(var a=this.getCurves(),b=0,c=0,d=a.length;c<d;c++)b+=a[c].getLength();this._length=b}return this._length},getArea:function(){var a=this._area;if(null==a){for(var b=this._segments,c=this._closed,d=a=0,e=b.length;d<e;d++){var f=d+1===e;a+=H.getArea(H.getValues(b[d],b[f?0:d+1],null,f&&!c))}this._area=
a}return a},isFullySelected:function(){var a=this._segments.length;return this.isSelected()&&0<a&&this._segmentSelection===7*a},setFullySelected:function(a){a&&this._selectSegments(!0);this.setSelected(a)},setSelection:function da(a){a&1||this._selectSegments(!1);da.base.call(this,a)},_selectSegments:function(a){var b=this._segments,c=b.length;a=a?7:0;this._segmentSelection=a*c;for(var d=0;d<c;d++)b[d]._selection=a},_updateSelection:function(a,b,c){a._selection=c;0<(this._segmentSelection+=c-b)&&
this.setSelected(!0)},divideAt:function(a){a=this.getLocationAt(a);var b;return a&&(b=a.getCurve().divideAt(a.getCurveOffset()))?b._segment1:null},splitAt:function(a){var b=this.getLocationAt(a);a=b&&b.index;b=b&&b.time;.99999999<b&&(a++,b=0);var c=this.getCurves();return 0<=a&&a<c.length?(1E-8<=b&&c[a++].divideAtTime(b),a=this.removeSegments(a,this._segments.length,!0),this._closed?(this.setClosed(!1),b=this):(b=new aa(Q.NO_INSERT),b.insertAbove(this),b.copyAttributes(this)),b._add(a,0),this.addSegment(a[0]),
b):null},split:function(a,c){var d,e=c===b?a:(d=this.getCurves()[a])&&d.getLocationAtTime(c);return null!=e?this.splitAt(e):null},join:function(a,b){var c=b||0;if(a&&a!==this){var d=a._segments,e=this.getLastSegment(),f=a.getLastSegment();if(!f)return this;e&&e._point.isClose(f._point,c)&&a.reverse();f=a.getFirstSegment();e&&e._point.isClose(f._point,c)?(e.setHandleOut(f._handleOut),this._add(d.slice(1))):((e=this.getFirstSegment())&&e._point.isClose(f._point,c)&&a.reverse(),f=a.getLastSegment(),
e&&e._point.isClose(f._point,c)?(e.setHandleIn(f._handleIn),this._add(d.slice(0,d.length-1),0)):this._add(d.slice()));a._closed&&this._add([d[0]]);a.remove()}d=this.getFirstSegment();e=this.getLastSegment();d!==e&&d._point.isClose(e._point,c)&&(d.setHandleIn(e._handleIn),e.remove(),this.setClosed(!0));return this},reduce:function(a){for(var b=this.getCurves(),c=(a=a&&a.simplify)?1E-7:0,d=b.length-1;0<=d;d--){var e=b[d];!e.hasHandles()&&(!e.hasLength(c)||a&&e.isCollinear(e.getNext()))&&e.remove()}return this},
reverse:function(){this._segments.reverse();for(var a=0,b=this._segments.length;a<b;a++){var c=this._segments[a],d=c._handleIn;c._handleIn=c._handleOut;c._handleOut=d;c._index=a}this._curves=null;this._changed(9)},flatten:function(a){a=(new rb(this,a||.25,256,!0)).parts;for(var b=a.length,c=[],d=0;d<b;d++)c.push(new T(a[d].curve.slice(0,2)));!this._closed&&0<b&&c.push(new T(a[b-1].curve.slice(6)));this.setSegments(c)},simplify:function(a){(a=(new Kb(this)).fit(a||2.5))&&this.setSegments(a);return!!a},
smooth:function(a){function c(a,b){var c=a&&a.index;if(null!=c){var e=a.path;if(e&&e!==d)throw Error(a._class+" "+c+" of "+e+" is not part of "+d);b&&a instanceof H&&c++}else c="number"===typeof a?a:b;return Math.min(0>c&&h?c%g:0>c?c+g:c,g-1)}var d=this,e=a||{},f=e.type||"asymmetric";a=this._segments;var g=a.length,h=this._closed,k=h&&e.from===b&&e.to===b,l=c(e.from,0),r=c(e.to,g-1);if(l>r)if(h)l-=g;else{var m=l;l=r;r=m}if(/^(?:asymmetric|continuous)$/.test(f)){var q="asymmetric"===f;f=Math.min;e=
r-l+1;var I=e-1,A=e=m=k?f(e,4):1,X=[];h||(e=f(1,l),A=f(1,g-r-1));I+=e+A;if(!(1>=I)){f=0;for(var n=l-e;f<=I;f++,n++)X[f]=a[(0>n?n+g:n)%g]._point;n=X[0]._x+2*X[1]._x;var sa=X[0]._y+2*X[1]._y,p=2,V=I-1,L=[n],oa=[sa],ya=[p];r=[];m=[];for(f=1;f<I;f++){var ja=f<V,G=ja?4:q?3:8,ba=ja?2:q?0:1,Na=(ja?1:q?1:2)/p;p=ya[f]=(ja?4:q?2:7)-Na;n=L[f]=G*X[f]._x+ba*X[f+1]._x-Na*n;sa=oa[f]=G*X[f]._y+ba*X[f+1]._y-Na*sa}r[V]=L[V]/ya[V];m[V]=oa[V]/ya[V];for(f=I-2;0<=f;f--)r[f]=(L[f]-r[f+1])/ya[f],m[f]=(oa[f]-m[f+1])/ya[f];
r[I]=(3*X[I]._x-r[V])/2;m[I]=(3*X[I]._y-m[V])/2;f=e;q=I-A;for(n=l;f<=q;f++,n++)l=a[0>n?n+g:n],A=l._point,I=r[f]-A._x,A=m[f]-A._y,(k||f<q)&&l.setHandleOut(I,A),(k||f>e)&&l.setHandleIn(-I,-A)}}else for(f=l;f<=r;f++)a[0>f?f+g:f].smooth(e,!k&&f===l,!k&&f===r)},toShape:function(a){function c(a,b){var c=g[a],d=c.getNext(),e=g[b],f=e.getNext();return c._handleOut.isZero()&&d._handleIn.isZero()&&e._handleOut.isZero()&&f._handleIn.isZero()&&d._point.subtract(c._point).isCollinear(f._point.subtract(e._point))}
function d(a){a=g[a];var b=a.getPrevious(),c=a.getNext();return b._handleOut.isZero()&&a._handleIn.isZero()&&a._handleOut.isZero()&&c._handleIn.isZero()&&a._point.subtract(b._point).isOrthogonal(c._point.subtract(a._point))}function e(a){var b=g[a],c=b.getNext();a=b._handleOut;var d=c._handleIn;if(a.isOrthogonal(d)){b=b._point;c=c._point;var e=(new qa(b,a,!0)).intersect(new qa(c,d,!0),!0);return e&&l.isZero(a.getLength()/e.subtract(b).getLength()-.5522847498307936)&&l.isZero(d.getLength()/e.subtract(c).getLength()-
.5522847498307936)}return!1}function f(a,b){return g[a]._point.getDistance(g[b]._point)}if(!this._closed)return null;var g=this._segments;if(!this.hasHandles()&&4===g.length&&c(0,2)&&c(1,3)&&d(1)){var h=Ga.Rectangle;var k=new p(f(0,3),f(0,1));var m=g[1]._point.add(g[2]._point).divide(2)}else if(8===g.length&&e(0)&&e(2)&&e(4)&&e(6)&&c(1,5)&&c(3,7)){h=Ga.Rectangle;k=new p(f(1,6),f(0,3));var r=k.subtract(new p(f(0,7),f(1,2))).divide(2);m=g[3]._point.add(g[4]._point).divide(2)}else 4===g.length&&e(0)&&
e(1)&&e(2)&&e(3)&&(l.isZero(f(0,2)-f(1,3))?(h=Ga.Circle,r=f(0,2)/2):(h=Ga.Ellipse,r=new p(f(2,0)/2,f(3,1)/2)),m=g[1]._point);if(h){var R=this.getPosition(!0);h=new h({center:R,size:k,radius:r,insert:!1});h.copyAttributes(this,!0);h._matrix.prepend(this._matrix);h.rotate(m.subtract(R).getAngle()+90);(a===b||a)&&h.insertAbove(this);return h}return null},toPath:"#clone",compare:function Ja(a){if(!a||a instanceof Ka)return Ja.base.call(this,a);var b=this.getCurves();a=a.getCurves();var c=b.length,d=a.length;
if(!c||!d)return c==d;for(var e=b[0].getValues(),f=[],g=0,h,k=0,l,m=0;m<d;m++){var A=a[m].getValues();f.push(A);var n=H.getOverlaps(e,A);if(n){h=!m&&0<n[0][0]?d-1:m;l=n[0][1];break}}m=Math.abs;A=f[h];for(var Xa;e&&A;){if((n=H.getOverlaps(e,A))&&1E-8>m(n[0][0]-k)){k=n[1][0];1===k&&(e=++g<c?b[g].getValues():null,k=0);var sa=n[0][1];if(1E-8>m(sa-l)){Xa||(Xa=[h,sa]);l=n[1][1];1===l&&(++h>=d&&(h=0),A=f[h]||a[h].getValues(),l=0);if(!e)return Xa[0]===h&&Xa[1]===l;continue}}break}return!1},_hitTestSelf:function(a,
b,c,d){function e(b,c){return 1>=a.subtract(b).divide(c).length}function f(a,c,d){if(!b.selected||c.isSelected()){var f=a._point;c!==f&&(c=c.add(f));if(e(c,ea))return new Ua(d,t,{segment:a,point:c})}}function g(a,c){return(c||b.segments)&&f(a,a._point,"segment")||!c&&b.handles&&(f(a,a._handleIn,"handle-in")||f(a,a._handleOut,"handle-out"))}function h(a){sa.add(a)}function k(b){var c=A||0<b._index&&b._index<m-1;if("round"===(c?G:ba))return e(b._point,ea);sa=new aa({internal:!0,closed:!0});c?b.isSmooth()||
aa._addBevelJoin(b,G,ja,Na,null,d,h,!0):"square"===ba&&aa._addSquareCap(b,ba,ja,null,d,h,!0);if(!sa.isEmpty()){var f;return sa.contains(a)||(f=sa.getNearestLocation(a))&&e(f.getPoint(),n)}}var t=this,l=this.getStyle();c=this._segments;var m=c.length,A=this._closed,n=b._tolerancePadding,ea=n,sa,p,V,L=b.stroke&&l.hasStroke(),oa=b.fill&&l.hasFill(),ya=b.curves,ja=L?l.getStrokeWidth()/2:oa&&0<b.tolerance||ya?0:null;if(null!==ja)if(0<ja){var G=l.getStrokeJoin();var ba=l.getStrokeCap();var Na=l.getMiterLimit();
ea=ea.add(aa._getStrokePadding(ja,d))}else G=ba="round";if(b.ends&&!b.segments&&!A){if(V=g(c[0],!0)||g(c[m-1],!0))return V}else if(b.segments||b.handles)for(l=0;l<m;l++)if(V=g(c[l]))return V;if(null!==ja){if(p=this.getNearestLocation(a))l=p.getTime(),0===l||1===l&&1<m?k(p.getSegment())||(p=null):e(p.getPoint(),ea)||(p=null);if(!p&&"miter"===G&&1<m)for(l=0;l<m;l++)if(V=c[l],a.getDistance(V._point)<=Na*ja&&k(V)){p=V.getLocation();break}}return!p&&oa&&this._contains(a)||p&&!L&&!ya?new Ua("fill",this):
p?new Ua(L?"stroke":"curve",this,{location:p,point:p.getPoint()}):null}},e.each(H._evaluateMethods,function(a){this[a+"At"]=function(b){return(b=this.getLocationAt(b))&&b[a]()}},{beans:!1,getLocationOf:function(){for(var a=m.read(arguments),b=this.getCurves(),c=0,d=b.length;c<d;c++){var e=b[c].getLocationOf(a);if(e)return e}return null},getOffsetOf:function(){var a=this.getLocationOf.apply(this,arguments);return a?a.getOffset():null},getLocationAt:function(a){if("number"===typeof a){for(var b=this.getCurves(),
c=0,d=0,e=b.length;d<e;d++){var f=c,g=b[d];c+=g.getLength();if(c>a)return g.getLocationAt(a-f)}if(0<b.length&&a<=this.getLength())return new Da(b[b.length-1],1)}else if(a&&a.getPath&&a.getPath()===this)return a;return null},getOffsetsWithTangent:function(){var a=m.read(arguments);if(a.isZero())return[];for(var b=[],c=0,d=this.getCurves(),e=0,f=d.length;e<f;e++){for(var g=d[e],h=g.getTimesWithTangent(a),k=0,l=h.length;k<l;k++){var q=c+g.getOffsetAtTime(h[k]);0>b.indexOf(q)&&b.push(q)}c+=g.length}return b}}),
new function(){function a(a,b,c,d){function e(b){var c=g[b];b=g[b+1];if(h!=c||k!=b)a.beginPath(),a.moveTo(h,k),a.lineTo(c,b),a.stroke(),a.beginPath(),a.arc(c,b,f,0,2*Math.PI,!0),a.fill()}for(var f=d/2,g=Array(6),h,k,w=0,l=b.length;w<l;w++){var x=b[w],t=x._selection;x._transformCoordinates(c,g);h=g[0];k=g[1];t&2&&e(2);t&4&&e(4);a.fillRect(h-f,k-f,d,d);t&1||(x=a.fillStyle,a.fillStyle="#ffffff",a.fillRect(h-f+1,k-f+1,d-2,d-2),a.fillStyle=x)}}function b(a,b,c){function d(b){if(c)b._transformCoordinates(c,
g),k=g[0],w=g[1];else{var d=b._point;k=d._x;w=d._y}h?(a.moveTo(k,w),h=!1):(c?(m=g[2],n=g[3]):(d=b._handleIn,m=k+d._x,n=w+d._y),m===k&&n===w&&p===l&&V===t?a.lineTo(k,w):a.bezierCurveTo(p,V,m,n,k,w));l=k;t=w;c?(p=g[4],V=g[5]):(d=b._handleOut,p=l+d._x,V=t+d._y)}for(var e=b._segments,f=e.length,g=Array(6),h=!0,k,w,l,t,m,n,p,V,L=0;L<f;L++)d(e[L]);b._closed&&0<f&&d(e[0])}return{_draw:function(a,c,d,e){function f(a){return x[(a%t+t)%t]}var g=c.dontStart,h=c.dontFinish||c.clip,k=this.getStyle(),w=k.hasFill(),
l=k.hasStroke(),x=k.getDashArray(),t=!fa.support.nativeDash&&l&&x&&x.length;g||a.beginPath();if(w||l&&!t||h)b(a,this,e),this._closed&&a.closePath();if(!h&&(w||l)&&(this._setStyles(a,c,d),w&&(a.fill(k.getFillRule()),a.shadowColor="rgba(0,0,0,0)"),l)){if(t){g||a.beginPath();c=new rb(this,.25,32,!1,e);d=c.length;k=-k.getDashOffset();g=0;for(k%=d;0<k;)k-=f(g--)+f(g--);for(;k<d;)e=k+f(g++),(0<k||0<e)&&c.drawPart(a,Math.max(k,0),Math.max(e,0)),k=e+f(g++)}a.stroke()}},_drawSelected:function(c,d){c.beginPath();
b(c,this,d);c.stroke();a(c,this._segments,d,fa.settings.handleSize)}}},new function(){function a(a){a=a._segments;if(!a.length)throw Error("Use a moveTo() command first");return a[a.length-1]}return{moveTo:function(){var a=this._segments;1===a.length&&this.removeSegment(0);a.length||this._add([new T(m.read(arguments))])},moveBy:function(){throw Error("moveBy() is unsupported on Path items.");},lineTo:function(){this._add([new T(m.read(arguments))])},cubicCurveTo:function(){var b=m.read(arguments),
c=m.read(arguments),d=m.read(arguments),e=a(this);e.setHandleOut(b.subtract(e._point));this._add([new T(d,c.subtract(d))])},quadraticCurveTo:function(){var b=m.read(arguments),c=m.read(arguments),d=a(this)._point;this.cubicCurveTo(b.add(d.subtract(b).multiply(1/3)),b.add(c.subtract(b).multiply(1/3)),c)},curveTo:function(){var b=m.read(arguments),c=m.read(arguments),d=e.pick(e.read(arguments),.5),f=1-d,g=a(this)._point;b=b.subtract(g.multiply(f*f)).subtract(c.multiply(d*d)).divide(2*d*f);if(b.isNaN())throw Error("Cannot put a curve through points with parameter = "+
d);this.quadraticCurveTo(b,c)},arcTo:function(){var b=Math.abs,c=Math.sqrt,d=a(this),f=d._point,g=m.read(arguments),h=e.peek(arguments);h=e.pick(h,!0);if("boolean"===typeof h){var k=f.add(g).divide(2);var r=k.add(k.subtract(f).rotate(h?-90:90))}else if(2>=e.remain(arguments))r=g,g=m.read(arguments);else{var R=p.read(arguments);var q=l.isZero;if(q(R.width)||q(R.height))return this.lineTo(g);var n=e.read(arguments);h=!!e.read(arguments);q=!!e.read(arguments);k=f.add(g).divide(2);var A=f.subtract(k).rotate(-n);
var X=A.x;var v=A.y;A=b(R.width);R=b(R.height);var sa=A*A,y=R*R,V=X*X,L=v*v,oa=c(V/sa+L/y);1<oa&&(A*=oa,R*=oa,sa=A*A,y=R*R);oa=(sa*y-sa*L-y*V)/(sa*L+y*V);1E-12>b(oa)&&(oa=0);if(0>oa)throw Error("Cannot create an arc with the given arguments");q=(new m(A*v/R,-R*X/A)).multiply((q===h?-1:1)*c(oa)).rotate(n).add(k);n=(new P).translate(q).rotate(n).scale(A,R);X=n._inverseTransform(f);A=X.getDirectedAngle(n._inverseTransform(g));!h&&0<A?A-=360:h&&0>A&&(A+=360)}if(r){q=new qa(f.add(r).divide(2),r.subtract(f).rotate(90),
!0);X=new qa(r.add(g).divide(2),g.subtract(r).rotate(90),!0);c=new qa(f,g);r=c.getSide(r);q=q.intersect(X,!0);if(!q){if(!r)return this.lineTo(g);throw Error("Cannot create an arc with the given arguments");}X=f.subtract(q);A=X.getDirectedAngle(g.subtract(q));f=c.getSide(q,!0);0===f?A=r*b(A):r===f&&(A+=0>A?360:-360)}b=b(A);b=360<=b?4:Math.ceil((b-1E-7)/90);f=A/b;r=f*Math.PI/360;r=4/3*Math.sin(r)/(1+Math.cos(r));c=[];for(h=0;h<=b;h++)A=g,k=null,h<b&&(k=X.rotate(90).multiply(r),n?(A=n._transformPoint(X),
k=n._transformPoint(X.add(k)).subtract(A)):A=q.add(X)),h?(v=X.rotate(-90).multiply(r),n&&(v=n._transformPoint(X.add(v)).subtract(A)),c.push(new T(A,v,k))):d.setHandleOut(k),X=X.rotate(f);this._add(c)},lineBy:function(){var b=m.read(arguments),c=a(this)._point;this.lineTo(c.add(b))},curveBy:function(){var b=m.read(arguments),c=m.read(arguments),d=e.read(arguments),f=a(this)._point;this.curveTo(f.add(b),f.add(c),d)},cubicCurveBy:function(){var b=m.read(arguments),c=m.read(arguments),d=m.read(arguments),
e=a(this)._point;this.cubicCurveTo(e.add(b),e.add(c),e.add(d))},quadraticCurveBy:function(){var b=m.read(arguments),c=m.read(arguments),d=a(this)._point;this.quadraticCurveTo(d.add(b),d.add(c))},arcBy:function(){var b=a(this)._point,c=b.add(m.read(arguments)),d=e.pick(e.peek(arguments),!0);"boolean"===typeof d?this.arcTo(c,d):this.arcTo(c,b.add(m.read(arguments)))},closePath:function(a){this.setClosed(!0);this.join(this,a)}}},{_getBounds:function(a,b){return aa[b.handle?"getHandleBounds":b.stroke?
"getStrokeBounds":"getBounds"](this._segments,this._closed,this,a,b)},statics:{getBounds:function(a,b,c,d,e,f){function g(a){a._transformCoordinates(d,h);for(a=0;2>a;a++)H._addBounds(k[a],k[a+4],h[a+2],h[a],a,f?f[a]:0,l,w,x);a=k;k=h;h=a}c=a[0];if(!c)return new E;var h=Array(6),k=c._transformCoordinates(d,Array(6)),l=k.slice(0,2),w=l.slice(),x=Array(2);e=1;for(var m=a.length;e<m;e++)g(a[e]);b&&g(c);return new E(l[0],l[1],w[0]-l[0],w[1]-l[1])},getStrokeBounds:function(a,b,c,d,e){function f(a){n=n.include(a)}
function g(a,b){"round"===b||a.isSmooth()?n=n.unite(y.setCenter(a._point.transform(d))):aa._addBevelJoin(a,b,v,sa,d,m,f)}function h(a,b){"round"===b?n=n.unite(y.setCenter(a._point.transform(d))):aa._addSquareCap(a,b,v,d,m,f)}var k=c.getStyle(),l=k.hasStroke(),w=k.getStrokeWidth(),m=l&&c._getStrokeMatrix(d,e),t=l&&aa._getStrokePadding(w,m),n=aa.getBounds(a,b,c,d,e,t);if(!l)return n;var v=w/2;c=k.getStrokeJoin();e=k.getStrokeCap();var sa=k.getMiterLimit(),y=new E(new p(t));k=a.length-(b?0:1);for(t=
1;t<k;t++)g(a[t],c);b?g(a[0],c):0<k&&(h(a[0],e),h(a[a.length-1],e));return n},_getStrokePadding:function(a,b){if(!b)return[a,a];var c=(new m(a,0)).transform(b),d=(new m(0,a)).transform(b),e=c.getAngleInRadians();c=c.getLength();d=d.getLength();var f=Math.sin(e),g=Math.cos(e),h=Math.tan(e);e=Math.atan2(d*h,c);h=Math.atan2(d,h*c);return[Math.abs(c*Math.cos(e)*g+d*Math.sin(e)*f),Math.abs(d*Math.sin(h)*g+c*Math.cos(h)*f)]},_addBevelJoin:function(a,b,c,d,e,f,g,h){a=a.getCurve();var k=a.getPrevious();e=
a.getPoint1().transform(e);k=k.getNormalAtTime(1).multiply(c).transform(f);f=a.getNormalAtTime(0).multiply(c).transform(f);0>k.getDirectedAngle(f)&&(k=k.negate(),f=f.negate());h&&g(e);g(e.add(k));"miter"===b&&(b=(new qa(e.add(k),new m(-k.y,k.x),!0)).intersect(new qa(e.add(f),new m(-f.y,f.x),!0),!0))&&e.getDistance(b)<=d*c&&g(b);g(e.add(f))},_addSquareCap:function(a,b,c,d,e,f,g){d=a._point.transform(d);a=a.getLocation();c=a.getNormal().multiply(0===a.getTime()?c:-c).transform(e);"square"===b&&(g&&
(f(d.subtract(c)),f(d.add(c))),d=d.add(c.rotate(-90)));f(d.add(c));f(d.subtract(c))},getHandleBounds:function(a,b,c,d,e){b=c.getStyle();var f;if(e.stroke&&b.hasStroke()){var g=c._getStrokeMatrix(d,e);c=f=b.getStrokeWidth()/2;"miter"===b.getStrokeJoin()&&(c=f*b.getMiterLimit());"square"===b.getStrokeCap()&&(c=Math.max(c,f*Math.SQRT2));f=aa._getStrokePadding(f,g);g=aa._getStrokePadding(c,g)}b=Array(6);c=Infinity;e=-c;for(var h=c,k=e,l=0,m=a.length;l<m;l++){a[l]._transformCoordinates(d,b);for(var w=
0;6>w;w+=2){var t=w?f:g,n=t?t[0]:0,p=t?t[1]:0,v=b[w],y=b[w+1];t=v-n;n=v+n;v=y-p;p=y+p;t<c&&(c=t);n>e&&(e=n);v<h&&(h=v);p>k&&(k=p)}}return new E(c,h,e-c,k-h)}}});aa.inject({statics:new function(){function a(a,b,c){c=e.getNamed(c);var d=new aa(c&&0==c.insert&&Q.NO_INSERT);d._add(a);d._closed=b;return d.set(c,{insert:!0})}function b(b,d,e){for(var f=Array(4),g=0;4>g;g++){var h=c[g];f[g]=new T(h._point.multiply(d).add(b),h._handleIn.multiply(d),h._handleOut.multiply(d))}return a(f,!0,e)}var c=[new T([-1,
0],[0,.5522847498307936],[0,-.5522847498307936]),new T([0,-1],[-.5522847498307936,0],[.5522847498307936,0]),new T([1,0],[0,-.5522847498307936],[0,.5522847498307936]),new T([0,1],[.5522847498307936,0],[-.5522847498307936,0])];return{Line:function(){return a([new T(m.readNamed(arguments,"from")),new T(m.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var a=m.readNamed(arguments,"center"),c=e.readNamed(arguments,"radius");return b(a,new p(c),arguments)},Rectangle:function(){var b=E.readNamed(arguments,
"rectangle"),c=p.readNamed(arguments,"radius",0,{readNull:!0}),d=b.getBottomLeft(!0),e=b.getTopLeft(!0),f=b.getTopRight(!0),g=b.getBottomRight(!0);if(!c||c.isZero())d=[new T(d),new T(e),new T(f),new T(g)];else{c=p.min(c,b.getSize(!0).divide(2));b=c.width;c=c.height;var h=.5522847498307936*b,k=.5522847498307936*c;d=[new T(d.add(b,0),null,[-h,0]),new T(d.subtract(0,c),[0,k]),new T(e.add(0,c),null,[0,-k]),new T(e.add(b,0),[-h,0],null),new T(f.subtract(b,0),null,[h,0]),new T(f.add(0,c),[0,-k],null),new T(g.subtract(0,
c),null,[0,k]),new T(g.subtract(b,0),[h,0])]}return a(d,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var a=Ga._readEllipse(arguments);return b(a.center,a.radius,arguments)},Oval:"#Ellipse",Arc:function(){var a=m.readNamed(arguments,"from"),b=m.readNamed(arguments,"through"),c=m.readNamed(arguments,"to"),d=e.getNamed(arguments),f=new aa(d&&0==d.insert&&Q.NO_INSERT);f.moveTo(a);f.arcTo(b,c);return f.set(d)},RegularPolygon:function(){var b=m.readNamed(arguments,"center"),c=e.readNamed(arguments,
"sides"),d=e.readNamed(arguments,"radius"),f=360/c,g=0===c%3;d=new m(0,g?-d:d);g=g?-1:.5;for(var h=Array(c),k=0;k<c;k++)h[k]=new T(b.add(d.rotate((k+g)*f)));return a(h,!0,arguments)},Star:function(){for(var b=m.readNamed(arguments,"center"),c=2*e.readNamed(arguments,"points"),d=e.readNamed(arguments,"radius1"),f=e.readNamed(arguments,"radius2"),g=360/c,h=new m(0,-1),k=Array(c),l=0;l<c;l++)k[l]=new T(b.add(h.rotate(g*l).multiply(l%2?f:d)));return a(k,!0,arguments)}}}});var Ka=eb.extend({_class:"CompoundPath",
_serializeFields:{children:[]},beans:!0,initialize:function(a){this._children=[];this._namedChildren={};this._initialize(a)||("string"===typeof a?this.setPathData(a):this.addChildren(Array.isArray(a)?a:arguments))},insertChildren:function t(a,b){var c=b,d=c[0];d&&"number"===typeof d[0]&&(c=[c]);for(d=b.length-1;0<=d;d--){var f=c[d];c!==b||f instanceof aa||(c=e.slice(c));Array.isArray(f)?c[d]=new aa({segments:f,insert:!1}):f instanceof Ka&&(c.splice.apply(c,[d,1].concat(f.removeChildren())),f.remove())}return t.base.call(this,
a,c)},reduce:function t(a){for(var b=this._children,c=b.length-1;0<=c;c--){var d=b[c].reduce(a);d.isEmpty()&&d.remove()}return b.length?t.base.call(this):(d=new aa(Q.NO_INSERT),d.copyAttributes(this),d.insertAbove(this),this.remove(),d)},isClosed:function(){for(var a=this._children,b=0,c=a.length;b<c;b++)if(!a[b]._closed)return!1;return!0},setClosed:function(a){for(var b=this._children,c=0,d=b.length;c<d;c++)b[c].setClosed(a)},getFirstSegment:function(){var a=this.getFirstChild();return a&&a.getFirstSegment()},
getLastSegment:function(){var a=this.getLastChild();return a&&a.getLastSegment()},getCurves:function(){for(var a=this._children,b=[],c=0,d=a.length;c<d;c++)e.push(b,a[c].getCurves());return b},getFirstCurve:function(){var a=this.getFirstChild();return a&&a.getFirstCurve()},getLastCurve:function(){var a=this.getLastChild();return a&&a.getLastCurve()},getArea:function(){for(var a=this._children,b=0,c=0,d=a.length;c<d;c++)b+=a[c].getArea();return b},getLength:function(){for(var a=this._children,b=0,
c=0,d=a.length;c<d;c++)b+=a[c].getLength();return b},getPathData:function(a,b){for(var c=this._children,d=[],e=0,f=c.length;e<f;e++){var g=c[e],h=g._matrix;d.push(g.getPathData(a&&!h.isIdentity()?a.appended(h):a,b))}return d.join("")},_hitTestChildren:function z(a,b,c){return z.base.call(this,a,b["class"]===aa||"path"===b.type?b:e.set({},b,{fill:!1}),c)},_draw:function(a,b,c,d){var e=this._children;if(e.length){b=b.extend({dontStart:!0,dontFinish:!0});a.beginPath();for(var f=0,g=e.length;f<g;f++)e[f].draw(a,
b,d);b.clip||(this._setStyles(a,b,c),b=this._style,b.hasFill()&&(a.fill(b.getFillRule()),a.shadowColor="rgba(0,0,0,0)"),b.hasStroke()&&a.stroke())}},_drawSelected:function(a,b,c){for(var d=this._children,e=0,f=d.length;e<f;e++){var g=d[e],h=g._matrix;c[g._id]||g._drawSelected(a,h.isIdentity()?b:b.appended(h))}}},new function(){function a(a,b){var c=a._children;if(b&&!c.length)throw Error("Use a moveTo() command first");return c[c.length-1]}return e.each("lineTo cubicCurveTo quadraticCurveTo curveTo arcTo lineBy cubicCurveBy quadraticCurveBy curveBy arcBy".split(" "),
function(b){this[b]=function(){var c=a(this,!0);c[b].apply(c,arguments)}},{moveTo:function(){var b=a(this),c=b&&b.isEmpty()?b:new aa(Q.NO_INSERT);c!==b&&this.addChild(c);c.moveTo.apply(c,arguments)},moveBy:function(){var b=a(this,!0);b=b&&b.getLastSegment();var c=m.read(arguments);this.moveTo(b?c.add(b._point):c)},closePath:function(b){a(this,!0).closePath(b)}})},e.each(["reverse","flatten","simplify","smooth"],function(a){this[a]=function(b){for(var c=this._children,d,e=0,f=c.length;e<f;e++)d=c[e][a](b)||
d;return d}},{}));eb.inject(new function(){function a(a,b){var c=a.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return b?c.resolveCrossings().reorient("nonzero"===c.getFillRule(),!0):c}function c(a,b,c,d,e){var f=new Ka(Q.NO_INSERT);f.addChildren(a,!0);f=f.reduce({simplify:b});e&&0==e.insert||f.insertAbove(d&&c.isSibling(d)&&c.getIndex()<d.getIndex()?d:c);f.copyAttributes(c,!0);return f}function d(b,d,g,h){function l(a){for(var b=0,c=a.length;b<c;b++){var d=a[b];e.push(w,d._segments);e.push(n,
d.getCurves());d._overlapsOnly=!0}}if(h&&(0==h.trace||h.stroke)&&/^(subtract|intersect)$/.test(g))return f(b,d,g);var r=a(b,!0),q=d&&b!==d&&a(d,!0),x=V[g];x[g]=!0;q&&(x.subtract||x.exclude)^q.isClockwise()^r.isClockwise()&&q.reverse();g=m(Da.expand(r.getCrossings(q)));var t=r._children||[r],z=q&&(q._children||[q]),w=[],n=[];if(g.length){l(t);z&&l(z);t=0;for(z=g.length;t<z;t++)A(g[t]._segment,r,q,n,x);t=0;for(z=w.length;t<z;t++){g=w[t];var L=g._intersection;g._winding||A(g,r,q,n,x);L&&L._overlap||
(g._path._overlapsOnly=!1)}r=p(w,x)}else r=k(z?t.concat(z):t.slice(),function(a){return!!x[a]});return c(r,!0,b,d,h)}function f(b,d,e){function f(a){if(!r[a._id]&&(m||h.contains(a.getPointAt(a.getLength()/2))^l))return q.unshift(a),r[a._id]=!0}var g=a(b),h=a(d),k=g.getCrossings(h),l="subtract"===e,m="divide"===e,r={},q=[];for(e=k.length-1;0<=e;e--){var t=k[e].split();t&&(f(t)&&t.getFirstSegment().setHandleIn(0,0),g.getLastSegment().setHandleOut(0,0))}f(g);return c(q,!1,b,d)}function g(a,b){for(var c=
a;c;){if(c===b)return;c=c._previous}for(;a._next&&a._next!==b;)a=a._next;if(!a._next){for(;b._previous;)b=b._previous;a._next=b;b._previous=a}}function h(a){for(var b=a.length-1;0<=b;b--)a[b].clearHandles()}function k(a,b,c){var d=a&&a.length;if(d){var f=e.each(a,function(a,b){this[a._id]={container:null,winding:a.isClockwise()?1:-1,index:b}},{}),g=a.slice().sort(function(a,b){return fb(b.getArea())-fb(a.getArea())}),h=g[0];null==c&&(c=h.isClockwise());for(h=0;h<d;h++){for(var k=g[h],l=f[k._id],m=
k.getInteriorPoint(),r=0,q=h-1;0<=q;q--){var t=g[q];if(t.contains(m)){m=f[t._id];r=m.winding;l.winding+=r;l.container=m.exclude?m.container:t;break}}b(l.winding)===b(r)?(l.exclude=!0,a[l.index]=null):(l=l.container,k.setClockwise(l?!l.isClockwise():c))}}return a}function m(a,b,c){for(var d=b&&[],e=!1,f=c||[],k=c&&{},l,m,r,q=(c&&c.length)-1;0<=q;q--){var t=c[q];t._path&&(k[t._path._id+"."+t._segment1._index]=!0)}for(q=a.length-1;0<=q;q--){var x=a[q],z=x._time,w=z,A=b&&!b(x);if(t=x._curve)t!==m?(e=
!t.hasHandles()||k&&k[t._path._id+"."+t._segment1._index],l=[],r=null,m=t):1E-8<=r&&(z/=r);if(A)l&&l.push(x);else{b&&d.unshift(x);r=w;if(1E-8>z)t=t._segment1;else if(.99999999<z)t=t._segment2;else for(w=t.divideAtTime(z,!0),e&&f.push(t,w),t=w._segment1,w=l.length-1;0<=w;w--)A=l[w],A._time=(A._time-z)/(1-z);x._setSegment(t);z=t._intersection;x=x._intersection;if(z)for(g(z,x),x=z;x;)g(x._intersection,z),x=x._next;else t._intersection=x}}c||h(f);return d||a}function n(a,b,c,d,e){function f(f){var k=
f[h+0],t=f[h+2],A=f[h+4],U=f[h+6];if(m<=y(k,t,A,U)&&m>=v(k,t,A,U))for(k=f[g+0],t=f[g+2],A=f[g+4],U=f[g+6],f=r>y(k,t,A,U)||q<v(k,t,A,U)?[f]:H.getMonoCurves(f,c),k=0,t=f.length;k<t;k++){A=f[k];U=A[h+0];var I=A[h+6];if(m<v(U,I)||m>y(U,I))A=void 0;else{var Ha=A[g+0],na=A[g+2],ib=A[g+4],O=A[g+6];if(U===I){if(Ha<q&&O>r||O<q&&Ha>r)w=!0;A=void 0}else{na=m===U?0:m===I?1:r>y(Ha,na,ib,O)||q<v(Ha,na,ib,O)?1:0<H.solveCubic(A,h,m,R,0,1)?R[0]:1;O=0===na?Ha:1===na?O:H.getPoint(A,na)[c?"y":"x"];I=U>I?1:-1;ib=L[h]>
L[h+6]?1:-1;var J=L[g+6];m!==U?(O<r?x+=I:O>q?z+=I:w=!0,O>l-1E-6&&O<l+1E-6&&(G/=2)):(I!==ib?Ha<r?x+=I:Ha>q&&(z+=I):Ha!=J&&(J<q&&O>q?(z+=I,w=!0):J>r&&O<r&&(x+=I,w=!0)),G=0);L=A;A=!e&&O>r&&O<q&&0===H.getTangent(A,na)[c?"x":"y"]&&n(a,b,!c,d,!0)}}if(A)return A}}for(var g=c?1:0,h=g^1,k=[a.x,a.y],l=k[g],m=k[h],r=l-1E-9,q=l+1E-9,t=k=0,x=0,z=0,w=!1,A=!1,G=1,R=[],L,I,J=0,ya=b.length;J<ya;J++){var V=b[J],p=V._path,oa=V.getValues();if(!J||b[J-1]._path!==p)if(L=null,p._closed||(I=H.getValues(p.getLastCurve().getSegment2(),
V.getSegment1(),null,!d),I[h]!==I[h+6]&&(L=I)),!L){L=oa;for(var X=p.getLastCurve();X&&X!==V;){var ja=X.getValues();if(ja[h]!==ja[h+6]){L=ja;break}X=X.getPrevious()}}if(V=f(oa))return V;if(J+1===ya||b[J+1]._path!==p){if(I&&(V=f(I)))return V;!w||x||z||(x=z=p.isClockwise(d)^c?1:-1);k+=x;t+=z;x=z=0;w&&(A=!0,w=!1);I=null}}k=fb(k);t=fb(t);return{winding:y(k,t),windingL:k,windingR:t,quality:G,onPath:A}}function A(a,b,c,d,e){var f=[],g=a,h=0;do{var k=a.getCurve(),m=k.getLength();f.push({segment:a,curve:k,
length:m});h+=m;a=a.getNext()}while(a&&!a._intersection&&a!==g);g=[.5,.25,.75];a={winding:0,quality:-1};for(var r=0;r<g.length&&.5>a.quality;r++){m=h*g[r];for(var q=0,t=f.length;q<t;q++){k=f[q];var x=k.length;if(m<=x){k=k.curve;x=k._path;var z=x._parent;x=z instanceof Ka?z:x;var w=l.clamp(k.getTimeAt(m),1E-8,.99999999);z=k.getPointAtTime(w);k=fb(k.getTangentAtTime(w).y)<Math.SQRT1_2;w=null;if(e.subtract&&c){var A=x===b?c._getWinding(z,k,!0):b._getWinding(z,k,!0);if(x===b&&A.winding||x===c&&!A.winding)if(1>
A.quality)continue;else w={winding:0,quality:1}}w=w||n(z,d,k,!0);w.quality>a.quality&&(a=w);break}m-=x}}for(q=f.length-1;0<=q;q--)f[q].segment._winding=a}function p(a,b){function c(a){var c;return!(!a||a._visited||b&&(!b[(c=a._winding||{}).winding]||b.unite&&2===c.winding&&c.windingL&&c.windingR))}function d(a){if(a)for(var b=0,c=h.length;b<c;b++)if(a===h[b])return!0;return!1}function e(a){a=a._segments;for(var b=0,c=a.length;b<c;b++)a[b]._visited=!0}function f(a,b){function e(e,f){for(;e&&e!==f;){var g=
e._segment,l=g&&g._path;if(l){l=g.getNext()||l.getFirstSegment();var m=l._intersection;g!==a&&(d(g)||d(l)||l&&c(g)&&(c(l)||m&&c(m._segment)))&&k.push(g);b&&h.push(g)}e=e._next}}var f=a._intersection,g=f,k=[];b&&(h=[a]);if(f){for(e(f);f&&f._prev;)f=f._prev;e(f,g)}return k}var g=[],h;a.sort(function(a,b){var c=a._intersection,d=b._intersection,e=!(!c||!c._overlap),f=a._path,g=b._path;return e^!(!d||!d._overlap)?e?1:-1:!c^!d?c?1:-1:f!==g?f._id-g._id:a._index-b._index});for(var k=0,l=a.length;k<l;k++){var m=
a[k],r=c(m),q=null,t=!1,x=!0,z=[],w;if(r&&m._path._overlapsOnly){var A=m._path,n=m._intersection._segment._path;A.compare(n)&&(A.getArea()&&g.push(A.clone(!1)),e(A),e(n),r=!1)}for(;r;){A=!q;n=f(m,A);var I=n.shift();t=!A&&(d(m)||d(I));var R=!t&&I;if(A){q=new aa(Q.NO_INSERT);var L=null}if(t){if(m.isFirst()||m.isLast())x=m._path._closed;m._visited=!0;break}R&&L&&(z.push(L),L=null);L||(R&&n.push(m),L={start:q._segments.length,crossings:n,visited:w=[],handleIn:J});R&&(m=I);if(!c(m)){q.removeSegments(L.start);
m=0;for(A=w.length;m<A;m++)w[m]._visited=!1;w.length=0;do if(m=L&&L.crossings.shift(),!m||!m._path)if(m=null,L=z.pop()){w=L.visited;var J=L.handleIn}while(L&&!c(m));if(!m)break}A=m.getNext();q.add(new T(m._point,J,A&&m._handleOut));m._visited=!0;w.push(m);m=A||m._path.getFirstSegment();J=A&&A._handleIn}t&&(x&&(q.getFirstSegment().setHandleIn(J),q.setClosed(x)),0!==q.getArea()&&g.push(q))}return g}var v=Math.min,y=Math.max,fb=Math.abs,V={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,
"-1":!0}};return{_getWinding:function(a,b,c){return n(a,this.getCurves(),b,c)},unite:function(a,b){return d(this,a,"unite",b)},intersect:function(a,b){return d(this,a,"intersect",b)},subtract:function(a,b){return d(this,a,"subtract",b)},exclude:function(a,b){return d(this,a,"exclude",b)},divide:function(a,b){return b&&(0==b.trace||b.stroke)?f(this,a,"divide"):c([this.subtract(a,b),this.intersect(a,b)],!0,this,a,b)},resolveCrossings:function(){function a(a,b){var c=a&&a._intersection;return c&&c._overlap&&
c._path===b}var b=this._children,c=b||[this],d=!1,f=!1,g=this.getIntersections(null,function(a){return a.hasOverlap()&&(d=!0)||a.isCrossing()&&(f=!0)}),k=d&&f&&[];g=Da.expand(g);if(d)for(var l=m(g,function(a){return a.hasOverlap()},k),r=l.length-1;0<=r;r--){var q=l[r],t=q._path;q=q._segment;var x=q.getPrevious(),z=q.getNext();a(x,t)&&a(z,t)&&(q.remove(),x._handleOut._set(0,0),z._handleIn._set(0,0),x===q||x.getCurve().hasLength()||(z._handleIn.set(x._handleIn),x.remove()))}f&&(m(g,d&&function(a){var b=
a.getCurve(),c=a.getSegment(),d=a._intersection;a=d._curve;d=d._segment;if(b&&a&&b._path&&a._path)return!0;c&&(c._intersection=null);d&&(d._intersection=null)},k),k&&h(k),c=p(e.each(c,function(a){e.push(this,a._segments)},[])));g=c.length;if(1<g&&b){c!==b&&this.setChildren(c);var w=this}else 1!==g||b||(c[0]!==this&&this.setSegments(c[0].removeSegments()),w=this);w||(w=new Ka(Q.NO_INSERT),w.addChildren(c),w=w.reduce(),w.copyAttributes(this),this.replaceWith(w));return w},reorient:function(a,c){var d=
this._children;d&&d.length?this.setChildren(k(this.removeChildren(),function(b){return!!(a?b:b&1)},c)):c!==b&&this.setClockwise(c);return this},getInteriorPoint:function(){var a=this.getBounds().getCenter(!0);if(!this.contains(a)){for(var b=this.getCurves(),c=a.y,d=[],e=[],f=0,g=b.length;f<g;f++){var h=b[f].getValues(),k=h[1],l=h[3],m=h[5],r=h[7];if(c>=v(k,l,m,r)&&c<=y(k,l,m,r))for(h=H.getMonoCurves(h),k=0,l=h.length;k<l;k++){m=h[k];r=m[1];var q=m[7];r!==q&&(c>=r&&c<=q||c>=q&&c<=r)&&(m=c===r?m[0]:
c===q?m[6]:1===H.solveCubic(m,1,c,e,0,1)?H.getPoint(m,e[0]).x:(m[0]+m[6])/2,d.push(m))}}1<d.length&&(d.sort(function(a,b){return a-b}),a.x=(d[0]+d[1])/2)}return a}}});var rb=e.extend({_class:"PathFlattener",initialize:function(a,b,c,d,e){function f(a,b){var c=H.getValues(a,b,e);h.push(c);g(c,a._index,0,1)}function g(a,c,e,f){if(!(f-e>m)||d&&H.isStraight(a)||H.isFlatEnough(a,b||.25)){e=a[6]-a[0];var h=a[7]-a[1];e=Math.sqrt(e*e+h*h);0<e&&(l+=e,k.push({offset:l,curve:a,index:c,time:f}))}else a=H.subdivide(a,
.5),h=(e+f)/2,g(a[0],c,e,h),g(a[1],c,h,f)}var h=[],k=[],l=0,m=1/(c||32);c=a._segments;for(var t=c[0],x,z=1,w=c.length;z<w;z++)x=c[z],f(t,x),t=x;a._closed&&f(x||t,c[0]);this.curves=h;this.parts=k;this.length=l;this.index=0},_get:function(a){for(var b=this.parts,c=b.length,d,e=this.index;d=e,e&&!(b[--e].offset<a););for(;d<c;d++)if(e=b[d],e.offset>=a)return this.index=d,b=(c=b[d-1])&&c.index===e.index?c.time:0,c=c?c.offset:0,{index:e.index,time:b+(e.time-b)*(a-c)/(e.offset-c)};return{index:b[c-1].index,
time:1}},drawPart:function(a,b,c){b=this._get(b);c=this._get(c);for(var d=b.index,e=c.index;d<=e;d++){var f=H.getPart(this.curves[d],d===b.index?b.time:0,d===c.index?c.time:1);d===b.index&&a.moveTo(f[0],f[1]);a.bezierCurveTo.apply(a,f.slice(2))}}},e.each(H._evaluateMethods,function(a){this[a+"At"]=function(b){b=this._get(b);return H[a](this.curves[b.index],b.time)}},{})),Kb=e.extend({initialize:function(a){var b=this.points=[],c=a._segments;a=a._closed;for(var d=0,e,f=c.length;d<f;d++){var g=c[d].point;
e&&e.equals(g)||b.push(e=g.clone())}a&&(b.unshift(b[b.length-1]),b.push(b[1]));this.closed=a},fit:function(a){var b=this.points,c=b.length,d=null;0<c&&(d=[new T(b[0])],1<c&&(this.fitCubic(d,a,0,c-1,b[1].subtract(b[0]),b[c-2].subtract(b[c-1])),this.closed&&(d.shift(),d.pop())));return d},fitCubic:function(a,b,c,d,e,f){var g=this.points;if(1===d-c)b=g[c],d=g[d],c=b.getDistance(d)/3,this.addCurve(a,[b,b.add(e.normalize(c)),d.add(f.normalize(c)),d]);else{for(var h=this.chordLengthParameterize(c,d),k=
Math.max(b,b*b),l,m=!0,r=0;4>=r;r++){var t=this.generateBezier(c,d,h,e,f),x=this.findMaxError(c,d,t,h);if(x.error<b&&m){this.addCurve(a,t);return}l=x.index;if(x.error>=k)break;m=this.reparameterize(c,d,h,t);k=x.error}g=g[l-1].subtract(g[l+1]);this.fitCubic(a,b,c,l,e,g);this.fitCubic(a,b,l,d,g.negate(),f)}},addCurve:function(a,b){a[a.length-1].setHandleOut(b[1].subtract(b[0]));a.push(new T(b[3],b[2].subtract(b[3])))},generateBezier:function(a,b,c,d,e){var f=Math.abs,g=this.points,h=g[a],k=g[b],l=[[0,
0],[0,0]],m=[0,0],t=0;for(b=b-a+1;t<b;t++){var x=c[t],z=1-x,w=3*x*z,n=z*z*z;z*=w;w*=x;var J=x*x*x;x=d.normalize(z);var p=e.normalize(w);n=g[a+t].subtract(h.multiply(n+z)).subtract(k.multiply(w+J));l[0][0]+=x.dot(x);l[0][1]+=x.dot(p);l[1][0]=l[0][1];l[1][1]+=p.dot(p);m[0]+=x.dot(n);m[1]+=p.dot(n)}a=l[0][0]*l[1][1]-l[1][0]*l[0][1];1E-12<f(a)?(f=l[0][0]*m[1]-l[1][0]*m[0],m=(m[0]*l[1][1]-m[1]*l[0][1])/a,f/=a):(a=l[0][0]+l[0][1],l=l[1][0]+l[1][1],m=f=1E-12<f(a)?m[0]/a:1E-12<f(l)?m[1]/l:0);l=k.getDistance(h);
a=1E-12*l;if(m<a||f<a)m=f=l/3;else{a=k.subtract(h);var v=d.normalize(m);var G=e.normalize(f);v.dot(a)-G.dot(a)>l*l&&(m=f=l/3,v=G=null)}return[h,h.add(v||d.normalize(m)),k.add(G||e.normalize(f)),k]},reparameterize:function(a,b,c,d){for(var e=a;e<=b;e++)c[e-a]=this.findRoot(d,this.points[e],c[e-a]);e=1;for(a=c.length;e<a;e++)if(c[e]<=c[e-1])return!1;return!0},findRoot:function(a,b,c){for(var d=[],e=[],f=0;2>=f;f++)d[f]=a[f+1].subtract(a[f]).multiply(3);for(f=0;1>=f;f++)e[f]=d[f+1].subtract(d[f]).multiply(2);
a=this.evaluate(3,a,c);d=this.evaluate(2,d,c);e=this.evaluate(1,e,c);b=a.subtract(b);e=d.dot(d)+b.dot(e);return l.isZero(e)?c:c-b.dot(d)/e},evaluate:function(a,b,c){b=b.slice();for(var d=1;d<=a;d++)for(var e=0;e<=a-d;e++)b[e]=b[e].multiply(1-c).add(b[e+1].multiply(c));return b[0]},chordLengthParameterize:function(a,b){for(var c=[0],d=a+1;d<=b;d++)c[d-a]=c[d-a-1]+this.points[d].getDistance(this.points[d-1]);d=1;for(var e=b-a;d<=e;d++)c[d]/=c[e];return c},findMaxError:function(a,b,c,d){for(var e=Math.floor((b-
a+1)/2),f=0,g=a+1;g<b;g++){var h=this.evaluate(3,c,d[g-a]).subtract(this.points[g]);h=h.x*h.x+h.y*h.y;h>=f&&(f=h,e=g)}return{error:f,index:e}}}),kb=Q.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(a){this._content="";this._lines=[];var c=a&&e.isPlainObject(a)&&a.x===b&&a.y===b;this._initialize(c&&a,!c&&m.read(arguments))},_equals:function(a){return this._content===a._content},copyContent:function(a){this.setContent(a._content)},
getContent:function(){return this._content},setContent:function(a){this._content=""+a;this._lines=this._content.split(/\r\n|\n|\r/mg);this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),Qa=kb.extend({_class:"PointText",initialize:function(){kb.apply(this,arguments)},getPoint:function(){var a=this._matrix.getTranslation();return new y(a.x,a.y,this,"setPoint")},setPoint:function(){var a=
m.read(arguments);this.translate(a.subtract(this._matrix.getTranslation()))},_draw:function(a,b,c){if(this._content){this._setStyles(a,b,c);b=this._lines;var d=this._style;c=d.hasFill();var e=d.hasStroke(),f=d.getLeading(),g=a.shadowColor;a.font=d.getFontStyle();a.textAlign=d.getJustification();d=0;for(var h=b.length;d<h;d++){a.shadowColor=g;var k=b[d];c&&(a.fillText(k,0,0),a.shadowColor="rgba(0,0,0,0)");e&&a.strokeText(k,0,0);a.translate(0,f)}}},_getBounds:function(a,b){var c=this._style,d=this._lines,
e=d.length,f=c.getJustification(),g=c.getLeading();c=this.getView().getTextWidth(c.getFontStyle(),d);d=0;"left"!==f&&(d-=c/("center"===f?2:1));e=new E(d,e?-.75*g:0,c,e*g);return a?a._transformBounds(e,e):e}}),Oa=e.extend(new function(){var a={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},b={},d={transparent:[0,0,0,0]},f,g=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],
h={"rgb-hsb":function(a,b,c){var d=Math.max(a,b,c),e=d-Math.min(a,b,c);return[0===e?0:60*(d==a?(b-c)/e+(b<c?6:0):d==b?(c-a)/e+2:(a-b)/e+4),0===d?0:e/d,d]},"hsb-rgb":function(a,b,c){a=(a/60%6+6)%6;var d=Math.floor(a);a-=d;d=g[d];b=[c,c*(1-b),c*(1-b*a),c*(1-b*(1-a))];return[b[d[0]],b[d[1]],b[d[2]]]},"rgb-hsl":function(a,b,c){var d=Math.max(a,b,c),e=Math.min(a,b,c),f=d-e,g=0===f,h=(d+e)/2;return[g?0:60*(d==a?(b-c)/f+(b<c?6:0):d==b?(c-a)/f+2:(a-b)/f+4),g?0:.5>h?f/(d+e):f/(2-d-e),h]},"hsl-rgb":function(a,
b,c){a=(a/360%1+1)%1;if(0===b)return[c,c,c];a=[a+1/3,a,a-1/3];b=.5>c?c*(1+b):c+b-c*b;c=2*c-b;for(var d=[],e=0;3>e;e++){var f=a[e];0>f&&(f+=1);1<f&&--f;d[e]=1>6*f?c+6*(b-c)*f:1>2*f?b:2>3*f?c+(b-c)*(2/3-f)*6:c}return d},"rgb-gray":function(a,b,c){return[.2989*a+.587*b+.114*c]},"gray-rgb":function(a){return[a,a,a]},"gray-hsb":function(a){return[0,0,a]},"gray-hsl":function(a){return[0,0,a]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return e.each(a,function(c,d){b[d]=[];
e.each(c,function(c,f){var g=e.capitalize(c),h=/^(hue|saturation)$/.test(c),k=b[d][f]="gradient"===d?"gradient"===c?function(a){var b=this._components[0];a=lb.read(Array.isArray(a)?a:arguments,0,{readNull:!0});b!==a&&(b&&b._removeOwner(this),a&&a._addOwner(this));return a}:function(){return m.read(arguments,0,{readNull:"highlight"===c,clone:!0})}:function(a){return null==a||isNaN(a)?0:+a};this["get"+g]=function(){return this._type===d||h&&/^hs[bl]$/.test(this._type)?this._components[f]:this._convert(d)[f]};
this["set"+g]=function(b){this._type===d||h&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(d),this._properties=a[d],this._type=d);this._components[f]=k.call(this,b);this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function I(g){var h=arguments,k=this.__read,l=0,m;Array.isArray(g)&&(h=g,g=h[0]);var r=null!=g&&typeof g;if("string"===r&&g in a){var q=g;g=h[1];if(Array.isArray(g)){var x=g;var t=h[2]}else k&&(l=1),h=e.slice(h,1),r=typeof g}if(!x){if(m="number"===r?h:"object"===
r&&null!=g.length?g:null)q||(q=3<=m.length?"rgb":"gray"),h=a[q].length,t=m[h],k&&(l+=m===arguments?h+(null!=t?1:0):1),m.length>h&&(m=e.slice(m,0,h));else if("string"===r){x=g;var z=x.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||x.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i);q="rgb";if(z){var n=z[4]?4:3;x=Array(n);for(h=0;h<n;h++)r=z[h+1],x[h]=parseInt(1==r.length?r+r:r,16)/255}else if(z=x.match(/^(rgb|hsl)a?\((.*)\)$/))for(q=z[1],x=z[2].split(/[,\s]+/g),z="hsl"===q,h=0,n=
Math.min(x.length,4);h<n;h++){var w=x[h];r=parseFloat(w);z?0===h?(w=w.match(/([a-z]*)$/)[1],r*={turn:360,rad:180/Math.PI,grad:.9}[w]||1):3>h&&(r/=100):3>h&&(r/=255);x[h]=r}else h=d[x],h||(c?(f||(f=ra.getContext(1,1),f.globalCompositeOperation="copy"),f.fillStyle="rgba(0,0,0,0)",f.fillStyle=x,f.fillRect(0,0,1,1),h=f.getImageData(0,0,1,1).data,h=d[x]=[h[0]/255,h[1]/255,h[2]/255]):h=[0,0,0]),x=h.slice();x=[q,x];q=x[0];x=x[1];4===x.length&&(t=x[3],x.length--)}else if("object"===r)if(g.constructor===I){if(q=
g._type,x=g._components.slice(),t=g._alpha,"gradient"===q)for(h=1,r=x.length;h<r;h++)(z=x[h])&&(x[h]=z.clone())}else if(g.constructor===lb)q="gradient",m=h;else{q="hue"in g?"lightness"in g?"hsl":"hsb":"gradient"in g||"stops"in g||"radial"in g?"gradient":"gray"in g?"gray":"rgb";t=a[q];z=b[q];this._components=x=[];h=0;for(r=t.length;h<r;h++)n=g[t[h]],null==n&&!h&&"gradient"===q&&"stops"in g&&(n={stops:g.stops,radial:g.radial}),n=z[h].call(this,n),null!=n&&(x[h]=n);t=g.alpha}k&&q&&(l=1)}this._type=q||
"rgb";if(!x)for(this._components=x=[],z=b[this._type],h=0,r=z.length;h<r;h++)n=z[h].call(this,m&&m[h]),null!=n&&(x[h]=n);this._components=x;this._properties=a[this._type];this._alpha=t;k&&(this.__read=l);return this},set:"#initialize",_serialize:function(a,b){var c=this.getComponents();return e.serialize(/^(gray|rgb)$/.test(this._type)?c:[this._type].concat(c),a,!0,b)},_changed:function(){this._canvasStyle=null;this._owner&&this._owner._changed(129)},_convert:function(a){var b;return this._type===
a?this._components.slice():(b=h[this._type+"-"+a])?b.apply(this,this._components):h["rgb-"+a].apply(this,h[this._type+"-rgb"].apply(this,this._components))},convert:function(a){return new Oa(a,this._convert(a),this._alpha)},getType:function(){return this._type},setType:function(b){this._components=this._convert(b);this._properties=a[b];this._type=b},getComponents:function(){var a=this._components.slice();null!=this._alpha&&a.push(this._alpha);return a},getAlpha:function(){return null!=this._alpha?
this._alpha:1},setAlpha:function(a){this._alpha=null==a?null:Math.min(Math.max(a,0),1);this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(a){var b=e.isPlainValue(a,!0)?Oa.read(arguments):a;return b===this||b&&this._class===b._class&&this._type===b._type&&this.getAlpha()===b.getAlpha()&&e.equals(this._components,b._components)||!1},toString:function(){for(var a=this._properties,b=[],c="gradient"===this._type,d=k.instance,e=0,f=a.length;e<f;e++){var g=this._components[e];
null!=g&&b.push(a[e]+": "+(c?g:d.number(g)))}null!=this._alpha&&b.push("alpha: "+d.number(this._alpha));return"{ "+b.join(", ")+" }"},toCSS:function(a){function b(a){return Math.round(255*(0>a?0:1<a?1:a))}var c=this._convert("rgb"),d=a||null==this._alpha?1:this._alpha;c=[b(c[0]),b(c[1]),b(c[2])];1>d&&c.push(0>d?0:d);return a?"#"+(16777216+(c[0]<<16)+(c[1]<<8)+c[2]).toString(16).slice(1):(4==c.length?"rgba(":"rgb(")+c.join(",")+")"},toCanvasStyle:function(a,b){if(this._canvasStyle)return this._canvasStyle;
if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var c=this._components,d=c[0],e=d._stops,f=c[1],g=c[2];c=c[3];var h=b&&b.inverted();h&&(f=h._transformPoint(f),g=h._transformPoint(g),c&&(c=h._transformPoint(c)));d._radial?(d=g.getDistance(f),c&&(g=c.subtract(f),g.getLength()>d&&(c=f.add(g.normalize(d-.1)))),c=c||f,f=a.createRadialGradient(c.x,c.y,0,f.x,f.y,d)):f=a.createLinearGradient(f.x,f.y,g.x,g.y);c=0;for(d=e.length;c<d;c++)g=e[c],h=g._offset,f.addColorStop(null==h?c/(d-1):h,g._color.toCanvasStyle());
return this._canvasStyle=f},transform:function(a){if("gradient"===this._type){for(var b=this._components,c=1,d=b.length;c<d;c++){var e=b[c];a._transformPoint(e,e,!0)}this._changed()}},statics:{_types:a,random:function(){var a=Math.random;return new Oa(a(),a(),a())}}})},new function(){return e.each({add:function(a,b){return a+b},subtract:function(a,b){return a-b},multiply:function(a,b){return a*b},divide:function(a,b){return a/b}},function(a,b){this[b]=function(b){b=Oa.read(arguments);for(var c=this._type,
d=this._components,e=b._convert(c),f=0,g=d.length;f<g;f++)e[f]=a(d[f],e[f]);return new Oa(c,e,null!=this._alpha?a(this._alpha,b.getAlpha()):null)}},{})}),lb=e.extend({_class:"Gradient",initialize:function(a,b){this._id=n.get();a&&e.isPlainObject(a)&&(this.set(a),a=b=null);null==this._stops&&this.setStops(a||["white","black"]);null==this._radial&&this.setRadial("string"===typeof b&&"radial"===b||b||!1)},_serialize:function(a,b){return b.add(this,function(){return e.serialize([this._stops,this._radial],
a,!0,b)})},_changed:function(){for(var a=0,b=this._owners&&this._owners.length;a<b;a++)this._owners[a]._changed()},_addOwner:function(a){this._owners||(this._owners=[]);this._owners.push(a)},_removeOwner:function(a){a=this._owners?this._owners.indexOf(a):-1;-1!=a&&(this._owners.splice(a,1),this._owners.length||(this._owners=b))},clone:function(){for(var a=[],b=0,c=this._stops.length;b<c;b++)a[b]=this._stops[b].clone();return new lb(a,this._radial)},getStops:function(){return this._stops},setStops:function(a){if(2>
a.length)throw Error("Gradient stop list needs to contain at least two stops.");var c=this._stops;if(c)for(var d=0,e=c.length;d<e;d++)c[d]._owner=b;c=this._stops=Va.readList(a,0,{clone:!0});d=0;for(e=c.length;d<e;d++)c[d]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(a){this._radial=a;this._changed()},equals:function(a){if(a===this)return!0;if(a&&this._class===a._class){var b=this._stops;a=a._stops;var c=b.length;if(c===a.length){for(var d=0;d<c;d++)if(!b[d].equals(a[d]))return!1;
return!0}}return!1}}),Va=e.extend({_class:"GradientStop",initialize:function(a,c){var d=a,e=c;if("object"===typeof a&&c===b)if(Array.isArray(a)&&"number"!==typeof a[0])d=a[0],e=a[1];else if("color"in a||"offset"in a||"rampPoint"in a)d=a.color,e=a.offset||a.rampPoint||0;this.setColor(d);this.setOffset(e)},clone:function(){return new Va(this._color.clone(),this._offset)},_serialize:function(a,b){var c=this._color,d=this._offset;return e.serialize(null==d?[c]:[c,d],a,!0,b)},_changed:function(){this._owner&&
this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(a){this._offset=a;this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){var a=Oa.read(arguments,0,{clone:!0});a&&(a._owner=this);this._color=a;this._changed()},equals:function(a){return a===this||a&&this._class===a._class&&this._color.equals(a._color)&&this._offset==a._offset||!1}}),pb=e.extend(new function(){var a={fillColor:null,fillRule:"nonzero",
strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new m,selectedColor:null},c=e.set({},a,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),d=e.set({},c,{fillColor:new Oa}),f={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},g={beans:!0},h={_class:"Style",
beans:!0,initialize:function(b,e,f){this._values={};this._project=(this._owner=e)&&e._project||f||fa.project;this._defaults=!e||e instanceof Ma?c:e instanceof kb?d:a;b&&this.set(b)}};e.each(c,function(a,c){var d=/Color$/.test(c),k="shadowOffset"===c,l=e.capitalize(c),r=f[c],x="set"+l,n="get"+l;h[x]=function(a){var e=this._owner,f=e&&e._children;if(f&&0<f.length&&!(e instanceof Ka)){e=0;for(var g=f.length;e<g;e++)f[e]._style[x](a)}else c in this._defaults&&(f=this._values[c],f!==a&&(d&&(f&&f._owner!==
b&&(f._owner=b,f._canvasStyle=null),a&&a.constructor===Oa&&(a._owner&&(a=a.clone()),a._owner=e)),this._values[c]=a,e&&e._changed(r||129)))};h[n]=function(a){var f=this._owner,g=f&&f._children;if(c in this._defaults&&(!g||!g.length||a||f instanceof Ka)){var h=this._values[c];h===b?(h=this._defaults[c])&&h.clone&&(h=h.clone()):!(g=d?Oa:k?m:null)||h&&h.constructor===g||(this._values[c]=h=g.read([h],0,{readNull:!0,clone:!0}))&&d&&(h._owner=f)}else if(g)for(f=0,a=g.length;f<a;f++){var l=g[f]._style[n]();
if(!f)h=l;else if(!e.equals(h,l))return b}return h};g[n]=function(a){return this._style[n](a)};g[x]=function(a){this._style[x](a)}});e.each({Font:"FontFamily",WindingRule:"FillRule"},function(a,b){var c="get"+b,d="set"+b;h[c]=g[c]="#get"+a;h[d]=g[d]="#set"+a});Q.inject(g);return h},{set:function(a){var b=a instanceof pb;if(a=b?a._values:a)for(var c in a)if(c in this._defaults){var d=a[c];this[c]=d&&b&&d.clone?d.clone():d}},equals:function(a){function c(a,c,d){a=a._values;var f=c._values;c=c._defaults;
for(var g in a){var h=a[g],k=f[g];if(!(d&&g in f||e.equals(h,k===b?c[g]:k)))return!1}return!0}return a===this||a&&this._class===a._class&&c(this,a)&&c(a,this,!0)||!1},_dispose:function(){var a;if(a=this.getFillColor())a._canvasStyle=null;if(a=this.getStrokeColor())a._canvasStyle=null;if(a=this.getShadowColor())a._canvasStyle=null},hasFill:function(){var a=this.getFillColor();return!!a&&0<a.alpha},hasStroke:function(){var a=this.getStrokeColor();return!!a&&0<a.alpha&&0<this.getStrokeWidth()},hasShadow:function(){var a=
this.getShadowColor();return!!a&&0<a.alpha&&(0<this.getShadowBlur()||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var a=this.getFontSize();return this.getFontWeight()+" "+a+(/[a-z]/i.test(a+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function w(){var a=w.base.call(this),b=this.getFontSize();/pt|em|%|px/.test(b)&&(b=this.getView().getPixelSize(b));return null!=a?a:1.2*b}}),va=new function(){function a(a,
b,c,d){for(var e=" webkit moz Moz ms o".split(" "),f=b[0].toUpperCase()+b.substring(1),g=0;6>g;g++){var h=e[g];h=h?h+f:b;if(h in a){if(c)a[h]=d;else return a[h];break}}}return{getStyles:function(a){var b=a&&9!==a.nodeType?a.ownerDocument:a;return(b=b&&b.defaultView)&&b.getComputedStyle(a,"")},getBounds:function(a,b){var c=a.ownerDocument,d=c.body,e=c.documentElement;try{var f=a.getBoundingClientRect()}catch(X){f={left:0,top:0,width:0,height:0}}var g=f.left-(e.clientLeft||d.clientLeft||0),h=f.top-
(e.clientTop||d.clientTop||0);b||(c=c.defaultView,g+=c.pageXOffset||e.scrollLeft||d.scrollLeft,h+=c.pageYOffset||e.scrollTop||d.scrollTop);return new E(g,h,f.width,f.height)},getViewportBounds:function(a){var b=a.ownerDocument;a=b.defaultView;b=b.documentElement;return new E(0,0,a.innerWidth||b.clientWidth,a.innerHeight||b.clientHeight)},getOffset:function(a,b){return va.getBounds(a,b).getPoint()},getSize:function(a){return va.getBounds(a,!0).getSize()},isInvisible:function(a){return va.getSize(a).equals(new p(0,
0))},isInView:function(a){return!va.isInvisible(a)&&va.getViewportBounds(a).intersects(va.getBounds(a,!0))},isInserted:function(a){return d.body.contains(a)},getPrefixed:function(b,c){return b&&a(b,c)},setPrefixed:function(b,c,d){if("object"===typeof c)for(var e in c)a(b,e,!0,c[e]);else a(b,c,!0,d)}}},ua={add:function(a,b){if(a)for(var c in b)for(var e=b[c],f=c.split(/[\s,]+/g),g=0,h=f.length;g<h;g++){var k=f[g];a.addEventListener(k,e,a!==d||"touchstart"!==k&&"touchmove"!==k?!1:{passive:!1})}},remove:function(a,
b){if(a)for(var c in b)for(var d=b[c],e=c.split(/[\s,]+/g),f=0,g=e.length;f<g;f++)a.removeEventListener(e[f],d,!1)},getPoint:function(a){a=a.targetTouches?a.targetTouches.length?a.targetTouches[0]:a.changedTouches[0]:a;return new m(a.pageX||a.clientX+d.documentElement.scrollLeft,a.pageY||a.clientY+d.documentElement.scrollTop)},getTarget:function(a){return a.target||a.srcElement},getRelatedTarget:function(a){return a.relatedTarget||a.toElement},getOffset:function(a,b){return ua.getPoint(a).subtract(va.getOffset(b||
ua.getTarget(a)))}};ua.requestAnimationFrame=new function(){function a(){var c=e;e=[];for(var f=0,g=c.length;f<g;f++)c[f]();(d=b&&e.length)&&b(a)}var b=va.getPrefixed(c,"requestAnimationFrame"),d=!1,e=[],f;return function(c){e.push(c);b?d||(b(a),d=!0):f||(f=setInterval(a,1E3/60))}};var ta=e.extend(f,{_class:"View",initialize:function J(a,b){function e(a){return b[a]||parseInt(b.getAttribute(a),10)}function f(){var a=va.getSize(b);return a.isNaN()||a.isZero()?new p(e("width"),e("height")):a}if(c&&
b){this._id=b.getAttribute("id");null==this._id&&b.setAttribute("id",this._id="view-"+J._id++);ua.add(b,this._viewEvents);va.setPrefixed(b.style,{userDrag:"none",userSelect:"none",touchCallout:"none",contentZooming:"none",tapHighlightColor:"rgba(0,0,0,0)"});if(g.hasAttribute(b,"resize")){var h=this;ua.add(c,this._windowEvents={resize:function(){h.setViewSize(f())}})}var k=f();if(g.hasAttribute(b,"stats")&&"undefined"!==typeof Stats){this._stats=new Stats;var l=this._stats.domElement,m=l.style,n=va.getOffset(b);
m.position="absolute";m.left=n.x+"px";m.top=n.y+"px";d.body.appendChild(l)}}else k=new p(b),b=null;this._project=a;this._scope=a._scope;this._element=b;this._pixelRatio||(this._pixelRatio=c&&c.devicePixelRatio||1);this._setElementSize(k.width,k.height);this._viewSize=k;J._views.push(this);J._viewsById[this._id]=this;(this._matrix=new P)._owner=this;J._focused||(J._focused=this);this._frameItems={};this._frameItemCount=0;this._itemEvents={"native":{},virtual:{}};this._autoUpdate=!fa.agent.node;this._needsUpdate=
!1},remove:function(){if(!this._project)return!1;ta._focused===this&&(ta._focused=null);ta._views.splice(ta._views.indexOf(this),1);delete ta._viewsById[this._id];var a=this._project;a._view===this&&(a._view=null);ua.remove(this._element,this._viewEvents);ua.remove(c,this._windowEvents);this._element=this._project=null;this.off("frame");this._animate=!1;this._frameItems={};return!0},_events:e.each(Q._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(a){this[a]={}},{onFrame:{install:function(){this.play()},
uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(a){(this._autoUpdate=a)&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var a=this;ua.requestAnimationFrame(function(){a._requested=!1;if(a._animate){a.requestUpdate();var b=a._element;va.getPrefixed(d,"hidden")&&"true"!==g.getAttribute(b,"keepalive")||!va.isInView(b)||a._handleFrame()}a._autoUpdate&&
a.update()});this._requested=!0}},play:function(){this._animate=!0;this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){fa=this._scope;var a=Date.now()/1E3,b=this._last?a-this._last:0;this._last=a;this.emit("frame",new e({delta:b,time:this._time+=b,count:this._count++}));this._stats&&this._stats.update()},_animateItem:function(a,b){var c=this._frameItems;if(b){if(c[a._id]={item:a,time:0,count:0},1===++this._frameItemCount)this.on("frame",this._handleFrameItems)}else delete c[a._id],
0===--this._frameItemCount&&this.off("frame",this._handleFrameItems)},_handleFrameItems:function(a){for(var b in this._frameItems){var c=this._frameItems[b];c.item.emit("frame",new e(a,{time:c.time+=a.delta,count:c.count++}))}},_changed:function(){this._project._changed(4097);this._bounds=this._decomposed=b},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var a=this._viewSize;
return new K(a.width,a.height,this,"setViewSize")},setViewSize:function(){var a=p.read(arguments),b=a.subtract(this._viewSize);b.isZero()||(this._setElementSize(a.width,a.height),this._viewSize.set(a),this._changed(),this.emit("resize",{size:a,delta:b}),this._autoUpdate&&this.update())},_setElementSize:function(a,b){var c=this._element;c&&(c.width!==a&&(c.width=a),c.height!==b&&(c.height=b))},getBounds:function(){this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new E(new m,this._viewSize)));
return this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return va.isInView(this._element)},isInserted:function(){return va.isInserted(this._element)},getPixelSize:function(a){var b=this._element;if(b){b=b.parentNode;var c=d.createElement("div");c.style.fontSize=a;b.appendChild(c);var e=parseFloat(va.getStyles(c).fontSize);b.removeChild(c)}else e=parseFloat(e);return e},getTextWidth:function(a,b){return 0}},e.each(["rotate","scale","shear","skew"],function(a){var b=
"rotate"===a;this[a]=function(){var c=(b?e:m).read(arguments),d=m.read(arguments,0,{readNull:!0});return this.transform((new P)[a](c,d||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var a=new P;return this.transform(a.translate.apply(a,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var a=m.read(arguments);this.translate(this.getCenter().subtract(a))},getZoom:function(){var a=
this._decompose();return(a=a&&a.scaling)?(a.x+a.y)/2:0},setZoom:function(a){this.transform((new P).scale(a/this.getZoom(),this.getCenter()))},getRotation:function(){var a=this._decompose();return a&&a.rotation},setRotation:function(a){var b=this.getRotation();null!=b&&null!=a&&this.rotate(a-b)},getScaling:function(){var a=this._decompose();return(a=a&&a.scaling)?new y(a.x,a.y,this,"setScaling"):b},setScaling:function(){var a=this.getScaling(),b=m.read(arguments,0,{clone:!0,readNull:!0});a&&b&&this.scale(b.x/
a.x,b.y/a.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var a=this._matrix;a.initialize.apply(a,arguments)},transform:function(a){this._matrix.append(a)},scrollBy:function(){this.translate(m.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(m.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(m.read(arguments))},getEventPoint:function(a){return this.viewToProject(ua.getOffset(a,this._element))}},{statics:{_views:[],
_viewsById:{},_id:0,create:function(a,b){d&&"string"===typeof b&&(b=d.getElementById(b));return new (c?Mb:ta)(a,b)}}},new function(){function a(a){a=ua.getTarget(a);return a.getAttribute&&ta._viewsById[a.getAttribute("id")]}function b(){var a=ta._focused;if(!a||!a.isVisible())for(var b=0,c=ta._views.length;b<c;b++)if((a=ta._views[b]).isVisible()){ta._focused=h=a;break}}function e(a,b,c,d,e,f,g){function h(a,c){if(a.responds(c)){if(l||(l=new yb(c,d,e,b||a,f?e.subtract(f):null)),a.emit(c,l)&&(L=!0,
l.prevented&&(oa=!0),l.stopped))return k=!0}else{var g=ya[c];if(g)return h(a,g)}}for(var k=!1,l;a&&a!==g&&!h(a,c);)a=a._parent;return k}function f(a,b,c,d,f,g){a._project.removeOn(c);oa=L=!1;return U&&e(U,null,c,d,f,g)||b&&b!==U&&!b.isDescendant(U)&&e(b,null,c,d,f,g,U)||e(a,U||b||a,c,d,f,g)}if(c){var g,h,k=!1,l=!1,m=c.navigator;if(m.pointerEnabled||m.msPointerEnabled){var n="pointerdown MSPointerDown";var p="pointermove MSPointerMove";var v="pointerup pointercancel MSPointerUp MSPointerCancel"}else n=
"touchstart",p="touchmove",v="touchend touchcancel","ontouchstart"in c&&m.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(n+=" mousedown",p+=" mousemove",v+=" mouseup");m={};var y={mouseout:function(a){var b=ta._focused,c=ua.getRelatedTarget(a);if(b&&(!c||"HTML"===c.nodeName)){c=ua.getOffset(a,b._element);var d=c.x,e=Math.abs,f=e(d),g=f-33554432;c.x=e(g)<f?g*(0>d?-1:1):d;c=b.viewToProject(c);b._handleMouseEvent("mousemove",a,c)}},scroll:b};m[n]=function(b){var c=ta._focused=a(b);k||
(k=!0,c._handleMouseEvent("mousedown",b))};y[p]=function(c){var d=ta._focused;if(!l){var e=a(c);e?d!==e&&(d&&d._handleMouseEvent("mousemove",c,void 0),g||(g=d),d=ta._focused=h=e):h&&h===d&&(g&&!g.isInserted()&&(g=null),d=ta._focused=g,g=null,b())}d&&d._handleMouseEvent("mousemove",c,void 0)};y[n]=function(){l=!0};y[v]=function(a){var b=ta._focused;b&&k&&b._handleMouseEvent("mouseup",a);l=k=!1};ua.add(d,y);ua.add(c,{load:b});var L=!1,oa=!1,ya={doubleclick:"click",mousedrag:"mousemove"},ja=!1,G,ba,
Na,E,U,Ha,ib,bb,jb={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:m,_handleMouseEvent:function(a,b,c){function d(a){return g.virtual[a]||r.responds(a)||m&&m.responds(a)}var g=this._itemEvents,h=g["native"][a],l="mousemove"===a,m=this._scope.tool,r=this;l&&k&&d("mousedrag")&&(a="mousedrag");c||(c=this.getEventPoint(b));var n=this.getBounds().contains(c),
q=h&&n&&r._project.hitTest(c,{tolerance:0,fill:!0,stroke:!0});q=q&&q.item||null;var x=!1,p={};p[a.substr(5)]=!0;h&&q!==E&&(E&&e(E,null,"mouseleave",b,c),q&&e(q,null,"mouseenter",b,c),E=q);ja^n&&(e(this,null,n?"mouseenter":"mouseleave",b,c),x=!0);!n&&!p.drag||c.equals(ba)||(f(this,q,l?a:"mousemove",b,c,ba),x=!0);ja=n;if(p.down&&n||p.up&&G){f(this,q,a,b,c,G);if(p.down){bb=q===Ha&&300>Date.now()-ib;Na=Ha=q;if(!oa&&q){for(h=q;h&&!h.responds("mousedrag");)h=h._parent;h&&(U=q)}G=c}else p.up&&(oa||q!==Na||
(ib=Date.now(),f(this,q,bb?"doubleclick":"click",b,c,G),bb=!1),Na=U=null);ja=!1;x=!0}ba=c;x&&m&&(L=m._handleMouseEvent(a,b,c,p)||L);!1!==b.cancelable&&(L&&!p.move||p.down&&d("mouseup"))&&b.preventDefault()},_handleKeyEvent:function(a,b,c,d){function e(e){e.responds(a)&&(fa=f,e.emit(a,h=h||new Nb(a,b,c,d)))}var f=this._scope,g=f.tool,h;this.isVisible()&&(e(this),g&&g.responds(a)&&e(g))},_countItemEvent:function(a,b){var c=this._itemEvents,d=c["native"];c=c.virtual;for(var e in jb)d[e]=(d[e]||0)+(jb[e][a]||
0)*b;c[a]=(c[a]||0)+b},statics:{updateFocus:b,_resetState:function(){k=l=L=ja=!1;g=h=G=ba=Na=E=U=Ha=ib=bb=null}}}}}),Mb=ta.extend({_class:"CanvasView",initialize:function(a,b){if(!(b instanceof c.HTMLCanvasElement)){var d=p.read(arguments,1);if(d.isZero())throw Error("Cannot create CanvasView with the provided argument: "+e.slice(arguments,1));b=ra.getCanvas(d)}var f=this._context=b.getContext("2d");f.save();this._pixelRatio=1;/^off|false$/.test(g.getAttribute(b,"hidpi"))||(d=c.devicePixelRatio||
1,f=va.getPrefixed(f,"backingStorePixelRatio")||1,this._pixelRatio=d/f);ta.call(this,a,b);this._needsUpdate=!0},remove:function z(){this._context.restore();return z.base.call(this)},_setElementSize:function R(a,b){var c=this._pixelRatio;R.base.call(this,a*c,b*c);if(1!==c){var d=this._element,e=this._context;g.hasAttribute(d,"resize")||(d=d.style,d.width=a+"px",d.height=b+"px");e.restore();e.save();e.scale(c,c)}},getPixelSize:function R(a){var b=fa.agent;if(b&&b.firefox)a=R.base.call(this,a);else{b=
this._context;var c=b.font;b.font=a+" serif";a=parseFloat(b.font);b.font=c}return a},getTextWidth:function(a,b){var c=this._context,d=c.font,e=0;c.font=a;for(var f=0,g=b.length;f<g;f++)e=Math.max(e,c.measureText(b[f]).width);c.font=d;return e},update:function(){if(!this._needsUpdate)return!1;var a=this._project,b=this._context,c=this._viewSize;b.clearRect(0,0,c.width+1,c.height+1);a&&a.draw(b,this._matrix,this._pixelRatio);this._needsUpdate=!1;return!0}}),qb=e.extend({_class:"Event",initialize:function(a){this.type=
(this.event=a)&&a.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0;this.event.preventDefault()},stopPropagation:function(){this.stopped=!0;this.event.stopPropagation()},stop:function(){this.stopPropagation();this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return Fb.modifiers}}),Nb=qb.extend({_class:"KeyEvent",initialize:function(a,b,c,d){this.type=a;this.event=b;this.key=c;this.character=d},toString:function(){return"{ type: '"+
this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),Fb=new function(){function a(a){var c=a.key||a.keyIdentifier;c=/^U\+/.test(c)?String.fromCharCode(parseInt(c.substr(2),16)):/^Arrow[A-Z]/.test(c)?c.substr(5):"Unidentified"===c||c===b?String.fromCharCode(a.keyCode):c;return g[c]||(1<c.length?e.hyphenate(c):c.toLowerCase())}function f(a,b,c,d){var g=ta._focused,h;(k[b]=a)?l[b]=c:delete l[b];if(1<b.length&&(h=e.camelize(b))in p){p[h]=a;var r=
fa&&fa.agent;if("meta"===h&&r&&r.mac)if(a)m={};else{for(var n in m)n in l&&f(!1,n,m[n],d);m=null}}else a&&m&&(m[b]=c);g&&g._handleKeyEvent(a?"keydown":"keyup",d,b,c)}var g={"\t":"tab"," ":"space","\b":"backspace","\u007f":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},h={tab:"\t",space:" ",enter:"\r"},k={},l={},m,n,p=(new e({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1})).inject({option:{get:function(){return this.alt}},command:{get:function(){var a=fa&&fa.agent;return a&&
a.mac?this.meta:this.control}}});ua.add(d,{keydown:function(b){var c=a(b),d=fa&&fa.agent;1<c.length||d&&d.chrome&&(b.altKey||d.mac&&b.metaKey||!d.mac&&b.ctrlKey)?f(!0,c,h[c]||(1<c.length?"":c),b):n=c},keypress:function(b){if(n){var c=a(b),d=b.charCode;d=32<=d?String.fromCharCode(d):1<c.length?"":c;c!==n&&(c=d.toLowerCase());f(!0,c,d,b);n=null}},keyup:function(b){var c=a(b);c in l&&f(!1,c,l[c],b)}});ua.add(c,{blur:function(a){for(var b in l)f(!1,b,l[b],a)}});return{modifiers:p,isDown:function(a){return!!k[a]}}},
yb=qb.extend({_class:"MouseEvent",initialize:function(a,b,c,d,e){this.type=a;this.event=b;this.point=c;this.target=d;this.delta=e},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Gb=qb.extend({_class:"ToolEvent",_item:null,initialize:function(a,b,c){this.tool=a;this.type=b;this.event=c},_choosePoint:function(a,b){return a?a:b?b.clone():null},getPoint:function(){return this._choosePoint(this._point,
this.tool._point)},setPoint:function(a){this._point=a},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(a){this._lastPoint=a},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(a){this._downPoint=a},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(a){this._middlePoint=
a},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(a){this._delta=a},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(a){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=a},getItem:function(){if(!this._item){var a=this.tool._scope.project.hitTest(this.getPoint());if(a){a=a.item;for(var b=a._parent;/^(Group|CompoundPath)$/.test(b._class);)a=
b,b=b._parent;this._item=a}}return this._item},setItem:function(a){this._item=a},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Ob=h.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:"onMouseDown onMouseUp onMouseDrag onMouseMove onActivate onDeactivate onEditOptions onKeyDown onKeyUp".split(" "),initialize:function(a){h.call(this);this._downCount=this._moveCount=-1;this.set(a)},getMinDistance:function(){return this._minDistance},
setMinDistance:function(a){this._minDistance=a;null!=a&&null!=this._maxDistance&&a>this._maxDistance&&(this._maxDistance=a)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(a){this._maxDistance=a;null!=this._minDistance&&null!=a&&a<this._minDistance&&(this._minDistance=a)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(a){this._minDistance=this._maxDistance=a},_handleMouseEvent:function(a,b,c,d){function e(a,
b){var e=c,f=g?n._point:n._downPoint||e;if(g){if(0<=n._moveCount&&e.equals(f))return!1;if(f&&(null!=a||null!=b)){var h=e.subtract(f),k=h.getLength();if(k<(a||0))return!1;b&&(e=f.add(h.normalize(Math.min(k,b))))}n._moveCount++}n._point=e;n._lastPoint=f||e;d.down&&(n._moveCount=-1,n._downPoint=e,n._downCount++);return!0}function f(){h&&(m=n.emit(a,new Gb(n,a,b))||m)}fa=this._scope;d.drag&&!this.responds(a)&&(a="mousemove");var g=d.move||d.drag,h=this.responds(a),k=this.minDistance,l=this.maxDistance,
m=!1,n=this;if(d.down)e(),f();else if(d.up)e(null,l),f();else if(h)for(;e(k,l);)f();return m}}),zb={request:function(b){var c=new a.XMLHttpRequest;c.open((b.method||"get").toUpperCase(),b.url,e.pick(b.async,!0));b.mimeType&&c.overrideMimeType(b.mimeType);c.onload=function(){var a=c.status;if(0===a||200===a)b.onLoad&&b.onLoad.call(c,c.responseText);else c.onerror()};c.onerror=function(){var a=c.status,d='Could not load "'+b.url+'" (Status: '+a+")";if(b.onError)b.onError(d,a);else throw Error(d);};
return c.send(null)}},ra={canvases:[],getCanvas:function(a,b){if(!c)return null;var e=!0;"object"===typeof a&&(b=a.height,a=a.width);if(this.canvases.length)var f=this.canvases.pop();else f=d.createElement("canvas"),e=!1;var g=f.getContext("2d");if(!g)throw Error("Canvas "+f+" is unable to provide a 2D context.");f.width===a&&f.height===b?e&&g.clearRect(0,0,a+1,b+1):(f.width=a,f.height=b);g.save();return f},getContext:function(a,b){var c=this.getCanvas(a,b);return c?c.getContext("2d"):null},release:function(a){(a=
a&&a.canvas?a.canvas:a)&&a.getContext&&(a.getContext("2d").restore(),this.canvases.push(a))}},xb=new function(){function a(a,b,e,f){f-=.2989*a+.587*b+.114*e;y=a+f;G=b+f;ba=e+f;f=.2989*y+.587*G+.114*ba;b=c(y,G,ba);a=d(y,G,ba);0>b&&(b=f-b,y=f+(y-f)*f/b,G=f+(G-f)*f/b,ba=f+(ba-f)*f/b);255<a&&(b=255-f,a-=f,y=f+(y-f)*b/a,G=f+(G-f)*b/a,ba=f+(ba-f)*b/a)}function b(a,b,e,f){var g=[a,b,e],h=d(a,b,e);e=c(a,b,e);e=e===a?0:e===b?1:2;h=h===a?0:h===b?1:2;a=0===c(e,h)?1===d(e,h)?2:1:0;g[h]>g[e]?(g[a]=(g[a]-g[e])*
f/(g[h]-g[e]),g[h]=f):g[a]=g[h]=0;g[e]=0;y=g[0];G=g[1];ba=g[2]}var c=Math.min,d=Math.max,f=Math.abs,g,h,k,l,m,n,p,v,y,G,ba,Na={multiply:function(){y=m*g/255;G=n*h/255;ba=p*k/255},screen:function(){y=m+g-m*g/255;G=n+h-n*h/255;ba=p+k-p*k/255},overlay:function(){y=128>m?2*m*g/255:255-2*(255-m)*(255-g)/255;G=128>n?2*n*h/255:255-2*(255-n)*(255-h)/255;ba=128>p?2*p*k/255:255-2*(255-p)*(255-k)/255},"soft-light":function(){var a=g*m/255;y=a+m*(255-(255-m)*(255-g)/255-a)/255;a=h*n/255;G=a+n*(255-(255-n)*(255-
h)/255-a)/255;a=k*p/255;ba=a+p*(255-(255-p)*(255-k)/255-a)/255},"hard-light":function(){y=128>g?2*g*m/255:255-2*(255-g)*(255-m)/255;G=128>h?2*h*n/255:255-2*(255-h)*(255-n)/255;ba=128>k?2*k*p/255:255-2*(255-k)*(255-p)/255},"color-dodge":function(){y=0===m?0:255===g?255:c(255,255*m/(255-g));G=0===n?0:255===h?255:c(255,255*n/(255-h));ba=0===p?0:255===k?255:c(255,255*p/(255-k))},"color-burn":function(){y=255===m?255:0===g?0:d(0,255-255*(255-m)/g);G=255===n?255:0===h?0:d(0,255-255*(255-n)/h);ba=255===
p?255:0===k?0:d(0,255-255*(255-p)/k)},darken:function(){y=m<g?m:g;G=n<h?n:h;ba=p<k?p:k},lighten:function(){y=m>g?m:g;G=n>h?n:h;ba=p>k?p:k},difference:function(){y=m-g;0>y&&(y=-y);G=n-h;0>G&&(G=-G);ba=p-k;0>ba&&(ba=-ba)},exclusion:function(){y=m+g*(255-m-m)/255;G=n+h*(255-n-n)/255;ba=p+k*(255-p-p)/255},hue:function(){var e=g,f=h,l=k;var r=m;var U=n,q=p;r=d(r,U,q)-c(r,U,q);b(e,f,l,r);a(y,G,ba,.2989*m+.587*n+.114*p)},saturation:function(){var e=m,f=n,l=p;var r=g;var U=h,q=k;r=d(r,U,q)-c(r,U,q);b(e,f,
l,r);a(y,G,ba,.2989*m+.587*n+.114*p)},luminosity:function(){a(m,n,p,.2989*g+.587*h+.114*k)},color:function(){a(g,h,k,.2989*m+.587*n+.114*p)},add:function(){y=c(m+g,255);G=c(n+h,255);ba=c(p+k,255)},subtract:function(){y=d(m-g,0);G=d(n-h,0);ba=d(p-k,0)},average:function(){y=(m+g)/2;G=(n+h)/2;ba=(p+k)/2},negation:function(){y=255-f(255-g-m);G=255-f(255-h-n);ba=255-f(255-k-p)}},E=this.nativeModes=e.each("source-over source-in source-out source-atop destination-over destination-in destination-out destination-atop lighter darker copy xor".split(" "),
function(a){this[a]=!0},{}),U=ra.getContext(1,1);U&&(e.each(Na,function(a,b){var c="darken"===b,d=!1;U.save();try{U.fillStyle=c?"#300":"#a00",U.fillRect(0,0,1,1),U.globalCompositeOperation=b,U.globalCompositeOperation===b&&(U.fillStyle=c?"#a00":"#300",U.fillRect(0,0,1,1),d=U.getImageData(0,0,1,1).data[0]!==c?170:51)}catch(O){}U.restore();E[b]=d}),ra.release(U));this.process=function(a,b,c,d,e){var f=b.canvas,r="normal"===a;if(r||E[a])c.save(),c.setTransform(1,0,0,1,0,0),c.globalAlpha=d,r||(c.globalCompositeOperation=
a),c.drawImage(f,e.x,e.y),c.restore();else if(a=Na[a]){r=c.getImageData(e.x,e.y,f.width,f.height);var U=r.data;b=b.getImageData(0,0,f.width,f.height).data;f=0;for(var q=U.length;f<q;f+=4){g=b[f];m=U[f];h=b[f+1];n=U[f+1];k=b[f+2];p=U[f+2];l=b[f+3];v=U[f+3];a();var Ha=l*d/255,A=1-Ha;U[f]=Ha*y+A*m;U[f+1]=Ha*G+A*n;U[f+2]=Ha*ba+A*p;U[f+3]=l*d+A*v}c.putImageData(r,e.x,e.y)}}},wa=new function(){function a(a,c,d){for(var e in c){var f=c[e],g=b[e];"number"===typeof f&&d&&(f=d.number(f));g?a.setAttributeNS(g,
e,f):a.setAttribute(e,f)}return a}var b={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns",xmlns:"http://www.w3.org/2000/xmlns/","xmlns:xlink":"http://www.w3.org/2000/xmlns/"};return{svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",create:function(b,c,e){return a(d.createElementNS("http://www.w3.org/2000/svg",b),c,e)},get:function(a,c){var d=b[c];d=d?a.getAttributeNS(d,c):a.getAttribute(c);return"null"===d?null:d},set:a}},
Ab=e.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{"true":"none","false":"non-scaling-stroke"},function(a,b){return!b&&(a instanceof eb||a instanceof Ga||a instanceof kb)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],
fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(a,b){var c=e.capitalize(b),d=a[2];this[b]={type:a[1],property:b,attribute:a[0],toSVG:d,fromSVG:d&&e.each(d,function(a,b){this[a]=b},{}),exportFilter:a[3],get:"get"+c,set:"set"+c}},{});new function(){function b(a,b,c){var d=new e,f=a.getTranslation();
b&&(a=a._shiftless(),f=a._inverseTransform(f),d[c?"cx":"x"]=f.x,d[c?"cy":"y"]=f.y,f=null);if(!a.isIdentity())if(c=a.decompose()){a=[];b=c.rotation;var g=c.scaling;c=c.skewing;f&&!f.isZero()&&a.push("translate("+v.point(f)+")");b&&a.push("rotate("+v.number(b)+")");l.isZero(g.x-1)&&l.isZero(g.y-1)||a.push("scale("+v.point(g)+")");c.x&&a.push("skewX("+v.number(c.x)+")");c.y&&a.push("skewY("+v.number(c.y)+")");d.transform=a.join(" ")}else d.transform="matrix("+a.getValues().join(",")+")";return d}function c(a,
c){var d=b(a._matrix),e=a._children;d=wa.create("g",d,v);for(var f=0,g=e.length;f<g;f++){var k=e[f],l=p(k,c);if(l)if(k.isClipMask()){var m=wa.create("clipPath");m.appendChild(l);h(k,m,"clip");wa.set(d,{"clip-path":"url(#"+m.id+")"})}else d.appendChild(l)}return d}function d(a){var c=a._type,d=a._radius,e=b(a._matrix,!0,"rectangle"!==c);if("rectangle"===c){c="rect";var f=a._size;a=f.width;f=f.height;e.x-=a/2;e.y-=f/2;e.width=a;e.height=f;d.isZero()&&(d=null)}d&&("circle"===c?e.r=d:(e.rx=d.width,e.ry=
d.height));return wa.create(c,e,v)}function f(a,b,c){var d={},f=!c&&a.getParent(),k=[];null!=a._name&&(d.id=a._name);e.each(Ab,function(b){var c=b.get,l=b.type,m=a[c]();if(b.exportFilter?b.exportFilter(a,m):!f||!e.equals(f[c](),m))if("color"===l&&null!=m&&(c=m.getAlpha(),1>c&&(d[b.attribute+"-opacity"]=c)),"style"===l)k.push(b.attribute+": "+m);else{c=b.attribute;if(null==m)m="none";else if("color"===l)if(m.gradient){b=g(m,"color");if(!b){var n=m.getGradient();b=n._radial;l=m.getOrigin();var r=m.getDestination();
if(b){if(l={cx:l.x,cy:l.y,r:l.getDistance(r)},r=m.getHighlight())l.fx=r.x,l.fy=r.y}else l={x1:l.x,y1:l.y,x2:r.x,y2:r.y};l.gradientUnits="userSpaceOnUse";b=wa.create((b?"radial":"linear")+"Gradient",l,v);n=n._stops;r=0;for(var p=n.length;r<p;r++){l=n[r];var U=l._color,q=U.getAlpha();l=l._offset;l={offset:null==l?r/(p-1):l};U&&(l["stop-color"]=U.toCSS(!0));1>q&&(l["stop-opacity"]=q);b.appendChild(wa.create("stop",l,v))}h(m,b,"color")}m="url(#"+b.id+")"}else m=m.toCSS(!0);else m="array"===l?m.join(","):
"lookup"===l?b.toSVG[m]:m;d[c]=m}});k.length&&(d.style=k.join(";"));1===d.opacity&&delete d.opacity;a._visible||(d.visibility="hidden");return wa.set(b,d,v)}function g(a,b){K||(K={ids:{},svgs:{}});return a&&K.svgs[b+"-"+(a._id||a.__id||(a.__id=n.get("svg")))]}function h(a,b,c){K||g();var d=K.ids[c]=(K.ids[c]||0)+1;b.id=c+"-"+d;K.svgs[c+"-"+(a._id||a.__id)]=b}function m(b,c){var d=b,e=null;if(K){d="svg"===b.nodeName.toLowerCase()&&b;for(var f in K.svgs)e||(d||(d=wa.create("svg"),d.appendChild(b)),
e=d.insertBefore(wa.create("defs"),d.firstChild)),e.appendChild(K.svgs[f]);K=null}return c.asString?(new a.XMLSerializer).serializeToString(d):d}function p(a,b,c){var d=H[a._class];if(d=d&&d(a,b)){var e=b.onExport;e&&(d=e(a,d,b)||d);(b=JSON.stringify(a._data))&&"{}"!==b&&"null"!==b&&d.setAttribute("data-paper-data",b)}return d&&f(a,d,c)}function y(a){a||(a={});v=new k(a.precision);return a}var v,H={Group:c,Layer:c,Raster:function(a,c){var d=b(a._matrix,!0),e=a.getSize(),f=a.getImage();d.x-=e.width/
2;d.y-=e.height/2;d.width=e.width;d.height=e.height;d.href=0==c.embedImages&&f&&f.src||a.toDataURL();return wa.create("image",d,v)},Path:function(a,c){var e=c.matchShapes;if(e){var f=a.toShape(!1);if(f)return d(f,c)}var g=a._segments,h=g.length;f=b(a._matrix);if(e&&2<=h&&!a.hasHandles())if(2<h){e=a._closed?"polygon":"polyline";for(var k=[],l=0;l<h;l++)k.push(v.point(g[l]._point));f.points=k.join(" ")}else e="line",h=g[0]._point,g=g[1]._point,f.set({x1:h.x,y1:h.y,x2:g.x,y2:g.y});else e="path",f.d=
a.getPathData(null,c.precision);return wa.create(e,f,v)},Shape:d,CompoundPath:function(a,c){var d=b(a._matrix),e=a.getPathData(null,c.precision);e&&(d.d=e);return wa.create("path",d,v)},SymbolItem:function(a,c){var d=b(a._matrix,!0),e=a._definition,f=g(e,"symbol"),k=e._item,l=k.getBounds();f||(f=wa.create("symbol",{viewBox:v.rectangle(l)}),f.appendChild(p(k,c)),h(e,f,"symbol"));d.href="#"+f.id;d.x+=l.x;d.y+=l.y;d.width=l.width;d.height=l.height;d.overflow="visible";return wa.create("use",d,v)},PointText:function(a){var c=
wa.create("text",b(a._matrix,!0),v);c.textContent=a._content;return c}},K;Q.inject({exportSVG:function(a){a=y(a);return m(p(this,a,!0),a)}});Ba.inject({exportSVG:function(a){a=y(a);var c=this._children,d=this.getView(),f=e.pick(a.bounds,"view"),g=a.matrix||"view"===f&&d._matrix;g=g&&P.read([g]);d="view"===f?new E([0,0],d.getViewSize()):"content"===f?Q._getBounds(c,g,{stroke:!0}).rect:E.read([f],0,{readNull:!0});f={version:"1.1",xmlns:wa.svg,"xmlns:xlink":wa.xlink};d&&(f.width=d.width,f.height=d.height,
d.x||d.y)&&(f.viewBox=v.rectangle(d));f=d=wa.create("svg",f,v);g&&!g.isIdentity()&&(f=d.appendChild(wa.create("g",b(g),v)));g=0;for(var h=c.length;g<h;g++)f.appendChild(p(c[g],a,!0));return m(d,a)}})};new function(){function f(a,b,c,d,e){a=wa.get(a,b);c=null==a?d?null:c?"":0:c?a:parseFloat(a);return/%\s*$/.test(a)?c/100*(e?1:ba[/x|^width/.test(b)?"width":"height"]):c}function g(a,b,c,d,e){b=f(a,b||"x",!1,d,e);c=f(a,c||"y",!1,d,e);return!d||null!=b&&null!=c?new m(b,c):null}function h(a,b,c,d,e){b=
f(a,b||"width",!1,d,e);c=f(a,c||"height",!1,d,e);return!d||null!=b&&null!=c?new p(b,c):null}function k(a,b,c){return"none"===a?null:"number"===b?parseFloat(a):"array"===b?a?a.split(/[\s,]+/g).map(parseFloat):[]:"color"===b?T(a)||a:"lookup"===b?c[a]:a}function l(a,b,c,d){var e=a.childNodes,f="clippath"===b;b="defs"===b;var g=new Ma,h=g._project,k=h._currentStyle,l=[];f||b||(g=L(g,a,d),h._currentStyle=g._style.clone());if(d)for(var m=a.querySelectorAll("defs"),n=0,r=m.length;n<r;n++)qa(m[n],c,!1);n=
0;for(r=e.length;n<r;n++){m=e[n];var p;1!==m.nodeType||/^defs$/i.test(m.nodeName)||!(p=qa(m,c,!1))||p instanceof v||l.push(p)}g.addChildren(l);f&&(g=L(g.reduce(),a,d));h._currentStyle=k;if(f||b)g.remove(),g=null;return g}function n(a,b){for(var c=a.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),d=[],e=0,f=c.length;e<f;e+=2)d.push(new m(parseFloat(c[e]),parseFloat(c[e+1])));c=new aa(d);"polygon"===b&&c.closePath();return c}function y(a,b){var c=(f(a,"href",!0)||"").substring(1),
d="radialgradient"===b;if(c)c=G[c].getGradient(),c._radial^d&&(c=c.clone(),c._radial=d);else{c=a.childNodes;for(var e=[],h=0,k=c.length;h<k;h++){var l=c[h];1===l.nodeType&&e.push(L(new Va,l))}c=new lb(e,d)}e="userSpaceOnUse"!==f(a,"gradientUnits",!0);if(d){d=g(a,"cx","cy",!1,e);h=d.add(f(a,"r",!1,!1,e),0);var m=g(a,"fx","fy",!0,e)}else d=g(a,"x1","y1",!1,e),h=g(a,"x2","y2",!1,e);L(new Oa(c,d,h,m),a)._scaleToBounds=e;return null}function H(a,b,c,d){if(a.transform){b=(d.getAttribute(c)||"").split(/\)\s*/g);
c=new P;d=0;for(var e=b.length;d<e;d++){var f=b[d];if(!f)break;var g=f.split(/\(\s*/);f=g[0];g=g[1].split(/[\s,]+/g);for(var h=0,k=g.length;h<k;h++)g[h]=parseFloat(g[h]);switch(f){case "matrix":c.append(new P(g[0],g[1],g[2],g[3],g[4],g[5]));break;case "rotate":c.rotate(g[0],g[1]||0,g[2]||0);break;case "translate":c.translate(g[0],g[1]||0);break;case "scale":c.scale(g);break;case "skewX":c.skew(g[0],0);break;case "skewY":c.skew(0,g[0])}}a.transform(c)}}function K(a,b,c){c="fill-opacity"===c?"getFillColor":
"getStrokeColor";(a=a[c]&&a[c]())&&a.setAlpha(parseFloat(b))}function V(a,c,d){var f=a.attributes[c];f=f&&f.value;!f&&a.style&&(c=e.camelize(c),(f=a.style[c])||d.node[c]===d.parent[c]||(f=d.node[c]));return f?"none"===f?null:f:b}function L(a,c,d){var f=c.parentNode,g={node:va.getStyles(c)||{},parent:!d&&!/^defs$/i.test(f.tagName)&&va.getStyles(f)||{}};e.each(Vb,function(d,e){var f=V(c,e,g);a=f!==b&&d(a,f,e,c,g)||a});return a}function T(a){(a=(a=(a=a&&a.match(/\((?:["'#]*)([^"')]+)/))&&a[1])&&G[c?
a.replace(c.location.href.split("#")[0]+"#",""):a])&&a._scaleToBounds&&(a=a.clone(),a._scaleToBounds=!0);return a}function qa(a,b,c){var f=a.nodeName.toLowerCase(),g="#document"!==f,k=d.body;if(c&&g){ba=fa.getView().getSize();ba=h(a,null,null,!0)||ba;var l=wa.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"});var m=a.parentNode;var n=a.nextSibling;l.appendChild(a);k.appendChild(l)}var r=fa.settings,p=r.applyMatrix,q=r.insertItems;r.applyMatrix=!1;r.insertItems=!1;var v=Na[f];f=v&&v(a,
f,b,c)||null;r.insertItems=q;r.applyMatrix=p;f&&(!g||f instanceof Ma||(f=L(f,a,c)),r=b.onImport,g=g&&a.getAttribute("data-paper-data"),r&&(f=r(a,f,b)||f),b.expandShapes&&f instanceof Ga&&(f.remove(),f=f.toPath()),g&&(f._data=JSON.parse(g)));l&&(k.removeChild(l),m&&(n?m.insertBefore(a,n):m.appendChild(a)));c&&(G={},f&&e.pick(b.applyMatrix,p)&&f.matrix.apply(!0,!0));return f}function ja(c,e,f){function g(d){try{var g="object"===typeof d?d:(new a.DOMParser).parseFromString(d,"image/svg+xml");if(!g.nodeName)throw Error("Unsupported SVG source: "+
c);fa=k;l=qa(g,e,!0);e&&!1===e.insert||f._insertItem(b,l);var m=e.onLoad;m&&m(l,d)}catch(lc){h(lc)}}function h(a,b){var c=e.onError;if(c)c(a,b);else throw Error(a);}if(!c)return null;e="function"===typeof e?{onLoad:e}:e||{};var k=fa,l=null;if("string"!==typeof c||/^.*</.test(c)){if("undefined"!==typeof File&&c instanceof File){var m=new FileReader;m.onload=function(){g(m.result)};m.onerror=function(){h(m.error)};return m.readAsText(c)}g(c)}else{var n=d.getElementById(c);n?g(n):zb.request({url:c,async:!0,
onLoad:g,onError:h})}return l}var G={},ba,Na={"#document":function(a,b,c,d){a=a.childNodes;b=0;for(var e=a.length;b<e;b++){var f=a[b];if(1===f.nodeType)return qa(f,c,d)}},g:l,svg:l,clippath:l,polygon:n,polyline:n,path:function(a){return eb.create(a.getAttribute("d"))},lineargradient:y,radialgradient:y,image:function(a){var b=new ab(f(a,"href",!0));b.on("load",function(){var b=h(a);this.setSize(b);b=g(a).add(b.divide(2));this._matrix.append((new P).translate(b))});return b},symbol:function(a,b,c,d){return new v(l(a,
b,c,d),!0)},defs:l,use:function(a){var b=(f(a,"href",!0)||"").substring(1);b=G[b];a=g(a);return b?b instanceof v?b.place(a):b.clone().translate(a):null},circle:function(a){return new Ga.Circle(g(a,"cx","cy"),f(a,"r"))},ellipse:function(a){return new Ga.Ellipse({center:g(a,"cx","cy"),radius:h(a,"rx","ry")})},rect:function(a){return new Ga.Rectangle(new E(g(a),h(a)),h(a,"rx","ry"))},line:function(a){return new aa.Line(g(a,"x1","y1"),g(a,"x2","y2"))},text:function(a){var b=new Qa(g(a).add(g(a,"dx","dy")));
b.setContent(a.textContent.trim()||"");return b}},Vb=e.set(e.each(Ab,function(a){this[a.attribute]=function(b,c){if(b[a.set]&&(b[a.set](k(c,a.type,a.fromSVG)),"color"===a.type)){var d=b[a.get]();if(d&&d._scaleToBounds){var e=b.getBounds();d.transform((new P).translate(e.getPoint()).scale(e.getSize()))}}}},{}),{id:function(a,b){G[b]=a;a.setName&&a.setName(b)},"clip-path":function(a,b){var c=T(b);if(c)if(c=c.clone(),c.setClipMask(!0),a instanceof Ma)a.insertChild(0,c);else return new Ma(c,a)},gradientTransform:H,
transform:H,"fill-opacity":K,"stroke-opacity":K,visibility:function(a,b){a.setVisible&&a.setVisible("visible"===b)},display:function(a,b){a.setVisible&&a.setVisible(null!==b)},"stop-color":function(a,b){a.setColor&&a.setColor(b)},"stop-opacity":function(a,b){a._color&&a._color.setAlpha(parseFloat(b))},offset:function(a,b){if(a.setOffset){var c=b.match(/(.*)%$/);a.setOffset(c?c[1]/100:parseFloat(b))}},viewBox:function(a,b,c,d,e){b=new E(k(b,"array"));c=h(d,null,null,!0);if(a instanceof Ma){var f=c?
c.divide(b.getSize()):1;var g=(new P).scale(f).translate(b.getPoint().negate());f=a}else a instanceof v&&(c&&b.setSize(c),f=a._item);f&&("visible"!==V(d,"overflow",e)&&(a=new Ga.Rectangle(b),a.setClipMask(!0),f.addChild(a)),g&&f.transform(g))}});Q.inject({importSVG:function(a,b){return ja(a,b,this)}});Ba.inject({importSVG:function(a,b){this.activate();return ja(a,b,this)}})};e.exports.PaperScript=function(){function b(a,b){return(y.acorn||E).parse(a,b)}function f(a,b,c){var d=P[b];if(a&&a[d])return a=
a[d](c),"!="===b?!a:a;switch(b){case "+":return a+c;case "-":return a-c;case "*":return a*c;case "/":return a/c;case "%":return a%c;case "==":return a==c;case "!=":return a!=c}}function h(a,b){var c=T[a];if(b&&b[c])return b[c]();switch(a){case "+":return+b;case "-":return-b}}function k(e,f){function g(a){for(var b=0,c=r.length;b<c;b++){var d=r[b];if(d[0]>=a)break;a+=d[1]}return a}function h(a){return e.substring(g(a.range[0]),g(a.range[1]))}function k(a,b){return e.substring(g(a.range[1]),g(b.range[0]))}
function l(a,b){for(var c=g(a.range[0]),d=g(a.range[1]),f=0,h=r.length-1;0<=h;h--)if(c>r[h][0]){f=h+1;break}r.splice(f,0,[c,b.length-d+c]);e=e.substring(0,c)+b+e.substring(d)}function m(a,b){if(a){for(var c in a)if("range"!==c&&"loc"!==c){var d=a[c];if(Array.isArray(d))for(var e=0,f=d.length;e<f;e++)m(d[e],a);else d&&"object"===typeof d&&m(d,a)}switch(a.type){case "UnaryExpression":a.operator in T&&"Literal"!==a.argument.type&&(c=h(a.argument),l(a,'$__("'+a.operator+'", '+c+")"));break;case "BinaryExpression":a.operator in
P&&"Literal"!==a.left.type&&(c=h(a.left),d=h(a.right),e=k(a.left,a.right),f=a.operator,l(a,"__$__("+c+","+e.replace(new RegExp("\\"+f),'"'+f+'"')+", "+d+")"));break;case "UpdateExpression":case "AssignmentExpression":d=b&&b.type;"ForStatement"===d||"BinaryExpression"===d&&/^[=!<>]/.test(b.operator)||"MemberExpression"===d&&b.computed||("UpdateExpression"===a.type?(c=h(a.argument),e="__$__("+c+', "'+a.operator[0]+'", 1)',f=c+" = "+e,a.prefix||"AssignmentExpression"!==d&&"VariableDeclarator"!==d||(h(b.left||
b.id)===c&&(f=e),f=c+"; "+f),l(a,f)):/^.=$/.test(a.operator)&&"Literal"!==a.left.type&&(c=h(a.left),d=h(a.right),e=c+" = __$__("+c+', "'+a.operator[0]+'", '+d+")",l(a,/^\(.*\)$/.test(h(a))?"("+e+")":e)));break;case "ExportDefaultDeclaration":l({range:[a.start,a.declaration.start]},"module.exports = ");break;case "ExportNamedDeclaration":if(c=a.declaration,d=a.specifiers,c){if(d=c.declarations)d.forEach(function(a){l(a,"module.exports."+h(a))}),l({range:[a.start,c.start+c.kind.length]},"")}else d&&
(c=d.map(function(a){a=h(a);return"module.exports."+a+" = "+a+"; "}).join(""))&&l(a,c)}}}function n(a){var b="";for(a=(Math.abs(a)<<1)+(0>a?1:0);a||!b;){var c=a&31;(a>>=5)&&(c|=32);b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c]}return b}if(!e)return"";f=f||{};var r=[],p=f.url||"",q=fa.agent,v=q.versionNumber,y=!1,A=f.sourceMaps,E=f.source||e,G=/\r\n|\n|\r/mg,H=f.offset||0;if(A&&(q.chrome&&30<=v||q.webkit&&537.76<=v||q.firefox&&23<=v||q.node)){q.node?H-=2:c&&p&&!c.location.href.indexOf(p)&&
(y=d.getElementsByTagName("html")[0].innerHTML,H=y.substr(0,y.indexOf(e)+1).match(G).length+1);y=0<H&&!(q.chrome&&36<=v||q.safari&&600<=v||q.firefox&&40<=v||q.node);q=["AA"+n(y?0:H)+"A"];q.length=(e.match(G)||[]).length+1+(y?H:0);var K={version:3,file:p,names:[],mappings:q.join(";AACA"),sourceRoot:"",sources:[p],sourcesContent:[E]}}m(b(e,{ranges:!0,preserveParens:!0,sourceType:"module"}));K&&(y&&(e=Array(H+1).join("\n")+e),/^(inline|both)$/.test(A)&&(e+="\n//# sourceMappingURL=data:application/json;base64,"+
a.btoa(unescape(encodeURIComponent(JSON.stringify(K))))),e+="\n//# sourceURL="+(p||"paperscript"));return{url:p,source:E,code:e,map:K}}function l(a,b,c){function g(b,c){for(var d in b)!c&&/^_/.test(d)||!(new RegExp("([\\b\\s\\W]|^)"+d.replace(/\$/g,"\\$")+"\\b")).test(a)||(q.push(d),v.push(b[d]))}fa=b;var l=b.getView(),n=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(a)&&!/\bnew\s+Tool\b/.test(a)?new Ob:null,r=n?n._events:[],p=["onFrame","onResize"].concat(r),q=[],v=[];a=("object"===
typeof a?a:k(a,c)).code;g({__$__:f,$__:h,paper:b,view:l,tool:n},!0);g(b);a="var module = { exports: {} }; "+a;(c=e.each(p,function(b){(new RegExp("\\s+"+b+"\\b")).test(a)&&(q.push(b),this.push("module.exports."+b+" = "+b+";"))},[]).join("\n"))&&(a+="\n"+c);a+="\nreturn module.exports;";var y=fa.agent;d&&(y.chrome||y.firefox&&40>y.versionNumber)?(c=d.createElement("script"),p=d.head||d.getElementsByTagName("head")[0],y.firefox&&(a="\n"+a),c.appendChild(d.createTextNode("document.__paperscript__ = function("+
q+") {"+a+"\n}")),p.appendChild(c),y=d.__paperscript__,delete d.__paperscript__,p.removeChild(c)):y=Function(q,a);var A=(c=y&&y.apply(b,v))||{};e.each(r,function(a){var b=A[a];b&&(n[a]=b)});l&&(A.onResize&&l.setOnResize(A.onResize),l.emit("resize",{size:l.size,delta:new m}),A.onFrame&&l.setOnFrame(A.onFrame),l.requestUpdate());return c}function n(a){if(/^text\/(?:x-|)paperscript$/.test(a.type)&&"true"!==g.getAttribute(a,"ignore")){var b=g.getAttribute(a,"canvas"),c=d.getElementById(b),e=a.src||a.getAttribute("data-src"),
f=g.hasAttribute(a,"async");if(!c)throw Error('Unable to find canvas with id "'+b+'"');var h=g.get(c.getAttribute("data-paper-scope"))||(new g).setup(c);c.setAttribute("data-paper-scope",h._id);e?zb.request({url:e,async:f,mimeType:"text/plain",onLoad:function(a){l(a,h,e)}}):l(a.innerHTML,h,a.baseURI);a.setAttribute("data-paper-ignore","true");return h}}function v(){e.each(d&&d.getElementsByTagName("script"),n)}var y=this,E=y.acorn;if(!E&&"undefined"!==typeof require)try{E=require("acorn")}catch(G){}if(!E){var H,
K;E=H=K={};(function(a,b){if("object"==typeof H&&"object"==typeof K)return b(H);if("function"==typeof define&&define.amd)return define(["exports"],b);b(a.acorn||(a.acorn={}))})(this,function(a){function b(a){ia=a||{};for(var b in Ga)Object.prototype.hasOwnProperty.call(ia,b)||(ia[b]=Ga[b]);Ia=ia.sourceFile||null}function c(a,b){var c=Oa(S,a);b+=" ("+c.line+":"+c.column+")";var d=new SyntaxError(b);d.pos=a;d.loc=c;d.raisedAt=D;throw d;}function d(a){function b(a){if(1==a.length)return c+="return str === "+
JSON.stringify(a[0])+";";c+="switch(str){";for(var b=0;b<a.length;++b)c+="case "+JSON.stringify(a[b])+":";c+="return true}return false;"}a=a.split(" ");var c="",d=[],e=0;a:for(;e<a.length;++e){for(var f=0;f<d.length;++f)if(d[f][0].length==a[e].length){d[f].push(a[e]);continue a}d.push([a[e]])}if(3<d.length){d.sort(function(a,b){return b.length-a.length});c+="switch(str.length){";for(e=0;e<d.length;++e)a=d[e],c+="case "+a[0].length+":",b(a);c+="}"}else b(a);return new Function("str",c)}function e(){this.line=
gb;this.column=D-Wa}function f(a,b){ya=D;ia.locations&&(Ma=new e);ha=a;h();Ra=b;Da=a.beforeExpr}function g(){for(var a=D,b=ia.onComment&&ia.locations&&new e,c=S.charCodeAt(D+=2);D<ua&&10!==c&&13!==c&&8232!==c&&8233!==c;)++D,c=S.charCodeAt(D);if(ia.onComment)ia.onComment(!1,S.slice(a+2,D),a,D,b,ia.locations&&new e)}function h(){for(;D<ua;){var a=S.charCodeAt(D);if(32===a)++D;else if(13===a)++D,a=S.charCodeAt(D),10===a&&++D,ia.locations&&(++gb,Wa=D);else if(10===a||8232===a||8233===a)++D,ia.locations&&
(++gb,Wa=D);else if(8<a&&14>a)++D;else if(47===a)if(a=S.charCodeAt(D+1),42===a){a=void 0;var b=ia.onComment&&ia.locations&&new e,d=D,f=S.indexOf("*/",D+=2);-1===f&&c(D-2,"Unterminated comment");D=f+2;if(ia.locations)for(Qb.lastIndex=d;(a=Qb.exec(S))&&a.index<D;)++gb,Wa=a.index+a[0].length;if(ia.onComment)ia.onComment(!0,S.slice(d+2,f),d,D,b,ia.locations&&new e)}else if(47===a)g();else break;else if(160===a)++D;else if(5760<=a&&ed.test(String.fromCharCode(a)))++D;else break}}function k(a){switch(a){case 46:return a=
S.charCodeAt(D+1),48<=a&&57>=a?a=p(!0):(++D,a=f(sc)),a;case 40:return++D,f(tb);case 41:return++D,f(mb);case 59:return++D,f(ub);case 44:return++D,f(Bb);case 91:return++D,f(ac);case 93:return++D,f(bc);case 123:return++D,f(Rb);case 125:return++D,f(Ib);case 58:return++D,f(Sb);case 63:return++D,f(tc);case 48:if(a=S.charCodeAt(D+1),120===a||88===a)return D+=2,a=r(16),null==a&&c(Ca+2,"Expected hexadecimal number"),cc(S.charCodeAt(D))&&c(D,"Identifier directly after number"),f(cb,a);case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return p(!1);
case 34:case 39:a:{D++;for(var b="";;){D>=ua&&c(Ca,"Unterminated string constant");var d=S.charCodeAt(D);if(d===a){++D;a=f(Va,b);break a}if(92===d){d=S.charCodeAt(++D);var e=/^[0-7]+/.exec(S.slice(D,D+3));for(e&&(e=e[0]);e&&255<parseInt(e,8);)e=e.slice(0,-1);"0"===e&&(e=null);++D;if(e)Sa&&c(D-2,"Octal literal in strict mode"),b+=String.fromCharCode(parseInt(e,8)),D+=e.length-1;else switch(d){case 110:b+="\n";break;case 114:b+="\r";break;case 120:b+=String.fromCharCode(q(2));break;case 117:b+=String.fromCharCode(q(4));
break;case 85:b+=String.fromCharCode(q(8));break;case 116:b+="\t";break;case 98:b+="\b";break;case 118:b+="\x0B";break;case 102:b+="\f";break;case 48:b+="\x00";break;case 13:10===S.charCodeAt(D)&&++D;case 10:ia.locations&&(Wa=D,++gb);break;default:b+=String.fromCharCode(d)}}else 13!==d&&10!==d&&8232!==d&&8233!==d||c(Ca,"Unterminated string constant"),b+=String.fromCharCode(d),++D}}return a;case 47:return a=S.charCodeAt(D+1),Da?(++D,a=n()):a=61===a?m(Jb,2):m(uc,1),a;case 37:case 42:return a=61===S.charCodeAt(D+
1)?m(Jb,2):m(Nb,1),a;case 124:case 38:return b=S.charCodeAt(D+1),a=b===a?m(124===a?Mc:Nc,2):61===b?m(Jb,2):m(124===a?fd:gd,1),a;case 94:return a=61===S.charCodeAt(D+1)?m(Jb,2):m(hd,1),a;case 43:case 45:return b=S.charCodeAt(D+1),b===a?45==b&&62==S.charCodeAt(D+2)&&dc.test(S.slice(nb,D))?(D+=3,g(),h(),a=l()):a=m(id,2):a=61===b?m(Jb,2):m(Mb,1),a;case 60:case 62:return b=S.charCodeAt(D+1),d=1,b===a?(d=62===a&&62===S.charCodeAt(D+2)?3:2,a=61===S.charCodeAt(D+d)?m(Jb,d+1):m(Kb,d)):33==b&&60==a&&45==S.charCodeAt(D+
2)&&45==S.charCodeAt(D+3)?(D+=4,g(),h(),a=l()):(61===b&&(d=61===S.charCodeAt(D+2)?3:2),a=m(Fb,d)),a;case 61:case 33:return a=61===S.charCodeAt(D+1)?m(jd,61===S.charCodeAt(D+2)?3:2):m(61===a?vc:Oc,1),a;case 126:return m(Oc,1)}return!1}function l(a){a?D=Ca+1:Ca=D;ia.locations&&(Ka=new e);if(a)return n();if(D>=ua)return f($a);var b=S.charCodeAt(D);if(cc(b)||92===b)return y();a=k(b);if(!1===a){b=String.fromCharCode(b);if("\\"===b||Qc.test(b))return y();c(D,"Unexpected character '"+b+"'")}return a}function m(a,
b){var c=S.slice(D,D+b);D+=b;f(a,c)}function n(){for(var a,b,d=D;;){D>=ua&&c(d,"Unterminated regular expression");var e=S.charAt(D);dc.test(e)&&c(d,"Unterminated regular expression");if(a)a=!1;else{if("["===e)b=!0;else if("]"===e&&b)b=!1;else if("/"===e&&!b)break;a="\\"===e}++D}a=S.slice(d,D);++D;(b=v())&&!/^[gmsiy]*$/.test(b)&&c(d,"Invalid regexp flag");try{var g=new RegExp(a,b)}catch(rc){rc instanceof SyntaxError&&c(d,rc.message),c(rc)}return f(ab,g)}function r(a,b){for(var c=D,d=0,e=0,f=null==
b?Infinity:b;e<f;++e){var g=S.charCodeAt(D);g=97<=g?g-97+10:65<=g?g-65+10:48<=g&&57>=g?g-48:Infinity;if(g>=a)break;++D;d=d*a+g}return D===c||null!=b&&D-c!==b?null:d}function p(a){var b=D,d=!1,e=48===S.charCodeAt(D);a||null!==r(10)||c(b,"Invalid number");46===S.charCodeAt(D)&&(++D,r(10),d=!0);a=S.charCodeAt(D);if(69===a||101===a)a=S.charCodeAt(++D),43!==a&&45!==a||++D,null===r(10)&&c(b,"Invalid number"),d=!0;cc(S.charCodeAt(D))&&c(D,"Identifier directly after number");a=S.slice(b,D);var g;d?g=parseFloat(a):
e&&1!==a.length?/[89]/.test(a)||Sa?c(b,"Invalid number"):g=parseInt(a,8):g=parseInt(a,10);return f(cb,g)}function q(a){a=r(16,a);null===a&&c(Ca,"Bad character escape sequence");return a}function v(){Tb=!1;for(var a,b=!0,d=D;;){var e=S.charCodeAt(D);if(Rc(e))Tb&&(a+=S.charAt(D)),++D;else if(92===e){Tb||(a=S.slice(d,D));Tb=!0;117!=S.charCodeAt(++D)&&c(D,"Expecting Unicode escape sequence \\uXXXX");++D;e=q(4);var f=String.fromCharCode(e);f||c(D-1,"Invalid Unicode escape");(b?cc(e):Rc(e))||c(D-4,"Invalid Unicode escape");
a+=f}else break;b=!1}return Tb?a:S.slice(d,D)}function y(){var a=v(),b=vb;!Tb&&ld(a)&&(b=Ea[a]);return f(b,a)}function A(){Ua=Ca;nb=ya;Xa=Ma;l()}function E(a){Sa=a;D=Ca;if(ia.locations)for(;D<Wa;)Wa=S.lastIndexOf("\n",Wa-2)+1,--gb;h();l()}function H(){this.type=null;this.start=Ca;this.end=null}function K(){this.start=Ka;this.end=null;null!==Ia&&(this.source=Ia)}function I(){var a=new H;ia.locations&&(a.loc=new K);ia.directSourceFile&&(a.sourceFile=ia.directSourceFile);ia.ranges&&(a.range=[Ca,0]);
return a}function P(a){var b=new H;b.start=a.start;ia.locations&&(b.loc=new K,b.loc.start=a.loc.start);ia.ranges&&(b.range=[a.range[0],0]);return b}function G(a,b){a.type=b;a.end=nb;ia.locations&&(a.loc.end=Xa);ia.ranges&&(a.range[1]=nb);return a}function R(a){return 5<=ia.ecmaVersion&&"ExpressionStatement"===a.type&&"Literal"===a.expression.type&&"use strict"===a.expression.value}function L(a){if(ha===a)return A(),!0}function T(){return!ia.strictSemicolons&&(ha===$a||ha===Ib||dc.test(S.slice(nb,
Ca)))}function V(){L(ub)||T()||X()}function Q(a){ha===a?A():X()}function X(){c(Ca,"Unexpected token")}function aa(a){"Identifier"!==a.type&&"MemberExpression"!==a.type&&c(a.start,"Assigning to rvalue");Sa&&"Identifier"===a.type&&fc(a.name)&&c(a.start,"Assigning to "+a.name+" in strict mode")}function Y(){(ha===uc||ha===Jb&&"/="==Ra)&&l(!0);var a=ha,b=I();switch(a){case eb:case hb:A();var d=a===eb;L(ub)||T()?b.label=null:ha!==vb?X():(b.label=ra(),V());for(var e=0;e<za.length;++e){var f=za[e];if(null==
b.label||f.name===b.label.name){if(null!=f.kind&&(d||"loop"===f.kind))break;if(b.label&&d)break}}e===za.length&&c(b.start,"Unsyntactic "+a.keyword);return G(b,d?"BreakStatement":"ContinueStatement");case kb:return A(),V(),G(b,"DebuggerStatement");case pb:return A(),za.push(wc),b.body=Y(),za.pop(),Q(u),b.test=fa(),V(),G(b,"DoWhileStatement");case wb:A();za.push(wc);Q(tb);if(ha===ub)return ca(b,null);if(ha===yb)return a=I(),A(),oa(a,!0),G(a,"VariableDeclaration"),1===a.declarations.length&&L(Fa)?qa(b,
a):ca(b,a);a=ja(!1,!0);return L(Fa)?(aa(a),qa(b,a)):ca(b,a);case ob:return A(),wa(b,!0);case xb:return A(),b.test=fa(),b.consequent=Y(),b.alternate=L(qb)?Y():null,G(b,"IfStatement");case Ya:return Qa||ia.allowReturnOutsideFunction||c(Ca,"'return' outside of function"),A(),L(ub)||T()?b.argument=null:(b.argument=ja(),V()),G(b,"ReturnStatement");case rb:A();b.discriminant=fa();b.cases=[];Q(Rb);for(za.push(ud);ha!=Ib;)ha===fb||ha===lb?(a=ha===fb,e&&G(e,"SwitchCase"),b.cases.push(e=I()),e.consequent=[],
A(),a?e.test=ja():(d&&c(Ua,"Multiple default clauses"),d=!0,e.test=null),Q(Sb)):(e||X(),e.consequent.push(Y()));e&&G(e,"SwitchCase");A();za.pop();return G(b,"SwitchStatement");case zb:return A(),dc.test(S.slice(nb,Ca))&&c(nb,"Illegal newline after throw"),b.argument=ja(),V(),G(b,"ThrowStatement");case Ab:return A(),b.block=N(),b.handler=null,ha===db&&(a=I(),A(),Q(tb),a.param=ra(),Sa&&fc(a.param.name)&&c(a.param.start,"Binding "+a.param.name+" in strict mode"),Q(mb),a.guard=null,a.body=N(),b.handler=
G(a,"CatchClause")),b.guardedHandlers=Za,b.finalizer=L(Cb)?N():null,b.handler||b.finalizer||c(b.start,"Missing catch or finally clause"),G(b,"TryStatement");case yb:return A(),oa(b),V(),G(b,"VariableDeclaration");case u:return A(),b.test=fa(),za.push(wc),b.body=Y(),za.pop(),G(b,"WhileStatement");case C:return Sa&&c(Ca,"'with' in strict mode"),A(),b.object=fa(),b.body=Y(),G(b,"WithStatement");case Rb:return N();case ub:return A(),G(b,"EmptyStatement");default:d=Ra;f=ja();if(a===vb&&"Identifier"===
f.type&&L(Sb)){for(e=0;e<za.length;++e)za[e].name===d&&c(f.start,"Label '"+d+"' is already declared");za.push({name:d,kind:ha.isLoop?"loop":ha===rb?"switch":null});b.body=Y();za.pop();b.label=f;return G(b,"LabeledStatement")}b.expression=f;V();return G(b,"ExpressionStatement")}}function fa(){Q(tb);var a=ja();Q(mb);return a}function N(a){var b=I(),c=!0,d=!1;b.body=[];for(Q(Rb);!L(Ib);){var e=Y();b.body.push(e);if(c&&a&&R(e)){var f=d;E(d=!0)}c=!1}d&&!f&&E(!1);return G(b,"BlockStatement")}function ca(a,
b){a.init=b;Q(ub);a.test=ha===ub?null:ja();Q(ub);a.update=ha===mb?null:ja();Q(mb);a.body=Y();za.pop();return G(a,"ForStatement")}function qa(a,b){a.left=b;a.right=ja();Q(mb);a.body=Y();za.pop();return G(a,"ForInStatement")}function oa(a,b){a.declarations=[];for(a.kind="var";;){var d=I();d.id=ra();Sa&&fc(d.id.name)&&c(d.id.start,"Binding "+d.id.name+" in strict mode");d.init=L(vc)?ja(!0,b):null;a.declarations.push(G(d,"VariableDeclarator"));if(!L(Bb))break}return a}function ja(a,b){var c=ta(b);if(!a&&
ha===Bb){var d=P(c);for(d.expressions=[c];L(Bb);)d.expressions.push(ta(b));return G(d,"SequenceExpression")}return c}function ta(a){var b=Z(va(),-1,a);if(L(tc)){var c=P(b);c.test=b;c.consequent=ja(!0);Q(Sb);c.alternate=ja(!0,a);b=G(c,"ConditionalExpression")}return ha.isAssign?(c=P(b),c.operator=Ra,c.left=b,A(),c.right=ta(a),aa(b),G(c,"AssignmentExpression")):b}function Z(a,b,c){var d=ha.binop;if(null!=d&&(!c||ha!==Fa)&&d>b){var e=P(a);e.left=a;e.operator=Ra;a=ha;A();e.right=Z(va(),d,c);d=G(e,a===
Mc||a===Nc?"LogicalExpression":"BinaryExpression");return Z(d,b,c)}return a}function va(){if(ha.prefix){var a=I(),b=ha.isUpdate;a.operator=Ra;Da=a.prefix=!0;A();a.argument=va();b?aa(a.argument):Sa&&"delete"===a.operator&&"Identifier"===a.argument.type&&c(a.start,"Deleting local variable in strict mode");return G(a,b?"UpdateExpression":"UnaryExpression")}for(b=sa(W());ha.postfix&&!T();)a=P(b),a.operator=Ra,a.prefix=!1,a.argument=b,aa(b),A(),b=G(a,"UpdateExpression");return b}function sa(a,b){if(L(sc)){var c=
P(a);c.object=a;c.property=ra(!0);c.computed=!1;return sa(G(c,"MemberExpression"),b)}return L(ac)?(c=P(a),c.object=a,c.property=ja(),c.computed=!0,Q(bc),sa(G(c,"MemberExpression"),b)):!b&&L(tb)?(c=P(a),c.callee=a,c.arguments=Ba(mb,!1),sa(G(c,"CallExpression"),b)):a}function W(){switch(ha){case pa:var a=I();A();return G(a,"ThisExpression");case vb:return ra();case cb:case Va:case ab:return a=I(),a.value=Ra,a.raw=S.slice(Ca,ya),A(),G(a,"Literal");case ka:case Aa:case Ta:return a=I(),a.value=ha.atomValue,
a.raw=ha.keyword,A(),G(a,"Literal");case tb:a=Ka;var b=Ca;A();var d=ja();d.start=b;d.end=ya;ia.locations&&(d.loc.start=a,d.loc.end=Ma);ia.ranges&&(d.range=[b,ya]);Q(mb);return d;case ac:return a=I(),A(),a.elements=Ba(bc,!0,!0),G(a,"ArrayExpression");case Rb:a=I();b=!0;d=!1;a.properties=[];for(A();!L(Ib);){if(b)b=!1;else if(Q(Bb),ia.allowTrailingCommas&&L(Ib))break;var e={key:ha===cb||ha===Va?W():ra(!0)},f=!1;if(L(Sb)){e.value=ja(!0);var g=e.kind="init"}else 5<=ia.ecmaVersion&&"Identifier"===e.key.type&&
("get"===e.key.name||"set"===e.key.name)?(f=d=!0,g=e.kind=e.key.name,e.key=ha===cb||ha===Va?W():ra(!0),ha!==tb&&X(),e.value=wa(I(),!1)):X();if("Identifier"===e.key.type&&(Sa||d))for(var u=0;u<a.properties.length;++u){var C=a.properties[u];if(C.key.name===e.key.name){var h=g==C.kind||f&&"init"===C.kind||"init"===g&&("get"===C.kind||"set"===C.kind);h&&!Sa&&"init"===g&&"init"===C.kind&&(h=!1);h&&c(e.key.start,"Redefinition of property")}}a.properties.push(e)}return G(a,"ObjectExpression");case ob:return a=
I(),A(),wa(a,!1);case la:return a=I(),A(),a.callee=sa(W(),!0),L(tb)?a.arguments=Ba(mb,!1):a.arguments=Za,G(a,"NewExpression");default:X()}}function wa(a,b){ha===vb?a.id=ra():b?X():a.id=null;a.params=[];var d=!0;for(Q(tb);!L(mb);)d?d=!1:Q(Bb),a.params.push(ra());d=Qa;var e=za;Qa=!0;za=[];a.body=N(!0);Qa=d;za=e;if(Sa||a.body.body.length&&R(a.body.body[0]))for(d=a.id?-1:0;d<a.params.length;++d)if(e=0>d?a.id:a.params[d],(Yc(e.name)||fc(e.name))&&c(e.start,"Defining '"+e.name+"' in strict mode"),0<=d)for(var f=
0;f<d;++f)e.name===a.params[f].name&&c(e.start,"Argument name clash in strict mode");return G(a,b?"FunctionDeclaration":"FunctionExpression")}function Ba(a,b,c){for(var d=[],e=!0;!L(a);){if(e)e=!1;else if(Q(Bb),b&&ia.allowTrailingCommas&&L(a))break;c&&ha===Bb?d.push(null):d.push(ja(!0))}return d}function ra(a){var b=I();a&&"everywhere"==ia.forbidReserved&&(a=!1);ha===vb?(!a&&(ia.forbidReserved&&(3===ia.ecmaVersion?Ob:zd)(Ra)||Sa&&Yc(Ra))&&-1==S.slice(Ca,ya).indexOf("\\")&&c(Ca,"The keyword '"+Ra+
"' is reserved"),b.name=Ra):a&&ha.keyword?b.name=ha.keyword:X();Da=!1;A();return G(b,"Identifier")}a.version="0.5.0";var ia,S,ua,Ia;a.parse=function(a,c){S=String(a);ua=S.length;b(c);gb=1;D=Wa=0;Da=!0;h();var d=ia.program;Ua=nb=D;ia.locations&&(Xa=new e);Qa=Sa=null;za=[];l();var f=d||I(),g=!0;d||(f.body=[]);for(;ha!==$a;)d=Y(),f.body.push(d),g&&R(d)&&E(!0),g=!1;return G(f,"Program")};var Ga=a.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,
locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null},Oa=a.getLineInfo=function(a,b){for(var c=1,d=0;;){Qb.lastIndex=d;var e=Qb.exec(a);if(e&&e.index<b)++c,d=e.index+e[0].length;else break}return{line:c,column:b-d}};a.tokenize=function(a,c){function d(a){nb=ya;l(a);e.start=Ca;e.end=ya;e.startLoc=Ka;e.endLoc=Ma;e.type=ha;e.value=Ra;return e}S=String(a);ua=S.length;b(c);gb=1;D=Wa=0;Da=!0;h();var e={};d.jumpTo=function(a,b){D=a;if(ia.locations){gb=1;Wa=Qb.lastIndex=
0;for(var c;(c=Qb.exec(S))&&c.index<a;)++gb,Wa=c.index+c[0].length}Da=b;h()};return d};var D,Ca,ya,Ka,Ma,ha,Ra,Da,gb,Wa,Ua,nb,Xa,Qa,za,Sa,Za=[],cb={type:"num"},ab={type:"regexp"},Va={type:"string"},vb={type:"name"},$a={type:"eof"},eb={keyword:"break"},fb={keyword:"case",beforeExpr:!0},db={keyword:"catch"},hb={keyword:"continue"},kb={keyword:"debugger"},lb={keyword:"default"},pb={keyword:"do",isLoop:!0},qb={keyword:"else",beforeExpr:!0},Cb={keyword:"finally"},wb={keyword:"for",isLoop:!0},ob={keyword:"function"},
xb={keyword:"if"},Ya={keyword:"return",beforeExpr:!0},rb={keyword:"switch"},zb={keyword:"throw",beforeExpr:!0},Ab={keyword:"try"},yb={keyword:"var"},u={keyword:"while",isLoop:!0},C={keyword:"with"},la={keyword:"new",beforeExpr:!0},pa={keyword:"this"},ka={keyword:"null",atomValue:null},Aa={keyword:"true",atomValue:!0},Ta={keyword:"false",atomValue:!1},Fa={keyword:"in",binop:7,beforeExpr:!0},Ea={"break":eb,"case":fb,"catch":db,"continue":hb,"debugger":kb,"default":lb,"do":pb,"else":qb,"finally":Cb,
"for":wb,"function":ob,"if":xb,"return":Ya,"switch":rb,"throw":zb,"try":Ab,"var":yb,"while":u,"with":C,"null":ka,"true":Aa,"false":Ta,"new":la,"in":Fa,"instanceof":{keyword:"instanceof",binop:7,beforeExpr:!0},"this":pa,"typeof":{keyword:"typeof",prefix:!0,beforeExpr:!0},"void":{keyword:"void",prefix:!0,beforeExpr:!0},"delete":{keyword:"delete",prefix:!0,beforeExpr:!0}},ac={type:"[",beforeExpr:!0},bc={type:"]"},Rb={type:"{",beforeExpr:!0},Ib={type:"}"},tb={type:"(",beforeExpr:!0},mb={type:")"},Bb=
{type:",",beforeExpr:!0},ub={type:";",beforeExpr:!0},Sb={type:":",beforeExpr:!0},sc={type:"."},tc={type:"?",beforeExpr:!0},uc={binop:10,beforeExpr:!0},vc={isAssign:!0,beforeExpr:!0},Jb={isAssign:!0,beforeExpr:!0},id={postfix:!0,prefix:!0,isUpdate:!0},Oc={prefix:!0,beforeExpr:!0},Mc={binop:1,beforeExpr:!0},Nc={binop:2,beforeExpr:!0},fd={binop:3,beforeExpr:!0},hd={binop:4,beforeExpr:!0},gd={binop:5,beforeExpr:!0},jd={binop:6,beforeExpr:!0},Fb={binop:7,beforeExpr:!0},Kb={binop:8,beforeExpr:!0},Mb={binop:9,
prefix:!0,beforeExpr:!0},Nb={binop:10,beforeExpr:!0};a.tokTypes={bracketL:ac,bracketR:bc,braceL:Rb,braceR:Ib,parenL:tb,parenR:mb,comma:Bb,semi:ub,colon:Sb,dot:sc,question:tc,slash:uc,eq:vc,name:vb,eof:$a,num:cb,regexp:ab,string:Va};for(var Gb in Ea)a.tokTypes["_"+Gb]=Ea[Gb];var Ob=d("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),zd=
d("class enum extends super const export import"),Yc=d("implements interface let package private protected public static yield"),fc=d("eval arguments"),ld=d("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),ed=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Qc=RegExp("[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]"),
Ad=RegExp("[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u0620-\u0649\u0672-\u06d3\u06e7-\u06e8\u06fb-\u06fc\u0730-\u074a\u0800-\u0814\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0840-\u0857\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962-\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09d7\u09df-\u09e0\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5f-\u0b60\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2-\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d46-\u0d48\u0d57\u0d62-\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e34-\u0e3a\u0e40-\u0e45\u0e50-\u0e59\u0eb4-\u0eb9\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f41-\u0f47\u0f71-\u0f84\u0f86-\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1029\u1040-\u1049\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u170e-\u1710\u1720-\u1730\u1740-\u1750\u1772\u1773\u1780-\u17b2\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1920-\u192b\u1930-\u193b\u1951-\u196d\u19b0-\u19c0\u19c8-\u19c9\u19d0-\u19d9\u1a00-\u1a15\u1a20-\u1a53\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b46-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1bb0-\u1bb9\u1be6-\u1bf3\u1c00-\u1c22\u1c40-\u1c49\u1c5b-\u1c7d\u1cd0-\u1cd2\u1d00-\u1dbe\u1e01-\u1f15\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2d81-\u2d96\u2de0-\u2dff\u3021-\u3028\u3099\u309a\ua640-\ua66d\ua674-\ua67d\ua69f\ua6f0-\ua6f1\ua7f8-\ua800\ua806\ua80b\ua823-\ua827\ua880-\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8f3-\ua8f7\ua900-\ua909\ua926-\ua92d\ua930-\ua945\ua980-\ua983\ua9b3-\ua9c0\uaa00-\uaa27\uaa40-\uaa41\uaa4c-\uaa4d\uaa50-\uaa59\uaa7b\uaae0-\uaae9\uaaf2-\uaaf3\uabc0-\uabe1\uabec\uabed\uabf0-\uabf9\ufb20-\ufb28\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]"),
dc=/[\n\r\u2028\u2029]/,Qb=/\r\n|[\n\r\u2028\u2029]/g,cc=a.isIdentifierStart=function(a){return 65>a?36===a:91>a?!0:97>a?95===a:123>a?!0:170<=a&&Qc.test(String.fromCharCode(a))},Rc=a.isIdentifierChar=function(a){return 48>a?36===a:58>a?!0:65>a?!1:91>a?!0:97>a?95===a:123>a?!0:170<=a&&Ad.test(String.fromCharCode(a))},Tb,wc={kind:"loop"},ud={kind:"switch"}});E.version||(E=null)}var P={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},T={"-":"__negate",
"+":"__self"},Q=e.each("add subtract multiply divide modulo equals negate".split(" "),function(a){this["__"+a]="#"+a},{__self:function(){return this}});m.inject(Q);p.inject(Q);Oa.inject(Q);c&&("complete"===d.readyState?setTimeout(v):ua.add(c,{load:v}));return{compile:k,execute:l,load:function(a){return a?n(a):v()},parse:b}}.call(this);var fa=new (g.inject(e.exports,{Base:e,Numerical:l,Key:Fb,DomEvent:ua,DomElement:va,document:d,window:c,Symbol:v,PlacedSymbol:ob}));fa.agent.node&&require("./node/extend.js")(fa);
"function"===typeof define&&define.amd?define("paper",fa):"object"===typeof module&&module&&(module.exports=fa);return fa}.call(this,"object"===typeof self?self:null);
(function(a,b){"object"===typeof exports&&"undefined"!==typeof module?b(exports):"function"===typeof define&&define.amd?define(["exports"],b):b(a.opentype={})})(this,function(a){function b(){this.table=new Uint16Array(16);this.trans=new Uint16Array(288)}function c(a,c){this.source=a;this.bitcount=this.tag=this.sourceIndex=0;this.dest=c;this.destLen=0;this.ltree=new b;this.dtree=new b}function d(a,b,c,d){var e;for(e=0;e<c;++e)a[e]=0;for(e=0;e<30-c;++e)a[e+c]=e/c|0;c=d;for(e=0;30>e;++e)b[e]=c,c+=1<<
a[e]}function e(a,b,c,d){var e,f;for(e=0;16>e;++e)a.table[e]=0;for(e=0;e<d;++e)a.table[b[c+e]]++;for(e=f=a.table[0]=0;16>e;++e)Dc[e]=f,f+=a.table[e];for(e=0;e<d;++e)b[c+e]&&(a.trans[Dc[b[c+e]]++]=e)}function f(a,b,c){if(!b)return c;for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var d=a.tag&65535>>>16-b;a.tag>>>=b;a.bitcount-=b;return d+c}function g(a,b){for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var c=0,d=0,e=0,f=a.tag;do d=2*d+(f&
1),f>>>=1,++e,c+=b.table[e],d-=b.table[e];while(0<=d);a.tag=f;a.bitcount-=e;return b.trans[c+d]}function h(a,b,c){for(;;){var d=g(a,b);if(256===d)return 0;if(256>d)a.dest[a.destLen++]=d;else{var e;d-=257;d=f(a,oc[d],pc[d]);var u=g(a,c);for(e=u=a.destLen-f(a,Ac[u],Bc[u]);e<u+d;++e)a.dest[a.destLen++]=a.dest[e]}}}function k(a,b,c,d,e){return Math.pow(1-e,3)*a+3*Math.pow(1-e,2)*e*b+3*(1-e)*Math.pow(e,2)*c+Math.pow(e,3)*d}function l(){this.y2=this.x2=this.y1=this.x1=Number.NaN}function n(){this.commands=
[];this.fill="black";this.stroke=null;this.strokeWidth=1}function m(a){throw Error(a);}function y(a,b){a||m(b)}function p(a){return function(){return a}}function K(a,b,c){for(var d=0;d<b.length;d+=1){var e=b[d];this[e.name]=e.value}this.tableName=a;this.fields=b;if(c)for(a=Object.keys(c),b=0;b<a.length;b+=1)d=a[b],e=c[d],void 0!==this[d]&&(this[d]=e)}function E(a,b,c){void 0===c&&(c=b.length);var d=Array(b.length+1);d[0]={name:a+"Count",type:"USHORT",value:c};for(c=0;c<b.length;c++)d[c+1]={name:a+
c,type:"USHORT",value:b[c]};return d}function Ia(a,b,c){var d=b.length,e=Array(d+1);e[0]={name:a+"Count",type:"USHORT",value:d};for(var f=0;f<d;f++)e[f+1]={name:a+f,type:"TABLE",value:c(b[f],f)};return e}function P(a,b,c){var d=b.length,e=[];e[0]={name:a+"Count",type:"USHORT",value:d};for(a=0;a<d;a++)e=e.concat(c(b[a],a));return e}function qa(a){1===a.format?K.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(E("glyph",a.glyphs))):Y.assert(!1,"Can't create coverage table format 2 yet.")}
function Ba(a){K.call(this,"scriptListTable",P("scriptRecord",a,function(a,b){var c=a.script,d=c.defaultLangSys;Y.assert(!!d,"Unable to write GSUB: script "+a.tag+" has no default language system.");return[{name:"scriptTag"+b,type:"TAG",value:a.tag},{name:"script"+b,type:"TABLE",value:new K("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new K("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:d.reqFeatureIndex}].concat(E("featureIndex",
d.featureIndexes)))}].concat(P("langSys",c.langSysRecords,function(a,b){var c=a.langSys;return[{name:"langSysTag"+b,type:"TAG",value:a.tag},{name:"langSys"+b,type:"TABLE",value:new K("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:c.reqFeatureIndex}].concat(E("featureIndex",c.featureIndexes)))}]})))}]}))}function Q(a){K.call(this,"featureListTable",P("featureRecord",a,function(a,b){var c=a.feature;return[{name:"featureTag"+b,type:"TAG",value:a.tag},
{name:"feature"+b,type:"TABLE",value:new K("featureTable",[{name:"featureParams",type:"USHORT",value:c.featureParams}].concat(E("lookupListIndex",c.lookupListIndexes)))}]}))}function Ma(a,b){K.call(this,"lookupListTable",Ia("lookup",a,function(a){var c=b[a.lookupType];Y.assert(!!c,"Unable to write GSUB lookup type "+a.lookupType+" tables.");return new K("lookupTable",[{name:"lookupType",type:"USHORT",value:a.lookupType},{name:"lookupFlag",type:"USHORT",value:a.lookupFlag}].concat(Ia("subtable",a.subtables,
c)))}))}function $a(a,b){return a.getUint8(b)}function Ga(a,b){return a.getUint16(b,!1)}function ab(a,b){return a.getUint32(b,!1)}function ob(a,b){var c=a.getInt16(b,!1),d=a.getUint16(b+2,!1);return c+d/65535}function v(a,b){this.data=a;this.offset=b;this.relativeOffset=0}function Ua(a,b,c){a.segments.push({end:b,start:b,delta:-(b-c),offset:0,glyphIndex:c})}function T(a){this.font=a}function wb(a){this.cmap=a}function H(a,b){this.encoding=a;this.charset=b}function Da(a){switch(a.version){case 1:this.names=
S.slice();break;case 2:this.names=Array(a.numberOfGlyphs);for(var b=0;b<a.numberOfGlyphs;b++)this.names[b]=a.glyphNameIndex[b]<S.length?S[a.glyphNameIndex[b]]:a.names[a.glyphNameIndex[b]-S.length];break;case 2.5:this.names=Array(a.numberOfGlyphs);for(b=0;b<a.numberOfGlyphs;b++)this.names[b]=S[b+a.glyphNameIndex[b]];break;case 3:this.names=[];break;default:this.names=[]}}function eb(a,b){var c=b||new n;return{configurable:!0,get:function(){"function"===typeof c&&(c=c());return c},set:function(a){c=
a}}}function aa(a){this.bindConstructorValues(a)}function Ka(a,b,c){Object.defineProperty(a,b,{get:function(){a.path;return a[c]},set:function(b){a[c]=b},enumerable:!0,configurable:!0})}function rb(a,b){this.font=a;this.glyphs={};if(Array.isArray(b))for(var c=0;c<b.length;c++)this.glyphs[c]=b[c];this.length=b&&b.length||0}function Kb(a,b){if(a===b)return!0;if(Array.isArray(a)&&Array.isArray(b)){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c+=1)if(!Kb(a[c],b[c]))return!1;return!0}return!1}
function kb(a){return 1240>a.length?107:33900>a.length?1131:32768}function Qa(a,b,c){var d=[],e=[],f=W.getCard16(a,b);if(0!==f){var g=W.getByte(a,b+2);var u=b+(f+1)*g+2;for(var h=b+3,C=0;C<f+1;C+=1)d.push(W.getOffset(a,h,g)),h+=g;f=u+d[f]}else f=b+2;for(g=0;g<d.length-1;g+=1)h=W.getBytes(a,u+d[g],u+d[g+1]),c&&(h=c(h)),e.push(h);return{objects:e,startOffset:b,endOffset:f}}function Oa(a,b){if(28===b){var c=a.parseByte();var d=a.parseByte();return c<<8|d}if(29===b){c=a.parseByte();d=a.parseByte();var e=
a.parseByte();var f=a.parseByte();return c<<24|d<<16|e<<8|f}if(30===b){c="";for(d=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){f=a.parseByte();e=f>>4;f&=15;if(15===e)break;c+=d[e];if(15===f)break;c+=d[f]}return parseFloat(c)}if(32<=b&&246>=b)return b-139;if(247<=b&&250>=b)return c=a.parseByte(),256*(b-247)+c+108;if(251<=b&&254>=b)return c=a.parseByte(),256*-(b-251)-c-108;throw Error("Invalid b0 "+b);}function lb(a,b,c){var d=new W.Parser(a,void 0!==b?b:0);b=[];var e=[];for(c=
void 0!==c?c:a.length;d.relativeOffset<c;)a=d.parseByte(),21>=a?(12===a&&(a=1200+d.parseByte()),b.push([a,e]),e=[]):e.push(Oa(d,a));c={};for(a=0;a<b.length;a+=1){d=b[a][0];e=b[a][1];e=1===e.length?e[0]:e;if(c.hasOwnProperty(d)&&!isNaN(c[d]))throw Error("Object "+c+" already has key "+d);c[d]=e}return c}function Va(a,b){return b=390>=b?jc[b]:a[b-391]}function pb(a,b,c){for(var d={},e,f=0;f<b.length;f+=1){var g=b[f];if(Array.isArray(g.type)){var u=[];u.length=g.type.length;for(var h=0;h<g.type.length;h++)e=
void 0!==a[g.op]?a[g.op][h]:void 0,void 0===e&&(e=void 0!==g.value&&void 0!==g.value[h]?g.value[h]:null),"SID"===g.type[h]&&(e=Va(c,e)),u[h]=e;d[g.name]=u}else e=a[g.op],void 0===e&&(e=void 0!==g.value?g.value:null),"SID"===g.type&&(e=Va(c,e)),d[g.name]=e}return d}function va(a,b,c,d){for(var e=[],f=0;f<c.length;f+=1){var g=new DataView((new Uint8Array(c[f])).buffer);var u=d;g=lb(g,0,g.byteLength);u=pb(g,Hc,u);u._subrs=[];u._subrsBias=0;var h=u["private"][0];g=u["private"][1];if(0!==h&&0!==g){var C=
d;h=lb(a,g+b,h);C=pb(h,qc,C);u._defaultWidthX=C.defaultWidthX;u._nominalWidthX=C.nominalWidthX;0!==C.subrs&&(g=Qa(a,g+C.subrs+b),u._subrs=g.objects,u._subrsBias=kb(u._subrs));u._privateDict=C}e.push(u)}return e}function ua(a,b,c){function d(a,b){r&&la.closePath();la.moveTo(a,b);r=!0}function e(){0===k.length%2||m||(z=k.shift()+y);l+=k.length>>1;k.length=0;m=!0}function f(c){for(var pa,ka,Aa,Ta,n,Fa,Ea=0;Ea<c.length;)switch(ka=c[Ea],Ea+=1,ka){case 1:e();break;case 3:e();break;case 4:1<k.length&&!m&&
(z=k.shift()+y,m=!0);q+=k.pop();d(p,q);break;case 5:for(;0<k.length;)p+=k.shift(),q+=k.shift(),la.lineTo(p,q);break;case 6:for(;0<k.length;){p+=k.shift();la.lineTo(p,q);if(0===k.length)break;q+=k.shift();la.lineTo(p,q)}break;case 7:for(;0<k.length;){q+=k.shift();la.lineTo(p,q);if(0===k.length)break;p+=k.shift();la.lineTo(p,q)}break;case 8:for(;0<k.length;)g=p+k.shift(),u=q+k.shift(),h=g+k.shift(),C=u+k.shift(),p=h+k.shift(),q=C+k.shift(),la.curveTo(g,u,h,C,p,q);break;case 10:pa=k.pop()+x;(pa=v[pa])&&
f(pa);break;case 11:return;case 12:ka=c[Ea];Ea+=1;switch(ka){case 35:g=p+k.shift();u=q+k.shift();h=g+k.shift();C=u+k.shift();pa=h+k.shift();ka=C+k.shift();Aa=pa+k.shift();Ta=ka+k.shift();n=Aa+k.shift();Fa=Ta+k.shift();p=n+k.shift();q=Fa+k.shift();k.shift();la.curveTo(g,u,h,C,pa,ka);la.curveTo(Aa,Ta,n,Fa,p,q);break;case 34:g=p+k.shift();u=q;h=g+k.shift();C=u+k.shift();pa=h+k.shift();ka=C;Aa=pa+k.shift();Ta=C;n=Aa+k.shift();Fa=q;p=n+k.shift();la.curveTo(g,u,h,C,pa,ka);la.curveTo(Aa,Ta,n,Fa,p,q);break;
case 36:g=p+k.shift();u=q+k.shift();h=g+k.shift();C=u+k.shift();pa=h+k.shift();ka=C;Aa=pa+k.shift();Ta=C;n=Aa+k.shift();Fa=Ta+k.shift();p=n+k.shift();la.curveTo(g,u,h,C,pa,ka);la.curveTo(Aa,Ta,n,Fa,p,q);break;case 37:g=p+k.shift();u=q+k.shift();h=g+k.shift();C=u+k.shift();pa=h+k.shift();ka=C+k.shift();Aa=pa+k.shift();Ta=ka+k.shift();n=Aa+k.shift();Fa=Ta+k.shift();Math.abs(n-p)>Math.abs(Fa-q)?p=n+k.shift():q=Fa+k.shift();la.curveTo(g,u,h,C,pa,ka);la.curveTo(Aa,Ta,n,Fa,p,q);break;default:console.log("Glyph "+
b.index+": unknown operator 1200"+ka),k.length=0}break;case 14:0<k.length&&!m&&(z=k.shift()+y,m=!0);r&&(la.closePath(),r=!1);break;case 18:e();break;case 19:case 20:e();Ea+=l+7>>3;break;case 21:2<k.length&&!m&&(z=k.shift()+y,m=!0);q+=k.pop();p+=k.pop();d(p,q);break;case 22:1<k.length&&!m&&(z=k.shift()+y,m=!0);p+=k.pop();d(p,q);break;case 23:e();break;case 24:for(;2<k.length;)g=p+k.shift(),u=q+k.shift(),h=g+k.shift(),C=u+k.shift(),p=h+k.shift(),q=C+k.shift(),la.curveTo(g,u,h,C,p,q);p+=k.shift();q+=
k.shift();la.lineTo(p,q);break;case 25:for(;6<k.length;)p+=k.shift(),q+=k.shift(),la.lineTo(p,q);g=p+k.shift();u=q+k.shift();h=g+k.shift();C=u+k.shift();p=h+k.shift();q=C+k.shift();la.curveTo(g,u,h,C,p,q);break;case 26:for(k.length%2&&(p+=k.shift());0<k.length;)g=p,u=q+k.shift(),h=g+k.shift(),C=u+k.shift(),p=h,q=C+k.shift(),la.curveTo(g,u,h,C,p,q);break;case 27:for(k.length%2&&(q+=k.shift());0<k.length;)g=p+k.shift(),u=q,h=g+k.shift(),C=u+k.shift(),p=h+k.shift(),q=C,la.curveTo(g,u,h,C,p,q);break;
case 28:pa=c[Ea];ka=c[Ea+1];k.push((pa<<24|ka<<16)>>16);Ea+=2;break;case 29:pa=k.pop()+a.gsubrsBias;(pa=a.gsubrs[pa])&&f(pa);break;case 30:for(;0<k.length;){g=p;u=q+k.shift();h=g+k.shift();C=u+k.shift();p=h+k.shift();q=C+(1===k.length?k.shift():0);la.curveTo(g,u,h,C,p,q);if(0===k.length)break;g=p+k.shift();u=q;h=g+k.shift();C=u+k.shift();q=C+k.shift();p=h+(1===k.length?k.shift():0);la.curveTo(g,u,h,C,p,q)}break;case 31:for(;0<k.length;){g=p+k.shift();u=q;h=g+k.shift();C=u+k.shift();q=C+k.shift();
p=h+(1===k.length?k.shift():0);la.curveTo(g,u,h,C,p,q);if(0===k.length)break;g=p;u=q+k.shift();h=g+k.shift();C=u+k.shift();p=h+k.shift();q=C+(1===k.length?k.shift():0);la.curveTo(g,u,h,C,p,q)}break;default:32>ka?console.log("Glyph "+b.index+": unknown operator "+ka):247>ka?k.push(ka-139):251>ka?(pa=c[Ea],Ea+=1,k.push(256*(ka-247)+pa+108)):255>ka?(pa=c[Ea],Ea+=1,k.push(256*-(ka-251)-pa-108)):(pa=c[Ea],ka=c[Ea+1],Aa=c[Ea+2],Ta=c[Ea+3],Ea+=4,k.push((pa<<24|ka<<16|Aa<<8|Ta)/65536))}}var g,u,h,C,la=new n,
k=[],l=0,m=!1,r=!1,p=0,q=0;if(a.isCIDFont){var t=a.tables.cff.topDict._fdArray[a.tables.cff.topDict._fdSelect[b.index]];var v=t._subrs;var x=t._subrsBias;var w=t._defaultWidthX;var y=t._nominalWidthX}else v=a.tables.cff.topDict._subrs,x=a.tables.cff.topDict._subrsBias,w=a.tables.cff.topDict._defaultWidthX,y=a.tables.cff.topDict._nominalWidthX;var z=w;f(c);b.advanceWidth=z;return la}function ta(a,b){jc.indexOf(a);var c=b.indexOf(a);0<=c?c+=jc.length:(c=jc.length+b.length,b.push(a));return c}function Mb(a,
b,c){for(var d={},e=0;e<a.length;e+=1){var f=a[e],g=b[f.name];void 0===g||Kb(g,f.value)||("SID"===f.type&&(g=ta(g,c)),d[f.op]={name:f.name,type:f.type,value:g})}return d}function qb(a,b){var c=new Z.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);c.dict=Mb(Hc,a,b);return c}function Nb(a){var b=new Z.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);b.topDicts=[{name:"topDict_0",type:"TABLE",value:a}];return b}function Fb(a,b,c){switch(a){case 0:return"utf-16";case 1:return nb[c]||
md[b];case 3:if(1===b||10===b)return"utf-16"}}function yb(a){var b={},c;for(c in a)b[a[c]]=parseInt(c);return b}function Gb(a,b,c,d,e,f){return new Z.Record("NameRecord",[{name:"platformID",type:"USHORT",value:a},{name:"encodingID",type:"USHORT",value:b},{name:"languageID",type:"USHORT",value:c},{name:"nameID",type:"USHORT",value:d},{name:"length",type:"USHORT",value:e},{name:"offset",type:"USHORT",value:f}])}function Ob(a,b){a:{var c=a.length;var d=b.length-c+1,e=0;b:for(;e<d;e++)for(;e<d;){for(var f=
0;f<c;f++)if(b[e+f]!==a[f])continue b;c=e;break a}c=-1}if(0>c)for(c=b.length,d=0,e=a.length;d<e;++d)b.push(a[d]);return c}function zb(a){for(;0!==a.length%4;)a.push(0);for(var b=0,c=0;c<a.length;c+=4)b+=(a[c]<<24)+(a[c+1]<<16)+(a[c+2]<<8)+a[c+3];return b%=Math.pow(2,32)}function ra(a,b,c,d){return new Z.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==a?a:""},{name:"checkSum",type:"ULONG",value:void 0!==b?b:0},{name:"offset",type:"ULONG",value:void 0!==c?c:0},{name:"length",type:"ULONG",
value:void 0!==d?d:0}])}function xb(a){var b=new Z.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);b.tables=a;b.numTables=a.length;var c=Math.pow(2,Math.log(b.numTables)/Math.log(2)|0);b.searchRange=16*c;b.entrySelector=Math.log(c)/Math.log(2)|0;b.rangeShift=16*b.numTables-b.searchRange;c=[];for(var d=[],e=b.sizeOf()+ra().sizeOf()*
b.numTables;0!==e%4;)e+=1,d.push({name:"padding",type:"BYTE",value:0});for(var f=0;f<a.length;f+=1){var g=a[f];Y.argument(4===g.tableName.length,"Table name"+g.tableName+" is invalid.");var u=g.sizeOf(),h=ra(g.tableName,zb(g.encode()),e,u);c.push({name:h.tag+" Table Record",type:"RECORD",value:h});d.push({name:g.tableName+" table",type:"RECORD",value:g});e+=u;for(Y.argument(!isNaN(e),"Something went wrong calculating the offset.");0!==e%4;)e+=1,d.push({name:"padding",type:"BYTE",value:0})}c.sort(function(a,
b){return a.value.tag>b.value.tag?1:-1});b.fields=b.fields.concat(c);b.fields=b.fields.concat(d);return b}function wa(a,b,c){for(var d=0;d<b.length;d+=1){var e=a.charToGlyphIndex(b[d]);if(0<e)return a.glyphs.get(e).getMetrics()}return c}function Ab(a,b){for(var c=0,d=a.length-1;c<=d;){var e=c+d>>>1,f=a[e].tag;if(f===b)return e;f<b?c=e+1:d=e-1}return-c-1}function fa(a,b){for(var c=0,d=a.length-1;c<=d;){var e=c+d>>>1,f=a[e];if(f===b)return e;f<b?c=e+1:d=e-1}return-c-1}function yc(a,b){for(var c,d=0,
e=a.length-1;d<=e;){var f=d+e>>>1;c=a[f];var g=c.start;if(g===b)return c;g<b?d=f+1:e=f-1}if(0<d)return c=a[d-1],b>c.end?0:c}function Db(a,b){this.font=a;this.tableName=b}function Ub(a){Db.call(this,a,"gpos")}function xa(a){Db.call(this,a,"gsub")}function Eb(a,b,c){a=a.subtables;for(var d=0;d<a.length;d++){var e=a[d];if(e.substFormat===b)return e}if(c)return a.push(c),c}function Zb(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d<a.length;++d)c[d]=a[d];return b}function Pa(a,b){if(!a)throw b;
}function Xb(a,b,c,d,e){0<(b&d)?(a=a.parseByte(),0===(b&e)&&(a=-a),a=c+a):a=0<(b&e)?c:c+a.parseShort();return a}function ma(a,b,c){b=new W.Parser(b,c);a.numberOfContours=b.parseShort();a._xMin=b.parseShort();a._yMin=b.parseShort();a._xMax=b.parseShort();a._yMax=b.parseShort();var d;if(0<a.numberOfContours){var e=a.endPointIndices=[];for(d=0;d<a.numberOfContours;d+=1)e.push(b.parseUShort());a.instructionLength=b.parseUShort();a.instructions=[];for(d=0;d<a.instructionLength;d+=1)a.instructions.push(b.parseByte());
var f=e[e.length-1]+1;d=[];for(var g=0;g<f;g+=1)if(c=b.parseByte(),d.push(c),0<(c&8))for(var u=b.parseByte(),h=0;h<u;h+=1)d.push(c),g+=1;Y.argument(d.length===f,"Bad flags.");if(0<e.length){g=[];if(0<f){for(h=0;h<f;h+=1)c=d[h],u={},u.onCurve=!!(c&1),u.lastPointOfContour=0<=e.indexOf(h),g.push(u);for(h=e=0;h<f;h+=1)c=d[h],u=g[h],u.x=Xb(b,c,e,2,16),e=u.x;for(h=e=0;h<f;h+=1)c=d[h],u=g[h],u.y=Xb(b,c,e,4,32),e=u.y}a.points=g}else a.points=[]}else if(0===a.numberOfContours)a.points=[];else{a.isComposite=
!0;a.points=[];a.components=[];for(c=!0;c;)d=b.parseUShort(),c={glyphIndex:b.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0},0<(d&1)?0<(d&2)?(c.dx=b.parseShort(),c.dy=b.parseShort()):c.matchedPoints=[b.parseUShort(),b.parseUShort()]:0<(d&2)?(c.dx=b.parseChar(),c.dy=b.parseChar()):c.matchedPoints=[b.parseByte(),b.parseByte()],0<(d&8)?c.xScale=c.yScale=b.parseF2Dot14():0<(d&64)?(c.xScale=b.parseF2Dot14(),c.yScale=b.parseF2Dot14()):0<(d&128)&&(c.xScale=b.parseF2Dot14(),c.scale01=b.parseF2Dot14(),
c.scale10=b.parseF2Dot14(),c.yScale=b.parseF2Dot14()),a.components.push(c),c=!!(d&32);if(d&256)for(a.instructionLength=b.parseUShort(),a.instructions=[],d=0;d<a.instructionLength;d+=1)a.instructions.push(b.parseByte())}}function kc(a,b){for(var c=[],d=0;d<a.length;d+=1){var e=a[d];c.push({x:b.xScale*e.x+b.scale01*e.y+b.dx,y:b.scale10*e.x+b.yScale*e.y+b.dy,onCurve:e.onCurve,lastPointOfContour:e.lastPointOfContour})}return c}function Yb(a){var b=new n;if(!a)return b;for(var c=[],d=[],e=0;e<a.length;e+=
1){var f=a[e];d.push(f);f.lastPointOfContour&&(c.push(d),d=[])}Y.argument(0===d.length,"There are still points left in the current contour.");for(a=0;a<c.length;++a){d=c[a];e=d[d.length-1];f=d[0];e.onCurve?b.moveTo(e.x,e.y):f.onCurve?b.moveTo(f.x,f.y):b.moveTo(.5*(e.x+f.x),.5*(e.y+f.y));for(var g=0;g<d.length;++g)if(e=f,f=d[(g+1)%d.length],e.onCurve)b.lineTo(e.x,e.y);else{var u=f;f.onCurve||(u={x:.5*(e.x+f.x),y:.5*(e.y+f.y)});b.quadraticCurveTo(e.x,e.y,u.x,u.y)}b.closePath()}return b}function $b(a,
b){if(b.isComposite)for(var c=0;c<b.components.length;c+=1){var d=b.components[c],e=a.get(d.glyphIndex);e.getPath();if(e.points){if(void 0===d.matchedPoints)e=kc(e.points,d);else{if(d.matchedPoints[0]>b.points.length-1||d.matchedPoints[1]>e.points.length-1)throw Error("Matched points out of range in "+b.name);var f=b.points[d.matchedPoints[0]],g=e.points[d.matchedPoints[1]];d={xScale:d.xScale,scale01:d.scale01,scale10:d.scale10,yScale:d.yScale,dx:0,dy:0};g=kc([g],d)[0];d.dx=f.x-g.x;d.dy=f.y-g.y;e=
kc(e.points,d)}b.points=b.points.concat(e)}}return Yb(b.points)}function B(a){this.font=a;this.getCommands=function(a){return Tc.getPath(a).commands};this._fpgmState=this._prepState=void 0;this._errorState=0}function M(a){return a}function F(a){return Math.sign(a)*Math.round(Math.abs(a))}function da(a){return Math.sign(a)*Math.round(Math.abs(2*a))/2}function Ja(a){return Math.sign(a)*(Math.round(Math.abs(a)+.5)-.5)}function ea(a){return Math.sign(a)*Math.ceil(Math.abs(a))}function t(a){return Math.sign(a)*
Math.floor(Math.abs(a))}function w(a,b){this.x=a;this.y=b;this.axis=void 0;this.slope=b/a;this.normalSlope=-a/b;Object.freeze(this)}function x(a,b){var c=Math.sqrt(a*a+b*b);a/=c;b/=c;return 1===a&&0===b?db:0===a&&1===b?hb:new w(a,b)}function z(a,b,c,d){this.x=this.xo=Math.round(64*a)/64;this.y=this.yo=Math.round(64*b)/64;this.lastPointOfContour=c;this.onCurve=d;this.nextPointOnContour=this.prevPointOnContour=void 0;this.yTouched=this.xTouched=!1;Object.preventExtensions(this)}function J(a,b){this.env=
a;this.stack=[];this.prog=b;switch(a){case "glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case "prep":this.fv=this.pv=this.dpv=db,this.round=F}}function r(a){a=a.tZone=Array(a.gZone.length);for(var b=0;b<a.length;b++)a[b]=new z(0,0)}function R(a,b){var c=a.prog,d=a.ip,e=1;do{var f=c[++d];if(88===f)e++;else if(89===f)e--;else if(64===f)d+=c[d+1]+1;else if(65===f)d+=2*c[d+1]+1;else if(176<=f&&183>=f)d+=f-176+1;else if(184<=f&&191>=f)d+=2*(f-184+1);else if(b&&1===e&&27===f)break}while(0<
e);a.ip=d}function q(b,c){a.DEBUG&&console.log(c.step,"SVTCA["+b.axis+"]");c.fv=c.pv=c.dpv=b}function I(b,c){a.DEBUG&&console.log(c.step,"SPVTCA["+b.axis+"]");c.pv=c.dpv=b}function A(b,c){a.DEBUG&&console.log(c.step,"SFVTCA["+b.axis+"]");c.fv=b}function X(b,c){var d=c.stack,e=d.pop(),f=d.pop();d=c.z2[e];var g=c.z1[f];a.DEBUG&&console.log("SPVTL["+b+"]",e,f);b?(e=d.y-g.y,d=g.x-d.x):(e=g.x-d.x,d=g.y-d.y);c.pv=c.dpv=x(e,d)}function Xa(b,c){var d=c.stack,e=d.pop(),f=d.pop();d=c.z2[e];var g=c.z1[f];a.DEBUG&&
console.log("SFVTL["+b+"]",e,f);b?(e=d.y-g.y,d=g.x-d.x):(e=g.x-d.x,d=g.y-d.y);c.fv=x(e,d)}function sa(b){a.DEBUG&&console.log(b.step,"POP[]");b.stack.pop()}function fb(b,c){var d=c.stack.pop(),e=c.z0[d],f=c.fv,g=c.pv;a.DEBUG&&console.log(c.step,"MDAP["+b+"]",d);var u=g.distance(e,Wb);b&&(u=c.round(u));f.setRelative(e,Wb,u,g);f.touch(e);c.rp0=c.rp1=d}function V(b,c){var d=c.z2,e=d.length-2;a.DEBUG&&console.log(c.step,"IUP["+b.axis+"]");for(var f=0;f<e;f++){var g=d[f];if(!b.touched(g)){var u=g.prevTouched(b);
if(u!==g){var h=g.nextTouched(b);u===h&&b.setRelative(g,g,b.distance(u,u,!1,!0),b,!0);b.interpolate(g,u,h,b)}}}}function L(b,c){for(var d=c.stack,e=(b?c.z0:c.z1)[b?c.rp1:c.rp2],f=c.fv,g=c.pv,u=c.loop,h=c.z2;u--;){var C=d.pop(),k=h[C],l=g.distance(e,e,!1,!0);f.setRelative(k,k,l,g);f.touch(k);a.DEBUG&&console.log(c.step,(1<c.loop?"loop "+(c.loop-u)+": ":"")+"SHP["+(b?"rp1":"rp2")+"]",C)}c.loop=1}function oa(b,c){var d=(b?c.z0:c.z1)[b?c.rp1:c.rp2],e=c.fv,f=c.pv,g=c.stack.pop(),u=c.z2[c.contours[g]],
h=u;a.DEBUG&&console.log(c.step,"SHC["+b+"]",g);g=f.distance(d,d,!1,!0);do h!==d&&e.setRelative(h,h,g,f),h=h.nextPointOnContour;while(h!==u)}function ya(b,c){var d=(b?c.z0:c.z1)[b?c.rp1:c.rp2],e=c.fv,f=c.pv,g=c.stack.pop();a.DEBUG&&console.log(c.step,"SHZ["+b+"]",g);switch(g){case 0:g=c.tZone;break;case 1:g=c.gZone;break;default:throw Error("Invalid zone");}for(var u=f.distance(d,d,!1,!0),h=g.length-2,C=0;C<h;C++)d=g[C],e.setRelative(d,d,u,f)}function ja(b,c){var d=c.stack,e=d.pop()/64;d=d.pop();
var f=c.z1[d],g=c.fv;g.setRelative(f,c.z0[c.rp0],e,c.pv);g.touch(f);a.DEBUG&&console.log(c.step,"MSIRP["+b+"]",e,d);c.rp1=c.rp0;c.rp2=d;b&&(c.rp0=d)}function G(b,c){var d=c.stack,e=d.pop();d=d.pop();var f=c.z0[d],g=c.fv,u=c.pv,h=c.cvt[e];a.DEBUG&&console.log(c.step,"MIAP["+b+"]",e,"(",h,")",d);e=u.distance(f,Wb);b&&(Math.abs(e-h)<c.cvCutIn&&(e=h),e=c.round(e));g.setRelative(f,Wb,e,u);0===c.zp0&&(f.xo=f.x,f.yo=f.y);g.touch(f);c.rp0=c.rp1=d}function ba(b,c){var d=c.stack,e=d.pop(),f=c.z2[e];a.DEBUG&&
console.log(c.step,"GC["+b+"]",e);d.push(64*c.dpv.distance(f,Wb,b,!1))}function Na(b,c){var d=c.stack,e=d.pop();d=d.pop();var f=c.dpv.distance(c.z0[d],c.z1[e],b,b);a.DEBUG&&console.log(c.step,"MD["+b+"]",e,d,"->",f);c.stack.push(Math.round(64*f))}function Vb(b,c){var d=c.stack,e=d.pop(),f=c.fv,g=c.pv,u=c.ppem,h=c.deltaBase+16*(b-1),C=c.deltaShift,k=c.z0;a.DEBUG&&console.log(c.step,"DELTAP["+b+"]",e,d);for(var l=0;l<e;l++){var m=d.pop(),n=d.pop();h+((n&240)>>4)===u&&(n=(n&15)-8,0<=n&&n++,a.DEBUG&&
console.log(c.step,"DELTAPFIX",m,"by",n*C),m=k[m],f.setRelative(m,m,n*C,g))}}function U(b,c){var d=c.stack,e=d.pop();a.DEBUG&&console.log(c.step,"ROUND[]");d.push(64*c.round(e/64))}function Ha(b,c){var d=c.stack,e=d.pop(),f=c.ppem,g=c.deltaBase+16*(b-1),u=c.deltaShift;a.DEBUG&&console.log(c.step,"DELTAC["+b+"]",e,d);for(var h=0;h<e;h++){var C=d.pop(),k=d.pop();g+((k&240)>>4)===f&&(k=(k&15)-8,0<=k&&k++,k*=u,a.DEBUG&&console.log(c.step,"DELTACFIX",C,"by",k),c.cvt[C]+=k)}}function ib(b,c){var d=c.stack,
e=d.pop(),f=d.pop();d=c.z2[e];var g=c.z1[f];a.DEBUG&&console.log(c.step,"SDPVTL["+b+"]",e,f);b?(e=d.y-g.y,d=g.x-d.x):(e=g.x-d.x,d=g.y-d.y);c.dpv=x(e,d)}function bb(b,c){var d=c.stack,e=c.prog,f=c.ip;a.DEBUG&&console.log(c.step,"PUSHB["+b+"]");for(var g=0;g<b;g++)d.push(e[++f]);c.ip=f}function jb(b,c){var d=c.ip,e=c.prog,f=c.stack;a.DEBUG&&console.log(c.ip,"PUSHW["+b+"]");for(var g=0;g<b;g++){var u=e[++d]<<8|e[++d];u&32768&&(u=-((u^65535)+1));f.push(u)}c.ip=d}function O(b,c,d,e,f,g){var u=g.stack,
h=b&&u.pop();u=u.pop();var k=g.z0[g.rp0],C=g.z1[u],la=g.minDis,pa=g.fv,l=g.dpv,m;var ka=m=l.distance(C,k,!0,!0);var n=0<=ka?1:-1;ka=Math.abs(ka);if(b){var Aa=g.cvt[h];e&&Math.abs(ka-Aa)<g.cvCutIn&&(ka=Aa)}d&&ka<la&&(ka=la);e&&(ka=g.round(ka));pa.setRelative(C,k,n*ka,l);pa.touch(C);a.DEBUG&&console.log(g.step,(b?"MIRP[":"MDRP[")+(c?"M":"m")+(d?">":"_")+(e?"R":"_")+(0===f?"Gr":1===f?"Bl":2===f?"Wh":"")+"]",b?h+"("+g.cvt[h]+","+Aa+")":"",u,"(d =",m,"->",n*ka,")");g.rp1=g.rp0;g.rp2=u;c&&(g.rp0=u)}function na(a){a=
a||{};a.empty||(Pa(a.familyName,"When creating a new Font object, familyName is required."),Pa(a.styleName,"When creating a new Font object, styleName is required."),Pa(a.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Pa(a.ascender,"When creating a new Font object, ascender is required."),Pa(a.descender,"When creating a new Font object, descender is required."),Pa(0>a.descender,"Descender should be negative (e.g. -512)."),this.names={fontFamily:{en:a.familyName||" "},fontSubfamily:{en:a.styleName||
" "},fullName:{en:a.fullName||a.familyName+" "+a.styleName},postScriptName:{en:a.postScriptName||(a.familyName+a.styleName).replace(/\s/g,"")},designer:{en:a.designer||" "},designerURL:{en:a.designerURL||" "},manufacturer:{en:a.manufacturer||" "},manufacturerURL:{en:a.manufacturerURL||" "},license:{en:a.license||" "},licenseURL:{en:a.licenseURL||" "},version:{en:a.version||"Version 0.1"},description:{en:a.description||" "},copyright:{en:a.copyright||" "},trademark:{en:a.trademark||" "}},this.unitsPerEm=
a.unitsPerEm||1E3,this.ascender=a.ascender,this.descender=a.descender,this.createdTimestamp=a.createdTimestamp,this.tables={os2:{usWeightClass:a.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:a.widthClass||this.usWidthClasses.MEDIUM,fsSelection:a.fsSelection||this.fsSelectionValues.REGULAR}});this.supported=!0;this.glyphs=new Pb.GlyphSet(this,a.glyphs||[]);this.encoding=new T(this);this.position=new Ub(this);this.substitution=new xa(this);this.tables=this.tables||{};Object.defineProperty(this,
"hinting",{get:function(){if(this._hinting)return this._hinting;if("truetype"===this.outlinesFormat)return this._hinting=new B(this)}})}function zc(a,b){var c=JSON.stringify(a),d=256,e;for(e in b){var f=parseInt(e);if(f&&!(256>f)){if(JSON.stringify(b[e])===c)return f;d<=f&&(d=f+1)}}b[d]=a;return d}function Zc(a,b,c){c=zc(b.name,c);return[{name:"tag_"+a,type:"TAG",value:b.tag},{name:"minValue_"+a,type:"FIXED",value:b.minValue<<16},{name:"defaultValue_"+a,type:"FIXED",value:b.defaultValue<<16},{name:"maxValue_"+
a,type:"FIXED",value:b.maxValue<<16},{name:"flags_"+a,type:"USHORT",value:0},{name:"nameID_"+a,type:"USHORT",value:c}]}function $c(a,b,c){var d={};a=new W.Parser(a,b);d.tag=a.parseTag();d.minValue=a.parseFixed();d.defaultValue=a.parseFixed();d.maxValue=a.parseFixed();a.skip("uShort",1);d.name=c[a.parseUShort()]||{};return d}function ad(a,b,c,d){d=zc(b.name,d);d=[{name:"nameID_"+a,type:"USHORT",value:d},{name:"flags_"+a,type:"USHORT",value:0}];for(var e=0;e<c.length;++e){var f=c[e].tag;d.push({name:"axis_"+
a+" "+f,type:"FIXED",value:b.coordinates[f]<<16})}return d}function cd(a,b,c,d){var e={};a=new W.Parser(a,b);e.name=d[a.parseUShort()]||{};a.skip("uShort",1);e.coordinates={};for(d=0;d<c.length;++d)e.coordinates[c[d].tag]=a.parseFixed();return e}function lc(a,b){require("fs").readFile(a,function(a,c){if(a)return b(a.message);b(null,Zb(c))})}function dd(a,b){var c=new XMLHttpRequest;c.open("get",a,!0);c.responseType="arraybuffer";c.onload=function(){return c.response?b(null,c.response):b("Font could not be loaded: "+
c.statusText)};c.onerror=function(){b("Font could not be loaded")};c.send()}function Ec(a,b){for(var c=[],d=12,e=0;e<b;e+=1){var f=W.getTag(a,d),g=W.getULong(a,d+4),h=W.getULong(a,d+8),u=W.getULong(a,d+12);c.push({tag:f,checksum:g,offset:h,length:u,compression:!1});d+=16}return c}function La(a,b){if("WOFF"===b.compression){var d=new Uint8Array(a.buffer,b.offset+2,b.compressedLength-2),u=new Uint8Array(b.length);d=new c(d,u);do{var k=d;k.bitcount--||(k.tag=k.source[k.sourceIndex++],k.bitcount=7);var C=
k.tag&1;k.tag>>>=1;k=C;C=f(d,2,0);switch(C){case 0:for(C=d;8<C.bitcount;)C.sourceIndex--,C.bitcount-=8;var l=C.source[C.sourceIndex+1];l=256*l+C.source[C.sourceIndex];var m=C.source[C.sourceIndex+3];m=256*m+C.source[C.sourceIndex+2];if(l!==(~m&65535))C=-3;else{C.sourceIndex+=4;for(m=l;m;--m)C.dest[C.destLen++]=C.source[C.sourceIndex++];C=C.bitcount=0}break;case 1:C=h(d,Fc,Gc);break;case 2:var n;l=d;var p=d.ltree,r=d.dtree;m=f(l,5,257);C=f(l,5,1);var q=f(l,4,4);for(n=0;19>n;++n)sb[n]=0;for(n=0;n<q;++n){var t=
f(l,3,0);sb[bd[n]]=t}e(Cc,sb,0,19);for(n=0;n<m+C;)switch(q=g(l,Cc),q){case 16:t=sb[n-1];for(q=f(l,2,3);q;--q)sb[n++]=t;break;case 17:for(q=f(l,3,3);q;--q)sb[n++]=0;break;case 18:for(q=f(l,7,11);q;--q)sb[n++]=0;break;default:sb[n++]=q}e(p,sb,0,m);e(r,sb,m,C);C=h(d,d.ltree,d.dtree);break;default:C=-3}if(0!==C)throw Error("Data error");}while(!k);d.destLen<d.dest.length&&("function"===typeof d.dest.slice?d.dest.slice(0,d.destLen):d.dest.subarray(0,d.destLen));if(u.byteLength!==b.length)throw Error("Decompression error: "+
b.tag+" decompressed length doesn't match recorded length");return{data:new DataView(u.buffer,0),offset:0}}return{data:a,offset:b.offset}}function nc(a){var b=new na({empty:!0});a=new DataView(a,0);var c=W.getTag(a,0);if(c===String.fromCharCode(0,1,0,0)||"true"===c||"typ1"===c){b.outlinesFormat="truetype";c=W.getUShort(a,4);var d=Ec(a,c)}else if("OTTO"===c)b.outlinesFormat="cff",c=W.getUShort(a,4),d=Ec(a,c);else if("wOFF"===c){d=W.getTag(a,4);if(d===String.fromCharCode(0,1,0,0))b.outlinesFormat="truetype";
else if("OTTO"===d)b.outlinesFormat="cff";else throw Error("Unsupported OpenType flavor "+c);d=c=W.getUShort(a,12);for(var e=[],f=44,g=0;g<d;g+=1){var h=W.getTag(a,f),u=W.getULong(a,f+4),k=W.getULong(a,f+8),l=W.getULong(a,f+12);e.push({tag:h,offset:u,compression:k<l?"WOFF":!1,compressedLength:k,length:l});f+=20}d=e}else throw Error("Unsupported OpenType signature "+c);for(e=0;e<c;e+=1)switch(f=d[e],f.tag){case "cmap":g=La(a,f);b.tables.cmap=Uc.parse(g.data,g.offset);b.encoding=new wb(b.tables.cmap);
break;case "cvt ":g=La(a,f);g=new W.Parser(g.data,g.offset);b.tables.cvt=g.parseShortList(f.length/2);break;case "fvar":var m=f;break;case "fpgm":g=La(a,f);g=new W.Parser(g.data,g.offset);b.tables.fpgm=g.parseByteList(f.length);break;case "head":g=La(a,f);b.tables.head=Ca.parse(g.data,g.offset);b.unitsPerEm=b.tables.head.unitsPerEm;var n=b.tables.head.indexToLocFormat;break;case "hhea":g=La(a,f);b.tables.hhea=Ic.parse(g.data,g.offset);b.ascender=b.tables.hhea.ascender;b.descender=b.tables.hhea.descender;
b.numberOfHMetrics=b.tables.hhea.numberOfHMetrics;break;case "hmtx":var p=f;break;case "ltag":g=La(a,f);var q=Jc.parse(g.data,g.offset);break;case "maxp":g=La(a,f);b.tables.maxp=ha.parse(g.data,g.offset);b.numGlyphs=b.tables.maxp.numGlyphs;break;case "name":var r=f;break;case "OS/2":g=La(a,f);b.tables.os2=za.parse(g.data,g.offset);break;case "post":g=La(a,f);b.tables.post=Sa.parse(g.data,g.offset);b.glyphNames=new Da(b.tables.post);break;case "prep":g=La(a,f);g=new W.Parser(g.data,g.offset);b.tables.prep=
g.parseByteList(f.length);break;case "glyf":var t=f;break;case "loca":var v=f;break;case "CFF ":var x=f;break;case "kern":var y=f;break;case "GPOS":var w=f;break;case "GSUB":var z=f;break;case "meta":var A=f}r=La(a,r);b.tables.name=Sc.parse(r.data,r.offset,q);b.names=b.tables.name;if(t&&v)n=0===n,v=La(a,v),v=qd.parse(v.data,v.offset,b.numGlyphs,n),t=La(a,t),b.glyphs=Tc.parse(t.data,t.offset,v,b);else if(x)t=La(a,x),D.parse(t.data,t.offset,b);else throw Error("Font doesn't contain TrueType or CFF outlines.");
p=La(a,p);Pc.parse(p.data,p.offset,b.numberOfHMetrics,b.numGlyphs,b.glyphs);t=b.tables.cmap.glyphIndexMap;v=Object.keys(t);for(n=0;n<v.length;n+=1)q=v[n],p=b.glyphs.get(t[q]),p.addUnicode(parseInt(q));for(t=0;t<b.glyphs.length;t+=1)p=b.glyphs.get(t),b.cffEncoding?p.name=b.isCIDFont?"gid"+t:b.cffEncoding.charset[t]:b.glyphNames.names&&(p.name=b.glyphNames.glyphIndexToName(t));y?(y=La(a,y),b.kerningPairs=xd.parse(y.data,y.offset)):b.kerningPairs={};w&&(w=La(a,w),b.tables.gpos=wd.parse(w.data,w.offset),
b.position.init());z&&(z=La(a,z),b.tables.gsub=Lc.parse(z.data,z.offset));m&&(m=La(a,m),b.tables.fvar=sd.parse(m.data,m.offset,b.names));A&&(A=La(a,A),b.tables.meta=vb.parse(A.data,A.offset),b.metas=b.tables.meta);return b}String.prototype.codePointAt||function(){var a=function(){try{var a={},b=Object.defineProperty,c=b(a,a,a)&&b}catch(Aa){}return c}(),b=function(a){if(null==this)throw TypeError();var b=String(this),c=b.length,d=a?Number(a):0;d!=d&&(d=0);if(!(0>d||d>=c))return a=b.charCodeAt(d),55296<=
a&&56319>=a&&c>d+1&&(b=b.charCodeAt(d+1),56320<=b&&57343>=b)?1024*(a-55296)+b-56320+65536:a};a?a(String.prototype,"codePointAt",{value:b,configurable:!0,writable:!0}):String.prototype.codePointAt=b}();var Fc=new b,Gc=new b,oc=new Uint8Array(30),pc=new Uint16Array(30),Ac=new Uint8Array(30),Bc=new Uint16Array(30),bd=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Cc=new b,sb=new Uint8Array(320),Dc=new Uint16Array(16);(function(a,b){var c;for(c=0;7>c;++c)a.table[c]=0;a.table[7]=24;a.table[8]=
152;a.table[9]=112;for(c=0;24>c;++c)a.trans[c]=256+c;for(c=0;144>c;++c)a.trans[24+c]=c;for(c=0;8>c;++c)a.trans[168+c]=280+c;for(c=0;112>c;++c)a.trans[176+c]=144+c;for(c=0;5>c;++c)b.table[c]=0;b.table[5]=32;for(c=0;32>c;++c)b.trans[c]=c})(Fc,Gc);d(oc,pc,4,3);d(Ac,Bc,2,1);oc[28]=0;pc[28]=258;l.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};l.prototype.addPoint=function(a,b){if("number"===typeof a){if(isNaN(this.x1)||isNaN(this.x2))this.x2=this.x1=
a;a<this.x1&&(this.x1=a);a>this.x2&&(this.x2=a)}if("number"===typeof b){if(isNaN(this.y1)||isNaN(this.y2))this.y2=this.y1=b;b<this.y1&&(this.y1=b);b>this.y2&&(this.y2=b)}};l.prototype.addX=function(a){this.addPoint(a,null)};l.prototype.addY=function(a){this.addPoint(null,a)};l.prototype.addBezier=function(a,b,c,d,e,f,g,h){var u=[a,b];c=[c,d];e=[e,f];f=[g,h];this.addPoint(a,b);this.addPoint(g,h);for(a=0;1>=a;a++)b=6*u[a]-12*c[a]+6*e[a],g=-3*u[a]+9*c[a]-9*e[a]+3*f[a],h=3*c[a]-3*u[a],0===g?0!==b&&(b=
-h/b,0<b&&1>b&&(0===a&&this.addX(k(u[a],c[a],e[a],f[a],b)),1===a&&this.addY(k(u[a],c[a],e[a],f[a],b)))):(h=Math.pow(b,2)-4*h*g,0>h||(d=(-b+Math.sqrt(h))/(2*g),0<d&&1>d&&(0===a&&this.addX(k(u[a],c[a],e[a],f[a],d)),1===a&&this.addY(k(u[a],c[a],e[a],f[a],d))),b=(-b-Math.sqrt(h))/(2*g),0<b&&1>b&&(0===a&&this.addX(k(u[a],c[a],e[a],f[a],b)),1===a&&this.addY(k(u[a],c[a],e[a],f[a],b)))))};l.prototype.addQuad=function(a,b,c,d,e,f){c=a+2/3*(c-a);d=b+2/3*(d-b);this.addBezier(a,b,c,d,c+1/3*(e-a),d+1/3*(f-b),
e,f)};n.prototype.moveTo=function(a,b){this.commands.push({type:"M",x:a,y:b})};n.prototype.lineTo=function(a,b){this.commands.push({type:"L",x:a,y:b})};n.prototype.curveTo=n.prototype.bezierCurveTo=function(a,b,c,d,e,f){this.commands.push({type:"C",x1:a,y1:b,x2:c,y2:d,x:e,y:f})};n.prototype.quadTo=n.prototype.quadraticCurveTo=function(a,b,c,d){this.commands.push({type:"Q",x1:a,y1:b,x:c,y:d})};n.prototype.close=n.prototype.closePath=function(){this.commands.push({type:"Z"})};n.prototype.extend=function(a){if(a.commands)a=
a.commands;else if(a instanceof l){this.moveTo(a.x1,a.y1);this.lineTo(a.x2,a.y1);this.lineTo(a.x2,a.y2);this.lineTo(a.x1,a.y2);this.close();return}Array.prototype.push.apply(this.commands,a)};n.prototype.getBoundingBox=function(){for(var a=new l,b=0,c=0,d=0,e=0,f=0;f<this.commands.length;f++){var g=this.commands[f];switch(g.type){case "M":a.addPoint(g.x,g.y);b=d=g.x;c=e=g.y;break;case "L":a.addPoint(g.x,g.y);d=g.x;e=g.y;break;case "Q":a.addQuad(d,e,g.x1,g.y1,g.x,g.y);d=g.x;e=g.y;break;case "C":a.addBezier(d,
e,g.x1,g.y1,g.x2,g.y2,g.x,g.y);d=g.x;e=g.y;break;case "Z":d=b;e=c;break;default:throw Error("Unexpected path command "+g.type);}}a.isEmpty()&&a.addPoint(0,0);return a};n.prototype.draw=function(a){a.beginPath();for(var b=0;b<this.commands.length;b+=1){var c=this.commands[b];"M"===c.type?a.moveTo(c.x,c.y):"L"===c.type?a.lineTo(c.x,c.y):"C"===c.type?a.bezierCurveTo(c.x1,c.y1,c.x2,c.y2,c.x,c.y):"Q"===c.type?a.quadraticCurveTo(c.x1,c.y1,c.x,c.y):"Z"===c.type&&a.closePath()}this.fill&&(a.fillStyle=this.fill,
a.fill());this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=this.strokeWidth,a.stroke())};n.prototype.toPathData=function(a){function b(){for(var b=arguments,c="",d=0;d<arguments.length;d+=1){var e=b[d];0<=e&&0<d&&(c+=" ");e=Math.round(e)===e?""+Math.round(e):e.toFixed(a);c+=e}return c}a=void 0!==a?a:2;for(var c="",d=0;d<this.commands.length;d+=1){var e=this.commands[d];"M"===e.type?c+="M"+b(e.x,e.y):"L"===e.type?c+="L"+b(e.x,e.y):"C"===e.type?c+="C"+b(e.x1,e.y1,e.x2,e.y2,e.x,e.y):"Q"===e.type?
c+="Q"+b(e.x1,e.y1,e.x,e.y):"Z"===e.type&&(c+="Z")}return c};n.prototype.toSVG=function(a){a='<path d="'+this.toPathData(a);a+='"';this.fill&&"black"!==this.fill&&(a=null===this.fill?a+' fill="none"':a+(' fill="'+this.fill+'"'));this.stroke&&(a+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"');return a+"/>"};n.prototype.toDOMElement=function(a){a=this.toPathData(a);var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d",a);return b};var Y={fail:m,argument:y,
assert:y},Lb={},N={},ca={};N.BYTE=function(a){Y.argument(0<=a&&255>=a,"Byte value should be between 0 and 255.");return[a]};ca.BYTE=p(1);N.CHAR=function(a){return[a.charCodeAt(0)]};ca.CHAR=p(1);N.CHARARRAY=function(a){for(var b=[],c=0;c<a.length;c+=1)b[c]=a.charCodeAt(c);return b};ca.CHARARRAY=function(a){return a.length};N.USHORT=function(a){return[a>>8&255,a&255]};ca.USHORT=p(2);N.SHORT=function(a){32768<=a&&(a=-(65536-a));return[a>>8&255,a&255]};ca.SHORT=p(2);N.UINT24=function(a){return[a>>16&
255,a>>8&255,a&255]};ca.UINT24=p(3);N.ULONG=function(a){return[a>>24&255,a>>16&255,a>>8&255,a&255]};ca.ULONG=p(4);N.LONG=function(a){2147483648<=a&&(a=-(4294967296-a));return[a>>24&255,a>>16&255,a>>8&255,a&255]};ca.LONG=p(4);N.FIXED=N.ULONG;ca.FIXED=ca.ULONG;N.FWORD=N.SHORT;ca.FWORD=ca.SHORT;N.UFWORD=N.USHORT;ca.UFWORD=ca.USHORT;N.LONGDATETIME=function(a){return[0,0,0,0,a>>24&255,a>>16&255,a>>8&255,a&255]};ca.LONGDATETIME=p(8);N.TAG=function(a){Y.argument(4===a.length,"Tag should be exactly 4 ASCII characters.");
return[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]};ca.TAG=p(4);N.Card8=N.BYTE;ca.Card8=ca.BYTE;N.Card16=N.USHORT;ca.Card16=ca.USHORT;N.OffSize=N.BYTE;ca.OffSize=ca.BYTE;N.SID=N.USHORT;ca.SID=ca.USHORT;N.NUMBER=function(a){return-107<=a&&107>=a?[a+139]:108<=a&&1131>=a?(a-=108,[(a>>8)+247,a&255]):-1131<=a&&-108>=a?(a=-a-108,[(a>>8)+251,a&255]):-32768<=a&&32767>=a?N.NUMBER16(a):N.NUMBER32(a)};ca.NUMBER=function(a){return N.NUMBER(a).length};N.NUMBER16=function(a){return[28,a>>8&
255,a&255]};ca.NUMBER16=p(3);N.NUMBER32=function(a){return[29,a>>24&255,a>>16&255,a>>8&255,a&255]};ca.NUMBER32=p(5);N.REAL=function(a){var b=a.toString(),c=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(b);c&&(b=parseFloat("1e"+((c[2]?+c[2]:0)+c[1].length)),b=(Math.round(a*b)/b).toString());a="";c=0;for(var d=b.length;c<d;c+=1){var e=b[c];a="e"===e?a+("-"===b[++c]?"c":"b"):"."===e?a+"a":"-"===e?a+"e":a+e}a+=a.length&1?"f":"ff";b=[30];c=0;for(d=a.length;c<d;c+=2)b.push(parseInt(a.substr(c,2),
16));return b};ca.REAL=function(a){return N.REAL(a).length};N.NAME=N.CHARARRAY;ca.NAME=ca.CHARARRAY;N.STRING=N.CHARARRAY;ca.STRING=ca.CHARARRAY;Lb.UTF8=function(a,b,c){for(var d=[],e=0;e<c;e++,b+=1)d[e]=a.getUint8(b);return String.fromCharCode.apply(null,d)};Lb.UTF16=function(a,b,c){var d=[];c/=2;for(var e=0;e<c;e++,b+=2)d[e]=a.getUint16(b);return String.fromCharCode.apply(null,d)};N.UTF16=function(a){for(var b=[],c=0;c<a.length;c+=1){var d=a.charCodeAt(c);b[b.length]=d>>8&255;b[b.length]=d&255}return b};
ca.UTF16=function(a){return 2*a.length};var mc={"x-mac-croatian":"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u2020\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u0160\u2122\u00b4\u00a8\u2260\u017d\u00d8\u221e\u00b1\u2264\u2265\u2206\u00b5\u2202\u2211\u220f\u0161\u222b\u00aa\u00ba\u03a9\u017e\u00f8\u00bf\u00a1\u00ac\u221a\u0192\u2248\u0106\u00ab\u010c\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u0110\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\uf8ff\u00a9\u2044\u20ac\u2039\u203a\u00c6\u00bb\u2013\u00b7\u201a\u201e\u2030\u00c2\u0107\u00c1\u010d\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\u0111\u00d2\u00da\u00db\u00d9\u0131\u02c6\u02dc\u00af\u03c0\u00cb\u02da\u00b8\u00ca\u00e6\u02c7",
"x-mac-cyrillic":"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042a\u042b\u042c\u042d\u042e\u042f\u2020\u00b0\u0490\u00a3\u00a7\u2022\u00b6\u0406\u00ae\u00a9\u2122\u0402\u0452\u2260\u0403\u0453\u221e\u00b1\u2264\u2265\u0456\u00b5\u0491\u0408\u0404\u0454\u0407\u0457\u0409\u0459\u040a\u045a\u0458\u0405\u00ac\u221a\u0192\u2248\u2206\u00ab\u00bb\u2026\u00a0\u040b\u045b\u040c\u045c\u0455\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u201e\u040e\u045e\u040f\u045f\u2116\u0401\u0451\u044f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e",
"x-mac-gaelic":"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u2020\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u00b4\u00a8\u2260\u00c6\u00d8\u1e02\u00b1\u2264\u2265\u1e03\u010a\u010b\u1e0a\u1e0b\u1e1e\u1e1f\u0120\u0121\u1e40\u00e6\u00f8\u1e41\u1e56\u1e57\u027c\u0192\u017f\u1e60\u00ab\u00bb\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\u1e61\u1e9b\u00ff\u0178\u1e6a\u20ac\u2039\u203a\u0176\u0177\u1e6b\u00b7\u1ef2\u1ef3\u204a\u00c2\u00ca\u00c1\u00cb\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\u2663\u00d2\u00da\u00db\u00d9\u0131\u00dd\u00fd\u0174\u0175\u1e84\u1e85\u1e80\u1e81\u1e82\u1e83",
"x-mac-greek":"\u00c4\u00b9\u00b2\u00c9\u00b3\u00d6\u00dc\u0385\u00e0\u00e2\u00e4\u0384\u00a8\u00e7\u00e9\u00e8\u00ea\u00eb\u00a3\u2122\u00ee\u00ef\u2022\u00bd\u2030\u00f4\u00f6\u00a6\u20ac\u00f9\u00fb\u00fc\u2020\u0393\u0394\u0398\u039b\u039e\u03a0\u00df\u00ae\u00a9\u03a3\u03aa\u00a7\u2260\u00b0\u00b7\u0391\u00b1\u2264\u2265\u00a5\u0392\u0395\u0396\u0397\u0399\u039a\u039c\u03a6\u03ab\u03a8\u03a9\u03ac\u039d\u00ac\u039f\u03a1\u2248\u03a4\u00ab\u00bb\u2026\u00a0\u03a5\u03a7\u0386\u0388\u0153\u2013\u2015\u201c\u201d\u2018\u2019\u00f7\u0389\u038a\u038c\u038e\u03ad\u03ae\u03af\u03cc\u038f\u03cd\u03b1\u03b2\u03c8\u03b4\u03b5\u03c6\u03b3\u03b7\u03b9\u03be\u03ba\u03bb\u03bc\u03bd\u03bf\u03c0\u03ce\u03c1\u03c3\u03c4\u03b8\u03c9\u03c2\u03c7\u03c5\u03b6\u03ca\u03cb\u0390\u03b0\u00ad",
"x-mac-icelandic":"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u00dd\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u00b4\u00a8\u2260\u00c6\u00d8\u221e\u00b1\u2264\u2265\u00a5\u00b5\u2202\u2211\u220f\u03c0\u222b\u00aa\u00ba\u03a9\u00e6\u00f8\u00bf\u00a1\u00ac\u221a\u0192\u2248\u2206\u00ab\u00bb\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\u00ff\u0178\u2044\u20ac\u00d0\u00f0\u00de\u00fe\u00fd\u00b7\u201a\u201e\u2030\u00c2\u00ca\u00c1\u00cb\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\uf8ff\u00d2\u00da\u00db\u00d9\u0131\u02c6\u02dc\u00af\u02d8\u02d9\u02da\u00b8\u02dd\u02db\u02c7",
"x-mac-inuit":"\u1403\u1404\u1405\u1406\u140a\u140b\u1431\u1432\u1433\u1434\u1438\u1439\u1449\u144e\u144f\u1450\u1451\u1455\u1456\u1466\u146d\u146e\u146f\u1470\u1472\u1473\u1483\u148b\u148c\u148d\u148e\u1490\u1491\u00b0\u14a1\u14a5\u14a6\u2022\u00b6\u14a7\u00ae\u00a9\u2122\u14a8\u14aa\u14ab\u14bb\u14c2\u14c3\u14c4\u14c5\u14c7\u14c8\u14d0\u14ef\u14f0\u14f1\u14f2\u14f4\u14f5\u1505\u14d5\u14d6\u14d7\u14d8\u14da\u14db\u14ea\u1528\u1529\u152a\u152b\u152d\u2026\u00a0\u152e\u153e\u1555\u1556\u1557\u2013\u2014\u201c\u201d\u2018\u2019\u1558\u1559\u155a\u155d\u1546\u1547\u1548\u1549\u154b\u154c\u1550\u157f\u1580\u1581\u1582\u1583\u1584\u1585\u158f\u1590\u1591\u1592\u1593\u1594\u1595\u1671\u1672\u1673\u1674\u1675\u1676\u1596\u15a0\u15a1\u15a2\u15a3\u15a4\u15a5\u15a6\u157c\u0141\u0142",
"x-mac-ce":"\u00c4\u0100\u0101\u00c9\u0104\u00d6\u00dc\u00e1\u0105\u010c\u00e4\u010d\u0106\u0107\u00e9\u0179\u017a\u010e\u00ed\u010f\u0112\u0113\u0116\u00f3\u0117\u00f4\u00f6\u00f5\u00fa\u011a\u011b\u00fc\u2020\u00b0\u0118\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u0119\u00a8\u2260\u0123\u012e\u012f\u012a\u2264\u2265\u012b\u0136\u2202\u2211\u0142\u013b\u013c\u013d\u013e\u0139\u013a\u0145\u0146\u0143\u00ac\u221a\u0144\u0147\u2206\u00ab\u00bb\u2026\u00a0\u0148\u0150\u00d5\u0151\u014c\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\u014d\u0154\u0155\u0158\u2039\u203a\u0159\u0156\u0157\u0160\u201a\u201e\u0161\u015a\u015b\u00c1\u0164\u0165\u00cd\u017d\u017e\u016a\u00d3\u00d4\u016b\u016e\u00da\u016f\u0170\u0171\u0172\u0173\u00dd\u00fd\u0137\u017b\u0141\u017c\u0122\u02c7",
macintosh:"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u2020\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u00b4\u00a8\u2260\u00c6\u00d8\u221e\u00b1\u2264\u2265\u00a5\u00b5\u2202\u2211\u220f\u03c0\u222b\u00aa\u00ba\u03a9\u00e6\u00f8\u00bf\u00a1\u00ac\u221a\u0192\u2248\u2206\u00ab\u00bb\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\u00ff\u0178\u2044\u20ac\u2039\u203a\ufb01\ufb02\u2021\u00b7\u201a\u201e\u2030\u00c2\u00ca\u00c1\u00cb\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\uf8ff\u00d2\u00da\u00db\u00d9\u0131\u02c6\u02dc\u00af\u02d8\u02d9\u02da\u00b8\u02dd\u02db\u02c7",
"x-mac-romanian":"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u2020\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u00b4\u00a8\u2260\u0102\u0218\u221e\u00b1\u2264\u2265\u00a5\u00b5\u2202\u2211\u220f\u03c0\u222b\u00aa\u00ba\u03a9\u0103\u0219\u00bf\u00a1\u00ac\u221a\u0192\u2248\u2206\u00ab\u00bb\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\u00ff\u0178\u2044\u20ac\u2039\u203a\u021a\u021b\u2021\u00b7\u201a\u201e\u2030\u00c2\u00ca\u00c1\u00cb\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\uf8ff\u00d2\u00da\u00db\u00d9\u0131\u02c6\u02dc\u00af\u02d8\u02d9\u02da\u00b8\u02dd\u02db\u02c7",
"x-mac-turkish":"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u2020\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u00b4\u00a8\u2260\u00c6\u00d8\u221e\u00b1\u2264\u2265\u00a5\u00b5\u2202\u2211\u220f\u03c0\u222b\u00aa\u00ba\u03a9\u00e6\u00f8\u00bf\u00a1\u00ac\u221a\u0192\u2248\u2206\u00ab\u00bb\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\u00ff\u0178\u011e\u011f\u0130\u0131\u015e\u015f\u2021\u00b7\u201a\u201e\u2030\u00c2\u00ca\u00c1\u00cb\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\uf8ff\u00d2\u00da\u00db\u00d9\uf8a0\u02c6\u02dc\u00af\u02d8\u02d9\u02da\u00b8\u02dd\u02db\u02c7"};
Lb.MACSTRING=function(a,b,c,d){d=mc[d];if(void 0!==d){for(var e="",f=0;f<c;f++){var g=a.getUint8(b+f);e=127>=g?e+String.fromCharCode(g):e+d[g&127]}return e}};var gc="function"===typeof WeakMap&&new WeakMap,hc;N.MACSTRING=function(a,b){a:{if(!hc)for(c in hc={},mc)hc[c]=new String(c);var c=hc[b];if(void 0!==c){if(gc){var d=gc.get(c);if(void 0!==d){c=d;break a}}d=mc[b];if(void 0!==d){for(var e={},f=0;f<d.length;f++)e[d.charCodeAt(f)]=f+128;gc&&gc.set(c,e);c=e;break a}}c=void 0}if(void 0!==c){d=[];for(e=
0;e<a.length;e++){f=a.charCodeAt(e);if(128<=f&&(f=c[f],void 0===f))return;d[e]=f}return d}};ca.MACSTRING=function(a,b){var c=N.MACSTRING(a,b);return void 0!==c?c.length:0};N.VARDELTAS=function(a){for(var b=0,c=[];b<a.length;){var d=a[b];if(0===d){d=b;b=0;for(var e=a.length;d<e&&64>b&&0===a[d];)++d,++b;c.push(128|b-1);b=d}else if(-128<=d&&127>=d){d=a;var f=b;b=c;var g=0,h=d.length;for(e=f;e<h&&64>g;){var u=d[e];if(!(-128<=u&&127>=u))break;if(0===u&&e+1<h&&0===d[e+1])break;++e;++g}for(b.push(g-1);f<
e;++f)b.push(d[f]+256&255);b=e}else{d=a;f=b;b=c;g=0;h=d.length;for(e=f;e<h&&64>g;){u=d[e];if(0===u)break;if(u=-128<=u&&127>=u&&e+1<h)u=d[e+1],u=-128<=u&&127>=u;if(u)break;++e;++g}for(b.push(64|g-1);f<e;++f)g=d[f],b.push(g+65536>>8&255,g+256&255);b=e}}return c};N.INDEX=function(a){for(var b=1,c=[b],d=[],e=0;e<a.length;e+=1){var f=N.OBJECT(a[e]);Array.prototype.push.apply(d,f);b+=f.length;c.push(b)}if(0===d.length)return[0,0];e=[];b=1+Math.floor(Math.log(b)/Math.log(2))/8|0;f=[void 0,N.BYTE,N.USHORT,
N.UINT24,N.ULONG][b];for(var g=0;g<c.length;g+=1){var h=f(c[g]);Array.prototype.push.apply(e,h)}return Array.prototype.concat(N.Card16(a.length),N.OffSize(b),e,d)};ca.INDEX=function(a){return N.INDEX(a).length};N.DICT=function(a){for(var b=[],c=Object.keys(a),d=c.length,e=0;e<d;e+=1){var f=parseInt(c[e],0),g=a[f];b=b.concat(N.OPERAND(g.value,g.type));b=b.concat(N.OPERATOR(f))}return b};ca.DICT=function(a){return N.DICT(a).length};N.OPERATOR=function(a){return 1200>a?[a]:[12,a-1200]};N.OPERAND=function(a,
b){var c=[];if(Array.isArray(b))for(var d=0;d<b.length;d+=1)Y.argument(a.length===b.length,"Not enough arguments given for type"+b),c=c.concat(N.OPERAND(a[d],b[d]));else if("SID"===b)c=c.concat(N.NUMBER(a));else if("offset"===b)c=c.concat(N.NUMBER32(a));else if("number"===b)c=c.concat(N.NUMBER(a));else if("real"===b)c=c.concat(N.REAL(a));else throw Error("Unknown operand type "+b);return c};N.OP=N.BYTE;ca.OP=ca.BYTE;var ic="function"===typeof WeakMap&&new WeakMap;N.CHARSTRING=function(a){if(ic){var b=
ic.get(a);if(void 0!==b)return b}b=[];for(var c=a.length,d=0;d<c;d+=1){var e=a[d];b=b.concat(N[e.type](e.value))}ic&&ic.set(a,b);return b};ca.CHARSTRING=function(a){return N.CHARSTRING(a).length};N.OBJECT=function(a){var b=N[a.type];Y.argument(void 0!==b,"No encoding function for type "+a.type);return b(a.value)};ca.OBJECT=function(a){var b=ca[a.type];Y.argument(void 0!==b,"No sizeOf function for type "+a.type);return b(a.value)};N.TABLE=function(a){for(var b=[],c=a.fields.length,d=[],e=[],f=0;f<
c;f+=1){var g=a.fields[f],h=N[g.type];Y.argument(void 0!==h,"No encoding function for field type "+g.type+" ("+g.name+")");var u=a[g.name];void 0===u&&(u=g.value);h=h(u);"TABLE"===g.type?(e.push(b.length),b=b.concat([0,0]),d.push(h)):b=b.concat(h)}for(c=0;c<d.length;c+=1)f=e[c],g=b.length,Y.argument(65536>g,"Table "+a.tableName+" too big."),b[f]=g>>8,b[f+1]=g&255,b=b.concat(d[c]);return b};ca.TABLE=function(a){for(var b=0,c=a.fields.length,d=0;d<c;d+=1){var e=a.fields[d],f=ca[e.type];Y.argument(void 0!==
f,"No sizeOf function for field type "+e.type+" ("+e.name+")");var g=a[e.name];void 0===g&&(g=e.value);b+=f(g);"TABLE"===e.type&&(b+=2)}return b};N.RECORD=N.TABLE;ca.RECORD=ca.TABLE;N.LITERAL=function(a){return a};ca.LITERAL=function(a){return a.length};K.prototype.encode=function(){return N.TABLE(this)};K.prototype.sizeOf=function(){return ca.TABLE(this)};qa.prototype=Object.create(K.prototype);qa.prototype.constructor=qa;Ba.prototype=Object.create(K.prototype);Ba.prototype.constructor=Ba;Q.prototype=
Object.create(K.prototype);Q.prototype.constructor=Q;Ma.prototype=Object.create(K.prototype);Ma.prototype.constructor=Ma;var Z={Table:K,Record:K,Coverage:qa,ScriptList:Ba,FeatureList:Q,LookupList:Ma,ushortList:E,tableList:Ia,recordList:P},yd={"byte":1,uShort:2,"short":2,uLong:4,fixed:4,longDateTime:8,tag:4};v.prototype.parseByte=function(){var a=this.data.getUint8(this.offset+this.relativeOffset);this.relativeOffset+=1;return a};v.prototype.parseChar=function(){var a=this.data.getInt8(this.offset+
this.relativeOffset);this.relativeOffset+=1;return a};v.prototype.parseCard8=v.prototype.parseByte;v.prototype.parseUShort=function(){var a=this.data.getUint16(this.offset+this.relativeOffset);this.relativeOffset+=2;return a};v.prototype.parseCard16=v.prototype.parseUShort;v.prototype.parseSID=v.prototype.parseUShort;v.prototype.parseOffset16=v.prototype.parseUShort;v.prototype.parseShort=function(){var a=this.data.getInt16(this.offset+this.relativeOffset);this.relativeOffset+=2;return a};v.prototype.parseF2Dot14=
function(){var a=this.data.getInt16(this.offset+this.relativeOffset)/16384;this.relativeOffset+=2;return a};v.prototype.parseULong=function(){var a=ab(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return a};v.prototype.parseOffset32=v.prototype.parseULong;v.prototype.parseFixed=function(){var a=ob(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return a};v.prototype.parseString=function(a){var b=this.data,c=this.offset+this.relativeOffset,d="";this.relativeOffset+=
a;for(var e=0;e<a;e++)d+=String.fromCharCode(b.getUint8(c+e));return d};v.prototype.parseTag=function(){return this.parseString(4)};v.prototype.parseLongDateTime=function(){var a=ab(this.data,this.offset+this.relativeOffset+4);this.relativeOffset+=8;return a-2082844800};v.prototype.parseVersion=function(a){var b=Ga(this.data,this.offset+this.relativeOffset),c=Ga(this.data,this.offset+this.relativeOffset+2);this.relativeOffset+=4;void 0===a&&(a=4096);return b+c/a/10};v.prototype.skip=function(a,b){void 0===
b&&(b=1);this.relativeOffset+=yd[a]*b};v.prototype.parseULongList=function(a){void 0===a&&(a=this.parseULong());for(var b=Array(a),c=this.data,d=this.offset+this.relativeOffset,e=0;e<a;e++)b[e]=c.getUint32(d),d+=4;this.relativeOffset+=4*a;return b};v.prototype.parseOffset16List=v.prototype.parseUShortList=function(a){void 0===a&&(a=this.parseUShort());for(var b=Array(a),c=this.data,d=this.offset+this.relativeOffset,e=0;e<a;e++)b[e]=c.getUint16(d),d+=2;this.relativeOffset+=2*a;return b};v.prototype.parseShortList=
function(a){for(var b=Array(a),c=this.data,d=this.offset+this.relativeOffset,e=0;e<a;e++)b[e]=c.getInt16(d),d+=2;this.relativeOffset+=2*a;return b};v.prototype.parseByteList=function(a){for(var b=Array(a),c=this.data,d=this.offset+this.relativeOffset,e=0;e<a;e++)b[e]=c.getUint8(d++);this.relativeOffset+=a;return b};v.prototype.parseList=function(a,b){b||(b=a,a=this.parseUShort());for(var c=Array(a),d=0;d<a;d++)c[d]=b.call(this);return c};v.prototype.parseList32=function(a,b){b||(b=a,a=this.parseULong());
for(var c=Array(a),d=0;d<a;d++)c[d]=b.call(this);return c};v.prototype.parseRecordList=function(a,b){b||(b=a,a=this.parseUShort());for(var c=Array(a),d=Object.keys(b),e=0;e<a;e++){for(var f={},g=0;g<d.length;g++){var h=d[g];f[h]=b[h].call(this)}c[e]=f}return c};v.prototype.parseRecordList32=function(a,b){b||(b=a,a=this.parseULong());for(var c=Array(a),d=Object.keys(b),e=0;e<a;e++){for(var f={},g=0;g<d.length;g++){var h=d[g];f[h]=b[h].call(this)}c[e]=f}return c};v.prototype.parseStruct=function(a){if("function"===
typeof a)return a.call(this);for(var b=Object.keys(a),c={},d=0;d<b.length;d++){var e=b[d];c[e]=a[e].call(this)}return c};v.prototype.parseValueRecord=function(a){void 0===a&&(a=this.parseUShort());if(0!==a){var b={};a&1&&(b.xPlacement=this.parseShort());a&2&&(b.yPlacement=this.parseShort());a&4&&(b.xAdvance=this.parseShort());a&8&&(b.yAdvance=this.parseShort());a&16&&(b.xPlaDevice=void 0,this.parseShort());a&32&&(b.yPlaDevice=void 0,this.parseShort());a&64&&(b.xAdvDevice=void 0,this.parseShort());
a&128&&(b.yAdvDevice=void 0,this.parseShort());return b}};v.prototype.parseValueRecordList=function(){for(var a=this.parseUShort(),b=this.parseUShort(),c=Array(b),d=0;d<b;d++)c[d]=this.parseValueRecord(a);return c};v.prototype.parsePointer=function(a){var b=this.parseOffset16();if(0<b)return(new v(this.data,this.offset+b)).parseStruct(a)};v.prototype.parsePointer32=function(a){var b=this.parseOffset32();if(0<b)return(new v(this.data,this.offset+b)).parseStruct(a)};v.prototype.parseListOfLists=function(a){for(var b=
this.parseOffset16List(),c=b.length,d=this.relativeOffset,e=Array(c),f=0;f<c;f++){var g=b[f];if(0===g)e[f]=void 0;else if(this.relativeOffset=g,a){for(var h=this.parseOffset16List(),u=Array(h.length),k=0;k<h.length;k++)this.relativeOffset=g+h[k],u[k]=a.call(this);e[f]=u}else e[f]=this.parseUShortList()}this.relativeOffset=d;return e};v.prototype.parseCoverage=function(){var a=this.offset+this.relativeOffset,b=this.parseUShort(),c=this.parseUShort();if(1===b)return{format:1,glyphs:this.parseUShortList(c)};
if(2===b){a=Array(c);for(b=0;b<c;b++)a[b]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:a}}throw Error("0x"+a.toString(16)+": Coverage format must be 1 or 2.");};v.prototype.parseClassDef=function(){var a=this.offset+this.relativeOffset,b=this.parseUShort();if(1===b)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===b)return{format:2,ranges:this.parseRecordList({start:v.uShort,end:v.uShort,classId:v.uShort})};throw Error("0x"+
a.toString(16)+": ClassDef format must be 1 or 2.");};v.list=function(a,b){return function(){return this.parseList(a,b)}};v.list32=function(a,b){return function(){return this.parseList32(a,b)}};v.recordList=function(a,b){return function(){return this.parseRecordList(a,b)}};v.recordList32=function(a,b){return function(){return this.parseRecordList32(a,b)}};v.pointer=function(a){return function(){return this.parsePointer(a)}};v.pointer32=function(a){return function(){return this.parsePointer32(a)}};
v.tag=v.prototype.parseTag;v["byte"]=v.prototype.parseByte;v.uShort=v.offset16=v.prototype.parseUShort;v.uShortList=v.prototype.parseUShortList;v.uLong=v.offset32=v.prototype.parseULong;v.uLongList=v.prototype.parseULongList;v.struct=v.prototype.parseStruct;v.coverage=v.prototype.parseCoverage;v.classDef=v.prototype.parseClassDef;var Xc={reserved:v.uShort,reqFeatureIndex:v.uShort,featureIndexes:v.uShortList};v.prototype.parseScriptList=function(){return this.parsePointer(v.recordList({tag:v.tag,script:v.pointer({defaultLangSys:v.pointer(Xc),
langSysRecords:v.recordList({tag:v.tag,langSys:v.pointer(Xc)})})}))||[]};v.prototype.parseFeatureList=function(){return this.parsePointer(v.recordList({tag:v.tag,feature:v.pointer({featureParams:v.offset16,lookupListIndexes:v.uShortList})}))||[]};v.prototype.parseLookupList=function(a){return this.parsePointer(v.list(v.pointer(function(){var b=this.parseUShort();Y.argument(1<=b&&9>=b,"GPOS/GSUB lookup type "+b+" unknown.");var c=this.parseUShort(),d=c&16;return{lookupType:b,lookupFlag:c,subtables:this.parseList(v.pointer(a[b])),
markFilteringSet:d?this.parseUShort():void 0}})))||[]};v.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var a=this.parseUShort(),b=this.parseUShort();Y.argument(1===a&&1>b,"GPOS/GSUB feature variations table unknown.");return this.parseRecordList32({conditionSetOffset:v.offset32,featureTableSubstitutionOffset:v.offset32})})||[]};var W={getByte:$a,getCard8:$a,getUShort:Ga,getCard16:Ga,getShort:function(a,b){return a.getInt16(b,!1)},getULong:ab,getFixed:ob,getTag:function(a,
b){for(var c="",d=b;d<b+4;d+=1)c+=String.fromCharCode(a.getInt8(d));return c},getOffset:function(a,b,c){for(var d=0,e=0;e<c;e+=1)d<<=8,d+=a.getUint8(b+e);return d},getBytes:function(a,b,c){for(var d=[];b<c;b+=1)d.push(a.getUint8(b));return d},bytesToString:function(a){for(var b="",c=0;c<a.length;c+=1)b+=String.fromCharCode(a[c]);return b},Parser:v},Uc={parse:function(a,b){var c={};c.version=W.getUShort(a,b);Y.argument(0===c.version,"cmap table version should be 0.");c.numTables=W.getUShort(a,b+2);
for(var d=-1,e=c.numTables-1;0<=e;--e){var f=W.getUShort(a,b+4+8*e),g=W.getUShort(a,b+4+8*e+2);if(3===f&&(0===g||1===g||10===g)||0===f&&(0===g||1===g||2===g||3===g||4===g)){d=W.getULong(a,b+4+8*e+4);break}}if(-1===d)throw Error("No valid cmap sub-tables found.");e=new W.Parser(a,b+d);c.format=e.parseUShort();if(12===c.format)for(e.parseUShort(),c.length=e.parseULong(),c.language=e.parseULong(),c.groupCount=d=e.parseULong(),c.glyphIndexMap={},f=0;f<d;f+=1){var h=e.parseULong();g=e.parseULong();for(var k=
e.parseULong();h<=g;h+=1)c.glyphIndexMap[h]=k,k++}else if(4===c.format)for(k=d,c.length=e.parseUShort(),c.language=e.parseUShort(),c.segCount=d=e.parseUShort()>>1,e.skip("uShort",3),c.glyphIndexMap={},e=new W.Parser(a,b+k+14),f=new W.Parser(a,b+k+16+2*d),g=new W.Parser(a,b+k+16+4*d),k=new W.Parser(a,b+k+16+6*d),h=0;h<d-1;h+=1)for(var u=e.parseUShort(),C=f.parseUShort(),l=g.parseShort(),m=k.parseUShort(),n=C;n<=u;n+=1){if(0!==m){var p=k.offset+k.relativeOffset-2;p+=m;p+=2*(n-C);p=W.getUShort(a,p);
0!==p&&(p=p+l&65535)}else p=n+l&65535;c.glyphIndexMap[n]=p}else throw Error("Only format 4 and 12 cmap tables are supported (found format "+c.format+").");return c},make:function(a){var b=!0,c;for(c=a.length-1;0<c;--c)if(65535<a.get(c).unicode){console.log("Adding CMAP format 12 (needed!)");b=!1;break}var d=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:b?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",
value:b?12:20}];b||(d=d.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}]));d=d.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);d=new Z.Table("cmap",
d);d.segments=[];for(c=0;c<a.length;c+=1){for(var e=a.get(c),f=0;f<e.unicodes.length;f+=1)Ua(d,e.unicodes[f],c);d.segments=d.segments.sort(function(a,b){return a.start-b.start})}d.segments.push({end:65535,start:65535,delta:1,offset:0});e=d.segments.length;f=0;var g=[],h=[],k=[],u=[],l=[];a=[];for(c=0;c<e;c+=1){var m=d.segments[c];65535>=m.end&&65535>=m.start?(g=g.concat({name:"end_"+c,type:"USHORT",value:m.end}),h=h.concat({name:"start_"+c,type:"USHORT",value:m.start}),k=k.concat({name:"idDelta_"+
c,type:"SHORT",value:m.delta}),u=u.concat({name:"idRangeOffset_"+c,type:"USHORT",value:m.offset}),void 0!==m.glyphId&&(l=l.concat({name:"glyph_"+c,type:"USHORT",value:m.glyphId}))):f+=1;b||void 0===m.glyphIndex||(a=a.concat({name:"cmap12Start_"+c,type:"ULONG",value:m.start}),a=a.concat({name:"cmap12End_"+c,type:"ULONG",value:m.end}),a=a.concat({name:"cmap12Glyph_"+c,type:"ULONG",value:m.glyphIndex}))}d.segCountX2=2*(e-f);d.searchRange=2*Math.pow(2,Math.floor(Math.log(e-f)/Math.log(2)));d.entrySelector=
Math.log(d.searchRange/2)/Math.log(2);d.rangeShift=d.segCountX2-d.searchRange;d.fields=d.fields.concat(g);d.fields.push({name:"reservedPad",type:"USHORT",value:0});d.fields=d.fields.concat(h);d.fields=d.fields.concat(k);d.fields=d.fields.concat(u);d.fields=d.fields.concat(l);d.cmap4Length=2*g.length+16+2*h.length+2*k.length+2*u.length+2*l.length;b||(b=16+4*a.length,d.cmap12Offset=20+d.cmap4Length,d.fields=d.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",
value:0},{name:"cmap12Length",type:"ULONG",value:b},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:a.length/3}]),d.fields=d.fields.concat(a));return d}},jc=".notdef;space;exclam;quotedbl;numbersign;dollar;percent;ampersand;quoteright;parenleft;parenright;asterisk;plus;comma;hyphen;period;slash;zero;one;two;three;four;five;six;seven;eight;nine;colon;semicolon;less;equal;greater;question;at;A;B;C;D;E;F;G;H;I;J;K;L;M;N;O;P;Q;R;S;T;U;V;W;X;Y;Z;bracketleft;backslash;bracketright;asciicircum;underscore;quoteleft;a;b;c;d;e;f;g;h;i;j;k;l;m;n;o;p;q;r;s;t;u;v;w;x;y;z;braceleft;bar;braceright;asciitilde;exclamdown;cent;sterling;fraction;yen;florin;section;currency;quotesingle;quotedblleft;guillemotleft;guilsinglleft;guilsinglright;fi;fl;endash;dagger;daggerdbl;periodcentered;paragraph;bullet;quotesinglbase;quotedblbase;quotedblright;guillemotright;ellipsis;perthousand;questiondown;grave;acute;circumflex;tilde;macron;breve;dotaccent;dieresis;ring;cedilla;hungarumlaut;ogonek;caron;emdash;AE;ordfeminine;Lslash;Oslash;OE;ordmasculine;ae;dotlessi;lslash;oslash;oe;germandbls;onesuperior;logicalnot;mu;trademark;Eth;onehalf;plusminus;Thorn;onequarter;divide;brokenbar;degree;thorn;threequarters;twosuperior;registered;minus;eth;multiply;threesuperior;copyright;Aacute;Acircumflex;Adieresis;Agrave;Aring;Atilde;Ccedilla;Eacute;Ecircumflex;Edieresis;Egrave;Iacute;Icircumflex;Idieresis;Igrave;Ntilde;Oacute;Ocircumflex;Odieresis;Ograve;Otilde;Scaron;Uacute;Ucircumflex;Udieresis;Ugrave;Yacute;Ydieresis;Zcaron;aacute;acircumflex;adieresis;agrave;aring;atilde;ccedilla;eacute;ecircumflex;edieresis;egrave;iacute;icircumflex;idieresis;igrave;ntilde;oacute;ocircumflex;odieresis;ograve;otilde;scaron;uacute;ucircumflex;udieresis;ugrave;yacute;ydieresis;zcaron;exclamsmall;Hungarumlautsmall;dollaroldstyle;dollarsuperior;ampersandsmall;Acutesmall;parenleftsuperior;parenrightsuperior;266 ff;onedotenleader;zerooldstyle;oneoldstyle;twooldstyle;threeoldstyle;fouroldstyle;fiveoldstyle;sixoldstyle;sevenoldstyle;eightoldstyle;nineoldstyle;commasuperior;threequartersemdash;periodsuperior;questionsmall;asuperior;bsuperior;centsuperior;dsuperior;esuperior;isuperior;lsuperior;msuperior;nsuperior;osuperior;rsuperior;ssuperior;tsuperior;ff;ffi;ffl;parenleftinferior;parenrightinferior;Circumflexsmall;hyphensuperior;Gravesmall;Asmall;Bsmall;Csmall;Dsmall;Esmall;Fsmall;Gsmall;Hsmall;Ismall;Jsmall;Ksmall;Lsmall;Msmall;Nsmall;Osmall;Psmall;Qsmall;Rsmall;Ssmall;Tsmall;Usmall;Vsmall;Wsmall;Xsmall;Ysmall;Zsmall;colonmonetary;onefitted;rupiah;Tildesmall;exclamdownsmall;centoldstyle;Lslashsmall;Scaronsmall;Zcaronsmall;Dieresissmall;Brevesmall;Caronsmall;Dotaccentsmall;Macronsmall;figuredash;hypheninferior;Ogoneksmall;Ringsmall;Cedillasmall;questiondownsmall;oneeighth;threeeighths;fiveeighths;seveneighths;onethird;twothirds;zerosuperior;foursuperior;fivesuperior;sixsuperior;sevensuperior;eightsuperior;ninesuperior;zeroinferior;oneinferior;twoinferior;threeinferior;fourinferior;fiveinferior;sixinferior;seveninferior;eightinferior;nineinferior;centinferior;dollarinferior;periodinferior;commainferior;Agravesmall;Aacutesmall;Acircumflexsmall;Atildesmall;Adieresissmall;Aringsmall;AEsmall;Ccedillasmall;Egravesmall;Eacutesmall;Ecircumflexsmall;Edieresissmall;Igravesmall;Iacutesmall;Icircumflexsmall;Idieresissmall;Ethsmall;Ntildesmall;Ogravesmall;Oacutesmall;Ocircumflexsmall;Otildesmall;Odieresissmall;OEsmall;Oslashsmall;Ugravesmall;Uacutesmall;Ucircumflexsmall;Udieresissmall;Yacutesmall;Thornsmall;Ydieresissmall;001.000;001.001;001.002;001.003;Black;Bold;Book;Light;Medium;Regular;Roman;Semibold".split(";"),
nd="                                space exclam quotedbl numbersign dollar percent ampersand quoteright parenleft parenright asterisk plus comma hyphen period slash zero one two three four five six seven eight nine colon semicolon less equal greater question at A B C D E F G H I J K L M N O P Q R S T U V W X Y Z bracketleft backslash bracketright asciicircum underscore quoteleft a b c d e f g h i j k l m n o p q r s t u v w x y z braceleft bar braceright asciitilde                                   exclamdown cent sterling fraction yen florin section currency quotesingle quotedblleft guillemotleft guilsinglleft guilsinglright fi fl  endash dagger daggerdbl periodcentered  paragraph bullet quotesinglbase quotedblbase quotedblright guillemotright ellipsis perthousand  questiondown  grave acute circumflex tilde macron breve dotaccent dieresis  ring cedilla  hungarumlaut ogonek caron emdash                 AE  ordfeminine     Lslash Oslash OE ordmasculine      ae    dotlessi   lslash oslash oe germandbls".split(" "),
ia="                                space exclamsmall Hungarumlautsmall  dollaroldstyle dollarsuperior ampersandsmall Acutesmall parenleftsuperior parenrightsuperior twodotenleader onedotenleader comma hyphen period fraction zerooldstyle oneoldstyle twooldstyle threeoldstyle fouroldstyle fiveoldstyle sixoldstyle sevenoldstyle eightoldstyle nineoldstyle colon semicolon commasuperior threequartersemdash periodsuperior questionsmall  asuperior bsuperior centsuperior dsuperior esuperior   isuperior   lsuperior msuperior nsuperior osuperior   rsuperior ssuperior tsuperior  ff fi fl ffi ffl parenleftinferior  parenrightinferior Circumflexsmall hyphensuperior Gravesmall Asmall Bsmall Csmall Dsmall Esmall Fsmall Gsmall Hsmall Ismall Jsmall Ksmall Lsmall Msmall Nsmall Osmall Psmall Qsmall Rsmall Ssmall Tsmall Usmall Vsmall Wsmall Xsmall Ysmall Zsmall colonmonetary onefitted rupiah Tildesmall                                   exclamdownsmall centoldstyle Lslashsmall   Scaronsmall Zcaronsmall Dieresissmall Brevesmall Caronsmall  Dotaccentsmall   Macronsmall   figuredash hypheninferior   Ogoneksmall Ringsmall Cedillasmall    onequarter onehalf threequarters questiondownsmall oneeighth threeeighths fiveeighths seveneighths onethird twothirds   zerosuperior onesuperior twosuperior threesuperior foursuperior fivesuperior sixsuperior sevensuperior eightsuperior ninesuperior zeroinferior oneinferior twoinferior threeinferior fourinferior fiveinferior sixinferior seveninferior eightinferior nineinferior centinferior dollarinferior periodinferior commainferior Agravesmall Aacutesmall Acircumflexsmall Atildesmall Adieresissmall Aringsmall AEsmall Ccedillasmall Egravesmall Eacutesmall Ecircumflexsmall Edieresissmall Igravesmall Iacutesmall Icircumflexsmall Idieresissmall Ethsmall Ntildesmall Ogravesmall Oacutesmall Ocircumflexsmall Otildesmall Odieresissmall OEsmall Oslashsmall Ugravesmall Uacutesmall Ucircumflexsmall Udieresissmall Yacutesmall Thornsmall Ydieresissmall".split(" "),
S=".notdef .null nonmarkingreturn space exclam quotedbl numbersign dollar percent ampersand quotesingle parenleft parenright asterisk plus comma hyphen period slash zero one two three four five six seven eight nine colon semicolon less equal greater question at A B C D E F G H I J K L M N O P Q R S T U V W X Y Z bracketleft backslash bracketright asciicircum underscore grave a b c d e f g h i j k l m n o p q r s t u v w x y z braceleft bar braceright asciitilde Adieresis Aring Ccedilla Eacute Ntilde Odieresis Udieresis aacute agrave acircumflex adieresis atilde aring ccedilla eacute egrave ecircumflex edieresis iacute igrave icircumflex idieresis ntilde oacute ograve ocircumflex odieresis otilde uacute ugrave ucircumflex udieresis dagger degree cent sterling section bullet paragraph germandbls registered copyright trademark acute dieresis notequal AE Oslash infinity plusminus lessequal greaterequal yen mu partialdiff summation product pi integral ordfeminine ordmasculine Omega ae oslash questiondown exclamdown logicalnot radical florin approxequal Delta guillemotleft guillemotright ellipsis nonbreakingspace Agrave Atilde Otilde OE oe endash emdash quotedblleft quotedblright quoteleft quoteright divide lozenge ydieresis Ydieresis fraction currency guilsinglleft guilsinglright fi fl daggerdbl periodcentered quotesinglbase quotedblbase perthousand Acircumflex Ecircumflex Aacute Edieresis Egrave Iacute Icircumflex Idieresis Igrave Oacute Ocircumflex apple Ograve Uacute Ucircumflex Ugrave dotlessi circumflex tilde macron breve dotaccent ring cedilla hungarumlaut ogonek caron Lslash lslash Scaron scaron Zcaron zcaron brokenbar Eth eth Yacute yacute Thorn thorn minus multiply onesuperior twosuperior threesuperior onehalf onequarter threequarters franc Gbreve gbreve Idotaccent Scedilla scedilla Cacute cacute Ccaron ccaron dcroat".split(" ");
T.prototype.charToGlyphIndex=function(a){a=a.codePointAt(0);var b=this.font.glyphs;if(b)for(var c=0;c<b.length;c+=1)for(var d=b.get(c),e=0;e<d.unicodes.length;e+=1)if(d.unicodes[e]===a)return c;return null};wb.prototype.charToGlyphIndex=function(a){return this.cmap.glyphIndexMap[a.codePointAt(0)]||0};H.prototype.charToGlyphIndex=function(a){a=a.codePointAt(0);return this.charset.indexOf(this.encoding[a])};Da.prototype.nameToGlyphIndex=function(a){return this.names.indexOf(a)};Da.prototype.glyphIndexToName=
function(a){return this.names[a]};var Hb={line:function(a,b,c,d,e){a.beginPath();a.moveTo(b,c);a.lineTo(d,e);a.stroke()}};aa.prototype.bindConstructorValues=function(a){this.index=a.index||0;this.name=a.name||null;this.unicode=a.unicode||void 0;this.unicodes=a.unicodes||void 0!==a.unicode?[a.unicode]:[];a.xMin&&(this.xMin=a.xMin);a.yMin&&(this.yMin=a.yMin);a.xMax&&(this.xMax=a.xMax);a.yMax&&(this.yMax=a.yMax);a.advanceWidth&&(this.advanceWidth=a.advanceWidth);Object.defineProperty(this,"path",eb(this,
a.path))};aa.prototype.addUnicode=function(a){0===this.unicodes.length&&(this.unicode=a);this.unicodes.push(a)};aa.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};aa.prototype.getPath=function(a,b,c,d,e){a=void 0!==a?a:0;b=void 0!==b?b:0;c=void 0!==c?c:72;var f;d||(d={});var g=d.xScale,h=d.yScale;d.hinting&&e&&e.hinting&&(f=this.path&&e.hinting.exec(this,c));f?(d=e.hinting.getCommands(f),a=Math.round(a),b=Math.round(b),g=h=1):(d=this.path.commands,c*=1/this.path.unitsPerEm,
void 0===g&&(g=c),void 0===h&&(h=c));c=new n;for(e=0;e<d.length;e+=1)f=d[e],"M"===f.type?c.moveTo(a+f.x*g,b+-f.y*h):"L"===f.type?c.lineTo(a+f.x*g,b+-f.y*h):"Q"===f.type?c.quadraticCurveTo(a+f.x1*g,b+-f.y1*h,a+f.x*g,b+-f.y*h):"C"===f.type?c.curveTo(a+f.x1*g,b+-f.y1*h,a+f.x2*g,b+-f.y2*h,a+f.x*g,b+-f.y*h):"Z"===f.type&&c.closePath();return c};aa.prototype.getContours=function(){if(void 0===this.points)return[];for(var a=[],b=[],c=0;c<this.points.length;c+=1){var d=this.points[c];b.push(d);d.lastPointOfContour&&
(a.push(b),b=[])}Y.argument(0===b.length,"There are still points left in the current contour.");return a};aa.prototype.getMetrics=function(){for(var a=this.path.commands,b=[],c=[],d=0;d<a.length;d+=1){var e=a[d];"Z"!==e.type&&(b.push(e.x),c.push(e.y));if("Q"===e.type||"C"===e.type)b.push(e.x1),c.push(e.y1);"C"===e.type&&(b.push(e.x2),c.push(e.y2))}a={xMin:Math.min.apply(null,b),yMin:Math.min.apply(null,c),xMax:Math.max.apply(null,b),yMax:Math.max.apply(null,c),leftSideBearing:this.leftSideBearing};
isFinite(a.xMin)||(a.xMin=0);isFinite(a.xMax)||(a.xMax=this.advanceWidth);isFinite(a.yMin)||(a.yMin=0);isFinite(a.yMax)||(a.yMax=0);a.rightSideBearing=this.advanceWidth-a.leftSideBearing-(a.xMax-a.xMin);return a};aa.prototype.draw=function(a,b,c,d,e){this.getPath(b,c,d,e).draw(a)};aa.prototype.drawPoints=function(a,b,c,d){function e(b,c,d,e){var f=2*Math.PI;a.beginPath();for(var g=0;g<b.length;g+=1)a.moveTo(c+b[g].x*e,d+b[g].y*e),a.arc(c+b[g].x*e,d+b[g].y*e,2,0,f,!1);a.closePath();a.fill()}b=void 0!==
b?b:0;c=void 0!==c?c:0;d=1/this.path.unitsPerEm*(void 0!==d?d:24);for(var f=[],g=[],h=this.path,k=0;k<h.commands.length;k+=1){var u=h.commands[k];void 0!==u.x&&f.push({x:u.x,y:-u.y});void 0!==u.x1&&g.push({x:u.x1,y:-u.y1});void 0!==u.x2&&g.push({x:u.x2,y:-u.y2})}a.fillStyle="blue";e(f,b,c,d);a.fillStyle="red";e(g,b,c,d)};aa.prototype.drawMetrics=function(a,b,c,d){b=void 0!==b?b:0;c=void 0!==c?c:0;d=1/this.path.unitsPerEm*(void 0!==d?d:24);a.lineWidth=1;a.strokeStyle="black";Hb.line(a,b,-1E4,b,1E4);
Hb.line(a,-1E4,c,1E4,c);var e=this.xMin||0,f=this.yMin||0,g=this.xMax||0,h=this.yMax||0,k=this.advanceWidth||0;a.strokeStyle="blue";Hb.line(a,b+e*d,-1E4,b+e*d,1E4);Hb.line(a,b+g*d,-1E4,b+g*d,1E4);Hb.line(a,-1E4,c+-f*d,1E4,c+-f*d);Hb.line(a,-1E4,c+-h*d,1E4,c+-h*d);a.strokeStyle="green";Hb.line(a,b+k*d,-1E4,b+k*d,1E4)};rb.prototype.get=function(a){"function"===typeof this.glyphs[a]&&(this.glyphs[a]=this.glyphs[a]());return this.glyphs[a]};rb.prototype.push=function(a,b){this.glyphs[a]=b;this.length++};
var Pb={GlyphSet:rb,glyphLoader:function(a,b){return new aa({index:b,font:a})},ttfGlyphLoader:function(a,b,c,d,e,f){return function(){var g=new aa({index:b,font:a});g.path=function(){c(g,d,e);var b=f(a.glyphs,g);b.unitsPerEm=a.unitsPerEm;return b};Ka(g,"xMin","_xMin");Ka(g,"xMax","_xMax");Ka(g,"yMin","_yMin");Ka(g,"yMax","_yMax");return g}},cffGlyphLoader:function(a,b,c,d){return function(){var e=new aa({index:b,font:a});e.path=function(){var b=c(a,e,d);b.unitsPerEm=a.unitsPerEm;return b};return e}}},
Hc=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",
op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:"real real real real real real".split(" "),value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,
type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],qc=[{name:"subrs",op:19,type:"offset",value:0},
{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}],D={parse:function(a,b,c){c.tables.cff={};W.getCard8(a,b);W.getCard8(a,b+1);W.getCard8(a,b+2);W.getCard8(a,b+3);var d=Qa(a,b+4,W.bytesToString);d=Qa(a,d.endOffset);var e=Qa(a,d.endOffset,W.bytesToString),f=Qa(a,e.endOffset);c.gsubrs=f.objects;c.gsubrsBias=kb(c.gsubrs);d=va(a,b,d.objects,e.objects);if(1!==d.length)throw Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+
d.length);d=d[0];c.tables.cff.topDict=d;d._privateDict&&(c.defaultWidthX=d._privateDict.defaultWidthX,c.nominalWidthX=d._privateDict.nominalWidthX);void 0!==d.ros[0]&&void 0!==d.ros[1]&&(c.isCIDFont=!0);if(c.isCIDFont){f=d.fdArray;var g=d.fdSelect;if(0===f||0===g)throw Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");f=Qa(a,f+b);var h=va(a,b,f.objects,e.objects);d._fdArray=h;f=c.numGlyphs;h=h.length;var k=[];g=new W.Parser(a,g+b);var u=g.parseCard8();if(0===
u)for(var l=0;l<f;l++){u=g.parseCard8();if(u>=h)throw Error("CFF table CID Font FDSelect has bad FD index value "+u+" (FD count "+h+")");k.push(u)}else if(3===u){var m=g.parseCard16(),C=g.parseCard16();if(0!==C)throw Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+C);for(var la=0;la<m;la++){u=g.parseCard8();l=g.parseCard16();if(u>=h)throw Error("CFF table CID Font FDSelect has bad FD index value "+u+" (FD count "+h+")");if(l>f)throw Error("CFF Table CID Font FDSelect format 3 range has bad GID "+
l);for(;C<l;C++)k.push(u);C=l}if(l!==f)throw Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+l);}else throw Error("CFF Table CID Font FDSelect table has unsupported format "+u);d._fdSelect=k}l=b+d["private"][1];f=e.objects;h=lb(a,l,d["private"][0]);f=pb(h,qc,f);c.defaultWidthX=f.defaultWidthX;c.nominalWidthX=f.nominalWidthX;0!==f.subrs?(l=Qa(a,l+f.subrs),c.subrs=l.objects,c.subrsBias=kb(c.subrs)):(c.subrs=[],c.subrsBias=0);l=Qa(a,b+d.charStrings);c.nGlyphs=l.objects.length;f=
c.nGlyphs;h=e.objects;k=new W.Parser(a,b+d.charset);--f;e=[".notdef"];g=k.parseCard8();if(0===g)for(u=0;u<f;u+=1)g=k.parseSID(),e.push(Va(h,g));else if(1===g)for(;e.length<=f;)for(g=k.parseSID(),u=k.parseCard8(),m=0;m<=u;m+=1)e.push(Va(h,g)),g+=1;else if(2===g)for(;e.length<=f;)for(g=k.parseSID(),u=k.parseCard16(),m=0;m<=u;m+=1)e.push(Va(h,g)),g+=1;else throw Error("Unknown charset format "+g);if(0===d.encoding)c.cffEncoding=new H(nd,e);else if(1===d.encoding)c.cffEncoding=new H(ia,e);else{f={};a=
new W.Parser(a,b+d.encoding);b=a.parseCard8();if(0===b)for(d=a.parseCard8(),h=0;h<d;h+=1)b=a.parseCard8(),f[b]=h;else if(1===b)for(d=a.parseCard8(),b=1,h=0;h<d;h+=1)for(k=a.parseCard8(),g=a.parseCard8(),u=k;u<=k+g;u+=1)f[u]=b,b+=1;else throw Error("Unknown encoding format "+b);a=new H(f,e);c.cffEncoding=a}c.encoding=c.encoding||c.cffEncoding;c.glyphs=new Pb.GlyphSet(c);for(a=0;a<c.nGlyphs;a+=1)c.glyphs.push(a,Pb.cffGlyphLoader(c,a,ua,l.objects[a]))},make:function(a,b){var c=new Z.Table("CFF ",[{name:"header",
type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),d=1/b.unitsPerEm;d={version:b.version,fullName:b.fullName,familyName:b.familyName,weight:b.weightName,fontBBox:b.fontBBox||[0,0,0,0],fontMatrix:[d,0,0,d,0,0],charset:999,encoding:0,charStrings:999,"private":[0,999]};for(var e=[],f,g=1;g<
a.length;g+=1)f=a.get(g),e.push(f.name);f=[];c.header=new Z.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}]);g=[b.postScriptName];var h=new Z.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);h.names=[];for(var k=0;k<g.length;k+=1)h.names.push({name:"name_"+k,type:"NAME",value:g[k]});c.nameIndex=h;g=qb(d,f);c.topDictIndex=Nb(g);c.globalSubrIndex=new Z.Record("Global Subr INDEX",
[{name:"subrs",type:"INDEX",value:[]}]);g=new Z.Record("Charsets",[{name:"format",type:"Card8",value:0}]);for(h=0;h<e.length;h+=1)k=ta(e[h],f),g.fields.push({name:"glyph_"+h,type:"SID",value:k});c.charsets=g;e=new Z.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]);for(g=0;g<a.length;g+=1){h=a.get(g);k=[];var u=h.path;k.push({name:"width",type:"NUMBER",value:h.advanceWidth});for(var l=0,m=0,C=0;C<u.commands.length;C+=1){var n=u.commands[C];if("Q"===n.type){var p=1/3,q=2/3;n=
{type:"C",x:n.x,y:n.y,x1:p*l+q*n.x1,y1:p*m+q*n.y1,x2:p*n.x+q*n.x1,y2:p*n.y+q*n.y1}}if("M"===n.type)l=Math.round(n.x-l),m=Math.round(n.y-m),k.push({name:"dx",type:"NUMBER",value:l}),k.push({name:"dy",type:"NUMBER",value:m}),k.push({name:"rmoveto",type:"OP",value:21}),l=Math.round(n.x),m=Math.round(n.y);else if("L"===n.type)l=Math.round(n.x-l),m=Math.round(n.y-m),k.push({name:"dx",type:"NUMBER",value:l}),k.push({name:"dy",type:"NUMBER",value:m}),k.push({name:"rlineto",type:"OP",value:5}),l=Math.round(n.x),
m=Math.round(n.y);else if("C"===n.type){p=Math.round(n.x1-l);q=Math.round(n.y1-m);var r=Math.round(n.x2-n.x1),t=Math.round(n.y2-n.y1);l=Math.round(n.x-n.x2);m=Math.round(n.y-n.y2);k.push({name:"dx1",type:"NUMBER",value:p});k.push({name:"dy1",type:"NUMBER",value:q});k.push({name:"dx2",type:"NUMBER",value:r});k.push({name:"dy2",type:"NUMBER",value:t});k.push({name:"dx",type:"NUMBER",value:l});k.push({name:"dy",type:"NUMBER",value:m});k.push({name:"rrcurveto",type:"OP",value:8});l=Math.round(n.x);m=
Math.round(n.y)}}k.push({name:"endchar",type:"OP",value:14});e.charStrings.push({name:h.name,type:"CHARSTRING",value:k})}c.charStringsIndex=e;e=new Z.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);e.dict=Mb(qc,{},f);c.privateDict=e;e=new Z.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(g=0;g<f.length;g+=1)e.strings.push({name:"string_"+g,type:"STRING",value:f[g]});c.stringIndex=e;e=c.header.sizeOf()+c.nameIndex.sizeOf()+c.topDictIndex.sizeOf()+c.stringIndex.sizeOf()+
c.globalSubrIndex.sizeOf();d.charset=e;d.encoding=0;d.charStrings=d.charset+c.charsets.sizeOf();d["private"][1]=d.charStrings+c.charStringsIndex.sizeOf();g=qb(d,f);c.topDictIndex=Nb(g);return c}},Ca={parse:function(a,b){var c={},d=new W.Parser(a,b);c.version=d.parseVersion();c.fontRevision=Math.round(1E3*d.parseFixed())/1E3;c.checkSumAdjustment=d.parseULong();c.magicNumber=d.parseULong();Y.argument(1594834165===c.magicNumber,"Font header has wrong magic number.");c.flags=d.parseUShort();c.unitsPerEm=
d.parseUShort();c.created=d.parseLongDateTime();c.modified=d.parseLongDateTime();c.xMin=d.parseShort();c.yMin=d.parseShort();c.xMax=d.parseShort();c.yMax=d.parseShort();c.macStyle=d.parseUShort();c.lowestRecPPEM=d.parseUShort();c.fontDirectionHint=d.parseShort();c.indexToLocFormat=d.parseShort();c.glyphDataFormat=d.parseShort();return c},make:function(a){var b=Math.round((new Date).getTime()/1E3)+2082844800,c=b;a.createdTimestamp&&(c=a.createdTimestamp+2082844800);return new Z.Table("head",[{name:"version",
type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1E3},{name:"created",type:"LONGDATETIME",value:c},{name:"modified",type:"LONGDATETIME",value:b},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",
type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],a)}},Ic={parse:function(a,b){var c={},d=new W.Parser(a,b);c.version=d.parseVersion();c.ascender=d.parseShort();c.descender=d.parseShort();c.lineGap=d.parseShort();c.advanceWidthMax=d.parseUShort();c.minLeftSideBearing=d.parseShort();c.minRightSideBearing=d.parseShort();c.xMaxExtent=d.parseShort();
c.caretSlopeRise=d.parseShort();c.caretSlopeRun=d.parseShort();c.caretOffset=d.parseShort();d.relativeOffset+=8;c.metricDataFormat=d.parseShort();c.numberOfHMetrics=d.parseUShort();return c},make:function(a){return new Z.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",
type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],a)}},Pc={parse:function(a,b,c,d,e){a=new W.Parser(a,
b);for(b=0;b<d;b+=1){if(b<c){var f=a.parseUShort();var g=a.parseShort()}var h=e.get(b);h.advanceWidth=f;h.leftSideBearing=g}},make:function(a){for(var b=new Z.Table("hmtx",[]),c=0;c<a.length;c+=1){var d=a.get(c),e=d.leftSideBearing||0;b.fields.push({name:"advanceWidth_"+c,type:"USHORT",value:d.advanceWidth||0});b.fields.push({name:"leftSideBearing_"+c,type:"SHORT",value:e})}return b}},Jc={make:function(a){for(var b=new Z.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",
value:0},{name:"numTags",type:"ULONG",value:a.length}]),c="",d=12+4*a.length,e=0;e<a.length;++e){var f=c.indexOf(a[e]);0>f&&(f=c.length,c+=a[e]);b.fields.push({name:"offset "+e,type:"USHORT",value:d+f});b.fields.push({name:"length "+e,type:"USHORT",value:a[e].length})}b.fields.push({name:"stringPool",type:"CHARARRAY",value:c});return b},parse:function(a,b){var c=new W.Parser(a,b),d=c.parseULong();Y.argument(1===d,"Unsupported ltag table version.");c.skip("uLong",1);d=c.parseULong();for(var e=[],f=
0;f<d;f++){for(var g="",h=b+c.parseUShort(),k=c.parseUShort(),u=h;u<h+k;++u)g+=String.fromCharCode(a.getInt8(u));e.push(g)}return e}},ha={parse:function(a,b){var c={},d=new W.Parser(a,b);c.version=d.parseVersion();c.numGlyphs=d.parseUShort();1===c.version&&(c.maxPoints=d.parseUShort(),c.maxContours=d.parseUShort(),c.maxCompositePoints=d.parseUShort(),c.maxCompositeContours=d.parseUShort(),c.maxZones=d.parseUShort(),c.maxTwilightPoints=d.parseUShort(),c.maxStorage=d.parseUShort(),c.maxFunctionDefs=
d.parseUShort(),c.maxInstructionDefs=d.parseUShort(),c.maxStackElements=d.parseUShort(),c.maxSizeOfInstructions=d.parseUShort(),c.maxComponentElements=d.parseUShort(),c.maxComponentDepth=d.parseUShort());return c},make:function(a){return new Z.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:a}])}},Ra="copyright fontFamily fontSubfamily uniqueID fullName version postScriptName trademark manufacturer designer description manufacturerURL designerURL license licenseURL reserved preferredFamily preferredSubfamily compatibleFullName sampleText postScriptFindFontName wwsFamily wwsSubfamily".split(" "),
Kc={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",
61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},
gb={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,
129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Wa={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",
5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",
6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",
1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",
9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"},md={0:"macintosh",
1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",
31:"x-mac-extarabic"},nb={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"},Sc={parse:function(a,b,c){var d={};b=new W.Parser(a,b);for(var e=b.parseUShort(),f=b.parseUShort(),g=b.offset+b.parseUShort(),h=0;h<f;h++){var k=b.parseUShort(),u=b.parseUShort(),l=b.parseUShort(),m=b.parseUShort();m=Ra[m]||
m;var C=b.parseUShort(),la=b.parseUShort();a:{switch(k){case 0:if(65535===l){var n="und";break a}if(c){n=c[l];break a}break;case 1:n=Kc[l];break a;case 3:n=Wa[l];break a}n=void 0}k=Fb(k,u,l);void 0!==k&&void 0!==n&&(k="utf-16"===k?Lb.UTF16(a,g+la,C):Lb.MACSTRING(a,g+la,C,k))&&(u=d[m],void 0===u&&(u=d[m]={}),u[n]=k)}1===e&&b.parseUShort();return d},make:function(a,b){var c=[],d={},e=yb(Ra);for(k in a){var f=e[k];void 0===f&&(f=k);f=parseInt(f);if(isNaN(f))throw Error('Name table entry "'+k+'" does not exist, see nameTableNames for complete list.');
d[f]=a[k];c.push(f)}var g=yb(Kc),h=yb(Wa);e=[];var k=[];for(var u=0;u<c.length;u++){f=c[u];var l=d[f],m;for(m in l){var C=l[m],n=1,p=g[m],q=gb[p],r=Fb(n,q,p);r=N.MACSTRING(C,r);void 0===r&&(n=0,p=b.indexOf(m),0>p&&(p=b.length,b.push(m)),q=4,r=N.UTF16(C));var t=Ob(r,k);e.push(Gb(n,q,p,f,r.length,t));n=h[m];void 0!==n&&(C=N.UTF16(C),p=Ob(C,k),e.push(Gb(3,1,n,f,C.length,p)))}}e.sort(function(a,b){return a.platformID-b.platformID||a.encodingID-b.encodingID||a.languageID-b.languageID||a.nameID-b.nameID});
c=new Z.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:e.length},{name:"stringOffset",type:"USHORT",value:6+12*e.length}]);for(d=0;d<e.length;d++)c.fields.push({name:"record_"+d,type:"RECORD",value:e[d]});c.fields.push({name:"strings",type:"LITERAL",value:k});return c}},xc=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,
end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,
end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},
{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,
end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},
{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},
{begin:65936,end:65999},{begin:66E3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}],za={parse:function(a,b){var c={},d=new W.Parser(a,b);c.version=d.parseUShort();c.xAvgCharWidth=d.parseShort();c.usWeightClass=d.parseUShort();c.usWidthClass=d.parseUShort();c.fsType=d.parseUShort();c.ySubscriptXSize=d.parseShort();c.ySubscriptYSize=d.parseShort();c.ySubscriptXOffset=d.parseShort();c.ySubscriptYOffset=d.parseShort();c.ySuperscriptXSize=d.parseShort();c.ySuperscriptYSize=d.parseShort();
c.ySuperscriptXOffset=d.parseShort();c.ySuperscriptYOffset=d.parseShort();c.yStrikeoutSize=d.parseShort();c.yStrikeoutPosition=d.parseShort();c.sFamilyClass=d.parseShort();c.panose=[];for(var e=0;10>e;e++)c.panose[e]=d.parseByte();c.ulUnicodeRange1=d.parseULong();c.ulUnicodeRange2=d.parseULong();c.ulUnicodeRange3=d.parseULong();c.ulUnicodeRange4=d.parseULong();c.achVendID=String.fromCharCode(d.parseByte(),d.parseByte(),d.parseByte(),d.parseByte());c.fsSelection=d.parseUShort();c.usFirstCharIndex=
d.parseUShort();c.usLastCharIndex=d.parseUShort();c.sTypoAscender=d.parseShort();c.sTypoDescender=d.parseShort();c.sTypoLineGap=d.parseShort();c.usWinAscent=d.parseUShort();c.usWinDescent=d.parseUShort();1<=c.version&&(c.ulCodePageRange1=d.parseULong(),c.ulCodePageRange2=d.parseULong());2<=c.version&&(c.sxHeight=d.parseShort(),c.sCapHeight=d.parseShort(),c.usDefaultChar=d.parseUShort(),c.usBreakChar=d.parseUShort(),c.usMaxContent=d.parseUShort());return c},make:function(a){return new Z.Table("OS/2",
[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},
{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",
type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},
{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",
type:"USHORT",value:0}],a)},unicodeRanges:xc,getUnicodeRange:function(a){for(var b=0;b<xc.length;b+=1){var c=xc[b];if(a>=c.begin&&a<c.end)return b}return-1}},Sa={parse:function(a,b){var c={},d=new W.Parser(a,b);c.version=d.parseVersion();c.italicAngle=d.parseFixed();c.underlinePosition=d.parseShort();c.underlineThickness=d.parseShort();c.isFixedPitch=d.parseULong();c.minMemType42=d.parseULong();c.maxMemType42=d.parseULong();c.minMemType1=d.parseULong();c.maxMemType1=d.parseULong();switch(c.version){case 1:c.names=
S.slice();break;case 2:c.numberOfGlyphs=d.parseUShort();c.glyphNameIndex=Array(c.numberOfGlyphs);for(var e=0;e<c.numberOfGlyphs;e++)c.glyphNameIndex[e]=d.parseUShort();c.names=[];for(e=0;e<c.numberOfGlyphs;e++)if(c.glyphNameIndex[e]>=S.length){var f=d.parseChar();c.names.push(d.parseString(f))}break;case 2.5:for(c.numberOfGlyphs=d.parseUShort(),c.offset=Array(c.numberOfGlyphs),e=0;e<c.numberOfGlyphs;e++)c.offset[e]=d.parseChar()}return c},make:function(){return new Z.Table("post",[{name:"version",
type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}},Za=Array(9);Za[1]=function(){var a=this.offset+this.relativeOffset,b=this.parseUShort();if(1===b)return{substFormat:1,
coverage:this.parsePointer(v.coverage),deltaGlyphId:this.parseUShort()};if(2===b)return{substFormat:2,coverage:this.parsePointer(v.coverage),substitute:this.parseOffset16List()};Y.assert(!1,"0x"+a.toString(16)+": lookup type 1 format must be 1 or 2.")};Za[2]=function(){var a=this.parseUShort();Y.argument(1===a,"GSUB Multiple Substitution Subtable identifier-format must be 1");return{substFormat:a,coverage:this.parsePointer(v.coverage),sequences:this.parseListOfLists()}};Za[3]=function(){var a=this.parseUShort();
Y.argument(1===a,"GSUB Alternate Substitution Subtable identifier-format must be 1");return{substFormat:a,coverage:this.parsePointer(v.coverage),alternateSets:this.parseListOfLists()}};Za[4]=function(){var a=this.parseUShort();Y.argument(1===a,"GSUB ligature table identifier-format must be 1");return{substFormat:a,coverage:this.parsePointer(v.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var cb=
{sequenceIndex:v.uShort,lookupListIndex:v.uShort};Za[5]=function(){var a=this.offset+this.relativeOffset,b=this.parseUShort();if(1===b)return{substFormat:b,coverage:this.parsePointer(v.coverage),ruleSets:this.parseListOfLists(function(){var a=this.parseUShort(),b=this.parseUShort();return{input:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(b,cb)}})};if(2===b)return{substFormat:b,coverage:this.parsePointer(v.coverage),classDef:this.parsePointer(v.classDef),classSets:this.parseListOfLists(function(){var a=
this.parseUShort(),b=this.parseUShort();return{classes:this.parseUShortList(a-1),lookupRecords:this.parseRecordList(b,cb)}})};if(3===b){a=this.parseUShort();var c=this.parseUShort();return{substFormat:b,coverages:this.parseList(a,v.pointer(v.coverage)),lookupRecords:this.parseRecordList(c,cb)}}Y.assert(!1,"0x"+a.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};Za[6]=function(){var a=this.offset+this.relativeOffset,b=this.parseUShort();if(1===b)return{substFormat:1,coverage:this.parsePointer(v.coverage),
chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(cb)}})};if(2===b)return{substFormat:2,coverage:this.parsePointer(v.coverage),backtrackClassDef:this.parsePointer(v.classDef),inputClassDef:this.parsePointer(v.classDef),lookaheadClassDef:this.parsePointer(v.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),
input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(cb)}})};if(3===b)return{substFormat:3,backtrackCoverage:this.parseList(v.pointer(v.coverage)),inputCoverage:this.parseList(v.pointer(v.coverage)),lookaheadCoverage:this.parseList(v.pointer(v.coverage)),lookupRecords:this.parseRecordList(cb)};Y.assert(!1,"0x"+a.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};Za[7]=function(){var a=this.parseUShort();Y.argument(1===a,"GSUB Extension Substitution subtable identifier-format must be 1");
a=this.parseUShort();var b=new v(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:a,extension:Za[a].call(b)}};Za[8]=function(){var a=this.parseUShort();Y.argument(1===a,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1");return{substFormat:a,coverage:this.parsePointer(v.coverage),backtrackCoverage:this.parseList(v.pointer(v.coverage)),lookaheadCoverage:this.parseList(v.pointer(v.coverage)),substitutes:this.parseUShortList()}};var ec=
Array(9);ec[1]=function(a){return 1===a.substFormat?new Z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Z.Coverage(a.coverage)},{name:"deltaGlyphID",type:"USHORT",value:a.deltaGlyphId}]):new Z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Z.Coverage(a.coverage)}].concat(Z.ushortList("substitute",a.substitute)))};ec[3]=function(a){Y.assert(1===a.substFormat,"Lookup type 3 substFormat must be 1.");
return new Z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Z.Coverage(a.coverage)}].concat(Z.tableList("altSet",a.alternateSets,function(a){return new Z.Table("alternateSetTable",Z.ushortList("alternate",a))})))};ec[4]=function(a){Y.assert(1===a.substFormat,"Lookup type 4 substFormat must be 1.");return new Z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Z.Coverage(a.coverage)}].concat(Z.tableList("ligSet",
a.ligatureSets,function(a){return new Z.Table("ligatureSetTable",Z.tableList("ligature",a,function(a){return new Z.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:a.ligGlyph}].concat(Z.ushortList("component",a.components,a.components.length+1)))}))})))};var Lc={parse:function(a,b){var c=new v(a,b||0),d=c.parseVersion(1);Y.argument(1===d||1.1===d,"Unsupported GSUB table version.");return 1===d?{version:d,scripts:c.parseScriptList(),features:c.parseFeatureList(),lookups:c.parseLookupList(Za)}:
{version:d,scripts:c.parseScriptList(),features:c.parseFeatureList(),lookups:c.parseLookupList(Za),variations:c.parseFeatureVariationsList()}},make:function(a){return new Z.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Z.ScriptList(a.scripts)},{name:"features",type:"TABLE",value:new Z.FeatureList(a.features)},{name:"lookups",type:"TABLE",value:new Z.LookupList(a.lookups,ec)}])}},vb={parse:function(a,b){var c=new W.Parser(a,b),d=c.parseULong();Y.argument(1===
d,"Unsupported META table version.");c.parseULong();c.parseULong();d=c.parseULong();for(var e={},f=0;f<d;f++){var g=c.parseTag(),h=c.parseULong(),k=c.parseULong();h=Lb.UTF8(a,b+h,k);e[g]=h}return e},make:function(a){var b=Object.keys(a).length,c="",d=16+12*b;b=new Z.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:d},{name:"numTags",type:"ULONG",value:b}]);for(var e in a){var f=c.length;c+=a[e];b.fields.push({name:"tag "+e,type:"TAG",
value:e});b.fields.push({name:"offset "+e,type:"ULONG",value:d+f});b.fields.push({name:"length "+e,type:"ULONG",value:a[e].length})}b.fields.push({name:"stringPool",type:"CHARARRAY",value:c});return b}},kd={make:xb,fontToTable:function(a){for(var b=[],c=[],d=[],e=[],f=[],g=[],h=[],k,u=0,l=0,m=0,n=0,p=0,q=0;q<a.glyphs.length;q+=1){var r=a.glyphs.get(q),t=r.unicode|0;if(isNaN(r.advanceWidth))throw Error("Glyph "+r.name+" ("+q+"): advanceWidth is not a number.");(k>t||void 0===k)&&0<t&&(k=t);u<t&&(u=
t);t=za.getUnicodeRange(t);if(32>t)l|=1<<t;else if(64>t)m|=1<<t-32;else if(96>t)n|=1<<t-64;else if(123>t)p|=1<<t-96;else throw Error("Unicode ranges bits > 123 are reserved for internal usage");".notdef"!==r.name&&(t=r.getMetrics(),b.push(t.xMin),c.push(t.yMin),d.push(t.xMax),e.push(t.yMax),g.push(t.leftSideBearing),h.push(t.rightSideBearing),f.push(r.advanceWidth))}b=Math.min.apply(null,b);c=Math.min.apply(null,c);d=Math.max.apply(null,d);e=Math.max.apply(null,e);q=Math.max.apply(null,f);for(t=r=
0;t<f.length;t+=1)r+=f[t];e={xMin:b,yMin:c,xMax:d,yMax:e,advanceWidthMax:q,advanceWidthAvg:r/f.length,minLeftSideBearing:Math.min.apply(null,g),maxLeftSideBearing:Math.max.apply(null,g),minRightSideBearing:Math.min.apply(null,h)};e.ascender=a.ascender;e.descender=a.descender;f=Ca.make({flags:3,unitsPerEm:a.unitsPerEm,xMin:e.xMin,yMin:e.yMin,xMax:e.xMax,yMax:e.yMax,lowestRecPPEM:3,createdTimestamp:a.createdTimestamp});g=Ic.make({ascender:e.ascender,descender:e.descender,advanceWidthMax:e.advanceWidthMax,
minLeftSideBearing:e.minLeftSideBearing,minRightSideBearing:e.minRightSideBearing,xMaxExtent:e.maxLeftSideBearing+(e.xMax-e.xMin),numberOfHMetrics:a.glyphs.length});h=ha.make(a.glyphs.length);k=za.make({xAvgCharWidth:Math.round(e.advanceWidthAvg),usWeightClass:a.tables.os2.usWeightClass,usWidthClass:a.tables.os2.usWidthClass,usFirstCharIndex:k,usLastCharIndex:u,ulUnicodeRange1:l,ulUnicodeRange2:m,ulUnicodeRange3:n,ulUnicodeRange4:p,fsSelection:a.tables.os2.fsSelection,sTypoAscender:e.ascender,sTypoDescender:e.descender,
sTypoLineGap:0,usWinAscent:e.yMax,usWinDescent:Math.abs(e.yMin),ulCodePageRange1:1,sxHeight:wa(a,"xyvw",{yMax:Math.round(e.ascender/2)}).yMax,sCapHeight:wa(a,"HIKLEFJMNTZBDPRAGOQSUVWXY",e).yMax,usDefaultChar:a.hasChar(" ")?32:0,usBreakChar:a.hasChar(" ")?32:0});u=Pc.make(a.glyphs);l=Uc.make(a.glyphs);m=a.getEnglishName("fontFamily");n=a.getEnglishName("fontSubfamily");p=m+" "+n;(d=a.getEnglishName("postScriptName"))||(d=m.replace(/\s/g,"")+"-"+n);c={};for(var v in a.names)c[v]=a.names[v];c.uniqueID||
(c.uniqueID={en:a.getEnglishName("manufacturer")+":"+p});c.postScriptName||(c.postScriptName={en:d});c.preferredFamily||(c.preferredFamily=a.names.fontFamily);c.preferredSubfamily||(c.preferredSubfamily=a.names.fontSubfamily);b=[];v=Sc.make(c,b);c=0<b.length?Jc.make(b):void 0;b=Sa.make();n=D.make(a.glyphs,{version:a.getEnglishName("version"),fullName:p,familyName:m,weightName:n,postScriptName:d,unitsPerEm:a.unitsPerEm,fontBBox:[0,e.yMin,e.ascender,e.advanceWidthMax]});m=a.metas&&0<Object.keys(a.metas).length?
vb.make(a.metas):void 0;v=[f,g,h,k,v,l,b,n,u];c&&v.push(c);a.tables.gsub&&v.push(Lc.make(a.tables.gsub));m&&v.push(m);a=xb(v);v=a.encode();v=zb(v);k=a.fields;u=!1;for(l=0;l<k.length;l+=1)if("head table"===k[l].name){k[l].value.checkSumAdjustment=2981146554-v;u=!0;break}if(!u)throw Error("Could not find head table with checkSum to adjust.");return a},computeCheckSum:zb};Db.prototype={searchTag:Ab,binSearch:fa,getTable:function(a){var b=this.font.tables[this.tableName];!b&&a&&(b=this.font.tables[this.tableName]=
this.createDefaultTable());return b},getScriptNames:function(){var a=this.getTable();return a?a.scripts.map(function(a){return a.tag}):[]},getDefaultScriptName:function(){var a=this.getTable();if(a){for(var b=!1,c=0;c<a.scripts.length;c++){var d=a.scripts[c].tag;if("DFLT"===d)return d;"latn"===d&&(b=!0)}if(b)return"latn"}},getScriptTable:function(a,b){var c=this.getTable(b);if(c){a=a||"DFLT";var d=c.scripts;c=Ab(c.scripts,a);if(0<=c)return d[c].script;if(b){var e={tag:a,script:{defaultLangSys:{reserved:0,
reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};d.splice(-1-c,0,e);return e.script}}},getLangSysTable:function(a,b,c){if(a=this.getScriptTable(a,c)){if(!b||"dflt"===b||"DFLT"===b)return a.defaultLangSys;var d=Ab(a.langSysRecords,b);if(0<=d)return a.langSysRecords[d].langSys;if(c)return b={tag:b,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}},a.langSysRecords.splice(-1-d,0,b),b.langSys}},getFeatureTable:function(a,b,c,d){if(a=this.getLangSysTable(a,b,d)){b=a.featureIndexes;
for(var e=this.font.tables[this.tableName].features,f=0;f<b.length;f++)if(a=e[b[f]],a.tag===c)return a.feature;if(d)return d=e.length,Y.assert(0===d||c>=e[d-1].tag,"Features must be added in alphabetical order."),a={tag:c,feature:{params:0,lookupListIndexes:[]}},e.push(a),b.push(d),a.feature}},getLookupTables:function(a,b,c,d,e){b=this.getFeatureTable(a,b,c,e);a=[];if(b){c=b.lookupListIndexes;for(var f=this.font.tables[this.tableName].lookups,g=0;g<c.length;g++)b=f[c[g]],b.lookupType===d&&a.push(b);
if(0===a.length&&e)return b={lookupType:d,lookupFlag:0,subtables:[],markFilteringSet:void 0},d=f.length,f.push(b),c.push(d),[b]}return a},getGlyphClass:function(a,b){switch(a.format){case 1:return a.startGlyph<=b&&b<a.startGlyph+a.classes.length?a.classes[b-a.startGlyph]:0;case 2:var c=yc(a.ranges,b);return c?c.classId:0}},getCoverageIndex:function(a,b){switch(a.format){case 1:var c=fa(a.glyphs,b);return 0<=c?c:-1;case 2:return(c=yc(a.ranges,b))?c.index+b-c.start:-1}},expandCoverage:function(a){if(1===
a.format)return a.glyphs;var b=[];a=a.ranges;for(var c=0;c<a.length;c++){var d=a[c],e=d.end;for(d=d.start;d<=e;d++)b.push(d)}return b}};Ub.prototype=Db.prototype;Ub.prototype.init=function(){var a=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(a)};Ub.prototype.getKerningValue=function(a,b,c){for(var d=0;d<a.length;d++)for(var e=a[d].subtables,f=0;f<e.length;f++){var g=e[f],h=this.getCoverageIndex(g.coverage,b);if(!(0>h))switch(g.posFormat){case 1:g=g.pairSets[h];for(h=
0;h<g.length;h++){var k=g[h];if(k.secondGlyph===c)return k.value1&&k.value1.xAdvance||0}break;case 2:return a=this.getGlyphClass(g.classDef1,b),c=this.getGlyphClass(g.classDef2,c),c=g.classRecords[a][c],c.value1&&c.value1.xAdvance||0}}return 0};Ub.prototype.getKerningTables=function(a,b){if(this.font.tables.gpos)return this.getLookupTables(a,b,"kern",2)};xa.prototype=Db.prototype;xa.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,
featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};xa.prototype.getSingle=function(a,b,c){var d=[];a=this.getLookupTables(b,c,a,1);for(b=0;b<a.length;b++){c=a[b].subtables;for(var e=0;e<c.length;e++){var f=c[e],g=this.expandCoverage(f.coverage);if(1===f.substFormat){var h=f.deltaGlyphId;for(f=0;f<g.length;f++){var k=g[f];d.push({sub:k,by:k+h})}}else for(h=f.substitute,f=0;f<g.length;f++)d.push({sub:g[f],by:h[f]})}}return d};xa.prototype.getAlternates=function(a,b,c){var d=[];a=this.getLookupTables(b,
c,a,3);for(b=0;b<a.length;b++){c=a[b].subtables;for(var e=0;e<c.length;e++){var f=c[e],g=this.expandCoverage(f.coverage);f=f.alternateSets;for(var h=0;h<g.length;h++)d.push({sub:g[h],by:f[h]})}}return d};xa.prototype.getLigatures=function(a,b,c){var d=[];a=this.getLookupTables(b,c,a,4);for(b=0;b<a.length;b++){c=a[b].subtables;for(var e=0;e<c.length;e++){var f=c[e],g=this.expandCoverage(f.coverage);f=f.ligatureSets;for(var h=0;h<g.length;h++)for(var k=g[h],u=f[h],l=0;l<u.length;l++){var m=u[l];d.push({sub:[k].concat(m.components),
by:m.ligGlyph})}}}return d};xa.prototype.addSingle=function(a,b,c,d){a=this.getLookupTables(c,d,a,1,!0)[0];a=Eb(a,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});Y.assert(1===a.coverage.format,"Ligature: unable to modify coverage table format "+a.coverage.format);c=b.sub;d=this.binSearch(a.coverage.glyphs,c);0>d&&(d=-1-d,a.coverage.glyphs.splice(d,0,c),a.substitute.splice(d,0,0));a.substitute[d]=b.by};xa.prototype.addAlternate=function(a,b,c,d){a=this.getLookupTables(c,d,a,3,!0)[0];
a=Eb(a,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});Y.assert(1===a.coverage.format,"Ligature: unable to modify coverage table format "+a.coverage.format);c=b.sub;d=this.binSearch(a.coverage.glyphs,c);0>d&&(d=-1-d,a.coverage.glyphs.splice(d,0,c),a.alternateSets.splice(d,0,0));a.alternateSets[d]=b.by};xa.prototype.addLigature=function(a,b,c,d){a=this.getLookupTables(c,d,a,4,!0)[0];c=a.subtables[0];c||(c={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},a.subtables[0]=
c);Y.assert(1===c.coverage.format,"Ligature: unable to modify coverage table format "+c.coverage.format);d=b.sub[0];a=b.sub.slice(1);b={ligGlyph:b.by,components:a};var e=this.binSearch(c.coverage.glyphs,d);if(0<=e){c=c.ligatureSets[e];for(d=0;d<c.length;d++){a:{e=c[d].components;var f=e.length;if(f!==a.length)e=!1;else{for(var g=0;g<f;g++)if(e[g]!==a[g]){e=!1;break a}e=!0}}if(e)return}c.push(b)}else e=-1-e,c.coverage.glyphs.splice(e,0,d),c.ligatureSets.splice(e,0,[b])};xa.prototype.getFeature=function(a,
b,c){if(/ss\d\d/.test(a))return this.getSingle(a,b,c);switch(a){case "aalt":case "salt":return this.getSingle(a,b,c).concat(this.getAlternates(a,b,c));case "dlig":case "liga":case "rlig":return this.getLigatures(a,b,c)}};xa.prototype.add=function(a,b,c,d){if(/ss\d\d/.test(a))return this.addSingle(a,b,c,d);switch(a){case "aalt":case "salt":return"number"===typeof b.by?this.addSingle(a,b,c,d):this.addAlternate(a,b,c,d);case "dlig":case "liga":case "rlig":return this.addLigature(a,b,c,d)}};var Tc={getPath:Yb,
parse:function(a,b,c,d){for(var e=new Pb.GlyphSet(d),f=0;f<c.length-1;f+=1){var g=c[f];g!==c[f+1]?e.push(f,Pb.ttfGlyphLoader(d,f,ma,a,b+g,$b)):e.push(f,Pb.glyphLoader(d,f))}return e}},Wc=function(a){var b=this.srPeriod,c=this.srPhase,d=this.srThreshold,e=1;0>a&&(a=-a,e=-1);a=Math.trunc((a+(d-c))/b)*b;a+=c;return 0>a?c*e:a*e},db={x:1,y:0,axis:"x",distance:function(a,b,c,d){return(c?a.xo:a.x)-(d?b.xo:b.x)},interpolate:function(a,b,c,d){if(d&&d!==this){var e=d.distance(a,b,!0,!0);var f=d.distance(a,
c,!0,!0);b=d.distance(b,b,!1,!0);c=d.distance(c,c,!1,!0);e=Math.abs(e);f=Math.abs(f);var g=e+f;0===g?db.setRelative(a,a,(b+c)/2,d,!0):db.setRelative(a,a,(b*f+c*e)/g,d,!0)}else e=a.xo-b.xo,f=a.xo-c.xo,b=b.x-b.xo,c=c.x-c.xo,e=Math.abs(e),f=Math.abs(f),g=e+f,a.x=0===g?a.xo+(b+c)/2:a.xo+(b*f+c*e)/g},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(a,b,c,d,e){a.x=d&&d!==this?(e?b.xo:b.x)+c*d.x+(a.y-((e?b.yo:b.y)+c*d.y))/d.normalSlope:(e?b.xo:b.x)+c},slope:0,touch:function(a){a.xTouched=!0},touched:function(a){return a.xTouched},
untouch:function(a){a.xTouched=!1}},hb={x:0,y:1,axis:"y",distance:function(a,b,c,d){return(c?a.yo:a.y)-(d?b.yo:b.y)},interpolate:function(a,b,c,d){if(d&&d!==this){var e=d.distance(a,b,!0,!0);var f=d.distance(a,c,!0,!0);b=d.distance(b,b,!1,!0);c=d.distance(c,c,!1,!0);e=Math.abs(e);f=Math.abs(f);var g=e+f;0===g?hb.setRelative(a,a,(b+c)/2,d,!0):hb.setRelative(a,a,(b*f+c*e)/g,d,!0)}else e=a.yo-b.yo,f=a.yo-c.yo,b=b.y-b.yo,c=c.y-c.yo,e=Math.abs(e),f=Math.abs(f),g=e+f,a.y=0===g?a.yo+(b+c)/2:a.yo+(b*f+c*
e)/g},normalSlope:0,setRelative:function(a,b,c,d,e){a.y=d&&d!==this?(e?b.yo:b.y)+c*d.y+d.normalSlope*(a.x-((e?b.xo:b.x)+c*d.x)):(e?b.yo:b.y)+c},slope:Number.POSITIVE_INFINITY,touch:function(a){a.yTouched=!0},touched:function(a){return a.yTouched},untouch:function(a){a.yTouched=!1}};Object.freeze(db);Object.freeze(hb);w.prototype.distance=function(a,b,c,d){return this.x*db.distance(a,b,c,d)+this.y*hb.distance(a,b,c,d)};w.prototype.interpolate=function(a,b,c,d){var e=d.distance(a,b,!0,!0);var f=d.distance(a,
c,!0,!0);b=d.distance(b,b,!1,!0);c=d.distance(c,c,!1,!0);e=Math.abs(e);f=Math.abs(f);var g=e+f;0===g?this.setRelative(a,a,(b+c)/2,d,!0):this.setRelative(a,a,(b*f+c*e)/g,d,!0)};w.prototype.setRelative=function(a,b,c,d,e){d=d||this;var f=d.normalSlope,g=this.slope,h=a.x,k=a.y;a.x=(g*h-f*((e?b.xo:b.x)+c*d.x)+((e?b.yo:b.y)+c*d.y)-k)/(g-f);a.y=g*(a.x-h)+k};w.prototype.touch=function(a){a.xTouched=!0;a.yTouched=!0};z.prototype.nextTouched=function(a){for(var b=this.nextPointOnContour;!a.touched(b)&&b!==
this;)b=b.nextPointOnContour;return b};z.prototype.prevTouched=function(a){for(var b=this.prevPointOnContour;!a.touched(b)&&b!==this;)b=b.prevPointOnContour;return b};var Wb=Object.freeze(new z(0,0)),vd={cvCutIn:1.0625,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};B.prototype.exec=function(b,c){if("number"!==typeof c)throw Error("Point size is not a number!");if(!(2<this._errorState)){var d=this.font,e=this._prepState;if(!e||e.ppem!==c){e=this._fpgmState;if(!e){J.prototype=vd;e=this._fpgmState=
new J("fpgm",d.tables.fpgm);e.funcs=[];e.font=d;a.DEBUG&&(console.log("---EXEC FPGM---"),e.step=-1);try{Cb(e)}catch(Fa){console.log("Hinting error in FPGM:"+Fa);this._errorState=3;return}}J.prototype=e;e=this._prepState=new J("prep",d.tables.prep);e.ppem=c;var f=d.tables.cvt;if(f){var g=e.cvt=Array(f.length);d=c/d.unitsPerEm;for(var h=0;h<f.length;h++)g[h]=f[h]*d}else e.cvt=[];a.DEBUG&&(console.log("---EXEC PREP---"),e.step=-1);try{Cb(e)}catch(Fa){2>this._errorState&&console.log("Hinting error in PREP:"+
Fa),this._errorState=2}}if(!(1<this._errorState))try{return od(b,e)}catch(Fa){1>this._errorState&&(console.log("Hinting error:"+Fa),console.log("Note: further hinting errors are silenced")),this._errorState=1}}};var od=function(b,c){var d=c.ppem/c.font.unitsPerEm,e=b.components;J.prototype=c;if(e){var f=c.font;var g=[];var h=[];for(var k=0;k<e.length;k++){var l=e[k],m=f.glyphs.get(l.glyphIndex);var u=new J("glyf",m.instructions);a.DEBUG&&(console.log("---EXEC COMP "+k+"---"),u.step=-1);Vc(m,u,d,d);
m=Math.round(l.dx*d);var n=Math.round(l.dy*d),C=u.gZone;l=u.contours;for(var p=0;p<C.length;p++){var q=C[p];q.xTouched=q.yTouched=!1;q.xo=q.x+=m;q.yo=q.y+=n}m=g.length;g.push.apply(g,C);for(C=0;C<l.length;C++)h.push(l[C]+m)}b.instructions&&!u.inhibitGridFit&&(u=new J("glyf",b.instructions),u.gZone=u.z0=u.z1=u.z2=g,u.contours=h,g.push(new z(0,0),new z(Math.round(b.advanceWidth*d),0)),a.DEBUG&&(console.log("---EXEC COMPOSITE---"),u.step=-1),Cb(u),g.length-=2)}else u=new J("glyf",b.instructions),a.DEBUG&&
(console.log("---EXEC GLYPH---"),u.step=-1),Vc(b,u,d,d),g=u.gZone;return g};var Vc=function(b,c,d,e){for(var f=b.points||[],g=f.length,h=c.gZone=c.z0=c.z1=c.z2=[],k=c.contours=[],l,m=0;m<g;m++)l=f[m],h[m]=new z(l.x*d,l.y*e,l.lastPointOfContour,l.onCurve);for(f=0;f<g;f++){l=h[f];if(!u){var u=l;k.push(f)}l.lastPointOfContour?(l.nextPointOnContour=u,u.prevPointOnContour=l,u=void 0):(e=h[f+1],l.nextPointOnContour=e,e.prevPointOnContour=l)}if(!c.inhibitGridFit){if(a.DEBUG)for(console.log("PROCESSING GLYPH",
c.stack),k=0;k<g;k++)console.log(k,h[k].x,h[k].y);h.push(new z(0,0),new z(Math.round(b.advanceWidth*d),0));Cb(c);h.length-=2;if(a.DEBUG)for(console.log("FINISHED GLYPH",c.stack),b=0;b<g;b++)console.log(b,h[b].x,h[b].y)}};var Cb=function(b){var c=b.prog;if(c){var d=c.length;for(b.ip=0;b.ip<d;b.ip++){a.DEBUG&&b.step++;var e=pd[c[b.ip]];if(!e)throw Error("unknown instruction: 0x"+Number(c[b.ip]).toString(16));e(b)}}};var pd=[q.bind(void 0,hb),q.bind(void 0,db),I.bind(void 0,hb),I.bind(void 0,db),A.bind(void 0,
hb),A.bind(void 0,db),X.bind(void 0,0),X.bind(void 0,1),Xa.bind(void 0,0),Xa.bind(void 0,1),function(b){var c=b.stack,d=c.pop();c=c.pop();a.DEBUG&&console.log(b.step,"SPVFS[]",d,c);b.pv=b.dpv=x(c,d)},function(b){var c=b.stack,d=c.pop();c=c.pop();a.DEBUG&&console.log(b.step,"SPVFS[]",d,c);b.fv=x(c,d)},function(b){var c=b.stack,d=b.pv;a.DEBUG&&console.log(b.step,"GPV[]");c.push(16384*d.x);c.push(16384*d.y)},function(b){var c=b.stack,d=b.fv;a.DEBUG&&console.log(b.step,"GFV[]");c.push(16384*d.x);c.push(16384*
d.y)},function(b){b.fv=b.pv;a.DEBUG&&console.log(b.step,"SFVTPV[]")},function(b){var c=b.stack,d=c.pop(),e=c.pop(),f=c.pop(),g=c.pop(),h=c.pop(),k=b.z0;c=b.z1;var l=k[d],m=k[e];k=c[f];c=c[g];b=b.z2[h];a.DEBUG&&console.log("ISECT[], ",d,e,f,g,h);d=l.x;e=l.y;f=m.x;m=m.y;g=k.x;k=k.y;l=c.x;c=c.y;h=(d-f)*(k-c)-(e-m)*(g-l);var u=d*m-e*f,n=g*c-k*l;b.x=(u*(g-l)-n*(d-f))/h;b.y=(u*(k-c)-n*(e-m))/h},function(b){b.rp0=b.stack.pop();a.DEBUG&&console.log(b.step,"SRP0[]",b.rp0)},function(b){b.rp1=b.stack.pop();
a.DEBUG&&console.log(b.step,"SRP1[]",b.rp1)},function(b){b.rp2=b.stack.pop();a.DEBUG&&console.log(b.step,"SRP2[]",b.rp2)},function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"SZP0[]",c);b.zp0=c;switch(c){case 0:b.tZone||r(b);b.z0=b.tZone;break;case 1:b.z0=b.gZone;break;default:throw Error("Invalid zone pointer");}},function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"SZP1[]",c);b.zp1=c;switch(c){case 0:b.tZone||r(b);b.z1=b.tZone;break;case 1:b.z1=b.gZone;break;default:throw Error("Invalid zone pointer");
}},function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"SZP2[]",c);b.zp2=c;switch(c){case 0:b.tZone||r(b);b.z2=b.tZone;break;case 1:b.z2=b.gZone;break;default:throw Error("Invalid zone pointer");}},function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"SZPS[]",c);b.zp0=b.zp1=b.zp2=c;switch(c){case 0:b.tZone||r(b);b.z0=b.z1=b.z2=b.tZone;break;case 1:b.z0=b.z1=b.z2=b.gZone;break;default:throw Error("Invalid zone pointer");}},function(b){b.loop=b.stack.pop();a.DEBUG&&console.log(b.step,
"SLOOP[]",b.loop)},function(b){a.DEBUG&&console.log(b.step,"RTG[]");b.round=F},function(b){a.DEBUG&&console.log(b.step,"RTHG[]");b.round=Ja},function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"SMD[]",c);b.minDis=c/64},function(b){a.DEBUG&&console.log(b.step,"ELSE[]");R(b,!1)},function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"JMPR[]",c);b.ip+=c-1},function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"SCVTCI[]",c);b.cvCutIn=c/64},void 0,void 0,function(b){var c=b.stack;a.DEBUG&&
console.log(b.step,"DUP[]");c.push(c[c.length-1])},sa,function(b){a.DEBUG&&console.log(b.step,"CLEAR[]");b.stack.length=0},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"SWAP[]");c.push(d);c.push(e)},function(b){var c=b.stack;a.DEBUG&&console.log(b.step,"DEPTH[]");c.push(c.length)},function(b){var c=b.stack,d=c.pop();a.DEBUG&&console.log(b.step,"CINDEX[]",d);c.push(c[c.length-d])},function(b){var c=b.stack,d=c.pop();a.DEBUG&&console.log(b.step,"MINDEX[]",d);c.push(c.splice(c.length-
d,1)[0])},void 0,void 0,void 0,function(b){var c=b.stack,d=c.pop();c=c.pop();a.DEBUG&&console.log(b.step,"LOOPCALL[]",d,c);var e=b.ip,f=b.prog;b.prog=b.funcs[d];for(d=0;d<c;d++)Cb(b),a.DEBUG&&console.log(++b.step,d+1<c?"next loopcall":"done loopcall",d);b.ip=e;b.prog=f},function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"CALL[]",c);var d=b.ip,e=b.prog;b.prog=b.funcs[c];Cb(b);b.ip=d;b.prog=e;a.DEBUG&&console.log(++b.step,"returning from",c)},function(b){if("fpgm"!==b.env)throw Error("FDEF not allowed here");
var c=b.prog,d=b.ip,e=b.stack.pop(),f=d;for(a.DEBUG&&console.log(b.step,"FDEF[]",e);45!==c[++d];);b.ip=d;b.funcs[e]=c.slice(f+1,d)},void 0,fb.bind(void 0,0),fb.bind(void 0,1),V.bind(void 0,hb),V.bind(void 0,db),L.bind(void 0,0),L.bind(void 0,1),oa.bind(void 0,0),oa.bind(void 0,1),ya.bind(void 0,0),ya.bind(void 0,1),function(b){for(var c=b.stack,d=b.loop,e=b.fv,f=c.pop()/64,g=b.z2;d--;){var h=c.pop(),k=g[h];a.DEBUG&&console.log(b.step,(1<b.loop?"loop "+(b.loop-d)+": ":"")+"SHPIX[]",h,f);e.setRelative(k,
k,f);e.touch(k)}b.loop=1},function(b){for(var c=b.stack,d=b.rp1,e=b.rp2,f=b.loop,g=b.z0[d],h=b.z1[e],k=b.fv,l=b.dpv,m=b.z2;f--;){var n=c.pop(),u=m[n];a.DEBUG&&console.log(b.step,(1<b.loop?"loop "+(b.loop-f)+": ":"")+"IP[]",n,d,"<->",e);k.interpolate(u,g,h,l);k.touch(u)}b.loop=1},ja.bind(void 0,0),ja.bind(void 0,1),function(b){for(var c=b.stack,d=b.z0[b.rp0],e=b.loop,f=b.fv,g=b.pv,h=b.z1;e--;){var k=c.pop(),l=h[k];a.DEBUG&&console.log(b.step,(1<b.loop?"loop "+(b.loop-e)+": ":"")+"ALIGNRP[]",k);f.setRelative(l,
d,0,g);f.touch(l)}b.loop=1},function(b){a.DEBUG&&console.log(b.step,"RTDG[]");b.round=da},G.bind(void 0,0),G.bind(void 0,1),function(b){var c=b.prog,d=b.ip,e=b.stack,f=c[++d];a.DEBUG&&console.log(b.step,"NPUSHB[]",f);for(var g=0;g<f;g++)e.push(c[++d]);b.ip=d},function(b){var c=b.ip,d=b.prog,e=b.stack,f=d[++c];a.DEBUG&&console.log(b.step,"NPUSHW[]",f);for(var g=0;g<f;g++){var h=d[++c]<<8|d[++c];h&32768&&(h=-((h^65535)+1));e.push(h)}b.ip=c},function(b){var c=b.stack,d=b.store;d||(d=b.store=[]);var e=
c.pop();c=c.pop();a.DEBUG&&console.log(b.step,"WS",e,c);d[c]=e},function(b){var c=b.stack,d=b.store,e=c.pop();a.DEBUG&&console.log(b.step,"RS",e);c.push(d&&d[e]||0)},function(b){var c=b.stack,d=c.pop();c=c.pop();a.DEBUG&&console.log(b.step,"WCVTP",d,c);b.cvt[c]=d/64},function(b){var c=b.stack,d=c.pop();a.DEBUG&&console.log(b.step,"RCVT",d);c.push(64*b.cvt[d])},ba.bind(void 0,0),ba.bind(void 0,1),void 0,Na.bind(void 0,0),Na.bind(void 0,1),function(b){a.DEBUG&&console.log(b.step,"MPPEM[]");b.stack.push(b.ppem)},
void 0,function(b){a.DEBUG&&console.log(b.step,"FLIPON[]");b.autoFlip=!0},void 0,void 0,function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"LT[]",d,e);c.push(e<d?1:0)},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"LTEQ[]",d,e);c.push(e<=d?1:0)},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"GT[]",d,e);c.push(e>d?1:0)},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"GTEQ[]",d,e);c.push(e>=d?1:
0)},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"EQ[]",d,e);c.push(d===e?1:0)},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"NEQ[]",d,e);c.push(d!==e?1:0)},function(b){var c=b.stack,d=c.pop();a.DEBUG&&console.log(b.step,"ODD[]",d);c.push(Math.trunc(d)%2?1:0)},function(b){var c=b.stack,d=c.pop();a.DEBUG&&console.log(b.step,"EVEN[]",d);c.push(Math.trunc(d)%2?0:1)},function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"IF[]",c);c||(R(b,
!0),a.DEBUG&&console.log(b.step,"EIF[]"))},function(b){a.DEBUG&&console.log(b.step,"EIF[]")},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"AND[]",d,e);c.push(d&&e?1:0)},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"OR[]",d,e);c.push(d||e?1:0)},function(b){var c=b.stack,d=c.pop();a.DEBUG&&console.log(b.step,"NOT[]",d);c.push(d?0:1)},Vb.bind(void 0,1),function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"SDB[]",c);b.deltaBase=c},function(b){var c=
b.stack.pop();a.DEBUG&&console.log(b.step,"SDS[]",c);b.deltaShift=Math.pow(.5,c)},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"ADD[]",d,e);c.push(e+d)},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"SUB[]",d,e);c.push(e-d)},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"DIV[]",d,e);c.push(64*e/d)},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"MUL[]",d,e);c.push(e*d/64)},function(b){var c=
b.stack,d=c.pop();a.DEBUG&&console.log(b.step,"ABS[]",d);c.push(Math.abs(d))},function(b){var c=b.stack,d=c.pop();a.DEBUG&&console.log(b.step,"NEG[]",d);c.push(-d)},function(b){var c=b.stack,d=c.pop();a.DEBUG&&console.log(b.step,"FLOOR[]",d);c.push(64*Math.floor(d/64))},function(b){var c=b.stack,d=c.pop();a.DEBUG&&console.log(b.step,"CEILING[]",d);c.push(64*Math.ceil(d/64))},U.bind(void 0,0),U.bind(void 0,1),U.bind(void 0,2),U.bind(void 0,3),void 0,void 0,void 0,void 0,function(b){var c=b.stack,d=
c.pop();c=c.pop();a.DEBUG&&console.log(b.step,"WCVTF[]",d,c);b.cvt[c]=d*b.ppem/b.font.unitsPerEm},Vb.bind(void 0,2),Vb.bind(void 0,3),Ha.bind(void 0,1),Ha.bind(void 0,2),Ha.bind(void 0,3),function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"SROUND[]",c);b.round=Wc;switch(c&192){case 0:var d=.5;break;case 64:d=1;break;case 128:d=2;break;default:throw Error("invalid SROUND value");}b.srPeriod=d;switch(c&48){case 0:b.srPhase=0;break;case 16:b.srPhase=.25*d;break;case 32:b.srPhase=.5*d;break;
case 48:b.srPhase=.75*d;break;default:throw Error("invalid SROUND value");}c&=15;b.srThreshold=0===c?0:(c/8-.5)*d},function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"S45ROUND[]",c);b.round=Wc;switch(c&192){case 0:var d=Math.sqrt(2)/2;break;case 64:d=Math.sqrt(2);break;case 128:d=2*Math.sqrt(2);break;default:throw Error("invalid S45ROUND value");}b.srPeriod=d;switch(c&48){case 0:b.srPhase=0;break;case 16:b.srPhase=.25*d;break;case 32:b.srPhase=.5*d;break;case 48:b.srPhase=.75*d;break;default:throw Error("invalid S45ROUND value");
}c&=15;b.srThreshold=0===c?0:(c/8-.5)*d},void 0,void 0,function(b){a.DEBUG&&console.log(b.step,"ROFF[]");b.round=M},void 0,function(b){a.DEBUG&&console.log(b.step,"RUTG[]");b.round=ea},function(b){a.DEBUG&&console.log(b.step,"RDTG[]");b.round=t},sa,sa,void 0,void 0,void 0,void 0,void 0,function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"SCANCTRL[]",c)},ib.bind(void 0,0),ib.bind(void 0,1),function(b){var c=b.stack,d=c.pop(),e=0;a.DEBUG&&console.log(b.step,"GETINFO[]",d);d&1&&(e=35);d&32&&
(e|=4096);c.push(e)},void 0,function(b){var c=b.stack,d=c.pop(),e=c.pop(),f=c.pop();a.DEBUG&&console.log(b.step,"ROLL[]");c.push(e);c.push(d);c.push(f)},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"MAX[]",d,e);c.push(Math.max(e,d))},function(b){var c=b.stack,d=c.pop(),e=c.pop();a.DEBUG&&console.log(b.step,"MIN[]",d,e);c.push(Math.min(e,d))},function(b){var c=b.stack.pop();a.DEBUG&&console.log(b.step,"SCANTYPE[]",c)},function(b){var c=b.stack.pop(),d=b.stack.pop();a.DEBUG&&
console.log(b.step,"INSTCTRL[]",c,d);switch(c){case 1:b.inhibitGridFit=!!d;break;case 2:b.ignoreCvt=!!d;break;default:throw Error("invalid INSTCTRL[] selector");}},void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,bb.bind(void 0,1),bb.bind(void 0,2),bb.bind(void 0,3),bb.bind(void 0,4),bb.bind(void 0,5),bb.bind(void 0,6),
bb.bind(void 0,7),bb.bind(void 0,8),jb.bind(void 0,1),jb.bind(void 0,2),jb.bind(void 0,3),jb.bind(void 0,4),jb.bind(void 0,5),jb.bind(void 0,6),jb.bind(void 0,7),jb.bind(void 0,8),O.bind(void 0,0,0,0,0,0),O.bind(void 0,0,0,0,0,1),O.bind(void 0,0,0,0,0,2),O.bind(void 0,0,0,0,0,3),O.bind(void 0,0,0,0,1,0),O.bind(void 0,0,0,0,1,1),O.bind(void 0,0,0,0,1,2),O.bind(void 0,0,0,0,1,3),O.bind(void 0,0,0,1,0,0),O.bind(void 0,0,0,1,0,1),O.bind(void 0,0,0,1,0,2),O.bind(void 0,0,0,1,0,3),O.bind(void 0,0,0,1,1,
0),O.bind(void 0,0,0,1,1,1),O.bind(void 0,0,0,1,1,2),O.bind(void 0,0,0,1,1,3),O.bind(void 0,0,1,0,0,0),O.bind(void 0,0,1,0,0,1),O.bind(void 0,0,1,0,0,2),O.bind(void 0,0,1,0,0,3),O.bind(void 0,0,1,0,1,0),O.bind(void 0,0,1,0,1,1),O.bind(void 0,0,1,0,1,2),O.bind(void 0,0,1,0,1,3),O.bind(void 0,0,1,1,0,0),O.bind(void 0,0,1,1,0,1),O.bind(void 0,0,1,1,0,2),O.bind(void 0,0,1,1,0,3),O.bind(void 0,0,1,1,1,0),O.bind(void 0,0,1,1,1,1),O.bind(void 0,0,1,1,1,2),O.bind(void 0,0,1,1,1,3),O.bind(void 0,1,0,0,0,0),
O.bind(void 0,1,0,0,0,1),O.bind(void 0,1,0,0,0,2),O.bind(void 0,1,0,0,0,3),O.bind(void 0,1,0,0,1,0),O.bind(void 0,1,0,0,1,1),O.bind(void 0,1,0,0,1,2),O.bind(void 0,1,0,0,1,3),O.bind(void 0,1,0,1,0,0),O.bind(void 0,1,0,1,0,1),O.bind(void 0,1,0,1,0,2),O.bind(void 0,1,0,1,0,3),O.bind(void 0,1,0,1,1,0),O.bind(void 0,1,0,1,1,1),O.bind(void 0,1,0,1,1,2),O.bind(void 0,1,0,1,1,3),O.bind(void 0,1,1,0,0,0),O.bind(void 0,1,1,0,0,1),O.bind(void 0,1,1,0,0,2),O.bind(void 0,1,1,0,0,3),O.bind(void 0,1,1,0,1,0),O.bind(void 0,
1,1,0,1,1),O.bind(void 0,1,1,0,1,2),O.bind(void 0,1,1,0,1,3),O.bind(void 0,1,1,1,0,0),O.bind(void 0,1,1,1,0,1),O.bind(void 0,1,1,1,0,2),O.bind(void 0,1,1,1,0,3),O.bind(void 0,1,1,1,1,0),O.bind(void 0,1,1,1,1,1),O.bind(void 0,1,1,1,1,2),O.bind(void 0,1,1,1,1,3)];var rd=Array.from||function(a){return a.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[^\uD800-\uDFFF]|./g)||[]};na.prototype.hasChar=function(a){return null!==this.encoding.charToGlyphIndex(a)};na.prototype.charToGlyphIndex=function(a){return this.encoding.charToGlyphIndex(a)};
na.prototype.charToGlyph=function(a){a=this.charToGlyphIndex(a);(a=this.glyphs.get(a))||(a=this.glyphs.get(0));return a};na.prototype.stringToGlyphs=function(a,b){b=b||this.defaultRenderOptions;for(var c=rd(a),d=[],e=0;e<c.length;e+=1)d.push(this.charToGlyphIndex(c[e]));c=d.length;if(b.features){var f=b.script||this.substitution.getDefaultScriptName();e=[];b.features.liga&&(e=e.concat(this.substitution.getFeature("liga",f,b.language)));b.features.rlig&&(e=e.concat(this.substitution.getFeature("rlig",
f,b.language)));for(f=0;f<c;f+=1)for(var g=0;g<e.length;g++){for(var h=e[g],k=h.sub,l=k.length,m=0;m<l&&k[m]===d[f+m];)m++;m===l&&(d.splice(f,l,h.by),c=c-l+1)}}e=Array(c);f=this.glyphs.get(0);for(g=0;g<c;g+=1)e[g]=this.glyphs.get(d[g])||f;return e};na.prototype.nameToGlyphIndex=function(a){return this.glyphNames.nameToGlyphIndex(a)};na.prototype.nameToGlyph=function(a){a=this.nameToGlyphIndex(a);(a=this.glyphs.get(a))||(a=this.glyphs.get(0));return a};na.prototype.glyphIndexToName=function(a){return this.glyphNames.glyphIndexToName?
this.glyphNames.glyphIndexToName(a):""};na.prototype.getKerningValue=function(a,b){a=a.index||a;b=b.index||b;var c=this.position.defaultKerningTables;return c?this.position.getKerningValue(c,a,b):this.kerningPairs[a+","+b]||0};na.prototype.defaultRenderOptions={kerning:!0,features:{liga:!0,rlig:!0}};na.prototype.forEachGlyph=function(a,b,c,d,e,f){b=void 0!==b?b:0;c=void 0!==c?c:0;d=void 0!==d?d:72;e=e||this.defaultRenderOptions;var g=1/this.unitsPerEm*d;a=this.stringToGlyphs(a,e);if(e.kerning){var h=
e.script||this.position.getDefaultScriptName();h=this.position.getKerningTables(h,e.language)}for(var k=0;k<a.length;k+=1){var l=a[k];f.call(this,l,b,c,d,e);l.advanceWidth&&(b+=l.advanceWidth*g);e.kerning&&k<a.length-1&&(l=h?this.position.getKerningValue(h,l.index,a[k+1].index):this.getKerningValue(l,a[k+1]),b+=l*g);e.letterSpacing?b+=e.letterSpacing*d:e.tracking&&(b+=e.tracking/1E3*d)}return b};na.prototype.getPath=function(a,b,c,d,e){var f=new n;this.forEachGlyph(a,b,c,d,e,function(a,b,c,d){a=a.getPath(b,
c,d,e,this);f.extend(a)});return f};na.prototype.getPaths=function(a,b,c,d,e){var f=[];this.forEachGlyph(a,b,c,d,e,function(a,b,c,d){a=a.getPath(b,c,d,e,this);f.push(a)});return f};na.prototype.getAdvanceWidth=function(a,b,c){return this.forEachGlyph(a,0,0,b,c,function(){})};na.prototype.draw=function(a,b,c,d,e,f){this.getPath(b,c,d,e,f).draw(a)};na.prototype.drawPoints=function(a,b,c,d,e,f){this.forEachGlyph(b,c,d,e,f,function(b,c,d,e){b.drawPoints(a,c,d,e)})};na.prototype.drawMetrics=function(a,
b,c,d,e,f){this.forEachGlyph(b,c,d,e,f,function(b,c,d,e){b.drawMetrics(a,c,d,e)})};na.prototype.getEnglishName=function(a){if(a=this.names[a])return a.en};na.prototype.validate=function(){function a(a){(a=b.getEnglishName(a))&&a.trim()}var b=this;a("fontFamily");a("weightName");a("manufacturer");a("copyright");a("version")};na.prototype.toTables=function(){return kd.fontToTable(this)};na.prototype.toBuffer=function(){console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead.");return this.toArrayBuffer()};
na.prototype.toArrayBuffer=function(){for(var a=this.toTables().encode(),b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d<a.length;d++)c[d]=a[d];return b};na.prototype.download=function(a){var b=this.getEnglishName("fontFamily"),c=this.getEnglishName("fontSubfamily");a=a||b.replace(/\s/g,"")+"-"+c+".otf";var d=this.toArrayBuffer();if("undefined"!==typeof window)window.URL=window.URL||window.webkitURL,window.URL?(b=new DataView(d),c=new Blob([b],{type:"font/opentype"}),b=document.createElement("a"),
b.href=window.URL.createObjectURL(c),b.download=a,a=document.createEvent("MouseEvents"),a.initEvent("click",!0,!1),b.dispatchEvent(a)):console.warn("Font file could not be downloaded. Try using a different browser.");else{b=require("fs");c=new Buffer(d.byteLength);d=new Uint8Array(d);for(var e=0;e<c.length;++e)c[e]=d[e];b.writeFileSync(a,c)}};na.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};na.prototype.usWidthClasses=
{ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};na.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var sd={make:function(a,b){var c=new Z.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:a.axes.length},
{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:a.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*a.axes.length}]);c.offsetToData=c.sizeOf();for(var d=0;d<a.axes.length;d++)c.fields=c.fields.concat(Zc(d,a.axes[d],b));for(d=0;d<a.instances.length;d++)c.fields=c.fields.concat(ad(d,a.instances[d],a.axes,b));return c},parse:function(a,b,c){var d=new W.Parser(a,b),e=d.parseULong();Y.argument(65536===e,"Unsupported fvar table version.");var f=d.parseOffset16();
d.skip("uShort",1);var g=d.parseUShort(),h=d.parseUShort();e=d.parseUShort();d=d.parseUShort();for(var k=[],l=0;l<g;l++)k.push($c(a,b+f+l*h,c));l=[];b=b+f+g*h;for(f=0;f<e;f++)l.push(cd(a,b+f*d,k,c));return{axes:k,instances:l}}},Ya=Array(10);Ya[1]=function(){var a=this.offset+this.relativeOffset,b=this.parseUShort();if(1===b)return{posFormat:1,coverage:this.parsePointer(v.coverage),value:this.parseValueRecord()};if(2===b)return{posFormat:2,coverage:this.parsePointer(v.coverage),values:this.parseValueRecordList()};
Y.assert(!1,"0x"+a.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};Ya[2]=function(){var a=this.offset+this.relativeOffset,b=this.parseUShort();Y.assert(1===b||2===b,"0x"+a.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");a=this.parsePointer(v.coverage);var c=this.parseUShort(),d=this.parseUShort();if(1===b)return{posFormat:b,coverage:a,valueFormat1:c,valueFormat2:d,pairSets:this.parseList(v.pointer(v.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(c),
value2:this.parseValueRecord(d)}})))};if(2===b){var e=this.parsePointer(v.classDef),f=this.parsePointer(v.classDef),g=this.parseUShort(),h=this.parseUShort();return{posFormat:b,coverage:a,valueFormat1:c,valueFormat2:d,classDef1:e,classDef2:f,class1Count:g,class2Count:h,classRecords:this.parseList(g,v.list(h,function(){return{value1:this.parseValueRecord(c),value2:this.parseValueRecord(d)}}))}}};Ya[3]=function(){return{error:"GPOS Lookup 3 not supported"}};Ya[4]=function(){return{error:"GPOS Lookup 4 not supported"}};
Ya[5]=function(){return{error:"GPOS Lookup 5 not supported"}};Ya[6]=function(){return{error:"GPOS Lookup 6 not supported"}};Ya[7]=function(){return{error:"GPOS Lookup 7 not supported"}};Ya[8]=function(){return{error:"GPOS Lookup 8 not supported"}};Ya[9]=function(){return{error:"GPOS Lookup 9 not supported"}};var td=Array(10),wd={parse:function(a,b){var c=new v(a,b||0),d=c.parseVersion(1);Y.argument(1===d||1.1===d,"Unsupported GPOS table version "+d);return 1===d?{version:d,scripts:c.parseScriptList(),
features:c.parseFeatureList(),lookups:c.parseLookupList(Ya)}:{version:d,scripts:c.parseScriptList(),features:c.parseFeatureList(),lookups:c.parseLookupList(Ya),variations:c.parseFeatureVariationsList()}},make:function(a){return new Z.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Z.ScriptList(a.scripts)},{name:"features",type:"TABLE",value:new Z.FeatureList(a.features)},{name:"lookups",type:"TABLE",value:new Z.LookupList(a.lookups,td)}])}},xd={parse:function(a,
b){var c=new W.Parser(a,b),d=c.parseUShort();if(0===d){d={};c.skip("uShort");var e=c.parseUShort();Y.argument(0===e,"Unsupported kern sub-table version.");c.skip("uShort",2);e=c.parseUShort();c.skip("uShort",3);for(var f=0;f<e;f+=1){var g=c.parseUShort(),h=c.parseUShort(),k=c.parseShort();d[g+","+h]=k}return d}if(1===d){d={};c.skip("uShort");1<c.parseULong()&&console.warn("Only the first kern subtable is supported.");c.skip("uLong");e=c.parseUShort()&255;c.skip("uShort");if(0===e)for(e=c.parseUShort(),
c.skip("uShort",3),f=0;f<e;f+=1)g=c.parseUShort(),h=c.parseUShort(),k=c.parseShort(),d[g+","+h]=k;return d}throw Error("Unsupported kern table version ("+d+").");}},qd={parse:function(a,b,c,d){a=new W.Parser(a,b);b=d?a.parseUShort:a.parseULong;for(var e=[],f=0;f<c+1;f+=1){var g=b.call(a);d&&(g*=2);e.push(g)}return e}};a.Font=na;a.Glyph=aa;a.Path=n;a.BoundingBox=l;a._parse=W;a.parse=nc;a.load=function(a,b){("undefined"===typeof window?lc:dd)(a,function(a,c){if(a)return b(a);try{var d=nc(c)}catch(Aa){return b(Aa,
null)}return b(null,d)})};a.loadSync=function(a){a=require("fs").readFileSync(a);return nc(Zb(a))};Object.defineProperty(a,"__esModule",{value:!0})});function ColorUtils(){}_=ColorUtils;_.hexToRgb=function(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,c,d,e){return c+c+d+d+e+e});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16),a:1}:null};
_.rgbToHex=function(a,b,c){a=Math.round(255*a);b=Math.round(255*b);c=Math.round(255*c);a=a.toString(16);1==a.length&&(a="0"+a);b=b.toString(16);1==b.length&&(b="0"+b);c=c.toString(16);1==c.length&&(c="0"+c);return("#"+a+b+c).toUpperCase()};_.rgbaToHtmlString=function(a,b,c,d){return"rgba("+Math.round(255*a)+","+Math.round(255*b)+","+Math.round(255*c)+","+d+")"};
_.parseColorString=function(a){var b={r:0,g:0,b:0,a:1};a=a.trim();0==a.indexOf("#")?(b=ColorUtils.hexToRgb(a),b.r*=1/255,b.g*=1/255,b.b*=1/255):-1<a.indexOf("rgb(")?(a=a.split("rgb(")[1].split(")")[0].split(","),b.r=1/255*parseInt(a[0]),b.g=1/255*parseInt(a[1]),b.b=1/255*parseInt(a[2])):-1<a.indexOf("rgba(")?(a=a.split("rgba(")[1].split(")")[0].split(","),b.r=1/255*parseInt(a[0]),b.g=1/255*parseInt(a[1]),b.b=1/255*parseInt(a[2]),b.a=parseFloat(a[3])):(b=ColorUtils.hexToRgb(ColorUtils.colorNameToHex(a)),
b.r*=1/255,b.g*=1/255,b.b*=1/255);return b};
_.colorNameToHex=function(a){var b={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",
darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",
goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",
lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",
olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",
slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return"undefined"!=typeof b[a.toLowerCase()]?b[a.toLowerCase()]:"#000000"};
_.hsvToRgb=function(a,b,c){var d,e;if(0==c)var f=e=d=0;else{var g=Math.floor(6*a),h=6*a-g;a=c*(1-b);var k=c*(1-b*h);b=c*(1-b*(1-h));switch(g){case 1:d=k;e=c;f=a;break;case 2:d=a;e=c;f=b;break;case 3:d=a;e=k;f=c;break;case 4:d=b;e=a;f=c;break;case 5:d=c;e=a;f=k;break;case 6:case 0:d=c,e=b,f=a}}return{r:d,g:e,b:f}};
_.rgbToHsv=function(a,b,c){var d=Math.max(Math.max(a,b),c),e=Math.min(Math.min(a,b),c);if(e==d)e=a=0;else{var f=d-e;e=f/d;a=(a==d?(b-c)/f:b==d?2+(c-a)/f:4+(a-b)/f)/6;0>a&&(a+=1);1<a&&--a}return{h:a,s:e,v:d}};
_.rainbow=function(a,b){var c=b/a,d=~~(6*c);c=6*c-d;var e=1-c;switch(d%6){case 0:var f=1;var g=c;var h=0;break;case 1:f=e;g=1;h=0;break;case 2:f=0;g=1;h=c;break;case 3:f=0;g=e;h=1;break;case 4:f=c;g=0;h=1;break;case 5:f=1,g=0,h=e}return"#"+("00"+(~~(255*f)).toString(16)).slice(-2)+("00"+(~~(255*g)).toString(16)).slice(-2)+("00"+(~~(255*h)).toString(16)).slice(-2)};_.mixColorChannel=function(a,b,c){return a*c+b*(1-c)};
_.mixColors=function(a,b,c){var d=this.mixColorChannel(a[0],b[0],c),e=this.mixColorChannel(a[1],b[1],c);a=this.mixColorChannel(a[2],b[2],c);return"rgb("+d+","+e+","+a+")"};SVGMatrix.prototype.identity=function(){this.a=1;this.c=this.b=0;this.d=1;this.f=this.e=0;return this};
SVGMatrix.prototype.toHTML=function(a){return a?"matrix("+[this.a.toFixed(a),this.b.toFixed(a),this.c.toFixed(a),this.d.toFixed(a),this.e.toFixed(a),this.f.toFixed(a)].join()+")":"matrix("+[this.a,this.b,this.c,this.d,this.e,this.f].join()+")"};SVGMatrix.prototype.clone=function(){var a=SVGUtils.createSVGMatrix();this.copyTo(a);return a};SVGMatrix.prototype.removeScale=function(){var a=this.getScale();a=SVGUtils.createSVGMatrix().scaleNonUniform(a.x,a.y).inverse();return this.multiply(a)};
SVGMatrix.prototype.rotateAroundPt=function(a,b){var c=this.translate(b.x,b.y);c=c.rotate(a);return c=c.translate(-b.x,-b.y)};SVGMatrix.prototype.scaleAroundPt=function(a,b,c){var d=this.translate(c.x,c.y);d=d.scaleNonUniform(a,b);return d=d.translate(-c.x,-c.y)};SVGMatrix.prototype.copyTo=function(a){a.a=this.a;a.b=this.b;a.c=this.c;a.d=this.d;a.e=this.e;a.f=this.f};
SVGMatrix.prototype.transformPointList=function(a,b){var c=a.length,d=a;b&&(d=[]);for(var e=0;e<c;e++)d[e]=a[e].matrixTransform(this);return d};SVGMatrix.prototype.deltaTransformPoint=function(a){return{x:a.x*this.a+a.y*this.c,y:a.x*this.b+a.y*this.d}};SVGMatrix.prototype.getRotation=function(){var a=this.deltaTransformPoint({x:0,y:1});return 180/Math.PI*Math.atan2(a.y,a.x)-90};
SVGMatrix.prototype.getScale=function(){return{x:Math.sqrt(this.a*this.a+this.b*this.b),y:Math.sqrt(this.c*this.c+this.d*this.d)}};SVGMatrix.prototype.getTranslation=function(){return SVGUtils.createSVGPoint(this.e,this.f)};
SVGMatrix.prototype.decompose=function(a){var b=this.a,c=this.b,d=this.c,e=this.d;var f=Math.acos;var g=Math.atan,h=Math.sqrt,k=Math.PI,l=this.e,n=this.f,m=0,y=0,p=0;var K=b*e-c*d;a?b?(y=g(d/b),p=g(c/b),f=b,K/=b):c?(m=.5*k,f=c,K/=c,y=g(e/c)):(f=d,K=e,y=.25*k):b||c?(k=h(b*b+c*c),m=0<c?f(b/k):-f(b/k),f=k,K/=k,y=g((b*d+c*e)/(k*k))):d||e?(p=h(d*d+e*e),m=.5*k-(0<e?f(-d/p):-f(d/p)),f=K/p,K=p,p=g((b*d+c*e)/(p*p))):K=f=0;return{translateX:l,translateY:n,scaleX:f,scaleY:K,skewX:y,skewY:p,rotation:m}};
SVGPoint.prototype.clone=function(){return SVGUtils.createSVGPoint(this.x,this.y)};SVGPoint.prototype.getAngleFromPoint=function(a,b){for(var c=Math.atan2(a.y-this.y,a.x-this.x);0>c;)c+=2*Math.PI;1==b&&(c=180*c/Math.PI);return c};SVGPoint.prototype.set=function(a,b){this.x=a;this.y=b};SVGPoint.prototype.getDistanceFromPoint=function(a){var b=a.x-this.x;a=a.y-this.y;return Math.sqrt(b*b+a*a)};SVGPoint.prototype.getDistance=function(a,b){var c=a.x-this.x,d=a.y-this.y;c=c*c+d*d;return b?c:Math.sqrt(c)};
SVGPoint.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};SVGPoint.prototype.normalize=function(a){void 0===a&&(a=1);var b=this.getLength();a=0!=b?a/b:0;return SVGUtils.createSVGPoint(this.x*a,this.y*a)};SVGPoint.prototype.scale=function(a,b){this.x*=a;this.y*=b};SVGPoint.prototype.translate=function(a,b){this.x+=a;this.y+=b};SVGPoint.prototype.isZero=function(){return 0==this.x&&0==this.y};SVGPoint.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};
SVGPoint.prototype.add=function(a){return void 0===a.x?SVGUtils.createSVGPoint(this.x+a,this.y+a):SVGUtils.createSVGPoint(this.x+a.x,this.y+a.y)};SVGPoint.prototype.subtract=function(a){return void 0===a.x?SVGUtils.createSVGPoint(this.x-a,this.y-a):SVGUtils.createSVGPoint(this.x-a.x,this.y-a.y)};SVGPoint.prototype.multiply=function(a){return void 0===a.x?SVGUtils.createSVGPoint(this.x*a,this.y*a):SVGUtils.createSVGPoint(this.x*a.x,this.y*a.y)};
SVGPoint.prototype.divide=function(a){return void 0===a.x?SVGUtils.createSVGPoint(this.x/a,this.y/a):SVGUtils.createSVGPoint(this.x/a.x,this.y/a.y)};SVGPoint.prototype.modulo=function(a){return void 0===a.x?SVGUtils.createSVGPoint(this.x%a,this.y%a):SVGUtils.createSVGPoint(this.x%a.x,this.y%a.y)};SVGPoint.prototype.negate=function(a){return SVGUtils.createSVGPoint(-this.x,-this.y)};SVGPoint.prototype.dot=function(a){return this.x*a.x+this.y*a.y};
SVGPoint.prototype.cross=function(a){return this.x*a.y-this.y*a.x};SVGElement.SVG_NS="http://www.w3.org/2000/svg";SVGElement.XLINK_NS="http://www.w3.org/1999/xlink";var SVGUtils=document.createElementNS(SVGElement.SVG_NS,"svg"),XMLUtils=(new DOMParser).parseFromString("<xml></xml>","application/xml");_=SVGElement.prototype;_.placeAt=function(a,b){this.setAttribute("transform","matrix(1 0 0 1 "+a+" "+b+")")};
_.setPivot=function(a,b){var c=this.getTransform().matrix,d=this.ownerSVGElement.createSVGMatrix();d=d.translate(a,b);this.getTransform().setMatrix(d.multiply(c))};_.setChildrenPivot=function(a,b){var c=this.children,d,e=c.length;for(d=0;d<e;d++){var f=c[d];console.log("setChildrenPivot",f);f.setPivot(-a,-b)}};_.isLocked=function(){for(var a=this;a.parentElement;){if(a.classList.contains("locked"))return!0;if(a===this.content)break;a=a.parentElement}return!1};
_.isSelected=function(){return this.hasAttribute("selected")?!0:!1};_.getLayerOwner=function(){for(var a=this;a.parentElement;){if(a.parentElement.classList.contains("layer"))return a.parentElement;a=a.parentElement}return null};_.getFirstLevelOfLayerOwner=function(){for(var a=this;a.parentElement;){if(a.parentElement.classList.contains("layer"))return a;a=a.parentElement}return null};_.__appendChild=_.appendChild;_.__insertBefore=_.insertBefore;_.__replaceChild=_.replaceChild;_.__removeChild=_.removeChild;
_.__setAttribute=_.setAttribute;_.__getAttribute=_.getAttribute;_.removeChild=function(a){if(a.onBeforeRemove)a.onBeforeRemove();a=this.__removeChild(a);if(a.onRemoved)a.onRemoved();return a};_.appendChild=function(a){a=this.__appendChild(a);if(a.onAdded)a.onAdded();return a};_.insertBefore=function(a,b){var c=this.__insertBefore(a,b);if(c.onAdded)c.onAdded();return c};_.replaceChild=function(a,b){var c=this.__replaceChild(a,b);if(c.onAdded)c.onAdded();if(b.onRemoved)b.onRemoved();return c};
_.setAttribute=function(a,b){this.__setAttribute(a,b);this.onAttributeChanged(a)};_.onAttributeChanged=function(a){};_.onGeometryChanged=function(a){console.log("onGeometryChanged",this)};_.onStyleChanged=function(a){console.log("onStyleChanged",this)};_.renderRequest=function(a,b){if(0===a)this.render();else if(1!=this.waitForRendering){this.waitForRendering=!0;var c=this;setTimeout(function(){!0===c.waitForRendering&&(c.render(),b&&b(c))},a||0)}};_.render=function(){this.waitForRendering=!1};
_.getGeometryPointList=function(){return[]};_.setStrokeAndFill=function(a,b,c,d){a=a||"none";b=b||"none";this.setAttribute("stroke",a);this.setAttribute("fill",b);"none"!=a&&(this.setAttribute("stroke-width",c||1),d=d||"none","none"!=d&&this.setAttribute("stroke-dasharray",d))};
_.createUniqueFillStrokeDefReferences=function(a){if(this.ownerSVGElement){var b;!0===a?(this.hasAttribute("fill")&&-1<this.getAttribute("fill").indexOf("url(#")&&(b=this.ownerSVGElement.getElementFromProjectDefs(this.getAttribute("fill")))&&this.setAttribute("fill",this.ownerSVGElement.addElementToProjectDefs(b.cloneNode(!0))),this.hasAttribute("stroke")&&-1<this.getAttribute("stroke").indexOf("url(#")&&(b=this.ownerSVGElement.getElementFromProjectDefs(this.getAttribute("stroke")))&&this.setAttribute("stroke",
this.ownerSVGElement.addElementToProjectDefs(b.cloneNode(!0)))):(this.hasAttribute("fill")&&-1<this.getAttribute("fill").indexOf("url(#")&&(b=String.extractIdFromUrl(this.getAttribute("fill")),0===b.indexOf("IDI_")&&(b=this.ownerSVGElement.getElementFromProjectDefs(this.getAttribute("fill")),!b||"linearGradient"!=b.nodeName&&"radialGradient"!=b.nodeName||this.setAttribute("fill",this.ownerSVGElement.addElementToProjectDefs(b.cloneNode(!0))))),this.hasAttribute("stroke")&&-1<this.getAttribute("stroke").indexOf("url(#")&&
(b=String.extractIdFromUrl(this.getAttribute("stroke")),0===b.indexOf("IDI_")&&(b=this.ownerSVGElement.getElementFromProjectDefs(this.getAttribute("stroke")),!b||"linearGradient"!=b.nodeName&&"radialGradient"!=b.nodeName||this.setAttribute("stroke",this.ownerSVGElement.addElementToProjectDefs(b.cloneNode(!0))))));b=this.children.length;for(var c=0;c<b;c++)this.children[c].createUniqueFillStrokeDefReferences(a)}else console.log("createUniqueFillStrokeDefReferences",this.ownerSVGElement)};
_.isTextAttribute=function(a){return-1<"font-family text-decoration font-style text-align font-weight font-size letter-spacing word-spacing line-height".split(" ").indexOf(a)?!0:!1};_.isGraphicAttribute=function(a){return-1<"opacity fill stroke fill-opacity stroke-opacity fill-rule paint-order stroke-width stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit marker-start marker-end marker-mid".split(" ").indexOf(a)?!0:!1};
_.stylePropertiesToAttributes=function(a){a=a||this.style;a.opacity&&(this.__setAttribute("opacity",a.opacity),this.style.removeProperty("opacity"));a.fill&&(this.__setAttribute("fill",a.fill),this.style.removeProperty("fill"));a.stroke&&(this.__setAttribute("stroke",a.stroke),this.style.removeProperty("stroke"));a.fillOpacity&&("1"!=a.fillOpacity&&this.__setAttribute("fill-opacity",a.fillOpacity),this.style.removeProperty("fill-opacity"));a.strokeOpacity&&("1"!=a.strokeOpacity&&this.__setAttribute("stroke-opacity",
a.strokeOpacity),this.style.removeProperty("stroke-opacity"));a.fillRule&&("nonzero"!=a.fillRule&&this.__setAttribute("fill-rule",a.fillRule),this.style.removeProperty("fill-rule"));a["stroke-width"]&&(this.__setAttribute("stroke-width",a["stroke-width"]),this.style.removeProperty("stroke-width"));a["stroke-linecap"]&&(this.__setAttribute("stroke-linecap",a["stroke-linecap"]),this.style.removeProperty("stroke-linecap"));a["stroke-linejoin"]&&(this.__setAttribute("stroke-linejoin",a["stroke-linejoin"]),
this.style.removeProperty("stroke-linejoin"));a["stroke-miterlimit"]&&(this.__setAttribute("stroke-miterlimit",a["stroke-miterlimit"]),this.style.removeProperty("stroke-miterlimit"));a["marker-start"]&&("none"!=a["marker-start"]&&this.__setAttribute("marker-start",a["marker-start"]),this.style.removeProperty("marker-start"));a["marker-end"]&&("none"!=a["marker-end"]&&this.__setAttribute("marker-end",a["marker-end"]),this.style.removeProperty("marker-end"));a["marker-mid"]&&("none"!=a["marker-mid"]&&
this.__setAttribute("marker-mid",a["marker-mid"]),this.style.removeProperty("marker-mid"));a["font-family"]&&(this.__setAttribute("font-family",a["font-family"].replace(/"/g,"")),this.style.removeProperty("font-family"));a["font-weight"]&&(this.__setAttribute("font-weight",a["font-weight"]),this.style.removeProperty("font-weight"));a["font-size"]&&(this.__setAttribute("font-size",parseFloat(a["font-size"])),this.style.removeProperty("font-size"));a.filter&&(this.__setAttribute("filter",a.filter.replace(/"/g,
"")),this.style.removeProperty("filter"));this.removeAttribute("style")};_.getTransform=function(){if(0==this.transform.baseVal.numberOfItems){var a=SVGUtils.createSVGTransformFromMatrix(SVGUtils.createSVGMatrix());this.transform.baseVal.appendItem(a)}return this.transform.baseVal.getItem(0)};_.globalMatrixToLocalMatrix=function(a){var b=this.parentNode;b instanceof SVGMaskElement&&(b=b.parentNode);return this.ownerSVGElement.getTransformToElement(b).multiply(a)};_.screenMatrixToLocalMatrix=function(a){return this.getScreenCTM().inverse().multiply(a)};
_.rotateAroundGlobalPt=function(a,b){var c=this.ownerSVGElement.createSVGMatrix(),d=this.getCTM();c=c.identity().translate(-b.x,-b.y);d=c.multiply(d);c=c.identity().rotate(a);d=c.multiply(d);c=c.identity().translate(b.x,b.y);d=c.multiply(d);this.getTransform().setMatrix(this.globalMatrixToLocalMatrix(d))};
_.scaleAroundGlobalPt=function(a,b,c,d){if(1==d){c=this.globalToLocal(c.x,c.y);d=this.getTransform();var e=d.matrix;e=e.translate(c.x,c.y);e=e.scaleNonUniform(a,b);e=e.translate(-c.x,-c.y);d.setMatrix(e)}else d=this.getCTM(),e=this.ownerSVGElement.createSVGMatrix(),e=e.translate(-c.x,-c.y),d=e.multiply(d),e.identity(),e=e.scaleNonUniform(a,b),d=e.multiply(d),e.identity(),e=e.translate(c.x,c.y),d=e.multiply(d),this.getTransform().setMatrix(this.globalMatrixToLocalMatrix(d))};
_.translateInGlobal=function(a,b){var c=this.ownerSVGElement.createSVGMatrix().translate(a,b).multiply(this.getCTM());this.getTransform().setMatrix(this.globalMatrixToLocalMatrix(c))};
_.globalRectToLocalPolygon=function(a){var b=this.ownerSVGElement.getTransformToElement(this),c=this.ownerSVGElement.createSVGPoint();c.x=a.x;c.y=a.y;var d=c.matrixTransform(b);c.x=a.x+a.width;c.y=a.y;var e=c.matrixTransform(b);c.x=a.x+a.width;c.y=a.y+a.height;var f=c.matrixTransform(b);c.x=a.x;c.y=a.y+a.height;a=c.matrixTransform(b);return[d,e,f,a,d]};
_.localRectToGlobalPolygon=function(a){var b=this.getTransformToElement(this.ownerSVGElement),c=this.ownerSVGElement.createSVGPoint();c.x=a.x;c.y=a.y;var d=c.matrixTransform(b);c.x=a.x+a.width;c.y=a.y;var e=c.matrixTransform(b);c.x=a.x+a.width;c.y=a.y+a.height;var f=c.matrixTransform(b);c.x=a.x;c.y=a.y+a.height;a=c.matrixTransform(b);return[d,e,f,a,d]};_.outsetBBox=function(a,b){a.min.x-=b;a.min.y-=b;a.max.x+=b;a.max.y+=b;return a};
_.insetBBox=function(a,b){a.min.x+=b;a.min.y+=b;a.max.x-=b;a.max.y-=b;return a};_.getLocalBBox=function(){var a=this.getBBox();a.center={x:a.x+a.width/2,y:a.y+a.height/2};a.min={x:a.x,y:a.y};a.max={x:a.x+a.width,y:a.y+a.height};return a};
_.getGlobalBBox=function(){if("firefox"==BROWSER_TYPE)return this.getGlobalBBoxByLocalBox();var a=this.getBoundingClientRect(),b={};b.y=b.top=a.top-DOCUMENT_OFFSET.y;b.x=b.left=a.left-DOCUMENT_OFFSET.x;b.width=a.width;b.height=a.height;b.min={x:b.x,y:b.y};b.max={x:b.x+b.width,y:b.y+b.height};b.center={x:b.x+b.width/2,y:b.y+b.height/2};b.right=b.max.x;b.bottom=b.max.y;return b};
_.getGlobalBBoxByLocalBox=function(){var a=this.getCTM(),b=this.ownerSVGElement.createSVGPoint();var c=this.getLocalBBox();b.x=c.x;b.y=c.y;var d=b.matrixTransform(a);b.x=c.x+c.width;b.y=c.y;var e=b.matrixTransform(a);b.x=c.x+c.width;b.y=c.y+c.height;var f=b.matrixTransform(a);b.x=c.x;b.y=c.y+c.height;var g=b.matrixTransform(a);a=Math.min(d.x,e.x,f.x,g.x);b=Math.max(d.x,e.x,f.x,g.x);var h=Math.min(d.y,e.y,f.y,g.y);d=Math.max(d.y,e.y,f.y,g.y);c.min={x:a,y:h};c.max={x:b,y:d};c.x=a;c.y=h;c.width=b-a;
c.height=d-h;c.left=a;c.right=b;c.top=h;c.bottom=d;c.center={x:c.x+c.width/2,y:c.y+c.height/2};return c};_.getSnapPointList=function(){return this.getGeometryPointList()};_.findSnapToPoint=function(a,b){for(var c=this.globalToLocal(a.x,a.y),d=this.getSnapPointList(),e,f=d.length,g=0;g<f;g++)if(e=d[g],e.x>c.x-b&&e.x<c.x+b&&e.y>c.y-b&&e.y<c.y+b)return e.idSegment=g,e;return null};_.getLocalCenter=function(){var a=this.getBBox();return{x:a.x+a.width/2,y:a.y+a.height/2}};
_.getTransformToElement||(_.getTransformToElement=function(a){return a.getScreenCTM().inverse().multiply(this.getScreenCTM())});_.globalToLocal=function(a,b){if(!this.ownerSVGElement)return{x:a,y:b};var c=this.ownerSVGElement.createSVGPoint(a,b),d=this.ownerSVGElement.getTransformToElement(this);return c.matrixTransform(d)};_.localToGlobal=function(a,b){var c=this.ownerSVGElement.createSVGPoint();c.x=a;c.y=b;return c.matrixTransform(this.getCTM())};
_.screenValueInLocal=function(a){return this.getScreenCTM().inverse().getScale().x*a};_.screenToLocal=function(a,b){return this.ownerSVGElement.createSVGPoint(a,b).matrixTransform(this.getScreenCTM().inverse())};_.localToScreen=function(a,b){var c=this.ownerSVGElement.createSVGPoint();c.x=a;c.y=b;return c.matrixTransform(this.getScreenCTM())};_.prepareToNormalizeScale=function(a){};_.normalizeScale=function(a){};
_.scaleAttributeNumber=function(a,b){this.hasAttribute(a)&&this.setAttribute(a,parseFloat(this.getAttribute(a))*b)};_.isContainedInGlobalRect=function(a){var b=this.getGlobalBBox();return b.left>a.left&&b.right<a.right&&b.top>a.top&&b.bottom<a.bottom?!0:!1};_.isPointInRect=function(a,b){return a.x>b.left&&a.x<b.right&&a.y>b.top&&a.y<b.bottom?!0:!1};
_.isPointInPoly=function(a,b){for(var c=!1,d=-1,e=a.length,f=e-1;++d<e;f=d)(a[d].y<=b.y&&b.y<a[f].y||a[f].y<=b.y&&b.y<a[d].y)&&b.x<(a[f].x-a[d].x)*(b.y-a[d].y)/(a[f].y-a[d].y)+a[d].x&&(c=!c);return c};_.intersectGlobalRect=function(a){var b=this.getGlobalBBox();return!(b.left>a.right||b.right<a.left||b.top>a.bottom||b.bottom<a.top)};
_.toSVGPathElement=function(){if(!this.getBBox)return null;var a=this.getLocalBBox();a=this.ownerSVGElement.createRect(a.x,a.y,a.width,a.height);var b=this.ownerSVGElement.createPath();b.setPathData(a.getPathData({normalize:!0}));return b};_.getSelectedTransformableGeometryPointList=function(){for(var a=[],b=this.getGeometryPointList(),c=0;c<b.length;c++)b[c].isSelected&&a.push(b[c]);return a};
_.getGradient=function(a){if(!this.hasAttribute(a))return null;a=this.getAttribute(a);return(a=this.getElementFromDocumentByIRI(a))&&(a instanceof SVGLinearGradientElement||a instanceof SVGRadialGradientElement)?a:null};_.getElementFromDocumentByIRI=function(a){return-1!=a.indexOf("url")&&(a=a.split("#")[1].split(")")[0],a=a.split('"')[0],a=document.querySelector('[id="'+a+'"]'))?a:null};
_.normalizeGradientScale=function(a,b){var c=a.getAttribute("gradientUnits")||"objectBoundingBox";console.log("gradientUnits",c);if("objectBoundingBox"!=c&&b.scaleStrokeAndEffects)if(a instanceof SVGRadialGradientElement){var d=this.ownerSVGElement.createSVGPoint(a.cx.baseVal.value,a.cy.baseVal.value);c=this.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix);d=d.matrixTransform(c);a.cx.baseVal.value=d.x;a.cy.baseVal.value=d.y;c=this.normalizationData.storedScreenMatrix.getScale();
a.r.baseVal.value*=Math.sqrt(Math.abs(c.x)*Math.abs(c.y))}else if(a instanceof SVGLinearGradientElement){d=this.ownerSVGElement.createSVGPoint(a.x1.baseVal.value,a.y1.baseVal.value);var e=this.ownerSVGElement.createSVGPoint(a.x2.baseVal.value,a.y2.baseVal.value);c=this.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix);d=d.matrixTransform(c);e=e.matrixTransform(c);a.x1.baseVal.value=d.x;a.y1.baseVal.value=d.y;a.x2.baseVal.value=e.x;a.y2.baseVal.value=e.y}};
SVGElement.elementFromString=function(a){return(new DOMParser).parseFromString(a,"text/xml").documentElement.firstChild};_=SVGSVGElement.prototype;"firefox"==BROWSER_TYPE&&(_.getIntersectionList=function(a,b){b=b||[];for(var c,d,e=this.querySelectorAll(".layer > *:not(.locked)"),f=0;f<e.length;f++){d=e[f];for(var g=0;g<d.children.length;g++)switch(c=d.children[g],console.log("child",c),c.nodeName){case "g":case "image":case "path":case "line":case "rect":c.intersectGlobalRect(a)&&b.push(c)}}return b});
_.createSVGLinearGradient=function(a,b,c,d,e,f,g){f=f||"objectBoundingBox";g=g||"pad";var h=document.createElementNS(SVGElement.SVG_NS,"linearGradient");h.setAttribute("id",a);h.setAttribute("x1",b);h.setAttribute("y1",c);h.setAttribute("x2",d);h.setAttribute("y2",e);h.setAttribute("gradientUnits",f);h.setAttribute("gradientTransform","matrix(1 0 0 1 0 0)");h.setAttribute("spreadMethod",g);return h};
_.createSVGRadialGradient=function(a,b,c,d,e,f){e=e||"objectBoundingBox";f=f||"pad";var g=document.createElementNS(SVGElement.SVG_NS,"radialGradient");g.setAttribute("id",a);g.setAttribute("cx",b);g.setAttribute("cy",c);g.setAttribute("r",d);g.setAttribute("gradientUnits",e);g.setAttribute("gradientTransform","matrix(1 0 0 1 0 0)");g.setAttribute("spreadMethod",f);return g};
_.createSVGStopColor=function(a,b,c){var d=document.createElementNS(SVGElement.SVG_NS,"stop");d.setAttribute("offset",a);d.setAttribute("stop-color",b);c&&d.setAttribute("stop-opacity",c);return d};
_.createSVGStopColorsFromCSS=function(a){var b=[],c=a.indexOf("("),d=a.lastIndexOf(")");a=a.substring(c+1,d);c=a.indexOf("rgb");-1==c&&(c=a.indexOf("rgba"));for(-1==c&&(c=a.indexOf("#"));-1!=c;){d=a.indexOf(")",c+1);var e=a.substring(c,d+1);c=d+1;d=a.indexOf("%",c+1);c=Number(a.substring(c,d))/100;var f=this.createSVGStopColor(c,e);console.log("offsetValue: "+c+"  colorValue "+e);console.log(f);b.push(f);c=a.indexOf("rgb",d+1);-1==c&&(c=a.indexOf("rgba",d+1));-1==c&&(c=a.indexOf("#",d+1))}return b};
_.createSVGGradientFromCSS=function(a,b){b=b||"__"+(new Date).getTime()+"__";var c=-1!=a.indexOf("linear")?this.createSVGLinearGradient(b,0,0,100,100):this.createSVGRadialGradient(b,0,0,100);c.appendChildren(this.createSVGStopColorsFromCSS(a));return c};
_.createSVGImage=function(a,b,c,d,e,f){b=b||0;c=c||0;var g=document.createElementNS(SVGElement.SVG_NS,"image");g.setAttribute("x",b);g.setAttribute("y",c);d&&e?(g.setAttributeNS(SVGElement.XLINK_NS,"href",a),g.setAttribute("width",d),g.setAttribute("height",e)):(b=new Image,b.src=a,b.onload=function(){g.setAttributeNS(SVGElement.XLINK_NS,"href",a);g.setAttribute("width",this.width);g.setAttribute("height",this.height);f&&f(g)});return g};
_.createSVGPatternFromImageUrl=function(a,b,c,d,e,f){b=b||"__"+(new Date).getTime()+"__";c=c||0;d=d||0;var g=this.createPattern(b,0,0,e,f);g.appendChild(this.createSVGImage(a,c,d,e,f));console.log("_width",e);console.log("_height",f);e||f||(console.log("carico image"),c=new Image,c.onload=function(a){console.log("onLoad image");g.setAttribute("width",this.naturalWidth);g.setAttribute("height",this.naturalHeight)},c.onload(a));return g};
_.createSVGPatternFromImage=function(a,b,c,d,e,f){b=b||"__"+(new Date).getTime()+"__";c=c||0;d=d||0;e=e||a.naturalWidth;f=f||a.naturalHeight;b=this.createPattern(b,0,0,e,f);b.appendChild(this.createSVGImage(a.src,c,d,e,f));return b};
_.parseTransformString=function(a){var b={rotate:{value:0,x:0,y:0},scale:{x:1,y:1}};if(!a)return b;var c=a.indexOf("rotate");if(-1<c){c=a.indexOf("(",c+6);var d=a.indexOf(")",c);c=a.substring(c+1,d);console.log("rotate properties",c);b.rotate={value:0,x:0,y:0};c=c.split(",");c[0]&&(b.rotate.value=parseFloat(c[0]));c[1]&&(b.rotate.x=parseFloat(c[1]));c[2]&&(b.rotate.y=parseFloat(c[2]))}c=a.indexOf("scale");-1<c&&(c=a.indexOf("(",c+5),d=a.indexOf(")",c),c=a.substring(c+1,d),console.log("scale properties",
c),b.scale={x:1,y:1},c=c.split(","),c[0]&&(b.scale.x=parseFloat(c[0])),c[1]&&(b.scale.y=parseFloat(c[1])));return b};_.__createSVGPoint=_.createSVGPoint;_.createSVGPoint=function(a,b){var c=this.__createSVGPoint();c.x=a||0;c.y=b||0;return c};_.createSVGPointPolar=function(a,b){var c=this.__createSVGPoint();c.x=a*Math.cos(b);c.y=a*Math.sin(b);return c};
_.getBBoxPointByLocationName=function(a,b){b=b||this.bbox;var c=(a||"left-top").split("-"),d=this.createSVGPoint();switch(c[0]){case "left":d.x=b.x;break;case "center":d.x=b.x+b.width/2;break;case "right":d.x=b.x+b.width}switch(c[1]){case "top":d.y=b.y;break;case "center":d.y=b.y+b.height/2;break;case "bottom":d.y=b.y+b.height}return d};_.getFill=function(){return this.hasAttribute("fill")?this.getAttribute("fill"):"#000000"};
_.getStroke=function(){return this.hasAttribute("stroke")?this.getAttribute("stroke"):"none"};_.getAngleBetweenPoints=function(a,b,c,d){a=Math.atan2(a.y-b.y,a.x-b.x);d&&(a-=d);for(c&&(a=Math.round(a/c)*c);0>a;)a+=2*Math.PI;return a};_.getLineLineIntersection=function(a,b,c,d){var e=d.x-c.x;var f=d.y-c.y;d=b.x-a.x;b=b.y-a.y;var g=a.y-c.y,h=a.x-c.x;c=f*d-e*b;e=(e*g-f*h)/c;f=(d*g-b*h)/c;return 0<=e&&1>=e&&0<=f&&1>=f?(f=a.y+e*b,e=a.x+e*d,{x:e,y:f}):null};
_.getPolygonLineIntersection=function(a,b,c,d){console.log(a);for(var e,f=[],g=a.length-1,h=0;h<g;h++)if(e=this.getLineLineIntersection(a[h],a[h+1],b,c),console.log("intersectionPt"),console.log(e),e){if(d)return!0;f.push(e)}return d?!1:e};_.createRect=function(a,b,c,d,e){var f=document.createElementNS(SVGElement.SVG_NS,"rect");e?f.setAttribute("transform","matrix(1,0,0,1,"+a+","+b+")"):(f.setAttribute("x",a),f.setAttribute("y",b));c&&f.setAttribute("width",c);d&&f.setAttribute("height",d);return f};
_.createCircle=function(a,b,c){var d=document.createElementNS(SVGElement.SVG_NS,"circle");d.setAttribute("cx",a);d.setAttribute("cy",b);d.setAttribute("r",c);return d};
_.createTextBox=function(a,b,c,d,e,f,g,h,k){var l=document.createElementNS(SVGElement.SVG_NS,"text");l.setAttribute("data-type","TextBox");l.setAttribute("transform","matrix(1,0,0,1,"+a+","+b+")");l.setAttribute("width",c);l.setAttribute("height",d);k=k||"left";h=h||"12";g=g||"regular";l.setAttribute("font-family",f||"arial");l.setAttribute("font-size",h);l.setAttribute("font-style",g);l.setAttribute("text-align",k);a="start";"left"==k?a="start":"center"==k?a="middle":"right"==k&&(a="end");l.setAttribute("text-anchor",
a);l.setText(e);return l};_.textElementsToInputTextFields=function(a){for(var b=a.querySelectorAll("text.input-text"),c=0;c<b.length;c++)b[c].toHTML_inputField(a),b[c].parentElement.removeChild(b[c])};_.createForeingObject=function(a,b,c,d,e){var f=document.createElementNS(SVGElement.SVG_NS,"foreignObject");f.setAttribute("transform","matrix(1,0,0,1,"+a+","+b+")");f.setAttribute("x",0);f.setAttribute("y",0);f.setAttribute("width",c);f.setAttribute("height",d);f.innerHTML=e;return f};
_.createClipPath=function(a){var b=document.createElementNS(SVGElement.SVG_NS,"clipPath");b.setAttribute("id",a);return b};_.createMask=function(a){var b=document.createElementNS(SVGElement.SVG_NS,"mask");b.setAttribute("id",a);return b};_.createEllipse=function(a,b,c,d){var e=document.createElementNS(SVGElement.SVG_NS,"ellipse");e.setAttribute("cx",a);e.setAttribute("cy",b);e.setAttribute("rx",c);e.setAttribute("ry",d);return e};
_.createGroup=function(a,b,c){var d=document.createElementNS(SVGElement.SVG_NS,"g");d.setAttribute("transform","matrix(1,0,0,1,"+(a||0)+","+(b||0)+")");c&&d.setAttribute("id",c);return d};_.createPath=function(){return document.createElementNS(SVGElement.SVG_NS,"path")};_.createSymbol=function(a){var b=document.createElementNS(SVGElement.SVG_NS,"symbol");b.setAttribute("id",a);b.style.overflow="visible";return b};
_.createMarker=function(a,b,c,d,e,f,g){var h=document.createElementNS(SVGElement.SVG_NS,"marker");h.setAttribute("id",a);f=f||0;g=g||"auto";d=d||"strokeWidth";h.setAttribute("refX",e||0);h.setAttribute("refY",f);h.setAttribute("orient",g);h.setAttribute("markerUnits",d);h.setAttribute("style","overflow:visible;");b&&h.setAttribute("markerWidth",b);c&&h.setAttribute("markerHeight",c);return h};
_.createPattern=function(a,b,c,d,e,f,g,h){var k=document.createElementNS(SVGElement.SVG_NS,"pattern");k.setAttribute("id",a);c=c||0;d=d||100;e=e||100;h=h||"userSpaceOnUse";k.setAttribute("x",b||0);k.setAttribute("y",c);(f||g)&&k.setAttribute("patternTransform","rotate("+f+") scale("+g+") ");k.setAttribute("patternUnits",h);k.setAttribute("width",d);k.setAttribute("height",e);return k};_.createDefs=function(){return document.createElementNS(SVGElement.SVG_NS,"defs")};
_.createUse=function(a){var b=document.createElementNS(SVGElement.SVG_NS,"use");b.setAttribute("href","#"+a);return b};_.createXlink=function(a,b){var c=document.createElementNS(SVGElement.SVG_NS,"a");c.setAttribute("xlink:href",a);b&&c.setAttribute("target",b);return c};_.createLine=function(a,b,c,d){var e=document.createElementNS(SVGElement.SVG_NS,"line");e.setAttribute("x1",a);e.setAttribute("y1",b);e.setAttribute("x2",c);e.setAttribute("y2",d);return e};
_.createSVG=function(a,b){var c=document.createElementNS(SVGElement.SVG_NS,"svg");c.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");a&&c.setAttribute("width",a);b&&c.setAttribute("height",b);return c};_.refresh=function(){this.getTransform().matrix.identity()};_.getMainElement=function(a){var b=a;b instanceof SVGTSpanElement&&(b=b.parentElement);b instanceof SVGTextPathElement&&(b=b.parentElement);"DIV"==a.nodeName&&(a=a.getParentElementByNodeName("foreignObject"))&&(b=a);return b};
_.refactorElementID=function(a,b){var c=a.getAttribute("id");b=b||CreateUniqueIDI();a.setAttribute("id",b);switch(a.nodeName){case "symbol":var d=this.querySelectorAll('use[href="#'+c+'"]');this.setAttributeElementList(d,{href:"#"+b});break;case "filter":d=this.querySelectorAll('*[filter="url(#'+c+')"]');this.setAttributeElementList(d,{filter:"url(#"+b+")"});break;case "marker":d=this.querySelectorAll('*[marker-start="url(#'+c+')"]');this.setAttributeElementList(d,{"marker-start":"url(#"+b+")"});
d=this.querySelectorAll('*[marker-mid="url(#'+c+')"]');this.setAttributeElementList(d,{"marker-mid":"url(#"+b+")"});d=this.querySelectorAll('*[marker-end="url(#'+c+')"]');this.setAttributeElementList(d,{"marker-end":"url(#"+b+")"});break;case "linearGradient":case "radialGradient":case "pattern":d=this.querySelectorAll('*[fill="url(#'+c+')"]');this.setAttributeElementList(d,{fill:"url(#"+b+")"});d=this.querySelectorAll('*[stroke="url(#'+c+')"]');this.setAttributeElementList(d,{stroke:"url(#"+b+")"});
break;default:d=this.querySelectorAll('*[clip-path="url(#'+c+')"]'),this.setAttributeElementList(d,{"clip-path":"url(#"+b+")"}),d=this.querySelectorAll('*[mask="url(#'+c+')"]'),this.setAttributeElementList(d,{mask:"url(#"+b+")"}),d=this.querySelectorAll('*[*|href="#'+c+'"]'),this.setAttributeElementList(d,{href:"#"+b})}};
_.getReferencedElementList=function(a){var b=a.getAttribute("id");switch(a.nodeName){case "symbol":return this.querySelectorAll('use[href="#'+b+'"]');case "filter":return this.querySelectorAll('*[filter="url(#'+b+')"]');case "marker":return this.querySelectorAll('*[marker-start="url(#'+b+')"],*[marker-mid="url(#'+b+')"],*[marker-end="url(#'+b+')"]');case "linearGradient":case "radialGradient":case "pattern":return this.querySelectorAll('*[fill="url(#'+b+')"],*[stroke="url(#'+b+')"]');default:return this.querySelectorAll('*[clip-path="url(#'+
b+')"],*[mask="url(#'+b+')"],*[*|href="url(#'+b+')"]')}};
_.removeUnusedDefsItems=function(a,b){b=b||this.querySelectorAll("defs>*[id]");for(var c,d=0;d<b.length;d++){c=b[d];if("linearGradient"==c.nodeName||"radialGradient"==c.nodeName){if(0==a.removeUnusedGradients)continue}else if("pattern"==c.nodeName){if(0==a.removeUnusedPatterns)continue}else if("symbol"==c.nodeName){if(0==a.removeUnusedSymbols)continue}else if("filter"==c.nodeName){if(0==a.removeUnusedFilters)continue}else if("marker"==c.nodeName&&0==a.removeUnusedMarkers)continue;0==this.getReferencedElementList(c).length&&
c.remove()}};_.rebuildDynamicIDs=function(a){for(var b,c=this.querySelectorAll('*[id^="IDI_"]'),d=0;d<c.length;d++){b=c[d];if("linearGradient"==b.nodeName||"radialGradient"==b.nodeName){if(1!=a.renameDynamicGradients)continue}else if("pattern"==b.nodeName){if(1!=a.renameDynamicPatterns)continue}else if("symbol"==b.nodeName){if(1!=a.renameDynamicSymbols)continue}else if("filter"==b.nodeName){if(1!=a.renameDynamicFilters)continue}else if("marker"==b.nodeName&&1!=a.renameDynamicMarkers)continue;this.refactorElementID(b)}};
_.elementListFromIntersection=function(a){var b=[],c=this.getIntersectionList(a,null);console.log("elementListFromIntersection",c);for(var d,e=0;e<c.length;e++)d=c[e],d.intersectGlobalRect(a)&&b.push(d);console.log("resultList",b);return b};
_.loadImageAndGetDataURL=function(a,b){var c=new Image;c.setAttribute("crossOrigin","anonymous");c.onload=function(){var a=document.createElement("canvas");a.width=this.naturalWidth;a.height=this.naturalHeight;a.getContext("2d").drawImage(this,0,0);b(a.toDataURL("image/png"))};c.src=a};SVGPatternElement.prototype.getTransform=function(){if(0==this.patternTransform.baseVal.numberOfItems){var a=SVGUtils.createSVGTransformFromMatrix(SVGUtils.createSVGMatrix());this.patternTransform.baseVal.appendItem(a)}return this.patternTransform.baseVal.getItem(0)};
SVGGradientElement.prototype.getTransform=function(){if(0==this.gradientTransform.baseVal.numberOfItems){var a=SVGElement.svgUtils.createSVGTransformFromMatrix(SVGElement.svgUtils.createSVGMatrix());this.gradientTransform.baseVal.appendItem(a)}return this.gradientTransform.baseVal.getItem(0)};
SVGLinearGradientElement.prototype.copyPointsTo=function(a){if(a instanceof SVGRadialGradientElement){var b=this.x2.baseVal.value-this.x1.baseVal.value,c=this.y2.baseVal.value-this.y1.baseVal.value,d=Math.sqrt(b*b+c*c)/2;c=this.y1.baseVal.value+c/2;a.cx.baseVal.value=this.x1.baseVal.value+b/2;a.cy.baseVal.value=c;a.r.baseVal.value=d}else a instanceof SVGLinearGradientElement&&(console.log("_targetGradient instanceof SVGLinearGradientElement"),console.log(this),console.log(a),a.x1.baseVal.value=this.x1.baseVal.value,
a.y1.baseVal.value=this.y1.baseVal.value,a.x2.baseVal.value=this.x2.baseVal.value,a.y2.baseVal.value=this.y2.baseVal.value)};
SVGRadialGradientElement.prototype.copyPointsTo=function(a){if(a instanceof SVGRadialGradientElement)a.cx.baseVal.value=this.cx.baseVal.value,a.cy.baseVal.value=this.cy.baseVal.value,a.r.baseVal.value=this.r.baseVal.value;else if(a instanceof SVGLinearGradientElement){var b=this.cy.baseVal.value-this.r.baseVal.value,c=this.cx.baseVal.value+this.r.baseVal.value,d=this.cy.baseVal.value+this.r.baseVal.value;a.x1.baseVal.value=this.cx.baseVal.value-this.r.baseVal.value;a.y1.baseVal.value=b;a.x2.baseVal.value=
c;a.y2.baseVal.value=d}};SVGGradientElement.prototype.initDefaultPoints=function(){this.setAttribute("objectBoundingBox");"linearGradient"==this.nodeName?(this.setAttribute("x1","0"),this.setAttribute("y1","0.5"),this.setAttribute("x2","1"),this.setAttribute("y2",".5")):(this.setAttribute("cx","0.5"),this.setAttribute("cy","0.5"),this.setAttribute("r",".5"))};
SVGGradientElement.prototype.setPointsFromBBox=function(a){this instanceof SVGRadialGradientElement?(this.cx.baseVal.value=a.center.x,this.cy.baseVal.value=a.center.y,this.r.baseVal.value=a.width/2):this instanceof SVGLinearGradientElement&&(this.x1.baseVal.value=a.center.x,this.y1.baseVal.value=a.min.y,this.x2.baseVal.value=a.center.x,this.y2.baseVal.value=a.max.y)};
SVGGradientElement.prototype.insertNewStopColor=function(a,b,c){var d=SVGUtils.createSVGStopColor(a,"#FFFFFF","1");this.appendChild(d);this.sortStopColors();if(b)d.setAttribute("stop-color",b),d.setAttribute("stop-opacity",c);else{if(d.previousElementSibling){c=d.previousElementSibling;b=ColorUtils.parseColorString(c.getAttribute("stop-color"));b.a=parseFloat(c.getAttribute("stop-opacity")||1);var e=parseFloat(c.getAttribute("offset"))}else b={r:0,g:0,b:0,a:1},e=0;if(d.nextElementSibling){var f=d.nextElementSibling;
c=ColorUtils.parseColorString(f.getAttribute("stop-color"));c.a=parseFloat(f.getAttribute("stop-opacity")||1);f=parseFloat(f.getAttribute("offset"))}else c={r:0,g:0,b:0,a:1},f=1;var g=(a-e)/(f-e);a=ColorUtils.mixColorChannel(b.r,c.r,g);e=ColorUtils.mixColorChannel(b.g,c.g,g);f=ColorUtils.mixColorChannel(b.b,c.b,g);b=ColorUtils.mixColorChannel(b.a,c.a,g);d.setAttribute("stop-color",ColorUtils.rgbToHex(a,e,f));d.setAttribute("stop-opacity",b);d.setAttribute("fill",ColorUtils.rgbToHex(a,e,f))}return d};
SVGGradientElement.prototype.sortStopColors=function(){var a=[],b,c=this.children.length;for(b=0;b<c;b++)a.push(this.children[b]);a.sort(function(a,b){return a.offset.baseVal-b.offset.baseVal});this.removeChildren();for(b=0;b<c;b++)this.appendChild(a[b])};SVGGradientElement.prototype.copyStopColorsTo=function(a){var b,c=this.children.length;a.removeChildren();for(b=0;b<c;b++)a.appendChild(this.children[b].cloneNode(!0))};
SVGStopElement.prototype.stylePropertiesToAttributes=function(){var a=this.style;a["stop-opacity"]&&this.setAttribute("stop-opacity",a["stop-opacity"]);a["stop-color"]&&(a=ColorUtils.parseColorString(a["stop-color"]),console.log("stop-color",a),this.setAttribute("stop-color",ColorUtils.rgbToHex(a.r,a.g,a.b)),1!=a.a&&this.setAttribute("stop-opacity",a.a));this.style.removeProperty("stop-color");this.style.removeProperty("stop-opacity")};_=SVGGElement.prototype;
_.getLocalBBox=function(){var a=this.getBBox();if(this.hasAttribute("clip-path")){var b=this.querySelector("clipPath");b&&(a=b.getBBox())}a.center={x:a.x+a.width/2,y:a.y+a.height/2};a.min={x:a.x,y:a.y};a.max={x:a.x+a.width,y:a.y+a.height};return a};_.__getGlobalBBox=SVGElement.prototype.getGlobalBBox;_.getGlobalBBox=function(){if(this.hasAttribute("clip-path")){var a=this.querySelector("clipPath");if(a)return a.getGlobalBBox()}return this.__getGlobalBBox()};
_.normalizeScale=function(a){var b=this.parentNode;b instanceof SVGMaskElement&&(b=b.parentNode);b=b.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix);this.getTransform().setMatrix(this.getTransform().matrix.identity().translate(b.e,b.f).rotate(this.normalizationData.localRotation));b=this.childNodes.length;for(var c=0;c<b;c++)this.childNodes[c].normalizeScale&&this.childNodes[c].normalizeScale(a)};_.toSVGPathElement=function(){return null};_.__cloneNode=_.cloneNode;
_.cloneNode=function(a){var b=this.__cloneNode(!1);if(a)for(var c=0;c<this.children.length;c++)b.appendChild(this.children[c].cloneNode(a));return b};_=SVGLineElement.prototype;
_.normalizeScale=function(a){var b=this.parentElement.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix);if("non-scaling-stroke"!=this.getAttribute("vector-effect")&&a.scaleStrokeAndEffects){var c=b.getScale();this.scaleStrokeAndEffects(Math.sqrt(c.x*c.x+c.y*c.y)/Math.sqrt(2))}this.getTransform().setMatrix(this.getTransform().matrix.identity().translate(b.e,b.f).rotate(this.normalizationData.localRotation));this.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix).transformPointList(this.getGeometryPointList());
this.geometryPointList[0].ownerShapeElement=this;this.geometryPointList[1].ownerShapeElement=this;this.geometryPointList[0].id=0;this.geometryPointList[1].id=1;this.render();(b=this.getGradient("stroke"))&&this.normalizeGradientScale(b,a)};
_.intersectGlobalRect=function(a){if(this.isContainedInGlobalRect(a))return!0;a=this.globalRectToLocalPolygon(a);return this.ownerSVGElement.getPolygonLineIntersection(a,{x:this.x1.baseVal.value,y:this.y1.baseVal.value},{x:this.x2.baseVal.value,y:this.y2.baseVal.value},!0)};
Object.defineProperty(_,"width",{get:function(){var a=this.ownerSVGElement.createSVGPoint(this.getAttribute("x1"),this.getAttribute("y1"));return this.ownerSVGElement.createSVGPoint(this.getAttribute("x2"),this.getAttribute("y2")).getDistanceFromPoint(a)},set:function(a){var b=this.ownerSVGElement.createSVGPoint(this.getAttribute("x1"),this.getAttribute("y1")),c=this.ownerSVGElement.createSVGPoint(this.getAttribute("x2"),this.getAttribute("y2"));a/=c.getDistanceFromPoint(b);c.x=b.x+(c.x-b.x)*a;c.y=
b.y+(c.y-b.y)*a;this.setAttribute("x2",c.x);this.setAttribute("y2",c.y)},enumerable:!0});
Object.defineProperty(_,"orientation",{get:function(){var a=this.ownerSVGElement.createSVGPoint(this.getAttribute("x1"),this.getAttribute("y1")),b=this.ownerSVGElement.createSVGPoint(this.getAttribute("x2"),this.getAttribute("y2"));return a.getAngleFromPoint(b,!0)},set:function(a){var b=this.ownerSVGElement.createSVGPoint(this.getAttribute("x1"),this.getAttribute("y1")),c=this.ownerSVGElement.createSVGPoint(this.getAttribute("x2"),this.getAttribute("y2"));c=c.getDistanceFromPoint(b);c=this.ownerSVGElement.createSVGPointPolar(c,
Math.PI/180*a);this.setAttribute("x2",b.x+c.x);this.setAttribute("y2",b.y+c.y)},enumerable:!0});_.toSVGPathElement=function(){var a=this.ownerSVGElement.createPath();a.setPathData(this.getPathData({normalize:!0}));return a};_.updateGeometry=function(a,b,c,d){this.x1.baseVal.value=a;this.y1.baseVal.value=b;this.x2.baseVal.value=c;this.y2.baseVal.value=d};_.getPt1=function(){return{x:this.x1.baseVal.value,y:this.y1.baseVal.value}};_.getPt2=function(){return{x:this.x2.baseVal.value,y:this.y2.baseVal.value}};
_.getGeometryPointList=function(){this.geometryPointList||(this.geometryPointList=[],this.geometryPointList.push(SVGUtils.createSVGPoint(this.x1.baseVal.value,this.y1.baseVal.value)),this.geometryPointList.push(SVGUtils.createSVGPoint(this.x2.baseVal.value,this.y2.baseVal.value)),this.geometryPointList[0].ownerShapeElement=this,this.geometryPointList[1].ownerShapeElement=this,this.geometryPointList[0].id=0,this.geometryPointList[1].id=1);return this.geometryPointList};
_.setGeometryPointList=function(a){this.geometryPointList=a;this.geometryPointList[0].ownerShapeElement=this;this.geometryPointList[1].ownerShapeElement=this;this.geometryPointList[0].id=0;this.geometryPointList[1].id=1};_.cloneGeometryPointList=function(a){var b=this.getGeometryPointList(),c=[];c.push(SVGUtils.createSVGPoint(b[0].x,b[0].y));c.push(SVGUtils.createSVGPoint(b[1].x,b[1].y));a&&(c[0].isSelected=b[0].isSelected,c[1].isSelected=b[1].isSelected);return c};
_.transformGeometryPointList=function(a,b){b=b||this.getGeometryPointList();var c,d=b.length;for(c=0;c<d;c++){var e=b[c];var f=e.matrixTransform(a);e.x=f.x;e.y=f.y}};_.toElementPreview=function(){return this.cloneNode()};_.getSnapPointList=function(){var a=this.getGeometryPointList().clone();a.push(SVGUtils.createSVGPoint(a[0].x+(a[1].x-a[0].x)/2,a[0].y+(a[1].y-a[0].y)/2));return a};
_.findSnapToPoint=function(a,b,c){a=this.globalToLocal(a.x,a.y);for(var d=this.getGeometryPointList(),e,f=d.length,g=0;g<f;g++)if(e=d[g],c){if(!0!==e.isSelected&&e.x>a.x-b&&e.x<a.x+b&&e.y>a.y-b&&e.y<a.y+b)return console.log("currentPoint.isSelected",e.isSelected),e}else if(e.x>a.x-b&&e.x<a.x+b&&e.y>a.y-b&&e.y<a.y+b)return e;return null};_.getFill=function(){return"none"};
_.render=function(){this.x1.baseVal.value=this.geometryPointList[0].x;this.y1.baseVal.value=this.geometryPointList[0].y;this.x2.baseVal.value=this.geometryPointList[1].x;this.y2.baseVal.value=this.geometryPointList[1].y;this.waitForRendering=!1};_=SVGImageElement.prototype;
_.initializeWithOriginalSize=function(a){var b=this,c=new Image;c.src=b.getAttributeNS(SVGElement.XLINK_NS,"href");c.onload=function(){console.log("img.onload",c);console.log("this.naturalWidth",this.naturalWidth);console.log("this.naturalHeight",this.naturalHeight);b.setAttribute("width",this.naturalWidth);b.setAttribute("height",this.naturalHeight);a&&a()}};_=SVGRectElement.prototype;
_.normalizeScale=function(a){var b=this.parentElement.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix),c=b.getScale();"non-scaling-stroke"!=this.getAttribute("vector-effect")&&a.scaleStrokeAndEffects&&this.scaleStrokeAndEffects(Math.sqrt(c.x*c.x+c.y*c.y)/Math.sqrt(2));this.scaleAttributeNumber("x",c.x);this.scaleAttributeNumber("y",c.y);this.scaleAttributeNumber("width",c.x);this.scaleAttributeNumber("height",c.y);c=this.ownerSVGElement.createSVGMatrix().scaleNonUniform(c.x,c.y).inverse();
this.getTransform().setMatrix(b.multiply(c));(b=this.getGradient("fill"))&&this.normalizeGradientScale(b,a);(b=this.getGradient("stroke"))&&this.normalizeGradientScale(b,a)};_.toSVGPathElement=function(){var a=SVGUtils.createPath();a.setPathData(this.getPathData({normalize:!0}));return a};_.toElementPreview=function(){return this.cloneNode()};
_.getSnapPointList=function(){var a=this.getBBox();var b=a.x;var c=a.y;var d=a.x+a.width;var e=a.y+a.height;var f=b+a.width/2;a=c+a.height/2;var g=[];g.push(SVGUtils.createSVGPoint(b,c));g.push(SVGUtils.createSVGPoint(d,c));g.push(SVGUtils.createSVGPoint(d,e));g.push(SVGUtils.createSVGPoint(b,e));g.push(SVGUtils.createSVGPoint(f,c));g.push(SVGUtils.createSVGPoint(d,a));g.push(SVGUtils.createSVGPoint(f,e));g.push(SVGUtils.createSVGPoint(b,a));g.push(SVGUtils.createSVGPoint(f,a));return g};
_.updateGeometry=function(a,b,c,d){this.x.baseVal.value=a;this.y.baseVal.value=b;c&&(this.width.baseVal.value=c);d&&(this.height.baseVal.value=d)};
_.intersectGlobalRect=function(a){if(this.isContainedInGlobalRect(a))return!0;a=this.globalRectToLocalPolygon(a);var b=this.getBBox();var c=b.x;var d=b.y;var e=b.x+b.width;b=b.y+b.height;var f;return(f=SVGUtils.getPolygonLineIntersection(a,{x:c,y:d},{x:e,y:d},!0))||(f=SVGUtils.getPolygonLineIntersection(a,{x:e,y:d},{x:e,y:b},!0))||(f=SVGUtils.getPolygonLineIntersection(a,{x:e,y:b},{x:c,y:b},!0))?!0:(f=SVGUtils.getPolygonLineIntersection(a,{x:c,y:b},{x:c,y:d},!0))?!0:!1};_=SVGEllipseElement.prototype;
_.normalizeScale=function(a){var b=this.parentElement.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix),c=b.getScale();"non-scaling-stroke"!=this.getAttribute("vector-effect")&&a.scaleStrokeAndEffects&&this.scaleStrokeAndEffects(Math.sqrt(Math.abs(c.x)*Math.abs(c.y)));this.scaleAttributeNumber("cx",c.x);this.scaleAttributeNumber("cy",c.y);this.scaleAttributeNumber("rx",c.x);this.scaleAttributeNumber("ry",c.y);c=this.ownerSVGElement.createSVGMatrix().scaleNonUniform(c.x,c.y).inverse();
this.getTransform().setMatrix(b.multiply(c));(b=this.getGradient("fill"))&&this.normalizeGradientScale(b,a);(b=this.getGradient("stroke"))&&this.normalizeGradientScale(b,a)};
_.getSnapPointList=function(){var a=this.getBBox();var b=a.x;var c=a.y;var d=a.x+a.width;var e=a.y+a.height;var f=b+a.width/2;a=c+a.height/2;var g=[];g.push(SVGUtils.createSVGPoint(f,c));g.push(SVGUtils.createSVGPoint(d,a));g.push(SVGUtils.createSVGPoint(f,e));g.push(SVGUtils.createSVGPoint(b,a));g.push(SVGUtils.createSVGPoint(f,a));return g};_.updateGeometry=function(a,b,c,d){this.cx.baseVal.value=a;this.cy.baseVal.value=b;c&&(this.rx.baseVal.value=c);d&&(this.ry.baseVal.value=d)};
_.toSVGPathElement=function(){var a=SVGUtils.createPath();a.setPathData(this.getPathData({normalize:!0}));return a};_.toElementPreview=function(){return this.cloneNode()};_=SVGGraphicsElement.prototype;
_.prepareToNormalizeScale=function(a){this.normalizationData={};this.normalizationData.storedScreenMatrix=this.getScreenCTM();this.normalizationData.localRotation=this.getTransform().matrix.getRotation();for(var b=this.childNodes.length,c=0;c<b;c++)console.log("prepareToNormalizeScale",this.childNodes[c]),this.childNodes[c].prepareToNormalizeScale&&this.childNodes[c].prepareToNormalizeScale(a)};
_.normalizeScale=function(a){var b=this.parentElement.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix);this.getTransform().setMatrix(b);b=this.childNodes.length;for(var c=0;c<b;c++)this.childNodes[c].normalizeScale&&this.childNodes[c].normalizeScale(a)};
_.createElementPreview=function(a){if(!this.hasAttribute("no-preview")){var b=this.toElementPreview();if(!b)return null;b.elementRef=this;this.interactiveElement=b;b.classList.add("interactive-path");b.setAttribute("vector-effect","non-scaling-stroke");b.setAttribute("stroke-width","1");a=a||this.getScreenCTM();b.getTransform().setMatrix(a);return b}};
_.toElementPreview=function(){if(!this.getBBox)return null;var a=this.getLocalBBox();a=SVGUtils.createRect(a.x,a.y,a.width,a.height);"true"==this.dataset.mantainAspectRatio&&(a.dataset.mantainAspectRatio="true");return a};
_.scaleStrokeAndEffects=function(a){this.scaleAttributeNumber("stroke-width",a);var b=this.getAttribute("stroke-dasharray");if(b){b=b.split(" ");var c,d=b.length;for(c=0;c<d;c++)b[c]=parseFloat(b[c])*a;this.setAttribute("stroke-dasharray",b.join(" "))}this.getAttribute("stroke-dash-offset")&&this.scaleAttributeNumber("stroke-dash-offset",a)};
_.setGraphicAttributesByElement=function(a,b){for(var c=b||"opacity fill stroke fill-opacity stroke-opacity fill-rule paint-order stroke-width stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit marker-start marker-end marker-mid".split(" "),d=[],e,f=0;f<c.length;f++)e=c[f],a.hasAttribute(e)&&(this.setAttribute(e,a.getAttribute(e)),d.push(e));return d};
_.setGraphicAttributesByObjectProperties=function(a){var b=[],c="opacity fill stroke fill-opacity stroke-opacity fill-rule paint-order stroke-width stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit marker-start marker-end marker-mid".split(" "),d;for(d in a)-1<c.indexOf(d)&&(this.setAttribute(d,a[d]),b.push(d));return b};_.getFill=function(){return this.hasAttribute("fill")?this.getAttribute("fill"):this.parentElement.getFill()};
_.getStroke=function(){return this.hasAttribute("stroke")?this.getAttribute("stroke"):this.parentElement.getStroke()};SVGClipPathElement.prototype.normalizeScale=SVGGElement.prototype.normalizeScale;SVGClipPathElement.prototype.toSVGPathElement=SVGGElement.prototype.toSVGPathElement;_=SVGTSpanElement.prototype;_.__getComputedTextLength=_.getComputedTextLength;
_.getComputedTextLength=function(a){var b=this.__getComputedTextLength();if(a&&(a.letterSpacing&&(b+=a.letterSpacing*(this.firstChild.data.length-1)),a.wordSpacing)){var c=this.firstChild.data.split(" ").length;b+=a.wordSpacing*(c-1)}return b};
"firefox"==BROWSER_TYPE&&(_.getBBox=function(){var a=this.getBoundingClientRect(),b=this.ownerSVGElement.createSVGPoint();b.x=a.left;b.y=a.top;var c=this.ownerSVGElement.createSVGPoint();c.x=a.right;c.y=a.bottom;a=this.getScreenCTM().inverse();b=b.matrixTransform(a);c=c.matrixTransform(a);console.log({x:b.x,y:b.y,width:c.x-b.x,height:c.y-b.y});return{x:b.x,y:b.y,width:c.x-b.x,height:c.y-b.y}});_=SVGTextElement.prototype;_.getText=function(){return this.textData?this.textData.text:""};
_.setText=function(a){this.textData||this.initTextData(a)};_.__getLocalBBox=SVGElement.prototype.getLocalBBox;
_.getLocalBBox=function(){var a={};if("TextBox"!=this.getAttribute("data-type"))return this.__getLocalBBox();this.hasAttribute("width")&&this.hasAttribute("height")?(a.x=0,a.y=0,a.width=parseFloat(this.getAttribute("width")),a.height=parseFloat(this.getAttribute("height"))):(a=this.getBBox(),this.setAttribute("width",a.width),this.setAttribute("height",a.height));a.center={x:a.x+a.width/2,y:a.y+a.height/2};a.min={x:a.x,y:a.y};a.max={x:a.x+a.width,y:a.y+a.height};return a};_.getGlobalBBox=function(){return this.getGlobalBBoxByLocalBox()};
_.prepareToNormalizeScale=function(a){this.normalizationData={};this.normalizationData.storedScreenMatrix=this.getScreenCTM();this.normalizationData.localRotation=this.getTransform().matrix.getRotation()};
_.normalizeScale=function(a){var b=this.parentElement.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix),c=b.getScale();this.scaleAttributeNumber("x",c.x);this.scaleAttributeNumber("y",c.y);this.scaleAttributeNumber("width",c.x);this.scaleAttributeNumber("height",c.y);var d=Math.sqrt(c.x*c.x+c.y*c.y)/Math.sqrt(2);"non-scaling-stroke"!=this.getAttribute("vector-effect")&&a.scaleStrokeAndEffects&&this.scaleStrokeAndEffects(d);if(a.scaleText&&(this.scaleStrokeAndEffects(d),this.scaleAttributeNumber("font-size",
d),this.scaleAttributeNumber("letter-spacing",d),this.scaleAttributeNumber("word-spacing",d),this.scaleAttributeNumber("line-height",d),"true"==this.dataset.useRichText&&this.textData.style)){var e=this.textData.style,f,g,h=e.length;for(g=0;g<h;g++)if(f=e[g])f["font-size"]&&(f["font-size"]=parseFloat(f["font-size"])*d),f["letter-spacing"]&&(f["letter-spacing"]=parseFloat(f["letter-spacing"])*d),f["word-spacing"]&&(f["word-spacing"]=parseFloat(f["word-spacing"])*d),f["line-height"]&&(f["line-height"]*=
d)}c=this.ownerSVGElement.createSVGMatrix().scaleNonUniform(c.x,c.y).inverse();this.getTransform().setMatrix(b.multiply(c));this.render();(b=this.getGradient("fill"))&&this.normalizeGradientScale(b,a);(b=this.getGradient("stroke"))&&this.normalizeGradientScale(b,a)};_.intersectGlobalRect=SVGRectElement.prototype.intersectGlobalRect;_.__cloneNode=_.cloneNode;_.cloneNode=function(a){a=this.__cloneNode(a);this.textData&&(a.textData=this.getTextData());return a};
_.convertTextToPath=function(a,b){return"TextOnPath"==this.getAttribute("data-type")?this.convertTextOnPathToPath(a,b):this.convertTextBoxToPath(a,b)};
_.convertTextBoxToPath=function(a,b){function c(a,c){opentype.load(a,function(a,d){a?b&&b(g):c(d)})}function d(b){var f=b.getStartPositionOfChar(0);var h=f.x;var n=f.y;var m=e.getElementStyle(b);f=window.GoogleFonts.getGoogleFontObjectByFamilyName(m["font-family"]).files[window.GoogleFonts.getGoogleFontVariantNameByStyleAndWeight(m["font-style"],m["font-weight"])];c(f,function(c){var e=opentype.Font.prototype.defaultRenderOptions;e.letterSpacing=parseFloat(m["letter-spacing"])||0;e.wordSpacing=parseFloat(m["word-spacing"])||
0;c=c.getPaths(b.textContent,h,n,m["font-size"],e);for(e=0;e<c.length;e++){var f=SVGUtils.createPath();f.setAttribute("d",c[e].toPathData(6));f.setGraphicAttributesByObjectProperties(m);g.appendChild(f)}b.nextElementSibling?d(b.nextElementSibling):a&&a(g)})}var e=this,f=this.querySelectorAll("tspan"),g=SVGUtils.createGroup();g.getTransform().setMatrix(this.getTransform().matrix.clone());d(f[0]);return g};
_.convertTextOnPathToPath=function(a,b){function c(a,c){opentype.load(a,function(a,d){a?b&&b(g):c(d)})}function d(b){var f,h,n,m,y=e.getElementStyle(b),p=window.GoogleFonts.getGoogleFontObjectByFamilyName(y["font-family"]).files[window.GoogleFonts.getGoogleFontVariantNameByStyleAndWeight(y["font-style"],y["font-weight"])];c(p,function(c){var e=opentype.Font.prototype.defaultRenderOptions;e.letterSpacing=parseFloat(y["letter-spacing"])||0;e.wordSpacing=parseFloat(y["word-spacing"])||0;for(var k=b.getNumberOfChars(),
l=0;l<k;l++){m=b.getStartPositionOfChar(l);f=m.x;h=m.y;n=b.getRotationOfChar(l);console.log("char rotation",n);for(var p=c.getPaths(b.textContent[l],0,0,y["font-size"],e),K=0;K<p.length;K++){var Q=SVGUtils.createPath();Q.getTransform().setMatrix(SVGUtils.createSVGMatrix().translate(f,h).rotate(n));Q.setAttribute("d",p[K].toPathData(3));Q.setGraphicAttributesByObjectProperties(y);g.appendChild(Q)}}b.nextElementSibling?d(b.nextElementSibling):a&&a(g)})}var e=this,f=this.querySelectorAll("tspan"),g=
SVGUtils.createGroup();g.getTransform().setMatrix(this.getTransform().matrix.clone());d(f[0]);return g};
opentype.Font.prototype.forEachGlyph=function(a,b,c,d,e,f){b=void 0!==b?b:0;c=void 0!==c?c:0;d=void 0!==d?d:72;e=e||this.defaultRenderOptions;var g=1/this.unitsPerEm*d;a=this.stringToGlyphs(a,e);if(e.kerning){var h=e.script||this.position.getDefaultScriptName();h=this.position.getKerningTables(h,e.language)}for(var k=0;k<a.length;k+=1){var l=a[k];f.call(this,l,b,c,d,e);l.advanceWidth&&(b+=l.advanceWidth*g);if(e.kerning&&k<a.length-1){var n=h?this.position.getKerningValue(h,l.index,a[k+1].index):this.getKerningValue(l,
a[k+1]);b+=n*g}e.letterSpacing?b+=e.letterSpacing:e.tracking&&(b+=e.tracking/1E3*d);e.wordSpacing&&"space"==l.name&&"space"==l.name&&(b+=e.wordSpacing)}return b};_=SVGTextElement.prototype;_.setTextSelectionAttribute=function(a,b){console.log("setTextSelectionAttribute",a);this.setTextStyleProperty(this.storedTextSelectionRange.textDataStartOffset,this.storedTextSelectionRange.textDataEndOffset,a,b)};
_.setAttribute=function(a,b){if(this.hasAttribute("data-type"))if("selected"==a)this.__setAttribute(a,b);else{"true"==this.dataset.useRichText&&this.hasAttribute("contenteditable")&&this.storedTextSelectionRange?this.setTextSelectionAttribute(a,b):(this.__setAttribute(a,b),console.log("text setAttribute _attributeName",a));var c;this.isTextAttribute(a)&&(c=200);var d=this;this.renderRequest(c,function(){console.log("self.storedTextSelectionRange",d.storedTextSelectionRange);d.restoreTextSelectionRange()})}else this.__setAttribute(a,
b)};_.onEnterToTextEditing=function(a){console.log("onEnterToTextEditing");this.firstElementChild&&!this.firstElementChild.hasAttribute("start-offset")&&this.renderRequest();this.__setAttribute("contenteditable","true");this.textData||this.initTextData();this.updateTextCursorPosition();this.updateDocumentDrawingProperties()};
_.onExitFromTextEditing=function(a){this.onEndInputAction();0==this.textData.text.length&&(this.textData=null,this.setText("text"),this.ownerSVGElement.createInsertTextDataUndoRedoActions(this,this.getTextData()),this.renderRequest());this.removeAttribute("contenteditable");HideElements([document.querySelector("#TEXT_CURSOR")])};_.onMouseDown=function(){console.log("TEXT EDITING onMouseDown");HideElements([document.querySelector("#TEXT_CURSOR")])};
_.onMouseUp=function(){console.log("TEXT EDITING onMouseUp");this.onEndInputAction();this.saveTextSelectionRange();console.log("this.storedTextSelectionRange",this.storedTextSelectionRange);this.caretPosition=this.storedTextSelectionRange.textDataStartOffset;console.log("this.caretPosition",this.caretPosition);console.log("this.getNumberOfChars()",this.getNumberOfChars());this.updateTextCursorPosition();this.updateDocumentDrawingProperties()};
_.updateTextCursorPosition=function(){var a=this.getNumberOfChars();var b=document.querySelector("#TEXT_CURSOR");if(0==a){var c={x:0,y:0};a=0}else{this.caretPosition>=a?(c=this.getEndPositionOfChar(a-1),a=this.getRotationOfChar(a-1)):(c=this.getStartPositionOfChar(this.caretPosition),a=this.getRotationOfChar(this.caretPosition));var d=this.storedTextSelectionRange&&"#cdata-section"==this.storedTextSelectionRange.startContainer.nodeName?this.storedTextSelectionRange.startContainer.parentElement.getExtentOfChar(c):
this.getExtentOfChar(c);console.log("this.storedTextSelectionRange",this.storedTextSelectionRange);console.log("charBBox",d);b.setAttribute("y2",-d.height)}c=this.getCTM().translate(c.x,c.y).rotate(a);b.getTransform().setMatrix(c);ShowElement(b)};_.updateDocumentDrawingProperties=function(){var a=this.ownerSVGElement;var b="true"==this.dataset.useRichText?this.getTextStyleAt(this.caretPosition):this.getElementStyle(this);a.updateDrawingPropertiesByObjectKeyValue(b);a.showSelectionProperties()};
_.onStartInputAction=function(a){this.inputAction=a;this.inputActionTextData=this.createTextData("");this.inputActionTextData.offset=0};
_.onInputAction=function(a){var b=a.key;a=a.keyCode;if(a==KeyboardEvent.CODES.keyCode_esc)this.onEndInputAction(),this.ownerSVGElement.exitFrom_TextEditing();else if(a==KeyboardEvent.CODES.keyCode_home||a==KeyboardEvent.CODES.keyCode_pageUp)this.onEndInputAction(),this.setCaretPosition(0),this.updateDocumentDrawingProperties();else if(a==KeyboardEvent.CODES.keyCode_end||a==KeyboardEvent.CODES.keyCode_pageDown)this.onEndInputAction(),this.setCaretPosition(this.getNumberOfChars()),this.updateDocumentDrawingProperties();
else if(a==KeyboardEvent.CODES.keyCode_arrowLeft||a==KeyboardEvent.CODES.keyCode_arrowUp)this.onEndInputAction(),this.caretPosition--,0>this.caretPosition&&(this.caretPosition=0),this.setCaretPosition(this.caretPosition),this.updateDocumentDrawingProperties();else if(a==KeyboardEvent.CODES.keyCode_arrowRight||a==KeyboardEvent.CODES.keyCode_arrowDown)this.onEndInputAction(),this.caretPosition++,b=this.getNumberOfChars(),this.caretPosition>b&&(this.caretPosition=b),this.setCaretPosition(this.caretPosition),
this.updateDocumentDrawingProperties();else{a==KeyboardEvent.CODES.keyCode_tab&&(b="    ");if(a==KeyboardEvent.CODES.keyCode_backspace){if(0<this.storedTextSelectionRange.selectedCharNum){console.log("deleteSelectedText");this.deleteSelectedText();this.renderRequest();return}if(0==this.caretPosition)return;this.caretPosition--;"deletePreviousText"!=this.inputAction&&(this.onEndInputAction(),this.onStartInputAction("deletePreviousText"));b=this.deleteTextData(this.caretPosition,1);this.inputActionTextData.text=
b.text+this.inputActionTextData.text;this.inputActionTextData.style.unshift(b.style[0]);this.inputActionTextData.offset=this.caretPosition}else if(a==KeyboardEvent.CODES.keyCode_delete){if(0<this.storedTextSelectionRange.selectedCharNum){this.deleteSelectedText();this.renderRequest();return}"deleteNextText"!=this.inputAction&&(this.onEndInputAction(),this.onStartInputAction("deleteNextText"),this.inputActionTextData.offset=this.caretPosition);b=this.deleteTextData(this.caretPosition,1);this.inputActionTextData.text+=
b.text;this.inputActionTextData.style.push(b.style[0])}else this.storedTextSelectionRange&&0<this.storedTextSelectionRange.selectedCharNum&&this.deleteSelectedText(),a==KeyboardEvent.CODES.keyCode_enter&&(this.onEndInputAction(),b="\n"),this.insertText(this.caretPosition,b),"insertText"!=this.inputAction&&(this.onEndInputAction(),this.onStartInputAction("insertText"),this.inputActionTextData.offset=this.caretPosition),this.inputActionTextData.text+=b,this.inputActionTextData.style=Array(this.inputActionTextData.text.length),
this.caretPosition+=b.length;var c=this;this.renderRequest(null,function(){c.setCaretPosition(c.caretPosition)})}};_.setCaretPosition=function(a){this.caretPosition=a;var b=this.getNumberOfChars();a>=b&&(a=b-1);this.selectSubString(a,0);this.saveTextSelectionRange();this.updateTextCursorPosition()};
_.onEndInputAction=function(){var a=this.ownerSVGElement;"insertText"==this.inputAction?a.createInsertTextDataUndoRedoActions(this,this.inputActionTextData):"deletePreviousText"==this.inputAction?a.createDeleteTextDataUndoRedoActions(this,this.inputActionTextData):"deleteNextText"==this.inputAction&&a.createDeleteTextDataUndoRedoActions(this,this.inputActionTextData);this.inputAction=null};
_.deleteSelectedText=function(){if(this.storedTextSelectionRange&&0<this.storedTextSelectionRange.selectedCharNum){var a=this.deleteTextData(this.caretPosition,this.storedTextSelectionRange.selectedCharNum);this.ownerSVGElement.createDeleteTextDataUndoRedoActions(this,a);this.setCaretPosition(this.caretPosition)}};
_.onKeyDown=function(a){var b=a.key,c=a.keyCode,d=a.metaKey||a.ctrlKey;console.log("cmd_or_ctrl",d);console.log("inputText",b);console.log("keyCode",c);b=this.ownerSVGElement;if(d)switch(this.onEndInputAction(),c){case KeyboardEvent.CODES.keyCode_Z:return a.shiftKey?b.redo():b.undo(),a.preventPropagation();case KeyboardEvent.CODES.keyCode_A:a.preventPropagation(),this.selectAll()}else 16!=c&&18!=c&&116!=c&&20!=c&&(a.preventPropagation(),this.onInputAction(a))};
_.createTextData=function(a){var b={};b.text=a||"";b.style=Array(b.text.length);b.drawInfo=Array(b.text.length);return b};_.initTextData=function(a){this.caretPosition=0;this.textData=this.createTextData(a||"")};_.selectAll=function(){this.selectSubString(0,this.textData.text.length);this.saveTextSelectionRange();this.caretPosition=0;this.updateTextCursorPosition()};
_.copySelectedText=function(a){a.clipboardData.setData("text/plain",this.textData.text.substring(this.storedTextSelectionRange.textDataStartOffset,this.storedTextSelectionRange.textDataEndOffset))};_.cutSelectedText=function(a){a.clipboardData.setData("text/plain",this.textData.text.substring(this.storedTextSelectionRange.textDataStartOffset,this.storedTextSelectionRange.textDataEndOffset));this.deleteSelectedText();var b=this;this.renderRequest(null,function(){b.setCaretPosition(b.caretPosition)})};
_.pasteText=function(a){console.log("clipText",a);this.deleteSelectedText();a=this.createTextData(a);a.offset=this.caretPosition;this.ownerSVGElement.createInsertTextDataUndoRedoActions(this,a);this.insertTextData(this.caretPosition,a);this.caretPosition+=a.text.length;var b=this;this.renderRequest(null,function(){b.setCaretPosition(b.caretPosition)});this.updateDocumentDrawingProperties()};
_.insertText=function(a,b){console.log("insertText pos",a);console.log("insertText _string",b);this.textData.text=this.textData.text.splice(a,0,b);var c=this.textData.style.splice(a);this.textData.style=this.textData.style.concat(Array(b.length),c);console.log("insertText this.textData.text",this.textData.text)};_.deleteTextData=function(a,b){var c=this.getTextData(a,a+b);this.textData.text=this.textData.text.splice(a,b);this.textData.style.splice(a,b);return c};
_.cloneStyle=function(a){var b={},c;for(c in a)b[c]=a[c];return b};_.cloneTextDataStyle=function(a){var b,c,d=a.style.length;for(c=0;c<d;c++)(b=a.style[c])&&(a.style[c]=this.cloneStyle(b))};_.getTextData=function(a,b){var c={};a=a||0;c.offset=a;b?(c.text=this.textData.text.substring(a,b),c.style=this.textData.style.slice(a,b)):(c.text=this.textData.text.substring(a),c.style=this.textData.style.slice(a));this.cloneTextDataStyle(c);return c};
_.insertTextData=function(a,b,c){c=c||0;this.textData.text=this.textData.text.splice(a,c,b.text);0<c&&this.textData.style.splice(a,c);a=this.textData.style.splice(a);this.textData.style=this.textData.style.concat(b.style,a)};_.splitTextStyle=function(a,b){var c=this.textData.style[b];this.textData.style[a]||(this.textData.style[a]=this.cloneStyle(this.getTextStyleAt(a)));c||(this.textData.style[b]=this.cloneStyle(this.getTextStyleAt(b)))};
_.setTextStyleProperty=function(a,b,c,d){this.splitTextStyle(a,b);for(a;a<b;a++)this.textData.style[a]&&(this.textData.style[a][c]=d)};_.getTextStyleAt=function(a){for(var b=this.textData.style;-1<a;){if(b[a])return b[a];a--}return this.getElementStyle(this)};_.getTSpanAt=function(a){for(var b=this.textData.style;-1<a&&!b[a];)a--;return this.querySelector('tspan[data-start-offset="'+a+'"]')};
_.getElementStyle=function(a){var b={};b.opacity=a.getAttribute("opacity")||this.getAttribute("opacity")||"1";b.fill=a.getAttribute("fill")||this.getAttribute("fill")||"#000000";b["fill-opacity"]=a.getAttribute("fill-opacity")||this.getAttribute("fill-opacity")||1;b.stroke=a.getAttribute("stroke")||this.getAttribute("stroke")||"none";b["stroke-opacity"]=a.getAttribute("stroke-opacity")||this.getAttribute("stroke-opacity")||1;b["stroke-width"]=a.getAttribute("stroke-width")||this.getAttribute("stroke-width")||
0;b["font-family"]=a.getAttribute("font-family")||this.getAttribute("font-family")||"arial";b["text-decoration"]=a.getAttribute("text-decoration")||this.getAttribute("text-decoration")||"none";b["font-size"]=a.getAttribute("font-size")||this.getAttribute("font-size")||12;b["text-align"]=a.getAttribute("text-align")||this.getAttribute("text-align")||"left";b["font-weight"]=a.getAttribute("font-weight")||this.getAttribute("font-weight")||"";b["font-style"]=a.getAttribute("font-style")||this.getAttribute("font-style")||
"";b["letter-spacing"]=a.getAttribute("letter-spacing")||this.getAttribute("letter-spacing")||0;b["word-spacing"]=a.getAttribute("word-spacing")||this.getAttribute("word-spacing")||0;b["line-height"]=a.getAttribute("line-height")||this.getAttribute("line-height")||"normal";return b};
_.restoreTextSelectionRange=function(){this.storedTextSelectionRange&&(0<this.storedTextSelectionRange.selectedCharNum&&this.selectSubString(this.storedTextSelectionRange.textDataStartOffset,this.storedTextSelectionRange.selectedCharNum),this.caretPosition=this.storedTextSelectionRange.textDataStartOffset)};
_.saveTextSelectionRange=function(){var a=window.getSelection();console.log("selection",a);console.log("selection.type",a.type);"None"!=a.type?(a=a.getRangeAt(0),console.log("selRange.toString",a.toString()),console.log("range",a),this.storedTextSelectionRange=a,"#cdata-section"==this.storedTextSelectionRange.startContainer.nodeName?(this.storedTextSelectionRange.textDataStartOffset=parseInt(this.storedTextSelectionRange.startContainer.parentElement.dataset.startOffset)+this.storedTextSelectionRange.startOffset,
this.storedTextSelectionRange.textDataEndOffset=parseInt(this.storedTextSelectionRange.endContainer.parentElement.dataset.startOffset)+this.storedTextSelectionRange.endOffset):(this.storedTextSelectionRange.textDataStartOffset=0,this.storedTextSelectionRange.textDataEndOffset=0),this.storedTextSelectionRange.selectedCharNum=this.storedTextSelectionRange.textDataEndOffset-this.storedTextSelectionRange.textDataStartOffset):(this.storedTextSelectionRange.endContainer=this.storedTextSelectionRange.startContainer,
this.storedTextSelectionRange.textDataStartOffset=parseInt(this.storedTextSelectionRange.startContainer.parentElement.dataset.startOffset)+this.storedTextSelectionRange.startOffset,this.storedTextSelectionRange.textDataEndOffset=this.storedTextSelectionRange.textDataStartOffset,this.storedTextSelectionRange.selectedCharNum=0);console.log("this.caretPosition",this.caretPosition);console.log("selection start",this.storedTextSelectionRange.textDataStartOffset);console.log("selection end",this.storedTextSelectionRange.textDataEndOffset)};
_.parseText=function(){if(!this.textData){var a={text:""};a.style=Array(a.text.length);a.drawInfo=Array(a.text.length);var b,c=this.children;if(0==c.length)this.setText(this.textContent),this.dataset.useRichText="false";else{for(var d=0;d<c.length;d++){var e=c[d];var f=null;for(b=0;b<e.childNodes.length;b++)if("#cdata-section"==e.childNodes[b].nodeName){console.log("trovato cdata",e.childNodes[b]);f=e.childNodes[b];break}f?(b=f.data,console.log("uso cdata.data",f.data)):(b=e.textContent,console.log("non uso cdata.data",
e.textContent));f=this.getElementStyle(e);a.style[a.text.length]=f;a.text+=b}this.textData=a}}};_.consolidateAllStyles=function(){var a=this.getElementStyle(this);console.log("consolidateAllStyles",a);for(var b,c,d=this.textData.style,e=0;e<d.length;e++)if(c=d[e])for(b in a)console.log(b,c[b]),void 0==c[b]&&(c[b]=a[b])};
_.render=function(){this.waitForRendering=!1;this.textElementUtils=document.querySelector("#TEXT_UTILS");this.textData||this.initTextData();var a=this.createWordList(this.textData),b=this.getAttribute("data-type"),c=this;"TextOnPath"==b&&(c=this.querySelector("textPath"));c.removeChildren();if(0!=a.length){var d=null;"TextBox"==b&&(d=parseFloat(this.__getAttribute("width")));this.textElementUtils.removeChildren();a=this.renderizeWordList(a,d);"TextBox"!=b&&a[0].setAttribute("dy",0);for(b=0;b<a.length;b++)c.appendChild(a[b]);
c=this.getBBox();this.__setAttribute("height",c.y+c.height);this.updateTextAlignment();console.log("text render")}};_.createWordList=function(a){var b=[],c=a.text;a=a.style;var d=null,e=!0,f=!0,g,h=c.length;for(g=0;g<h;g++){var k=a[g];var l=c[g];if(e){var n={isNewLine:f,idStart:g,text:"",style:k};d={wordChunkList:[n]};b.push(d);e=f=!1}else k&&(n={idStart:g,text:"",style:k},d.wordChunkList.push(n));n.text+=l;"\n"===l?e=f=!0:" "===l&&(e=!0)}return b};
_.renderizeWordList=function(a,b){function c(){if(e.firstElementChild)for(f=e.getBBox(),g=f.height,h=0-f.y,k=g-h,y["line-height"]&&"normal"!=y["line-height"]&&(g=parseFloat(y["line-height"])),e.firstElementChild.setAttribute("dy",l+g-k),l=k;e.firstElementChild;)d.push(e.removeChild(e.firstElementChild))}var d=[],e=this.textElementUtils,f,g,h,k,l=0,n,m=a.length,y=this.currentStyle=this.getElementStyle(this);for(p in y)e.setAttribute(p,y[p]);for(n=0;n<m;n++){var p=a[n];if(p.wordChunkList[0].isNewLine){c();
var K=this.renderizeWordInNewTextLine(p)}else K=this.renderizeWordInCurrentTextLine(p,b),K||(c(),K=this.renderizeWordInNewTextLine(p))}c();return d};
_.renderizeWordInNewTextLine=function(a){var b;var c=a.wordChunkList[0];c.style&&(this.currentStyle=c.style);var d=this.createTSpan(c.idStart,c.text,this.currentStyle,!0,0);var e=a.wordChunkList.length;for(b=1;b<e;b++)c=a.wordChunkList[b],c.style?(this.currentStyle=c.style,d=this.createTSpan(c.idStart,c.text,this.currentStyle,!1)):d.firstChild.data+=c.text;this.textElementUtils.firstElementChild.lastTextLineTSpan=this.textElementUtils.lastElementChild;return d};
_.renderizeWordInCurrentTextLine=function(a,b){var c,d,e=d=this.textElementUtils.lastElementChild,f=e.firstChild.data,g=this.currentStyle;var h=a.wordChunkList.length;for(c=0;c<h;c++){var k=a.wordChunkList[c];"true"==this.dataset.useRichText&&k.style?(this.currentStyle=k.style,d=this.createTSpan(k.idStart,k.text,this.currentStyle,!1)):d.firstChild.data+=k.text}if(b)if(c=this.textElementUtils.getBBox().width,c>b){for(;this.textElementUtils.lastElementChild!=e;)this.textElementUtils.lastElementChild.remove();
e.firstChild.data=f;this.currentStyle=g;d=null}else this.textElementUtils.firstElementChild.textLineWidth=c;this.textElementUtils.firstElementChild.lastTextLineTSpan=this.textElementUtils.lastElementChild;return d};
_.updateTextAlignment=function(){var a=parseFloat(this.__getAttribute("width")),b,c=this.__getAttribute("text-align");var d=0;this.hasAttribute("letter-spacing")&&(d=parseFloat(this.getAttribute("letter-spacing")));if("justify"==c){this.__setAttribute("text-anchor","start");this.__setAttribute("text-anchor","start");var e=this.querySelectorAll("tspan");var f=e.length;for(b=0;b<f;b++){var g=e[b];g.setAttribute("lengthAdjust","spacing");g.setAttribute("textLength",a)}}else"right"==c||"center"==c?this.__setAttribute("text-anchor",
"end"):this.__setAttribute("text-anchor","start");e=this.querySelectorAll('tspan[x="0"]');f=e.length;for(b=0;b<f;b++)if(g=e[b],"right"==c){var h=e[b].lastTextLineTSpan;var k=h.firstChild.data;var l=k.length;k=k.charCodeAt(l-1);32==k||10==k?(k=h.getStartPositionOfChar(l-1).x,l=d,h.hasAttribute("letter-spacing")&&(l=parseFloat(h.getAttribute("letter-spacing"))),h=a-k+l):h=a;g.setAttribute("x",h)}else"center"==c?(h=e[b].lastTextLineTSpan,k=h.firstChild.data,l=k.length,k=k.charCodeAt(l-1),32==k||10==
k?(k=h.getStartPositionOfChar(l-1).x,l=d,h.hasAttribute("letter-spacing")&&(l=parseFloat(h.getAttribute("letter-spacing"))),h=a/2+Math.abs(k)/2+l/2):h=a/2,g.setAttribute("x",h)):"justify"==c&&(h=e[b].lastTextLineTSpan,k=h.firstChild.data,l=k.length,k=k.charCodeAt(l-1),32==k||10==k)&&(k=Math.abs(h.getStartPositionOfChar(l-1).x),l=d,h.hasAttribute("letter-spacing")&&(l=parseFloat(h.getAttribute("letter-spacing"))),g.setAttribute("textLength",a+(a-k)+l));"center"==c&&this.__setAttribute("text-anchor",
"middle")};_.createTSpan=function(a,b,c,d,e){var f=document.createElementNS(SVGElement.SVG_NS,"tspan");f.dataset.startOffset=a;f.setAttribute("style","white-space: pre;");f.appendChild(XMLUtils.createCDATASection(b));if("true"==this.dataset.useRichText&&c)for(var g in c)f.setAttribute(g,c[g]);d&&(f.setAttribute("x","0"),f.setAttribute("dy",e));this.textElementUtils.appendChild(f);return f};_=SVGPathElement.prototype;
_.normalizeScale=function(a){var b=this.parentElement.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix);if("non-scaling-stroke"!=this.getAttribute("vector-effect")&&a.scaleStrokeAndEffects){var c=b.getScale();this.scaleStrokeAndEffects(Math.sqrt(c.x*c.x+c.y*c.y)/Math.sqrt(2))}console.log("this.normalizationData.localRotation",this.normalizationData.localRotation);console.log("matrixInParent rotation",b.getRotation());this.getTransform().setMatrix(this.getTransform().matrix.identity().translate(b.e,
b.f).rotate(this.normalizationData.localRotation));this.transformGeometryPointList(this.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix));this.render();(b=this.getGradient("fill"))&&this.normalizeGradientScale(b,a);(b=this.getGradient("stroke"))&&this.normalizeGradientScale(b,a)};_.toElementPreview=function(){var a=this.toSVGPathElement();"true"==this.dataset.mantainAspectRatio&&(a.dataset.mantainAspectRatio="true");return a};_.setPivot=function(a,b){};
_.geometryPointListToTransformData=function(a){var b=a||this.getGeometryPointList(),c={element:this,pointDataList:[]},d,e=b.length;for(d=0;d<e;d++)switch(a=b[d],a.type){case "L":case "M":c.pointDataList.push({point:a,values:{x:a.x,y:a.y}});break;case "C":c.pointDataList.push({point:a,values:{x:a.x,y:a.y}});c.pointDataList.push({point:a.controlPt1,values:{x:a.controlPt1.x,y:a.controlPt1.y}});c.pointDataList.push({point:a.controlPt2,values:{x:a.controlPt2.x,y:a.controlPt2.y}});break;case "Q":c.pointDataList.push({point:a,
values:{x:a.x,y:a.y}}),c.pointDataList.push({point:a.controlPt1,values:{x:a.controlPt1.x,y:a.controlPt1.y}})}return c};
_.transformGeometryPointList=function(a,b){b=b||this.getGeometryPointList();var c,d=b.length;for(c=0;c<d;c++){var e=b[c];switch(e.type){case "L":case "M":var f=e.matrixTransform(a);e.x=f.x;e.y=f.y;break;case "C":f=e.matrixTransform(a);e.x=f.x;e.y=f.y;var g=e.controlPt1;f=g.matrixTransform(a);g.x=f.x;g.y=f.y;g=e.controlPt2;f=g.matrixTransform(a);g.x=f.x;g.y=f.y;break;case "Q":f=e.matrixTransform(a),e.x=f.x,e.y=f.y,g=e.controlPt1,f=g.matrixTransform(a),g.x=f.x,g.y=f.y}}};
_.getGeometryPointList=function(a){if(!this.geometryPointList){this.geometryPointList=[];a=this.getPathData(a);for(var b=null,c=a.length,d,e,f=0;f<c;f++){d=a[f];e=null;switch(d.type){case "L":e=this.createGeometryPoint_LINETO(d.values[0],d.values[1]);break;case "Z":d=this.geometryPointList[this.geometryPointList.length-1];if(d.x!=b.x||d.y!=b.y)d=this.createGeometryPoint_LINETO(b.x,b.y),d.ownerShapeElement=this,this.geometryPointList.push(d);e=this.createGeometryPoint_CLOSEPATH();break;case "M":b=
e=this.createGeometryPoint_MOVETO(d.values[0],d.values[1]);break;case "C":e=this.createGeometryPoint_CURVETO_CUBIC(d.values[0],d.values[1],d.values[2],d.values[3],d.values[4],d.values[5]);break;case "Q":e=this.createGeometryPoint_CURVETO_QUADRATIC(d.values[0],d.values[1],d.values[2],d.values[3])}e.ownerShapeElement=this;e.id=f;this.geometryPointList.push(e)}}return this.geometryPointList};
_.cloneSegment=function(a,b){switch(a.type){case "L":var c=this.createGeometryPoint_LINETO(a.x,a.y);break;case "Z":c=this.createGeometryPoint_CLOSEPATH();break;case "M":c=this.createGeometryPoint_MOVETO(a.x,a.y);break;case "C":c=this.createGeometryPoint_CURVETO_CUBIC(a.controlPt1.x,a.controlPt1.y,a.controlPt2.x,a.controlPt2.y,a.x,a.y);break;case "Q":c=this.createGeometryPoint_CURVETO_QUADRATIC(a.controlPt1.x,a.controlPt1.y,a.x,a.y)}b&&(c.isSelected=a.isSelected);return c};
_.cloneGeometryPointList=function(a){for(var b=this.getGeometryPointList(),c=[],d=b.length,e,f=0;f<d;f++)e=this.cloneSegment(b[f],a),e.id=f,c.push(e);return c};_.clonePointList=function(a){for(var b=[],c=a.length,d=0;d<c;d++)b.push(this.cloneSegment(a[d]));return b};_.setGeometryPointList=function(a){this.geometryPointList=a;a=this.geometryPointList.length;for(var b=0;b<a;b++)this.geometryPointList[b].ownerShapeElement=this,this.geometryPointList[b].id=b};
_.getSubPathMoveToSegmentId=function(a){var b=this.getGeometryPointList(),c=b.indexOf(a);if(-1<c)for(a=b[c];a&&"M"!=a.type;)c--,a=b[c];return c};_.getSubPathList=function(){for(var a=this.getGeometryPointList(),b,c=[],d=a.length,e=0;e<d;e++)"M"==a[e].type&&(b={ownerPath:this,geometryPointList:[]},c.push(b)),b.geometryPointList.push(a[e]);return c};_.getSubPathIdBySegment=function(a){for(var b=this.getSubPathList(),c=b.length,d=0;d<c;d++)if(-1<b[d].geometryPointList.indexOf(a))return d;return 0};
_.removeSubPath=function(a){for(var b=this.getSubPathList(),c=[],d=b.length,e=0;e<d;e++)e!=a&&(c=c.concat(b[e].geometryPointList));this.setGeometryPointList(c)};_.setSubPathGeometryPointList=function(a,b){for(var c=this.getSubPathList(),d=[],e=c.length,f=0;f<e;f++)d=f==a?d.concat(b):d.concat(c[f].geometryPointList);this.setGeometryPointList(d)};
_.getNearestPoint=function(a){var b={};paper.install(b);paper.setup([640,480]);a=b.project.importSVG(this).getNearestLocation(a);return{x:a.point.x,y:a.point.y,distance:a.distance,t:a.time}};
_.getSegmentIdAtLength=function(a){if(void 0===a||!isFinite(a))throw"Invalid arguments.";var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d",this.getAttribute("d"));var c=b.getGeometryPointList();if(0==c.length)return null;for(var d=c.length-1;0<d;d--)if(c.pop(),b.render(),a>b.getTotalLength())return d;return null};_.getSegmentAtLength=function(a){return(a=this.getSegmentIdAtLength(a))?this.getGeometryPointList()[a]:null};
_.findSnapToPoint=function(a,b,c){a=this.globalToLocal(a.x,a.y);for(var d=this.getGeometryPointList(),e,f=d.length,g=0;g<f;g++)if(e=d[g],"Z"!=e.type){if(c){console.log("currentPoint",e);if(e.isSelected)continue;if(e.connectedToSelection)continue}if(e.x>a.x-b&&e.x<a.x+b&&e.y>a.y-b&&e.y<a.y+b)return e.idSegment=g,e}return null};
_.findSegmentLineToAtPoint=function(a,b){for(var c=this.globalToLocal(a.x,a.y),d=this.getGeometryPointList(),e,f=d.length,g=0;g<f;g++)if(e=d[g],"L"==e.type){var h=d[g-1],k=window.GeometryUtils.isPointOnLine(h,e,c,b,!0);console.log("findSegmentLineToAtPoint",k);if(k)return{pointOnSegment:k,segment:{pt1:SVGUtils.createSVGPoint(h.x,h.y),pt2:SVGUtils.createSVGPoint(e.x,e.y)}}}return null};
_.findSegmentAtPoint=function(a,b){var c=(new Date).getTime(),d=this.parentElement.globalToLocal(a.x,a.y),e={};paper.install(e);paper.setup([640,480]);var f=e.project.importSVG(this);f.fillColor="none";f.strokeColor="black";f.strokeWidth=b;d=e.project.hitTest(d,{segments:!0,stroke:!0,fill:!1,tolerance:b});console.log("hitResult",d);console.log("hitResult time",(new Date).getTime()-c);if(!d)return null;e=null;if("segment"==d.type)var g=d.segment.index;else"stroke"==d.type&&(g=d.location.index,e=d.location.time);
g++;f=this.getSubPathList();var h=d.item.index,k=f[h],l=k.geometryPointList[g],n=k.geometryPointList[g-1],m={x:d.point.x,y:d.point.y};console.log("subPathId time",(new Date).getTime()-c);return{path:this,subPathList:f,type:d.type,subPath:k,subPathId:h,segmentId:g,segment:l,previousSegment:n,t:e,point:m}};
_.applySnapTo_segments=function(a,b){var c=(new Date).getTime(),d=this.parentElement.globalToLocal(a.x,a.y),e={};paper.install(e);paper.setup([640,480]);var f=e.project.importSVG(this);f.fillColor="none";f.strokeColor="black";d=e.project.hitTest(d,{segments:!0,stroke:!0,fill:!1,tolerance:b});console.log("hitResult",d);console.log("hitResult time",(new Date).getTime()-c);if(!d)return null;e=null;if("segment"==d.type)var g=d.segment.index;else"stroke"==d.type&&(g=d.location.index,e=d.location.time);
g++;f=this.getSubPathList();var h=d.item.index,k=f[h],l=k.geometryPointList[g],n={x:d.point.x,y:d.point.y};console.log("subPathId time",(new Date).getTime()-c);return{path:this,subPathList:f,type:d.type,subPath:k,subPathId:h,segmentId:g,segment:l,t:e,point:n}};_.render=function(){for(var a=this.geometryPointList.length,b="",c=0;c<a;c++)this.geometryPointList[c].id=c,b+=this.geometryPointList[c].toString();this.setAttribute("d",b);this.waitForRendering=!1};
_.createGeometryPoint_LINETO=function(a,b){var c=SVGUtils.createSVGPoint(a,b);c.type="L";c.toString=function(){return this.type+" "+this.x+" "+this.y+" "};return c};_.createGeometryPoint_CLOSEPATH=function(){return{type:"Z",toString:function(){return this.type+" "}}};_.createGeometryPoint_MOVETO=function(a,b){var c=SVGUtils.createSVGPoint(a,b);c.type="M";c.toString=function(){return this.type+" "+this.x+" "+this.y+" "};return c};
_.createGeometryPoint_LINETO=function(a,b){var c=SVGUtils.createSVGPoint(a,b);c.type="L";c.toString=function(){return this.type+" "+this.x+" "+this.y+" "};return c};
_.createGeometryPoint_CURVETO_CUBIC=function(a,b,c,d,e,f){e=SVGUtils.createSVGPoint(e,f);e.type="C";e.controlPt1=SVGUtils.createSVGPoint(a,b);e.controlPt1.type="CTRL1";e.controlPt2=SVGUtils.createSVGPoint(c,d);e.controlPt2.type="CTRL2";e.controlPt1.ownerPoint=e;e.controlPt2.ownerPoint=e;e.toString=function(){return this.type+" "+this.controlPt1.x+" "+this.controlPt1.y+" "+this.controlPt2.x+" "+this.controlPt2.y+" "+this.x+" "+this.y+" "};return e};
_.createGeometryPoint_CURVETO_QUADRATIC=function(a,b,c,d){c=SVGUtils.createSVGPoint(c,d);c.type="Q";c.controlPt1=SVGUtils.createSVGPoint(a,b);c.controlPt1.type="CTRL1";c.controlPt1.ownerPoint=c;c.toString=function(){return this.type+" "+this.controlPt1.x+" "+this.controlPt1.y+" "+this.x+" "+this.y+" "};return c};
_.createGeometryPoint_ARCTO=function(a,b,c,d,e,f,g){f=SVGUtils.createSVGPoint(f,g);f.type="A";f.rx=a;f.ry=b;f.angle=c;f.largeArcFlag=d;f.sweepFlag=e;f.toString=function(){return this.type+" "+this.rx+" "+this.ry+" "+this.angle+" "+this.largeArcFlag+" "+this.sweepFlag+" "+this.x+" "+this.y+" "};return f};
_.buildRegularPolygon=function(a,b,c,d,e){var f=2*Math.PI/c,g=0;var h=a+d*Math.sin(f/2+f*g);var k=b+d*Math.cos(f/2+f*g);var l="M "+h+" "+k;for(g=1;g<=c;g++)h=a+d*Math.sin(f/2+f*g),k=b+d*Math.cos(f/2+f*g),l+=" L "+h+" "+k;(e||this).setAttribute("d",l+"Z")};_.quadraticCurveToCubicCurve=function(a,b){return this.createGeometryPoint_CURVETO_CUBIC(a.x+2/3*(b.controlPt1.x-a.x),a.y+2/3*(b.controlPt1.y-a.y),b.controlPt1.x+1/3*(b.x-b.controlPt1.x),b.controlPt1.y+1/3*(b.y-b.controlPt1.y),b.x,b.y)};
_.convertQuandraticCurveToCubicCurve=function(){for(var a=[],b=this.getGeometryPointList(),c=b.length,d,e=0;e<c;e++)d=b[e],"Q"==d.type&&(b[e]=this.quadraticCurveToCubicCurve(b[e-1],b[e]),b[e].ownerShapeElement=this,a.push(b[e]));return a};
_.getSelectedTransformableGeometryPointList=function(){var a=[],b=this.getSubPathList(),c,d=b.length;for(c=0;c<d;c++){var e=b[c].geometryPointList,f,g=e.length;for(f=0;f<g;f++){var h=e[f];console.log("geometryPoint.isSelected",h.isSelected);h.isSelected&&(h.flagged=!0,"Q"==h.type?h.controlPt1.flagged=!0:"C"==h.type?h.controlPt2.flagged=!0:"M"==h.type&&"Z"==e[g-1].type&&(h=e[g-2],h.flagged=!0,"Q"==h.type?h.controlPt1.flagged=!0:"C"==h.type&&(h.controlPt2.flagged=!0)),f<g-1&&(h=e[f+1],"Z"==h.type&&
(h=e[0],h.flagged=!0,h=e[1]),"Q"==h.type||"C"==h.type))&&(h.controlPt1.flagged=!0)}for(f=0;f<g;f++)h=e[f],h.flagged&&(a.push(h),h.connectedToSelection=!0,delete h.flagged),"Q"==h.type?h.controlPt1.flagged&&(a.push(h.controlPt1),h.controlPt1.connectedToSelection=!0,delete h.controlPt1.flagged):"C"==h.type&&(h.controlPt1.flagged&&(a.push(h.controlPt1),h.controlPt1.connectedToSelection=!0,delete h.controlPt1.flagged),h.controlPt2.flagged&&(a.push(h.controlPt2),h.controlPt2.connectedToSelection=!0,delete h.controlPt2.flagged))}return a};
_.unifyPathSegments=function(a){var b=a.getTransformToElement(this);a=a.cloneNode();a.transformGeometryPointList(b);b=this.getGeometryPointList();this.setGeometryPointList(b.concat(a.cloneGeometryPointList()))};
_.reverseSegments=function(a){function b(a){h=a.geometryPointList;var b=h.length-1;e=h[b];a=!1;if("Z"==e.type||"z"==e.type)a=!0,b--,e=h[b];for(d.push(n.createGeometryPoint_MOVETO(e.x,e.y));0<b;b--)f=h[b],g=h[b-1],f=n.cloneSegment(f),f.x=g.x,f.y=g.y,"C"==f.type&&(k=f.controlPt1.x,l=f.controlPt1.y,f.controlPt1.x=f.controlPt2.x,f.controlPt1.y=f.controlPt2.y,f.controlPt2.x=k,f.controlPt2.y=l),d.push(f);a&&d.push(n.createGeometryPoint_CLOSEPATH())}var c=this.getSubPathList(),d=[],e,f,g,h,k,l,n=this;if(void 0!=
a)console.log("reverseSubPath"),b(c[a]),this.setSubPathGeometryPointList(a,d);else{for(a=0;a<c.length;a++)b(c[a]);this.setGeometryPointList(d)}this.renderRequest()};
_.closePath=function(a){function b(a){var b=a.geometryPointList;a=b[0];var c=b[b.length-1];"Z"!=c.type&&"z"!=c.type&&(a.x==c.x&&a.y==c.y||b.push(d.createGeometryPoint_LINETO(a.x,a.y)),b.push(d.createGeometryPoint_CLOSEPATH()))}var c=this.getSubPathList(),d=this;if(void 0!=a)b(c[a]);else for(a=0;a<c.length;a++)b(c[a]);var e=[];for(a=0;a<c.length;a++)e=e.concat(c[a].geometryPointList);this.setGeometryPointList(e);this.renderRequest()};
_.hasPointInPolygon=function(a){for(var b=this.getGeometryPointList(),c,d=b.length,e=0;e<d;e++)if(c=b[e],"Z"!=c.type&&this.isPointInPoly(a,c))return!0;return!1};_.intersectGlobalRect=function(a){if(this.isContainedInGlobalRect(a))return!0;a=this.globalRectToLocalPolygon(a);if(this.hasPointInPolygon(a))return!0;for(var b=this.getTotalLength(),c,d=0;d<b;){c=this.getPointAtLength(d);if(this.isPointInPoly(a,c))return!0;d+=3}return!1};
_.toSVGPathElement=function(){isNaN(this.getTransform().matrix.e)&&this.getTransform().matrix.identity();return this.cloneNode(!0)};_=SVGMaskElement.prototype;_.getScreenCTM=function(a){return this.parentNode.getScreenCTM()};_.prepareToNormalizeScale=function(a){this.normalizationData=this.parentNode.normalizationData;for(var b=this.childNodes.length,c=0;c<b;c++)this.childNodes[c].prepareToNormalizeScale&&this.childNodes[c].prepareToNormalizeScale(a)};
_.normalizeScale=function(a){for(var b=this.childNodes.length,c=0;c<b;c++)this.childNodes[c].normalizeScale&&this.childNodes[c].normalizeScale(a)};_=SVGForeignObjectElement.prototype;
_.normalizeScale=function(a){a=this.parentElement.screenMatrixToLocalMatrix(this.normalizationData.storedScreenMatrix);var b=a.getScale();this.scaleAttributeNumber("x",b.x);this.scaleAttributeNumber("y",b.y);this.scaleAttributeNumber("width",b.x);this.scaleAttributeNumber("height",b.y);b=this.ownerSVGElement.createSVGMatrix().scaleNonUniform(b.x,b.y).inverse();this.getTransform().setMatrix(a.multiply(b));console.log("SVGForeignObjectElement",this.getCTM().toHTML());console.log("SVGForeignObjectElement",
this.children[0])};_.toSVGPathElement=function(){return SVGUtils.createRect(this.x.baseVal.value,this.y.baseVal.value,this.width.baseVal.value,this.height.baseVal.value).toSVGPathElement()};_.getGlobalBBox=function(){return this.getGlobalBBoxByLocalBox()};_.updateGeometry=function(a,b,c,d){this.x.baseVal.value=a;this.y.baseVal.value=b;c&&(this.width.baseVal.value=c);d&&(this.height.baseVal.value=d)};_.createUniqueFillStrokeDefReferences=function(){};_=SVGUseElement.prototype;
function GoogleFonts_utils(){this.fontCategories=null;this.defaultFontFamilyNames="Roboto;Montserrat;Rubik;Archivo Narrow;Lato;Oswald;Playfair Display;Indie Flower;Pacifico;Abril Fatface".split(";");this.defaultFontFamilyList=[];this.init()}_=GoogleFonts_utils.prototype;
_.init=function(){var a=this;window.onLoadGoogleFontFamilies=function(b){var c={},d=b.items,e,f=d.length;for(e=0;e<f;e++){var g=d[e];c[g.category]||(c[g.category]=[]);c[g.category].push(g)}a.fontCategories=c;a.allFontList=d;console.log("window.fontCategories",a.fontCategories);console.log("onLoadGoogleFontFamilies",b);a.createDefaultFontFamilyList();console.log("defaultFontFamilyList",a.defaultFontFamilyList)};IncludeJS("/data/janvas_6.2/fonts/google-font-families.js")};
_.createDefaultFontFamilyList=function(){var a,b=this.defaultFontFamilyNames.length;for(a=0;a<b;a++)this.defaultFontFamilyList.push(this.getGoogleFontObjectByFamilyName(this.defaultFontFamilyNames[a]))};_.selectFontByFamilyName=function(a){a=a.toLowerCase();var b=GoogleFonts.allFontList,c,d=b.length;for(c=0;c<d;c++)b[c].family.toLowerCase()==a&&(b[c].isSelected=!0)};_.getSelectedFontList=function(){var a=[],b=GoogleFonts.allFontList,c,d=b.length;for(c=0;c<d;c++)b[c].isSelected&&a.push(b[c]);return a};
_.findFontList=function(a){a=a.toLowerCase();var b=[],c=GoogleFonts.allFontList,d,e=c.length;for(d=0;d<e;d++)-1<c[d].family.toLowerCase().indexOf(a)&&b.push(c[d]);return b};_.getGoogleFontObjectByFamilyName=function(a){for(var b in this.fontCategories){var c=this.fontCategories[b],d,e=c.length;for(d=0;d<e;d++)if(c[d].family==a)return c[d]}return null};
_.getFontUrlByFontFamilyStyleAndWeight=function(a,b,c,d){d=d||"latin";b=this.getGoogleFontVariantNameByStyleAndWeight(b,c);return"https://fonts.googleapis.com/css?family="+a.replace(/ /g,"+")+":"+b+"&subset="+d};
_.loadGoogleFont=function(a,b,c,d){b||(b=-1<a.variants.indexOf("regular")?"regular":a.variants[0]);c||(c=-1<a.subsets.indexOf("latin")?"latin":a.subsets[0]);a="https://fonts.googleapis.com/css?family="+a.family.replace(/ /g,"+")+":"+b+"&subset="+c;console.log("googlefontUrl",a);IncludeCSS(a,function(a){d&&d()})};
_.getGoogleFontVariantNameByStyleAndWeight=function(a,b){console.log("getGoogleFontVariantNameByStyleAndWeight _fontStyle",a);console.log("getGoogleFontVariantNameByStyleAndWeight _fontWeight",b);if("italic"==a){var c="italic";"400"!=b&&(c=b+c)}else c="regular",""!=b&&"400"!=b&&(c=b);return c};
_.getGoogleFontStyleAndWeightByVariantName=function(a){var b={name:"Regular","font-style":"regular","font-weight":400};switch(a){case "regular":b={name:"Regular","font-style":"normal","font-weight":400};break;case "italic":b={name:"Italic","font-style":"italic","font-weight":400};break;case "100":b={name:"Thin","font-style":"normal","font-weight":100};break;case "200":b={name:"Extra Light","font-style":"normal","font-weight":200};break;case "300":b={name:"Light","font-style":"normal","font-weight":300};
break;case "400":b={name:"Regular","font-style":"normal","font-weight":400};break;case "500":b={name:"Medium","font-style":"normal","font-weight":500};break;case "600":b={name:"Semi Bold","font-style":"normal","font-weight":600};break;case "700":b={name:"Bold","font-style":"normal","font-weight":700};break;case "800":b={name:"Extra Bold","font-style":"normal","font-weight":800};break;case "900":b={name:"Black","font-style":"normal","font-weight":900};break;case "100italic":b={name:"Thin - italic",
"font-style":"italic","font-weight":100};break;case "200italic":b={name:"Extra Light - italic","font-style":"italic","font-weight":200};break;case "300italic":b={name:"Light - italic","font-style":"italic","font-weight":300};break;case "400italic":b={name:"Regular - italic","font-style":"italic","font-weight":400};break;case "500italic":b={name:"Medium - italic","font-style":"italic","font-weight":500};break;case "600italic":b={name:"Semi Bold - italic","font-style":"italic","font-weight":600};break;
case "700italic":b={name:"Bold - italic","font-style":"italic","font-weight":700};break;case "800italic":b={name:"Extra Bold - italic","font-style":"italic","font-weight":800};break;case "900italic":b={name:"Black - italic","font-style":"italic","font-weight":900}}return b};window.GoogleFonts=new GoogleFonts_utils;function Geometry_utils(){}_=Geometry_utils.prototype;
_.isPointOnLine=function(a,b,c,d,e){if(e){if(b.x<a.x){e=b.x;var f=a.x}else e=a.x,f=b.x;if(b.y<a.y){var g=b.y;var h=a.y}else g=a.y,h=b.y;if(c.x<e||c.x>f||c.y<g||c.y>h)return!1}e=(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y);return 0==e?!1:Math.abs(((a.y-c.y)*(b.x-a.x)-(a.x-c.x)*(b.y-a.y))/e)*Math.sqrt(e)<d?(c=((c.x-a.x)*(b.x-a.x)+(c.y-a.y)*(b.y-a.y))/e,{x:a.x+c*(b.x-a.x),y:a.y+c*(b.y-a.y)}):!1};
_.projectPointOnLine=function(a,b,c,d){var e=b.x-a.x,f=b.y-a.y,g=e*e+f*f,h=(c.x-a.x)*e+(c.y-a.y)*f;d=d?min(1,max(0,h/g)):h/g;h=(b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x);return{point:{x:a.x+e*d,y:a.y+f*d},left:1>h,dot:h,t:d}};_.getPointPerpendicolarLine=function(a,b,c){var d=b.x-a.x;b=b.y-a.y;var e=Math.sqrt(d*d+b*b);d/=e;b/=e;c=d*(c.x-a.x)+b*(c.y-a.y);return{x:d*c+a.x,y:b*c+a.y}};
_.getLineLineIntersection=function(a,b,c,d,e){if(e){e=d.x-c.x;var f=d.y-c.y;d=b.x-a.x;var g=b.y-a.y;b=a.y-c.y;var h=a.y-c.y;c=f*d-e*g;e=(e*b-f*h)/c;c=(d*b-g*h)/c;return 0<=e&&1>=e&&0<=c&&1>=c?(c=a.y+e*g,e=a.x+e*d,{x:e,z:c}):null}e=b.y-a.y;g=a.x-b.x;f=b.x*a.y-a.x*b.y;a=d.y-c.y;b=c.x-d.x;c=d.x*c.y-c.x*d.y;d=e*b-a*g;return 0==d?null:{x:(g*c-b*f)/d,y:(a*f-e*c)/d}};window.GeometryUtils=new Geometry_utils;
function LengthPropertyLabel_interaction(a){this.appRef=a.appRef;this.connectEvents();this.onChangeCallback=null}_=LengthPropertyLabel_interaction.prototype;_.hide=function(){this.style.display="none"};
_.show=function(a,b,c,d){var e=a.x+(b.x-a.x)/2,f=a.y+(b.y-a.y)/2;a=SVGUtils.getAngleBetweenPoints(b,a)/(Math.PI/180);90<=a&&270>a?(console.log("angle",a),a+=180,this.setAttribute("y","27")):this.setAttribute("y","-27");this.setAttribute("transform","translate("+e+" "+f+") rotate("+a+" 0 0)");this.textContent=c;this.style.display="inline";this.onChangeCallback=d};_.onClickOn_label=function(a){console.log("onClickOnLabel");this.appRef.inputProperty2DPanel.show(this,LOCALIZER.translate("length"))};
_.getValue=function(){return this.textContent};
function BBox2D_interaction(a){this.appRef=a.appRef;this.selectionSizeY=this.selectionSizeX=0;this.showElementOrigin=this.showElementPivot=!1;this.isLocalMode=null;this.boundsPoints=[];for(a=0;4>a;a++)this.boundsPoints[a]=SVGUtils.createSVGPoint(0,0);this.nw=this.querySelector("#nw");this.n=this.querySelector("#n");this.ne=this.querySelector("#ne");this.e=this.querySelector("#e");this.se=this.querySelector("#se");this.s=this.querySelector("#s");this.sw=this.querySelector("#sw");this.w=this.querySelector("#w");
this.top_line=this.querySelector("#top_line");this.right_line=this.querySelector("#right_line");this.bottom_line=this.querySelector("#bottom_line");this.left_line=this.querySelector("#left_line");this.rotation=this.querySelector("#rotation");this.bboxPivot=this.querySelector("#bboxPivot");this.elementPivot=this.querySelector("#elementPivot");this.origin=this.querySelector("#origin");this.labelSizeX=this.querySelector("#LABEL_SIZE_X");this.labelSizeY=this.querySelector("#LABEL_SIZE_Y");var b=this;
this.labelSizeX.onChangeCallback=function(a){b.appRef.transform2DPanel.applySizeX(a)};this.labelSizeY.onChangeCallback=function(a){b.appRef.transform2DPanel.applySizeY(a)};this.connectEvents()}_=BBox2D_interaction.prototype;_.onClick_labelSizeX=function(){this.appRef.inputProperty2DPanel.show(this.labelSizeX,LOCALIZER.translate("width"))};_.onClick_labelSizeY=function(){this.appRef.inputProperty2DPanel.show(this.labelSizeY,LOCALIZER.translate("height"))};
_.onMouseDown_handles=function(a){this.scaleAxis="XY";var b=a.target;console.log("clickedHandle",b);this.appRef.activeEditablePage.setPen({pointInDocumentSpace:b.parentElement.getTransform().matrix.getTranslation()});if(b.classList.contains("resize")){switch(b.parentElement.getAttribute("id")){case "nw":var c=this.boundsPoints[2];break;case "n":c=this.getCenterBottom();this.scaleAxis="Y";break;case "ne":c=this.boundsPoints[3];break;case "e":c=this.getCenterLeft();this.scaleAxis="X";break;case "se":c=
this.boundsPoints[0];break;case "s":c=this.getCenterTop();this.scaleAxis="Y";break;case "sw":c=this.boundsPoints[1];break;case "w":c=this.getCenterRight(),this.scaleAxis="X"}this.appRef.tools.scaleElement2D_tool.setTransformProperties(this.getCenter(),c,this.scaleAxis,this.isLocalMode);GMOUSE.globalMouseTargetDelegate=this.appRef.tools.scaleElement2D_tool}else if(b.classList.contains("translate"))this.appRef.tools.translate2D_tool.onMouseDown(a);else b.classList.contains("rotate")?(this.appRef.tools.rotateElement2D_tool.setPivotPoint(this.getCenter()),
GMOUSE.globalMouseTargetDelegate=this.appRef.tools.rotateElement2D_tool):b.classList.contains("translate-pivot")&&console.log("translate-pivot")};
_.show=function(){var a=this.appRef.activeEditablePage,b=a.selectionList;this.selectionBBox=null;this.appRef.transform2DPanel.isLocalMode&&1==b.length?(this.isLocalMode=!0,a=b[0],this.selectionBBox=a.getLocalBBox(),this.selectionSizeX=this.selectionBBox.width,this.selectionSizeY=this.selectionBBox.height,this.boundsPoints[0].set(this.selectionBBox.min.x,this.selectionBBox.min.y),this.boundsPoints[1].set(this.selectionBBox.max.x,this.selectionBBox.min.y),this.boundsPoints[2].set(this.selectionBBox.max.x,
this.selectionBBox.max.y),this.boundsPoints[3].set(this.selectionBBox.min.x,this.selectionBBox.max.y),a.getCTM().transformPointList(this.boundsPoints)):(this.isLocalMode=!1,this.selectionBBox=a.getElementListGlobalBBox(b),b=a.content.getCTM().inverse(),a=SVGUtils.createSVGPoint(this.selectionBBox.min.x,this.selectionBBox.min.y).matrixTransform(b),b=SVGUtils.createSVGPoint(this.selectionBBox.max.x,this.selectionBBox.max.y).matrixTransform(b),this.selectionSizeX=b.x-a.x,this.selectionSizeY=b.y-a.y,
this.boundsPoints[0].set(this.selectionBBox.min.x,this.selectionBBox.min.y),this.boundsPoints[1].set(this.selectionBBox.max.x,this.selectionBBox.min.y),this.boundsPoints[2].set(this.selectionBBox.max.x,this.selectionBBox.max.y),this.boundsPoints[3].set(this.selectionBBox.min.x,this.selectionBBox.max.y));this.update();ShowElement(this)};
_.update=function(){function a(a){return 45*Math.round(SVGUtils.getAngleBetweenPoints(a,n)/(Math.PI/180*45))}function b(a){return Math.round(SVGUtils.getAngleBetweenPoints(a,n)/(Math.PI/180))}var c=this.boundsPoints[0].x;var d=this.boundsPoints[0].y;var e=this.boundsPoints[1].x;var f=this.boundsPoints[1].y;var g=this.boundsPoints[2].x;var h=this.boundsPoints[2].y;var k=this.boundsPoints[3].x;var l=this.boundsPoints[3].y;this.top_line.updateGeometry(c,d,e,f);this.right_line.updateGeometry(e,f,g,h);
this.bottom_line.updateGeometry(g,h,k,l);this.left_line.updateGeometry(k,l,c,d);var n=this.getCenter();this.bboxPivot.placeAt(n.x,n.y);this.nw.placeAt(c,d);this.ne.placeAt(e,f);this.se.placeAt(g,h);this.sw.placeAt(k,l);c=this.getCenterTop();this.n.placeAt(c.x,c.y);d=this.getCenterRight();this.e.placeAt(d.x,d.y);e=this.getCenterBottom();this.s.placeAt(e.x,e.y);f=this.getCenterLeft();this.w.placeAt(f.x,f.y);g={0:"ew-resize",45:"nwse-resize",90:"ns-resize",135:"nesw-resize",180:"ew-resize",225:"nwse-resize",
270:"ns-resize",315:"nesw-resize"};this.e.querySelector(".resize").style.cursor=g[String(a(d))];this.se.querySelector(".resize").style.cursor=g[String(a(this.boundsPoints[2]))];this.s.querySelector(".resize").style.cursor=g[String(a(e))];this.sw.querySelector(".resize").style.cursor=g[String(a(this.boundsPoints[3]))];this.w.querySelector(".resize").style.cursor=g[String(a(f))];this.nw.querySelector(".resize").style.cursor=g[String(a(this.boundsPoints[0]))];this.n.querySelector(".resize").style.cursor=
g[String(a(c))];this.ne.querySelector(".resize").style.cursor=g[String(a(this.boundsPoints[1]))];this.rotation.setAttribute("transform","translate("+e.x+" "+e.y+") rotate("+(b(e)+90+180)+" 0 0)");this.labelSizeX.setAttribute("y","-27");this.labelSizeY.setAttribute("y","27");e=b(d);90<e&&270>e&&(e+=180,this.labelSizeX.setAttribute("y","27"));this.labelSizeX.setAttribute("transform","translate("+c.x+" "+c.y+") rotate("+e+" 0 0)");e=b(c);console.log("angle",e);90<e&&270>e&&(e+=180,this.labelSizeY.setAttribute("y",
"-27"));this.labelSizeY.setAttribute("transform","translate("+d.x+" "+d.y+") rotate("+e+" 0 0)");this.labelSizeX.textContent=this.appRef.activeEditablePage.valueToUnit(this.selectionSizeX);this.labelSizeY.textContent=this.appRef.activeEditablePage.valueToUnit(this.selectionSizeY);this.origin.style.display=this.elementPivot.style.display="none";this.isLocalMode&&(this.showElementPivot&&(c=this.appRef.activeEditablePage.selectionList[0].getCTM(),this.elementPivot.placeAt(c.e,c.f),this.elementPivot.style.display=
"inline"),this.showElementOrigin&&(this.origin.style.display="inline",c=this.appRef.activeEditablePage.selectionList[0].parentElement.getCTM(),d=this.origin.getTransform().matrix.identity(),this.origin.getTransform().setMatrix(d.rotate(c.getRotation())),d.e=c.e,d.f=c.f))};_.getCenter=function(){return SVGUtils.createSVGPoint(this.boundsPoints[0].x+(this.boundsPoints[2].x-this.boundsPoints[0].x)/2,this.boundsPoints[0].y+(this.boundsPoints[2].y-this.boundsPoints[0].y)/2)};
_.getCenterTop=function(){return SVGUtils.createSVGPoint(this.boundsPoints[0].x+(this.boundsPoints[1].x-this.boundsPoints[0].x)/2,this.boundsPoints[0].y+(this.boundsPoints[1].y-this.boundsPoints[0].y)/2)};_.getCenterLeft=function(){return SVGUtils.createSVGPoint(this.boundsPoints[0].x+(this.boundsPoints[3].x-this.boundsPoints[0].x)/2,this.boundsPoints[0].y+(this.boundsPoints[3].y-this.boundsPoints[0].y)/2)};
_.getCenterRight=function(){return SVGUtils.createSVGPoint(this.boundsPoints[1].x+(this.boundsPoints[2].x-this.boundsPoints[1].x)/2,this.boundsPoints[1].y+(this.boundsPoints[2].y-this.boundsPoints[1].y)/2)};_.getCenterBottom=function(){return SVGUtils.createSVGPoint(this.boundsPoints[2].x+(this.boundsPoints[3].x-this.boundsPoints[2].x)/2,this.boundsPoints[2].y+(this.boundsPoints[3].y-this.boundsPoints[2].y)/2)};
function PerspectiveDeform2D_interaction(a){this.appRef=a.appRef;this.boundsPoints=[];this.originalBoundsPoints=[];for(a=0;4>a;a++)this.boundsPoints[a]=SVGUtils.createSVGPoint(0,0),this.originalBoundsPoints[a]=SVGUtils.createSVGPoint(0,0);this.nw=this.querySelector("#nw");this.ne=this.querySelector("#ne");this.se=this.querySelector("#se");this.sw=this.querySelector("#sw");this.top_line=this.querySelector("#top_line");this.right_line=this.querySelector("#right_line");this.bottom_line=this.querySelector("#bottom_line");
this.left_line=this.querySelector("#left_line");this.connectEvents()}_=PerspectiveDeform2D_interaction.prototype;
_.onMouseDown_handles=function(a){a=a.target;this.appRef.activeEditablePage.setPen({pointInDocumentSpace:a.parentElement.getTransform().matrix.getTranslation()});if(a.classList.contains("resize"))switch(a.parentElement.getAttribute("id")){case "nw":this.idActiveHandle=0;break;case "ne":this.idActiveHandle=1;break;case "se":this.idActiveHandle=2;break;case "sw":this.idActiveHandle=3}GMOUSE.globalMouseTargetDelegate=this};
_.show=function(){var a=this.appRef.activeEditablePage;this.selectionBBox=a.getElementListGlobalBBox(a.selectionList);this.boundsPoints[0].set(this.selectionBBox.min.x,this.selectionBBox.min.y);this.boundsPoints[1].set(this.selectionBBox.max.x,this.selectionBBox.min.y);this.boundsPoints[2].set(this.selectionBBox.max.x,this.selectionBBox.max.y);this.boundsPoints[3].set(this.selectionBBox.min.x,this.selectionBBox.max.y);this.originalBoundsPoints[0].set(this.selectionBBox.min.x,this.selectionBBox.min.y);
this.originalBoundsPoints[1].set(this.selectionBBox.max.x,this.selectionBBox.min.y);this.originalBoundsPoints[2].set(this.selectionBBox.max.x,this.selectionBBox.max.y);this.originalBoundsPoints[3].set(this.selectionBBox.min.x,this.selectionBBox.max.y);this.initTransform();this.update();ShowElement(this)};
_.initTransform=function(){this.transformableInteractivePathList=[];var a=this.appRef.interaction2D.elementPreviews.querySelectorAll("g,path,line"),b;for(b=0;b<a.length;b++){var c=a[b];if(c.elementRef&&("path"==c.elementRef.nodeName||"line"==c.elementRef.nodeName)){var d=c.elementRef;var e=d.cloneGeometryPointList();d.transformGeometryPointList(d.getCTM(),e);c.originalGlobalPointList=e;this.transformableInteractivePathList.push(c)}c.getTransform().matrix.identity()}b=this.appRef.activeEditablePage;
this.undoAction=new SetGeometryPoint2D_action(b);this.redoAction=new SetGeometryPoint2D_action(b);a=this.transformableInteractivePathList.length;for(b=0;b<a;b++)this.undoAction.addTransformDataPointList(this.transformableInteractivePathList[b].elementRef.geometryPointListToTransformData());this.deformInteractivePathList()};
_.update=function(){var a=this.boundsPoints[0].x;var b=this.boundsPoints[0].y;var c=this.boundsPoints[1].x;var d=this.boundsPoints[1].y;var e=this.boundsPoints[2].x;var f=this.boundsPoints[2].y;var g=this.boundsPoints[3].x;var h=this.boundsPoints[3].y;this.top_line.updateGeometry(a,b,c,d);this.right_line.updateGeometry(c,d,e,f);this.bottom_line.updateGeometry(e,f,g,h);this.left_line.updateGeometry(g,h,a,b);this.nw.placeAt(a,b);this.ne.placeAt(c,d);this.se.placeAt(e,f);this.sw.placeAt(g,h)};
_.onGlobalMouseDrag=function(a){a=this.appRef.activeEditablePage.screenPointToPen(GMOUSE.mouseMovePt);this.boundsPoints[this.idActiveHandle].x=a.pointInDocumentSpace.x;this.boundsPoints[this.idActiveHandle].y=a.pointInDocumentSpace.y;this.update();this.canBeDeformed()&&this.deformInteractivePathList()};_.onGlobalMouseEndDrag=function(a){this.swapInteractivePathPointListToElementPointList()};
_.endTransform=function(a){var b=this.transformableInteractivePathList.length;for(a=0;a<b;a++)this.redoAction.addTransformDataPointList(this.transformableInteractivePathList[a].elementRef.geometryPointListToTransformData()),this.transformableInteractivePathList[a].originalGlobalPointList=null;this.appRef.activeEditablePage.history.addUndoRedoActions(this.undoAction,this.redoAction);this.transformableInteractivePathList=null};
_.swapInteractivePathPointListToElementPointList=function(){for(var a,b,c,d,e,f,g,h=0;h<this.transformableInteractivePathList.length;h++){a=this.transformableInteractivePathList[h];e=a.elementRef;b=e.getCTM().inverse().multiply(a.getCTM());a.transformGeometryPointList(b);f=a.getGeometryPointList();g=e.getGeometryPointList();b=f.length;for(a=0;a<b;a++)d=f[a],c=g[a],"Z"!=d.type&&(c.x=d.x,c.y=d.y),"Q"==c.type?(c.controlPt1.x=d.controlPt1.x,c.controlPt1.y=d.controlPt1.y):"C"==c.type&&(c.controlPt1.x=
d.controlPt1.x,c.controlPt1.y=d.controlPt1.y,c.controlPt2.x=d.controlPt2.x,c.controlPt2.y=d.controlPt2.y);e.render()}this.deformInteractivePathList()};_.deformInteractivePathList=function(){for(var a=0;a<this.transformableInteractivePathList.length;a++)this.deformInteractivePath(this.transformableInteractivePathList[a])};
_.canBeDeformed=function(a){function b(a,b,c){var d=b.x-c.x;c=b.y-c.y;var e=b.x-a.x;a=b.y-a.y;return 180*Math.atan2(d*a-c*e,d*e+c*a)/Math.PI}var c=this.boundsPoints[0],d=this.boundsPoints[1],e=this.boundsPoints[2],f=this.boundsPoints[3];a=b(f,c,d);var g=b(c,d,e);d=b(d,e,f);c=b(e,f,c);return 0<a&&180>a&&0<g&&180>g&&0<d&&180>d&&0<c&&180>c?!0:!1};
_.deformInteractivePath=function(a){for(var b=a.getGeometryPointList(),c=a.originalGlobalPointList,d,e,f,g=0;g<b.length;g++)d=b[g],e=c[g],"Z"!=d.type&&(f=this.deformPoint(e.x,e.y,this.originalBoundsPoints,this.boundsPoints),d.x=f.x,d.y=f.y),"Q"==d.type?(f=this.deformPoint(e.controlPt1.x,e.controlPt1.y,this.originalBoundsPoints,this.boundsPoints),d.controlPt1.x=f.x,d.controlPt1.y=f.y):"C"==d.type&&(f=this.deformPoint(e.controlPt1.x,e.controlPt1.y,this.originalBoundsPoints,this.boundsPoints),d.controlPt1.x=
f.x,d.controlPt1.y=f.y,f=this.deformPoint(e.controlPt2.x,e.controlPt2.y,this.originalBoundsPoints,this.boundsPoints),d.controlPt2.x=f.x,d.controlPt2.y=f.y);a.renderRequest()};
_.deformPoint=function(a,b,c,d){var e=c[0].x,f=c[0].y,g=c[2].x,h=c[2].y,k=d[0].x,l=d[0].y,n=d[1].x,m=d[1].y,y=d[2].x,p=d[2].y;c=d[3].x;d=d[3].y;n==y&&(y+=.001);k==c&&(c+=.001);k==n&&(n+=.001);c==y&&(y+=.001);var K=(m-p)/(n-y),E=(l-d)/(k-c),Ia=(l-m)/(k-n),P=(d-p)/(c-y);K==E&&(E+=.001);E=(K*n-E*k+l-m)/(K-E);var qa=K*(E-n)+m;Ia==P&&(P+=.001);y=(Ia*n-P*y+p-m)/(Ia-P);p=Ia*(y-n)+m;E==y&&(y+=.001);P=(qa-p)/(E-y);P==Ia&&(Ia+=.001);k=(P*c-Ia*k+l-d)/(P-Ia);P==K&&(K+=.001);n=(P*c-K*n+m-d)/(P-K);b=(h-b)/(h-f);
e=(a-e)/(g-e);a=(k-c)*b+c;g=(P*(k-c)+d-d)*b+d;f=(n-c)*e+c;y==a&&(a+=.001);E==f&&(f+=.001);b=(p-g)/(y-a);c=(qa-((P*(n-c)+d-d)*e+d))/(E-f);b==c&&(c+=.001);c=(b*y-c*E+qa-p)/(b-c);return{x:c,y:b*(c-a)+g}};
function Points2D_interaction(a){this.appRef=a.appRef;this.interactionPointTemplate=document.querySelector("#INTERACTION_POINT_TEMPLATE");this.interactionControlPointTemplate=document.querySelector("#INTERACTION_CONTROL_POINT_TEMPLATE");this.interactionPointTemplate.removeAttribute("id");this.interactionControlPointTemplate.removeAttribute("id");ConnectEvent("mousedown",this,this.onMouseDown,this);ConnectEvent("mouseup",this,this.onMouseUp,this)}_=Points2D_interaction.prototype;
_.onMouseDown=function(a){console.log("_e.target",a.target);var b=this.appRef.activeEditablePage,c=a.target.parentElement;console.log("clickedInteractionPoint",c);if(this.appRef.tools.activeTool==this.appRef.tools.selectionGlobal2D_tool||this.appRef.tools.activeTool==this.appRef.tools.selectionPoint2D_tool){if(!c.classList.contains("control")){if(a.altKey&&"path"==c.pointRef.ownerShapeElement.nodeName){a.shiftKey||(b.removePathSegments_undable([c.pointRef]),b.setCurrentEditablePoint(null));return}c.pointRef.isSelected?
a.shiftKey?(b.deselectPoint(c.pointRef),b.setCurrentEditablePoint(null)):(c.pointRef.editable=!0,b.setCurrentEditablePoint(c.pointRef)):(a.shiftKey||b.deselectAllPoints(),b.selectPoint(c.pointRef),c.pointRef.editable=!0,b.setCurrentEditablePoint(c.pointRef))}this.appRef.activeEditablePage.setPen({pointInDocumentSpace:c.getTransform().matrix.getTranslation()});if(a.target.classList.contains("resize"))if(c.classList.contains("control")){b=c.pointRef.ownerPoint;var d=b.ownerShapeElement;a.altKey&&"path"==
d.nodeName?(d.getGeometryPointList(),"C"==b.type?"CTRL2"==c.pointRef.type?(a=d.createGeometryPoint_CURVETO_QUADRATIC(b.controlPt1.x,b.controlPt1.y,b.x,b.y),a.editable=!0,this.appRef.activeEditablePage.replacePathSegment_undable(a,b)):"CTRL1"==c.pointRef.type&&(a=d.createGeometryPoint_CURVETO_QUADRATIC(b.controlPt2.x,b.controlPt2.y,b.x,b.y),a.editable=!0,this.appRef.activeEditablePage.replacePathSegment_undable(a,b)):(a=d.createGeometryPoint_LINETO(b.x,b.y),a.editable=!0,this.appRef.activeEditablePage.replacePathSegment_undable(a,
b))):(this.appRef.tools.translateControlPoint2D_tool.draggableControlPointList=this.createDraggablePathControlPoint(c.pointRef),this.appRef.tools.translateControlPoint2D_tool.onMouseDown(a))}else this.appRef.tools.translatePoint2D_tool.onMouseDown(a);else if(a.target.classList.contains("translate"))this.appRef.tools.translate2D_tool.onMouseDown(a)}else this.appRef.tools.activeTool.onMouseDownOnInteractionPoint(c)};_.onMouseUp=function(a){this.show()};
_.createDraggablePathControlPoint=function(a){var b=[a];if("CTRL2"==a.type){if(a=a.ownerPoint.interactionPointRef.nextElementSibling){var c=a.pointRef;"Z"==c.type&&(a=a.parentElement.firstChild.nextElementSibling,c=a.pointRef);"Q"!=c.type&&"C"!=c.type||b.push(c.controlPt1)}}else if("CTRL1"==a.type&&(a=a.ownerPoint.interactionPointRef.previousElementSibling)){c=a.pointRef;if("M"==c.type)if(a=a.parentElement.lastChild,c=a.pointRef,"Z"==c.type)a=a.previousElementSibling,c=a.pointRef;else return b;"C"==
c.type&&b.push(c.controlPt2)}return b};_.show=function(){this.removeAllInteractionPoints();var a=this.appRef.activeEditablePage.selectionList,b,c=a.length;for(b=0;b<c;b++)"path"==a[b].nodeName?this.createPathInteractionPoints(a[b]):this.createElementInteractionPoints(a[b]);ShowElement(this)};
_.showRoundableCornerPoints=function(){this.removeAllInteractionPoints();var a=this.appRef.activeEditablePage.selectionList,b,c=a.length;for(b=0;b<c;b++)"path"==a[b].nodeName&&this.createRoundablePathInteractionPoints(a[b]);ShowElement(this)};
_.createRoundablePathInteractionPoints=function(a){function b(a){d=n.appendChild(h.interactionPointTemplate.cloneNode(!0));e=a.matrixTransform(f);d.placeAt(e.x,e.y);d.pointRef=a;a.interactionPointRef=d}var c=SVGUtils.createGroup(0,0,"path-interaction"),d,e,f=a.getCTM();var g=a.getSubPathList();a.selectionInfo&&void 0!=a.selectionInfo.subPathId&&(g=[g[a.selectionInfo.subPathId]]);var h=this,k=g.length;for(a=0;a<k;a++){var l=g[a].geometryPointList;var n=c.appendChild(SVGUtils.createGroup(0,0,"point-list"));
c.appendChild(SVGUtils.createGroup(0,0,"control-point-list"));var m,y=l.length-1;for(m=0;m<y;m++)"L"==l[m].type&&("L"==l[m+1].type?b(l[m]):"Z"==l[m+1].type&&"L"==l[1].type&&b(l[m]))}this.appendChild(c)};_.removeAllInteractionPoints=function(){var a=this.querySelectorAll(".interaction-point"),b,c=a.length;for(b=0;b<c;b++)delete a[b].pointRef.interactionPointRef,delete a[b].pointRef;this.removeChildren()};
_.createElementInteractionPoints=function(a){var b=this.appendChild(SVGUtils.createGroup(0,0,a.nodeName+"-interaction")),c=a.getCTM();a=a.getGeometryPointList();b=b.appendChild(SVGUtils.createGroup(0,0,"point-list"));var d,e=a.length;for(d=0;d<e;d++){var f=a[d];var g=b.appendChild(this.interactionPointTemplate.cloneNode(!0));var h=f.matrixTransform(c);g.placeAt(h.x,h.y);f.isSelected&&g.classList.add("selected");f.isFocused&&g.classList.add("focused");g.pointRef=f;f.interactionPointRef=g}};
_.createPathInteractionPoints=function(a){var b=SVGUtils.createGroup(0,0,"path-interaction"),c=a.getCTM();var d=a.getSubPathList();a.selectionInfo&&void 0!=a.selectionInfo.subPathId&&(d=[d[a.selectionInfo.subPathId]]);var e=d.length;for(a=0;a<e;a++){var f=d[a].geometryPointList;var g=b.appendChild(SVGUtils.createGroup(0,0,"point-list"));b.appendChild(SVGUtils.createGroup(0,0,"control-point-list"));var h,k=f.length;for(h=0;h<k;h++){var l=f[h];if("Z"==l.type)var n=g.appendChild(SVGUtils.createGroup());
else{n=g.appendChild(this.interactionPointTemplate.cloneNode(!0));var m=l.matrixTransform(c);n.placeAt(m.x,m.y);l.isSelected&&n.classList.add("selected");l.isFocused&&n.classList.add("focused")}n.pointRef=l;l.interactionPointRef=n}g=[];for(h=0;h<k;h++)l=f[h],l.editable&&("Q"!=l.type&&"C"!=l.type||g.push(l),h<k-1&&(l=f[h+1],"Z"==l.type&&(l=f[1]),"Q"!=l.type&&"C"!=l.type||g.push(l)));k=g.length;for(h=0;h<k;h++)this.createPathInteractionControlPoints(g[h])}this.appendChild(b)};
_.createPathInteractionControlPoints=function(a){var b=a.ownerShapeElement.getCTM();var c=a.interactionPointRef.parentElement.nextElementSibling;if("Q"==a.type){var d=a.interactionPointRef.getTransform().matrix.getTranslation();var e=c.appendChild(this.interactionControlPointTemplate.cloneNode(!0));e.pointRef=a.controlPt1;var f=a.controlPt1.matrixTransform(b);e.placeAt(f.x,f.y);d=SVGUtils.createLine(d.x,d.y,f.x,f.y);c.parentNode.insertBefore(d,c.parentNode.firstChild)}else"C"==a.type&&(d=a.interactionPointRef.previousElementSibling.getTransform().matrix.getTranslation(),
e=c.appendChild(this.interactionControlPointTemplate.cloneNode(!0)),e.pointRef=a.controlPt1,f=a.controlPt1.matrixTransform(b),e.placeAt(f.x,f.y),d=SVGUtils.createLine(d.x,d.y,f.x,f.y),c.parentNode.insertBefore(d,c.parentNode.firstChild),d=a.interactionPointRef.getTransform().matrix.getTranslation(),e=c.appendChild(this.interactionControlPointTemplate.cloneNode(!0)),e.pointRef=a.controlPt2,f=a.controlPt2.matrixTransform(b),e.placeAt(f.x,f.y),d=SVGUtils.createLine(d.x,d.y,f.x,f.y),c.parentNode.insertBefore(d,
c.parentNode.firstChild))};
function Rotation2D_interaction(a){this.appRef=a.appRef;this.pivot=this.querySelector("#pivot");this.axisLine=this.querySelector("#axis-line");this.label=this.querySelector(".label");var b=this;this.label.onChangeCallback=function(a){var c=b.appRef.activeEditablePage,e=b.pivot.getTransform().matrix.getTranslation();c.rotateElementList_undable(c.selectionList,a,e)};this.label.getValue=function(){return"0\u00b0"};this.goniometro=this.querySelector(".goniometer");this.positionInContentSpace={x:0,y:0};
this.connectEvents()}_=Rotation2D_interaction.prototype;_.onMouseDown_pivot=function(a){GMOUSE.globalMouseTargetDelegate=this};_.show=function(){ShowElement(this,"always");this.update()};
_.updateRotation=function(a){var b=this.appRef.activeEditablePage.getPen(),c=this.pivot.getTransform().matrix.getTranslation(),d=SVGUtils.getAngleBetweenPoints(b.pointInDocumentSpace,c,0,0)/(Math.PI/180),e=this.goniometro.getTransform().matrix;e.identity();this.goniometro.getTransform().setMatrix(e.rotate(d));void 0===a&&(a=d);this.label.textContent=a.toFixed(this.appRef.activeEditablePage.fixedDecimals)+"\u00b0";this.axisLine.updateGeometry(c.x,c.y,b.pointInDocumentSpace.x,b.pointInDocumentSpace.y)};
_.onClickOn_label=function(){console.log("onClickOn_label");this.appRef.inputProperty2DPanel.show(this.label,LOCALIZER.translate("rotation"))};_.setPosition=function(a){this.positionInContentSpace=a;this.update()};_.update=function(){var a=this.appRef.activeEditablePage.content.localToGlobal(this.positionInContentSpace.x,this.positionInContentSpace.y);this.pivot.placeAt(a.x,a.y)};_.onGlobalMouseDrag=function(a){this.setPosition(this.appRef.activeEditablePage.screenPointToPen(GMOUSE.mouseMovePt).pointInContentSpace)};
_.getPivotPositionInDocumentSpace=function(a){a=this.pivot.getTransform().matrix;return SVGUtils.createSVGPoint(a.e,a.f)};
function Scale2D_interaction(a){this.appRef=a.appRef;this.positionInContentSpace={x:0,y:0};this.pivot=this.querySelector("#pivot");this.connectEvents();var b=this;this.labelScaleX=this.querySelector("#LABEL_SCALE_X");this.labelScaleX.onChangeCallback=function(a){var c=b.appRef.activeEditablePage,e=b.pivot.getTransform().matrix.getTranslation();c.scaleElementList_undable(c.selectionList,a/100,1,e)};this.labelScaleY=this.querySelector("#LABEL_SCALE_Y");this.labelScaleY.onChangeCallback=function(a){var c=
b.appRef.activeEditablePage,e=b.pivot.getTransform().matrix.getTranslation();c.scaleElementList_undable(c.selectionList,1,a/100,e)}}_=Scale2D_interaction.prototype;_.setPosition=function(a){this.positionInContentSpace=a;this.update()};_.onMouseDown_pivot=function(a){GMOUSE.globalMouseTargetDelegate=this};_.onClickOn_labelScaleX=function(){console.log("onClickOn_label");this.appRef.inputProperty2DPanel.show(this.labelScaleX)};_.onClickOn_labelScaleY=function(){console.log("onClickOn_label");this.appRef.inputProperty2DPanel.show(this.labelScaleY)};
_.show=function(){ShowElement(this,"always");this.update()};_.update=function(){var a=this.appRef.activeEditablePage.content.localToGlobal(this.positionInContentSpace.x,this.positionInContentSpace.y);this.pivot.placeAt(a.x,a.y)};_.onGlobalMouseDrag=function(a){this.setPosition(this.appRef.activeEditablePage.screenPointToPen(GMOUSE.mouseMovePt).pointInContentSpace)};_.getPivotPositionInDocumentSpace=function(a){a=this.pivot.getTransform().matrix;return SVGUtils.createSVGPoint(a.e,a.f)};
function Gradient2D_interaction(a){this.appRef=a.appRef;this.gradientPointA=this.querySelector("#pointA");this.gradientPointB=this.querySelector("#pointB");this.stopColorsContainer=this.querySelector(".stop-colors");this.stopColorPointTemplate=this.stopColorsContainer.querySelector("#STOP_COLOR_POINT_TEMPLATE");this.stopColorPointTemplate.removeAttribute("id");this.stopColorPointTemplate.remove();a.interactionElement=this;this.setGradientPointLocationTool=new SetGradientPointLocation2D_tool(a);this.setGradientStopColorLocationTool=
new SetGradientStopColorLocation2D_tool(a);ConnectEvent("mousedown",this,this.onMouseDown,this);ConnectEvent("mouseup",this,this.onMouseUp,this)}_=Gradient2D_interaction.prototype;_.show=function(){ShowElement(this);this.update();this.appRef.colorPickerPanel.setOnChangeEvents()};
_.update=function(){if(this.classList.contains("showed")){var a=this.appRef.fillStroke2DPanel.editableGradientDef;if(a){var b=a.nodeName,c=a.getAttribute("gradientUnits")||"objectBoundingBox";this.globalPointC=this.globalPointB=this.globalPointA=null;var d=this.appRef.activeEditablePage.selectionList[0];"linearGradient"==b?a.hasAttribute("x1")||(a.initDefaultPoints(),c="objectBoundingBox"):a.hasAttribute("cx")||(a.initDefaultPoints(),c="objectBoundingBox");if("objectBoundingBox"==c)if(c=d.getBBox(),
"linearGradient"==b){b=parseFloat(a.getAttribute("x1"));var e=parseFloat(a.getAttribute("y1"));var f=parseFloat(a.getAttribute("x2"));a=parseFloat(a.getAttribute("y2"));b=c.x+b*c.width;e=c.y+e*c.height;f=c.x+f*c.width;a=c.y+a*c.height}else b=parseFloat(a.getAttribute("cx")),e=parseFloat(a.getAttribute("cy")),a=parseFloat(a.getAttribute("r")),b=c.x+b*c.width,e=c.y+e*c.height,a*=c.width,f=b+a,a=e;else"linearGradient"==b?(b=parseFloat(a.getAttribute("x1")),e=parseFloat(a.getAttribute("y1")),f=parseFloat(a.getAttribute("x2")),
a=parseFloat(a.getAttribute("y2"))):(b=parseFloat(a.getAttribute("cx")),e=parseFloat(a.getAttribute("cy")),a=parseFloat(a.getAttribute("r")),f=b+a,a=e);this.globalPointA=d.localToGlobal(b,e);this.gradientPointA.setAttribute("cx",this.globalPointA.x);this.gradientPointA.setAttribute("cy",this.globalPointA.y);this.globalPointB=d.localToGlobal(f,a);this.gradientPointB.setAttribute("cx",this.globalPointB.x);this.gradientPointB.setAttribute("cy",this.globalPointB.y);d=this.querySelectorAll("line");d[0].updateGeometry(this.globalPointA.x,
this.globalPointA.y,this.globalPointB.x,this.globalPointB.y);d[1].updateGeometry(this.globalPointA.x,this.globalPointA.y,this.globalPointB.x,this.globalPointB.y);this.createEditableStopColorViews()}}};
_.createEditableStopColorViews=function(){var a=this.appRef.fillStroke2DPanel.editableGradientDef;a.sortStopColors();this.stopColorsContainer.removeChildren();for(var b=a.children.length,c=0;c<b;c++){var d=a.children[c];d.stylePropertiesToAttributes();var e=this.stopColorPointTemplate.cloneNode(!0);e.stopColorRef=d;e.setAttribute("fill",d.getAttribute("stop-color"));this.stopColorsContainer.appendChild(e);var f=this.globalPointA.x+(this.globalPointB.x-this.globalPointA.x)*d.offset.baseVal;d=this.globalPointA.y+
(this.globalPointB.y-this.globalPointA.y)*d.offset.baseVal;e.setAttribute("cx",f);e.setAttribute("cy",d)}};
_.onMouseDown=function(a){console.log("onMouseDown Gradient2D_interaction _e.target",a.target);a.target.parentElement.classList.contains("stop-colors")?(this.setGradientStopColorLocationTool.setEditableStopColor(a.target.stopColorRef),GMOUSE.globalMouseTargetDelegate=this.setGradientStopColorLocationTool):(this.setGradientPointLocationTool.setEditablePointName(a.target.getAttribute("id")),GMOUSE.globalMouseTargetDelegate=this.setGradientPointLocationTool)};
_.onMouseUp=function(a){console.log("onMouseUp Gradient2D_interaction _e.target",a.target);if(a.target.parentElement.classList.contains("stop-colors")){var b=this;this.appRef.colorPickerPanel.setOnChangeEvents(function(c){var d=c.getColorAsHex();a.target.setAttribute("fill",d);console.log("onChangeEnd hexColorValue",d);b.appRef.activeEditablePage.setAttributeElementList_undable([a.target.stopColorRef],{"stop-color":d,"stop-opacity":c.alpha},!1);b.appRef.fillStroke2DPanel.gradientEditor2DPanel.update()});
this.appRef.contextPanels.showContextPanel("COLOR_PICKER_CONTEXT_PANEL")}else if("line"==a.target.nodeName){console.log("aggiungi un color-stop",a.target);var c=this.appRef.activeEditablePage.mousePointInDocumentSpace(GMOUSE.mouseDownPt),d=this.globalPointA,e=this.globalPointB,f=this.appRef.fillStroke2DPanel.editableGradientDef;c=f.insertNewStopColor(Math.abs(e.x-d.x)>Math.abs(e.y-d.y)?(c.x-d.x)/(e.x-d.x):(c.y-d.y)/(e.y-d.y));this.appRef.activeEditablePage.createAddGradientStopColor_undable(f,c);
this.appRef.colorPickerPanel.setColor(c.getAttribute("stop-color"),c.getAttribute("stop-opacity"));this.update();this.appRef.interaction2D.gradientPoints2D.update()}};function SetGradientPointLocation2D_tool(a){this.appRef=a.appRef;this.interactionElement=a.interactionElement}_=SetGradientPointLocation2D_tool.prototype;_.setEditablePointName=function(a){this.editablePointName=a};
_.onGlobalMouseStartDrag=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;"linearGradient"==a.nodeName?(this.stored_x1=a.getAttribute("x1"),this.stored_y1=a.getAttribute("y1"),this.stored_x2=a.getAttribute("x2"),this.stored_y2=a.getAttribute("y2")):(this.stored_cx=a.getAttribute("cx"),this.stored_cy=a.getAttribute("cy"),this.stored_r=a.getAttribute("r"))};
_.onGlobalMouseDrag=function(a){var b=this.appRef.activeEditablePage,c=b.selectionList[0];a=this.appRef.fillStroke2DPanel.editableGradientDef;var d=b.screenPointToPen(GMOUSE.mouseMovePt);b.setPen(d);b=d.pointInDocumentSpace;b=c.globalToLocal(b.x,b.y);"objectBoundingBox"==(a.getAttribute("gradientUnits")||"objectBoundingBox")&&(c=c.getBBox(),b.x=(b.x-c.x)/c.width,b.y=(b.y-c.y)/c.height);"linearGradient"==a.nodeName?"pointA"==this.editablePointName?(a.setAttribute("x1",b.x),a.setAttribute("y1",b.y)):
"pointB"==this.editablePointName&&(a.setAttribute("x2",b.x),a.setAttribute("y2",b.y)):"pointA"==this.editablePointName?(a.setAttribute("cx",b.x),a.setAttribute("cy",b.y)):"pointB"==this.editablePointName&&(c=parseFloat(a.getAttribute("cx")),c=b.x-c,console.log("r",c),0<c&&a.setAttribute("r",c));this.interactionElement.update()};
_.onGlobalMouseEndDrag=function(a){a=this.appRef.activeEditablePage;var b=this.appRef.fillStroke2DPanel.editableGradientDef;if("linearGradient"==b.nodeName)if("pointA"==this.editablePointName){var c=b.getAttribute("x1"),d=b.getAttribute("y1");b.setAttribute("x1",this.stored_x1);b.setAttribute("y1",this.stored_y1);a.setAttributeElementList_undable([b],{x1:c,y1:d},!1)}else"pointB"==this.editablePointName&&(c=b.getAttribute("x2"),d=b.getAttribute("y2"),b.setAttribute("x2",this.stored_x2),b.setAttribute("y2",
this.stored_y2),a.setAttributeElementList_undable([b],{x2:c,y2:d},!1));else"pointA"==this.editablePointName?(c=b.getAttribute("cx"),d=b.getAttribute("cy"),b.setAttribute("cx",this.stored_cx),b.setAttribute("cy",this.stored_cy),a.setAttributeElementList_undable([b],{cx:c,cy:d},!1)):"pointB"==this.editablePointName&&(c=b.getAttribute("r"),b.setAttribute("r",this.stored_r),a.setAttributeElementList_undable([b],{r:c},!1));a.onChange()};
function SetGradientStopColorLocation2D_tool(a){this.appRef=a.appRef;this.interactionElement=a.interactionElement}_=SetGradientStopColorLocation2D_tool.prototype;_.setEditableStopColor=function(a){this.editableStopColor=a};_.onGlobalMouseStartDrag=function(a){this.storedOffsetValue=this.editableStopColor.getAttribute("offset")};
_.onGlobalMouseDrag=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=this.interactionElement.globalPointA,c=this.interactionElement.globalPointB,d=this.appRef.activeEditablePage.mousePointInDocumentSpace(GMOUSE.mouseMovePt);var e=Math.min(c.x,b.x);var f=Math.max(c.x,b.x);var g=Math.min(c.y,b.y);var h=Math.max(c.y,b.y);d.x<e?d.x=e:d.x>f&&(d.x=f);d.y<g?d.y=g:d.y>h&&(d.y=h);this.editableStopColor.setAttribute("offset",String(Math.abs(c.x-b.x)>Math.abs(c.y-b.y)?(d.x-b.x)/(c.x-b.x):
(d.y-b.y)/(c.y-b.y)));a.sortStopColors();this.interactionElement.update()};_.onGlobalMouseEndDrag=function(a){a=this.appRef.activeEditablePage;a.createGradientStopColorOffsetUndoRedoActions(this.editableStopColor,this.storedOffsetValue,this.editableStopColor.getAttribute("offset"));this.appRef.fillStroke2DPanel.update();a.onChange()};
function SmartGuide2D_interaction(a){this.appRef=a.appRef;this.guideX=this.querySelector("#GUIDE_X");this.guideY=this.querySelector("#GUIDE_Y");this.smartGuide0=this.querySelector("#VIRTUAL_GUIDE_0");this.smartGuide1=this.querySelector("#VIRTUAL_GUIDE_1");this.smartGuide2=this.querySelector("#VIRTUAL_GUIDE_2");this.focusedElementTarget=this.lastAssignedGuide=this.lastTimeOut=null}_=SmartGuide2D_interaction.prototype;
_.hideGuides=function(){this.guideX.style.display=this.guideY.style.display=this.smartGuide0.style.display=this.smartGuide1.style.display=this.smartGuide2.style.display="none"};_.showGuideX=function(a){this.guideX.style.display="inline";this.guideX.updateGeometry(a,0,a,2500)};_.showGuideY=function(a){this.guideY.style.display="inline";this.guideY.updateGeometry(0,a,2500,a)};
_.showSmartGuide0=function(){var a=this.appRef.activeEditablePage.parentElement.offsetWidth,b=GeometryUtils.getLineLineIntersection(this.smartGuide0.getPt1(),this.smartGuide0.getPt2(),{x:0,y:0},{x:a,y:0});b&&(this.smartGuide0.setAttribute("x1",b.x),this.smartGuide0.setAttribute("y1",b.y));b=this.appRef.activeEditablePage.parentElement.offsetHeight;if(b=GeometryUtils.getLineLineIntersection(this.smartGuide0.getPt1(),this.smartGuide0.getPt2(),{x:0,y:b},{x:a,y:b}))this.smartGuide0.setAttribute("x2",
b.x),this.smartGuide0.setAttribute("y2",b.y);this.smartGuide0.style.display="inline"};
_.showSmartGuide1=function(){var a=this.appRef.activeEditablePage.parentElement.offsetWidth,b=GeometryUtils.getLineLineIntersection(this.smartGuide1.getPt1(),this.smartGuide1.getPt2(),{x:0,y:0},{x:a,y:0});b&&(this.smartGuide1.setAttribute("x1",b.x),this.smartGuide1.setAttribute("y1",b.y));b=this.appRef.activeEditablePage.parentElement.offsetHeight;if(b=GeometryUtils.getLineLineIntersection(this.smartGuide1.getPt1(),this.smartGuide1.getPt2(),{x:0,y:b},{x:a,y:b}))this.smartGuide1.setAttribute("x2",
b.x),this.smartGuide1.setAttribute("y2",b.y);this.smartGuide1.style.display="inline"};
_.showSmartGuide2=function(){var a=this.appRef.activeEditablePage.parentElement.offsetWidth,b=GeometryUtils.getLineLineIntersection(this.smartGuide2.getPt1(),this.smartGuide2.getPt2(),{x:0,y:0},{x:a,y:0});b&&(this.smartGuide2.setAttribute("x1",b.x),this.smartGuide2.setAttribute("y1",b.y));b=this.appRef.activeEditablePage.parentElement.offsetHeight;if(b=GeometryUtils.getLineLineIntersection(this.smartGuide2.getPt1(),this.smartGuide2.getPt2(),{x:0,y:b},{x:a,y:b}))this.smartGuide2.setAttribute("x2",
b.x),this.smartGuide2.setAttribute("y2",b.y);this.smartGuide2.style.display="inline"};_.defineSmartGuide=function(a,b,c){a.updateGeometry(b.x,b.y,c.x,c.y);a.originalPt1=b;a.originalPt2=c;a.enabled=!0;console.log("DEFINE SMART GUIDE",a)};
_.setAndEnableSmartGuide=function(a,b){this.lastAssignedGuide==this.smartGuide2?(this.defineSmartGuide(this.smartGuide1,a,b),this.lastAssignedGuide=this.smartGuide1,this.showSmartGuide1()):(this.defineSmartGuide(this.smartGuide2,a,b),this.lastAssignedGuide=this.smartGuide2,this.showSmartGuide2());var c=this.appRef.interaction2D.smartPoints.point0;if("inline"==c.style.display){var d=GeometryUtils.projectPointOnLine(a,b,{x:c.cx.baseVal.value,y:c.cy.baseVal.value});this.lastAssignedGuide.perpendicolarPoints=
{pt1:{x:c.cx.baseVal.value,y:c.cy.baseVal.value},pt2:d.point};this.defineSmartGuide(this.smartGuide0,this.lastAssignedGuide.perpendicolarPoints.pt1,this.lastAssignedGuide.perpendicolarPoints.pt2)}};
_.isSmartGuideAlreadyDefined=function(a,b){return this.smartGuide0.originalPt1&&a.x==this.smartGuide0.originalPt1.x&&a.y==this.smartGuide0.originalPt1.y&&b.x==this.smartGuide0.originalPt2.x&&b.y==this.smartGuide0.originalPt2.y||this.smartGuide1.originalPt1&&a.x==this.smartGuide1.originalPt1.x&&a.y==this.smartGuide1.originalPt1.y&&b.x==this.smartGuide1.originalPt2.x&&b.y==this.smartGuide1.originalPt2.y||this.smartGuide2.originalPt1&&a.x==this.smartGuide2.originalPt1.x&&a.y==this.smartGuide2.originalPt1.y&&
b.x==this.smartGuide2.originalPt2.x&&b.y==this.smartGuide2.originalPt2.y?!0:!1};_.resetGuideState=function(){this.smartGuide0.originalPt1=this.smartGuide0.originalPt2=this.smartGuide1.originalPt1=this.smartGuide1.originalPt2=this.smartGuide2.originalPt1=this.smartGuide2.originalPt2=null;this.smartGuide0.enabled=!1;this.smartGuide1.enabled=!1;this.smartGuide2.enabled=!1;this.smartGuide0.perpendicolarPoints=this.smartGuide1.perpendicolarPoints=this.smartGuide2.perpendicolarPoints=null};
_.isMouseNearTheStoredSnappedScreenPoint=function(){var a=this.appRef.activeEditablePage.snapDistance,b=this.storedPen.pointInScreenSpace;return GMOUSE.mouseMovePt.x>b.x-a&&GMOUSE.mouseMovePt.x<b.x+a&&GMOUSE.mouseMovePt.y>b.y-a&&GMOUSE.mouseMovePt.y<b.y+a?!0:!1};
_.onPenSnappedToSegment=function(a){if(a.elementAtPoint){if("line"==a.elementAtPoint.nodeName)var b=a.elementAtPoint.getGeometryPointList();else if("path"==a.elementAtPoint.nodeName&&a.segment)b=[a.segment.pt1,a.segment.pt2];else return;b=a.elementAtPoint.getCTM().transformPointList(b,!0);if(!this.isSmartGuideAlreadyDefined(b[0],b[1])){this.storedPen=a;var c=this,d=b[0],e=b[1];clearTimeout(this.lastTimeOut);this.lastTimeOut=setTimeout(function(){c.isMouseNearTheStoredSnappedScreenPoint()&&c.setAndEnableSmartGuide(d,
e)},100)}}};
_.findSnapTo_smartGuides=function(a,b){function c(c,e){if(f=GeometryUtils.getLineLineIntersection(c.getPt1(),c.getPt2(),e.getPt1(),e.getPt2()))if(g=Math.abs(a.pointInDocumentSpace.x-f.x),g<b&&(g=Math.abs(a.pointInDocumentSpace.y-f.y),g<b))return a.pointInDocumentSpace=f,a.pointInContentSpace=d.globalToLocal(a.pointInDocumentSpace.x,a.pointInDocumentSpace.y),a.intersectionPoint=f;return null}var d=this.appRef.activeEditablePage.content,e,f,g;this.smartGuide1.enabled&&(e=GeometryUtils.isPointOnLine(this.smartGuide1.getPt1(),this.smartGuide1.getPt2(),
a.pointInDocumentSpace,b))&&(a.pointInDocumentSpace=e,a.pointInContentSpace=this.appRef.activeEditablePage.content.globalToLocal(a.pointInDocumentSpace.x,a.pointInDocumentSpace.y),a.overGuide=!0,this.showSmartGuide1(),this.smartGuide1.perpendicolarPoints&&this.smartGuide0.originalPt2.x!=this.smartGuide1.perpendicolarPoints.pt2.x&&this.defineSmartGuide(this.smartGuide0,this.smartGuide1.perpendicolarPoints.pt1,this.smartGuide1.perpendicolarPoints.pt2));this.smartGuide2.enabled&&(e=GeometryUtils.isPointOnLine(this.smartGuide2.getPt1(),
this.smartGuide2.getPt2(),a.pointInDocumentSpace,b))&&(a.pointInDocumentSpace=e,a.pointInContentSpace=this.appRef.activeEditablePage.content.globalToLocal(a.pointInDocumentSpace.x,a.pointInDocumentSpace.y),a.overGuide=!0,this.showSmartGuide2(),this.smartGuide2.perpendicolarPoints&&this.smartGuide0.originalPt2.x!=this.smartGuide2.perpendicolarPoints.pt2.x&&this.defineSmartGuide(this.smartGuide0,this.smartGuide2.perpendicolarPoints.pt1,this.smartGuide2.perpendicolarPoints.pt2));this.smartGuide0.enabled&&
(e=GeometryUtils.isPointOnLine(this.smartGuide0.getPt1(),this.smartGuide0.getPt2(),a.pointInDocumentSpace,b))&&(a.pointInDocumentSpace=e,a.pointInContentSpace=this.appRef.activeEditablePage.content.globalToLocal(a.pointInDocumentSpace.x,a.pointInDocumentSpace.y),a.overGuide=!0,this.showSmartGuide0());e="inline"==this.smartGuide0.style.display;var h="inline"==this.smartGuide1.style.display,k="inline"==this.smartGuide2.style.display,l="inline"==this.guideX.style.display,n="inline"==this.guideY.style.display;
this.appRef.interaction2D.smartPoints.intersectionPoint.style.display="none";if(e&&h&&(f=c(this.smartGuide0,this.smartGuide1))){this.appRef.interaction2D.smartPoints.showIntersectionPoint(f.x,f.y);return}if(e&&k&&(f=c(this.smartGuide0,this.smartGuide2))){this.appRef.interaction2D.smartPoints.showIntersectionPoint(f.x,f.y);return}if(h&&k&&(f=c(this.smartGuide1,this.smartGuide2))){this.appRef.interaction2D.smartPoints.showIntersectionPoint(f.x,f.y);return}if(e&&n&&(f=c(this.smartGuide0,this.guideY))){this.appRef.interaction2D.smartPoints.showIntersectionPoint(f.x,
f.y);return}if(e&&l&&(f=c(this.smartGuide0,this.guideX))){this.appRef.interaction2D.smartPoints.showIntersectionPoint(f.x,f.y);return}if(h&&n&&(f=c(this.smartGuide1,this.guideY))){this.appRef.interaction2D.smartPoints.showIntersectionPoint(f.x,f.y);return}if(h&&l&&(f=c(this.smartGuide1,this.guideX))){this.appRef.interaction2D.smartPoints.showIntersectionPoint(f.x,f.y);return}if(k&&n&&(f=c(this.smartGuide2,this.guideY))){this.appRef.interaction2D.smartPoints.showIntersectionPoint(f.x,f.y);return}k&&
l&&(f=c(this.smartGuide2,this.guideX))&&this.appRef.interaction2D.smartPoints.showIntersectionPoint(f.x,f.y)};
function SmartPoints2D_interaction(a){this.appRef=a.appRef;this.point0=this.querySelector("#SMART_POINT_0");this.point1=this.querySelector("#SMART_POINT_1");this.point2=this.querySelector("#SMART_POINT_2");this.intersectionPoint=this.querySelector("#SMART_POINT_INTERSECTION");this.focusedPoint=this.querySelector("#SMART_FOCUSED_POINT");this.lastAssignedPoint=this.lastTimeOut=this.storedPen=null}_=SmartPoints2D_interaction.prototype;
_.hidePoints=function(){this.point0.style.display=this.point1.style.display=this.point2.style.display=this.intersectionPoint.style.display=this.focusedPoint.style.display="none";this.point0.updateGeometry(0,0);this.point1.updateGeometry(0,0);this.point2.updateGeometry(0,0);this.intersectionPoint.updateGeometry(0,0);this.focusedPoint.updateGeometry(0,0)};_.showPoint0=function(a,b){this.point0.style.display="inline";this.point0.updateGeometry(a,b)};
_.showPoint1=function(a,b){this.point1.style.display="inline";this.point1.updateGeometry(a,b)};_.showPoint2=function(a,b){this.point2.style.display="inline";this.point2.updateGeometry(a,b)};_.showIntersectionPoint=function(a,b){this.intersectionPoint.style.display="inline";this.intersectionPoint.updateGeometry(a,b)};_.showFocusedPoint=function(a,b){this.focusedPoint.style.display="inline";this.focusedPoint.updateGeometry(a,b)};
_.defineSmartPoint=function(){this.lastAssignedPoint==this.point2?(this.showPoint1(this.storedPen.pointInDocumentSpace.x,this.storedPen.pointInDocumentSpace.y),this.lastAssignedPoint=this.point1):(this.showPoint2(this.storedPen.pointInDocumentSpace.x,this.storedPen.pointInDocumentSpace.y),this.lastAssignedPoint=this.point2)};
_.isSmartPointAlreadyDefined=function(a){return a.x==this.point1.cx.baseVal.value&&a.y==this.point1.cy.baseVal.value||a.x==this.point2.cx.baseVal.value&&a.y==this.point2.cy.baseVal.value?!0:!1};_.isMouseNearTheStoredSnappedScreenPoint=function(){var a=this.appRef.activeEditablePage.snapDistance,b=this.storedPen.pointInScreenSpace;return GMOUSE.mouseMovePt.x>b.x-a&&GMOUSE.mouseMovePt.x<b.x+a&&GMOUSE.mouseMovePt.y>b.y-a&&GMOUSE.mouseMovePt.y<b.y+a?!0:!1};
_.onPenSnappedToPoint=function(a){if(!this.isSmartPointAlreadyDefined(a.pointInDocumentSpace)){this.storedPen=a;var b=this;clearTimeout(this.lastTimeOut);this.lastTimeOut=setTimeout(function(){b.isMouseNearTheStoredSnappedScreenPoint()&&b.defineSmartPoint()},100)}};
function Segment2D_interaction(a){this.appRef=a.appRef;this.interactiveLine=document.querySelector("#INTERACTIVE_LINE");this.interactivePathSegment_L=document.querySelector("#INTERACTIVE_PATH_SEGMENT_L");this.interactivePathSegment_Q=document.querySelector("#INTERACTIVE_PATH_SEGMENT_Q");this.interactivePathSegment_C=document.querySelector("#INTERACTIVE_PATH_SEGMENT_C");this.interactivePathSegment_A=document.querySelector("#INTERACTIVE_PATH_SEGMENT_A");this.currentSegmentRef=this.previousSegmentRef=
null}_=Segment2D_interaction.prototype;_.hideSegments=function(){this.interactivePathSegment_L.style.display=this.interactivePathSegment_Q.style.display=this.interactivePathSegment_C.style.display="none"};
_.showActiveInteractivePathSegment=function(){console.log("-------showActiveInteractivePathSegment",this.currentSegmentRef);if(this.currentSegmentRef){var a=this.currentSegmentRef.ownerShapeElement;if("line"==a.nodeName){this.showInteractivePathSegment_Line();var b=this.interactivePathSegment_L.getGeometryPointList();a=a.getGeometryPointList();a=a[1].getDistanceFromPoint(a[0]);this.appRef.interaction2D.lengthPropertyLabel.show(b[0],b[1],this.appRef.activeEditablePage.valueToUnit(a),this.appRef.line2DPanel.setLineLength)}else"L"==
this.currentSegmentRef.type?(this.showInteractivePathSegment_L(),b=this.interactivePathSegment_L.getGeometryPointList(),a=this.currentSegmentRef.getDistanceFromPoint(this.previousSegmentRef),this.appRef.interaction2D.lengthPropertyLabel.show(b[0],b[1],this.appRef.activeEditablePage.valueToUnit(a),this.appRef.path2DPanel.setLineToLength)):"C"==this.currentSegmentRef.type&&this.showInteractivePathSegment_C()}};
_.setInteractivePathSegment=function(a,b){this.previousSegmentRef=a;this.currentSegmentRef=b;this.showActiveInteractivePathSegment()};
_.showInteractivePathSegment_Line=function(){var a=this.currentSegmentRef.ownerShapeElement,b=this.previousSegmentRef,c=this.currentSegmentRef,d=this.interactivePathSegment_L.getGeometryPointList({normalize:!1});d[0].x=b.x;d[0].y=b.y;d[1].x=c.x;d[1].y=c.y;this.interactivePathSegment_L.transformGeometryPointList(a.getTransformToElement(this.appRef.activeEditablePage));this.interactivePathSegment_L.render();this.interactivePathSegment_L.style.display="inline"};
_.showInteractivePathSegment_L=function(){var a=this.currentSegmentRef.ownerShapeElement,b=this.previousSegmentRef,c=this.currentSegmentRef,d=this.interactivePathSegment_L.getGeometryPointList({normalize:!1});d[0].x=b.x;d[0].y=b.y;d[1].x=c.x;d[1].y=c.y;this.interactivePathSegment_L.transformGeometryPointList(a.getTransformToElement(this.appRef.activeEditablePage));this.interactivePathSegment_L.render();this.interactivePathSegment_L.style.display="inline"};
_.showInteractivePathSegment_C=function(){var a=this.currentSegmentRef.ownerShapeElement,b=this.previousSegmentRef,c=this.currentSegmentRef,d=this.interactivePathSegment_C.getGeometryPointList({normalize:!1});d[0].x=b.x;d[0].y=b.y;d[1].x=c.x;d[1].y=c.y;d[1].controlPt1.x=c.controlPt1.x;d[1].controlPt1.y=c.controlPt1.y;d[1].controlPt2.x=c.controlPt2.x;d[1].controlPt2.y=c.controlPt2.y;this.interactivePathSegment_C.transformGeometryPointList(a.getTransformToElement(this.appRef.activeEditablePage));this.interactivePathSegment_C.render();
this.interactivePathSegment_C.style.display="inline"};_.showInteractivePathSegment_Q=function(){this.interactivePathSegment_Q.style.display="inline"};function Workspace2D(a){this.appRef=a.appRef;this.init()}_=Workspace2D.prototype;
_.init=function(){this.horizontalRulerCanvas=document.querySelector("#HORIZONTAL_RULER canvas");this.verticalRulerCanvas=document.querySelector("#VERTICAL_RULER canvas");this.gridPattern=document.querySelector("#grid-pattern");this.gridPattern.image=this.gridPattern.querySelector("image");this.gridPattern.canvas=document.createElement("canvas");this.page=this.querySelector(".page");this.origin=document.querySelector("#INTERACTION_2D #ORIGIN_XY");ConnectEvent("mousedown",this.horizontalRulerCanvas,
this.appRef.tools.createGuide2D_tool.onMouseDown,this.appRef.tools.createGuide2D_tool);ConnectEvent("mousedown",this.verticalRulerCanvas,this.appRef.tools.createGuide2D_tool.onMouseDown,this.appRef.tools.createGuide2D_tool);ConnectEvent("mousedown",document.querySelector("#ORIGIN_RULERS"),this.appRef.tools.setOrigin2D_tool.onMouseDown,this.appRef.tools.setOrigin2D_tool)};_.onResize=function(a){console.log("Workspace2D onResize");this.updateRulersSize();this.updateRulersAndGrid()};
_.updateActivePageBackground=function(){var a=this.appRef.activeEditablePage;this.page.setAttribute("width",a.dataset.width);this.page.setAttribute("height",a.dataset.height)};_.updateRulersSize=function(){this.horizontalRulerCanvas.width=this.horizontalRulerCanvas.parentNode.offsetWidth;this.horizontalRulerCanvas.height=this.horizontalRulerCanvas.parentNode.offsetHeight;this.verticalRulerCanvas.width=this.verticalRulerCanvas.parentNode.offsetWidth;this.verticalRulerCanvas.height=this.verticalRulerCanvas.parentNode.offsetHeight};
_.updateGridVisibility=function(){var a=this.querySelector("rect.grid");this.appRef.activeEditablePage.showGrid?(a.classList.remove("hidden"),this.appRef.activeEditablePage.classList.contains("showed")&&this.updateRulersAndGrid()):a.classList.add("hidden")};
_.updateRulersVisibility=function(){this.appRef.activeEditablePage.showRulers?(this.horizontalRulerCanvas.classList.remove("hidden"),this.verticalRulerCanvas.classList.remove("hidden"),this.appRef.activeEditablePage.classList.contains("showed")&&this.updateRulersAndGrid()):(this.horizontalRulerCanvas.classList.add("hidden"),this.verticalRulerCanvas.classList.add("hidden"))};
_.updateRulersAndGrid=function(){var a=this.appRef.activeEditablePage;if(a.showRulers){var b=a.content,c=b.getTransform().matrix,d=b.currentScale||1;b=c.e+a.origin.x*d;c=c.f+a.origin.y*d;d*=1/a.drawingScale;var e=this.drawRuler(this.horizontalRulerCanvas,b,1/a.unitValue,d,!1);d=this.drawRuler(this.verticalRulerCanvas,c,1/a.unitValue,d,!0)}a.showGrid&&(this.drawGrid(e.markersDistance,d.markersDistance,b,c,e.divisors),"safari"==BROWSER_TYPE&&this.querySelector(".grid").getTransform().matrix.identity())};
_.drawRuler=function(a,b,c,d,e){d=d||1;var f=c*d,g=1,h=10;if(40>f){g=(Math.floor(40/f/h)+1)*h;f=c*d*g;var k=Math.floor(f/40);1<k&&(h=5<k?2:5,g=(Math.round(40/f/h)+1)*h,f=c*d*g)}c=a.getContext("2d");c.setTransform(1,0,0,1,0,0);c.clearRect(0,0,a.width,a.height);c.lineWidth=1;c.strokeStyle="#afafaf";c.fillStyle="#000";c.font="8px arial";d=b-Math.ceil(b/f)*f;var l;k=f/h;c.beginPath();if(e)for(a=a.height,c.translate(16,0),c.rotate(.5*Math.PI);d<a;){e=~~d+.5;c.moveTo(e,0);c.lineTo(e,13);c.fillText(Math.round((d-
b)/f*g),e+4,12);for(l=1;l<h;l++)e=~~d+k*l+.5,c.moveTo(e,0),l%2?c.lineTo(e,4):c.lineTo(e,6);d+=f}else for(a=a.width;d<a;){e=~~d+.5;c.moveTo(e,16);c.lineTo(e,3);c.fillText(Math.round((d-b)/f*g),e+4,9);for(l=1;l<h;l++)e=~~d+k*l+.5,c.moveTo(e,16),l%2?c.lineTo(e,12):c.lineTo(e,10);d+=f}c.stroke();return{markersDistance:f,divisors:h}};
_.drawGrid=function(a,b,c,d,e){var f=this.gridPattern.canvas;f.width=a;f.height=b;var g=f.getContext("2d");g.lineWidth=.5;g.strokeStyle="#d4d4d4";g.beginPath();g.rect(.5,.5,Math.floor(a)-.5,Math.floor(b)-.5);g.stroke();for(var h=a/e,k=b/e,l,n=1;n<e;n++)l=~~(h*n)+.5,g.moveTo(l,1),g.lineTo(l,b-1),l=~~(k*n)+.5,g.moveTo(1,l),g.lineTo(a-1,l);g.stroke();this.gridPattern.setAttribute("width",a);this.gridPattern.setAttribute("height",b);this.gridPattern.image.setAttribute("width",a);this.gridPattern.image.setAttribute("height",
b);this.gridPattern.image.setAttributeNS(SVGElement.XLINK_NS,"href",f.toDataURL("image/png"));a=this.gridPattern.getTransform().matrix;a.e=c;a.f=d};
_.viewActivePageAtScale=function(a){var b=this.appRef.activeEditablePage,c=parseFloat(this.parentElement.offsetWidth),d=parseFloat(this.parentElement.offsetHeight),e=this.page,f=e.getAttribute("width"),g=e.getAttribute("height"),h=b.content.getTransform().matrix.identity();h=h.translate(c/2-f/2,d/2-g/2);h=h.scale(a);b.content.getTransform().setMatrix(h);e.getTransform().setMatrix(h);b.content.currentScale=a;this.updateRulersAndGrid();this.updateOrigin()};
_.fitActivePageToView=function(a,b){var c=this.appRef.activeEditablePage;a=a||20;b=b||20;var d=parseFloat(this.parentElement.offsetWidth),e=parseFloat(this.parentElement.offsetHeight),f=c.content.getTransform().matrix.identity(),g=this.page,h=g.getAttribute("width"),k=g.getAttribute("height"),l=Math.min((d-a)/h,(e-b)/k);f=f.translate(d/2-h*l/2,e/2-k*l/2);f=f.scale(l);c.content.getTransform().setMatrix(f);g.getTransform().setMatrix(f);c.content.currentScale=l;this.updateRulersAndGrid();this.updateOrigin()};
_.fitElementToView=function(a,b,c){b=b||20;c=c||20;var d=parseFloat(this.parentElement.offsetWidth),e=parseFloat(this.parentElement.offsetHeight);a=a.getGlobalBBox();this.zoom(Math.min((d-b)/a.width,(e-c)/a.height));this.appRef.activeEditablePage.updateInteraction()};
_.fitRectToView=function(a,b,c){console.log("fitRectToView",a);var d=this.appRef.activeEditablePage;b=b||20;c=c||20;var e=parseFloat(this.parentElement.offsetWidth),f=parseFloat(this.parentElement.offsetHeight),g=d.content.getTransform().matrix.identity(),h=this.page,k=a.width,l=a.height;b=Math.min((e-b)/k,(f-c)/l);g=g.translate(e/2-(a.x+k/2)*b,f/2-(a.y+l/2)*b);g=g.scale(b);d.content.getTransform().setMatrix(g);h.getTransform().setMatrix(g);d.content.currentScale=b;this.updateRulersAndGrid();this.updateOrigin()};
_.pan=function(a,b){var c=this.appRef.activeEditablePage.content.getTransform().matrix;c.e+=a;c.f+=b;this.page.getTransform().setMatrix(c);this.updateRulersAndGrid();this.updateOrigin()};
_.zoom=function(a,b,c){var d=this.appRef.activeEditablePage,e=d.content.getTransform().matrix,f=d.content.currentScale*a;250<f||.01>f||(d.content.currentScale=f,b||(0<d.selectionList.length?(d=d.getElementListGlobalBBox(d.selectionList),b=d.center.x,c=d.center.y):(b=this.parentElement.getSize(),b.x/=2,b.y/=2,d=d.mousePointInDocumentSpace(b),b=d.x,c=d.y)),e.a*=a,e.b*=a,e.c*=a,e.d*=a,e.e*=a,e.f*=a,e.e+=(1-a)*b,e.f+=(1-a)*c,this.page.getTransform().setMatrix(e),this.updateRulersAndGrid(),this.updateOrigin())};
_.setPageViewByMatrix=function(a){var b=this.appRef.activeEditablePage;b.content.getTransform().setMatrix(a);b.content.currentScale=a.getScale().x;this.page.getTransform().setMatrix(a);this.updateRulersAndGrid();this.updateOrigin()};_.updateOrigin=function(){var a=this.appRef.activeEditablePage,b=a.content,c=b.getTransform().matrix,d=b.currentScale||1;b=c.e+a.origin.x*d;a=c.f+a.origin.y*d;c=this.origin.getTransform().matrix;c.e=b;c.f=a};
function Document2D(a){this.appRef=a.appRef;this.idFile=null;ConnectEvent("beforeprint",window,this.onBeforePrintDocument,this);ConnectEvent("afterprint",window,this.onAfterPrintDocument,this)}_=Document2D.prototype;_.onResize=function(a){};_.addNewPage=function(a,b){var c=document.querySelector("#TEMPLATES .page-2D").cloneNode(!0);c.querySelector(".layers").setAttribute("id",CreateUniqueIDI());this.appendChild(c);c.connectController(SVGPage,{appRef:this.appRef});c.setSize(a,b);return c};
_.getActivePage=function(){return this.querySelector(".page-2D.showed")};
_.setActivePage=function(a){this.appRef.activeEditablePage=a;console.log("this.appRef.activeEditablePage",this.appRef.activeEditablePage);ShowElement(this.appRef.activeEditablePage);this.appRef.activeEditablePage.deselectAllElements();this.appRef.workspace.updateGridVisibility();this.appRef.workspace.updateRulersSize();this.appRef.workspace.updateRulersAndGrid();this.appRef.workspace.updateActivePageBackground();this.appRef.activeEditablePage.updateInteraction();this.appRef.workspace.fitActivePageToView();
this.appRef.page2DPanel.update()};_.isChanged=function(){var a=this.querySelectorAll(".page-2D"),b,c=a.length;for(b=0;b<c;b++){var d=a[b];if(d.isChanged)return!0}return!1};_.setAsUnchanged=function(){var a=this.querySelectorAll(".page-2D"),b,c=a.length;for(b=0;b<c;b++)a[b].isChanged=!1};_.printDocument=function(){window.print()};_.onBeforePrintDocument=function(){var a=this.querySelectorAll(".page-2D"),b,c=a.length;for(b=0;b<c;b++){var d=a[b];d.setAttribute("viewBox","0 0 "+d.dataset.width+" "+d.dataset.height)}};
_.onAfterPrintDocument=function(){var a=this.querySelectorAll(".page-2D"),b,c=a.length;for(b=0;b<c;b++){var d=a[b];d.removeAttribute("viewBox")}};
function SVGPage(a){this.appRef=a.appRef;this.type="DOCUMENT_2D";this.focusedElement=this;this.hitRect=this.createSVGRect();this.hitRect.width=4;this.hitRect.height=4;DEVICE_WITH_TOUCH_EVENTS?(ConnectEvent("touchstart",this,this.onTouchStart,this),ConnectEvent("touchmove",this,this.onTouchMove,this),ConnectEvent("touchend",this,this.onTouchEnd,this),ConnectEvent("gesturestart",this,this.onGestureStart,this),ConnectEvent("gesturechange",this,this.onGestureChange,this),ConnectEvent("gestureend",this,
this.onGestureEnd,this)):(ConnectEvent("mousedown",this,this.onMouseDown,this),ConnectEvent("mousemove",this,this.onMouseMove,this),ConnectEvent("mouseup",this,this.onMouseUp,this),ConnectEvent("dragover",this,this.onDragOver,this),ConnectEvent("drop",this,this.onDropOver,this));this.content=this.querySelector(".content");this.guides=this.querySelector(".guides");this.history=new UndoRedoHistory;this.isChanged=!1;this.units={PIXEL:1,KILOMETER:2.645833333E-4,METER:2.645833333E-4,CENTIMETER:.02645833333,
MILLIMETER:.2645833333,FOOT:8.680446194226E-4,INCH:.0104166667,YARD:2.893482064742E-4,MILE:1.644023900422E-7,NAUTICAL_MILE:1.428617710583E-7};this.unitKeyShortNames={PIXEL:"px",KILOMETER:"km",METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in",YARD:"yd",MILE:"mi",NAUTICAL_MILE:"nm"};this.unitKey="PIXEL";this.unitValue=this.units[this.unitKey];this.drawingScale=1;this.fixedDecimals=2;this.showGrid=!1;this.origin={x:0,y:0};this.snapDistance=this.gridStep=10;this.snapAngle=45;this.translationStep=
1;this.rotationStep=90;this.elementsMargin=this.pageMargin=0;this.snapToPageBorders=this.snapToGrid=!1;this.snapToBBoxProjections=this.snapToSmartGuides=this.snapToSegments=this.snapToPoint=this.showRulers=!0;this.selectGroupChildren=!1;this.selectionList=[];this.selectionPointList=[];this.drawingProperties={};this.drawingProperties.fill="none";this.drawingProperties["fill-opacity"]=1;this.drawingProperties.stroke="#000000";this.drawingProperties["stroke-opacity"]=1;this.drawingProperties["stroke-width"]=
1;this.drawingProperties["stroke-miterlimit"]=4;this.drawingProperties["stroke-linecap"]="butt";this.drawingProperties["stroke-linejoin"]="miter";this.drawingProperties["stroke-dasharray"]="";this.drawingProperties["stroke-dashoffset"]="0";this.drawingProperties.mixBlendMode="normal";this.drawingProperties["paint-order"]="normal";this.drawingProperties["vector-effect"]="";this.drawingProperties.opacity=1;this.drawingProperties["font-family"]="";this.drawingProperties["font-size"]=12;this.drawingProperties["text-align"]=
"left";this.drawingProperties["font-weight"]="";this.drawingProperties["font-style"]="regular";this.drawingProperties["letter-spacing"]=0;this.drawingProperties["word-spacing"]=0;this.drawingProperties["line-height"]="normal";this.drawingProperties["text-decoration"]="none";this.drawingProperties["marker-start"]="";this.drawingProperties["marker-end"]="";this.drawingProperties["marker-mid"]="";this.drawingProperties.scaleStrokeAndEffects=!0;this.drawingProperties.scaleText=!0;this.applyLastTransformAction=
null}_=SVGPage.prototype;_.onMouseWheel=function(a){this.appRef.tools.activeTool.onMouseWheel(a)};
_.onMouseDown=function(a){this.appRef.updateKeysState(a);if(3==a.which)console.log("context menu target",a.target),this.appRef.contextPanels.showContextPanel("EDIT_2D_CONTEXT_MENU");else if(this.isHTMLTextEditing||this.isTextEditing){var b=this.getElementAtPoint(GMOUSE.mouseDownPt.x,GMOUSE.mouseDownPt.y);if(b&&(b=this.getMainElement(b),this.selectionList[0]==b)){this.selectionList[0].onMouseDown(a);return}this.isHTMLTextEditing&&this.exitFrom_HTMLTextEditing();this.isTextEditing&&this.exitFrom_TextEditing()}else this.appRef.tools.activeTool.onMouseDown(a)};
_.onMouseMove=function(a){if(!this.appRef.activeEditablePage.isHTMLTextEditing&&!this.appRef.activeEditablePage.isTextEditing)this.appRef.tools.activeTool.onMouseMove(a)};_.onMouseUp=function(a){if(!this.appRef.activeEditablePage.isHTMLTextEditing)if(this.appRef.activeEditablePage.isTextEditing){console.log("SVGPage onMouseUp isTextEditing ",this.appRef.activeEditablePage.isTextEditing);var b=this.appRef.activeEditablePage.selectionList[0];setTimeout(function(){b.onMouseUp()},0)}else this.appRef.tools.activeTool.onMouseUp(a)};
_.onTouchStart=function(a){this.appRef.tools.activeTool.onTouchStart(a)};_.onTouchMove=function(a){this.appRef.tools.activeTool.onTouchMove(a)};_.onTouchEnd=function(a){this.appRef.tools.activeTool.onTouchEnd(a)};_.onTouchCancel=function(a){this.appRef.tools.activeTool.onTouchCancel(a)};_.onGestureStart=function(a){this.appRef.tools.activeTool.onGestureStart(a)};_.onGestureEnd=function(a){this.appRef.tools.activeTool.onGestureEnd(a)};_.onGestureChange=function(a){this.appRef.tools.activeTool.onGestureChange(a)};
_.onDragOver=function(a){GMOUSE.mouseMovePt=a.getMousePoint();var b=this.screenPointToPen(GMOUSE.mouseMovePt);this.setPen(b);a.preventPropagation()};
_.onDropOver=function(a){console.log("onDropOver");console.log("getTransferData",GetTransferData());GMOUSE.onMouseUp(a);var b=GetTransferData();if(b)this.onDropTransferData(b),SetTransferData(null);else if(console.log("_e.dataTransfer",a),b=a.dataTransfer.getData("url"))this.getActiveLayer().appendChild(SVGUtils.createSVGImage(b,0,0));else if("text/html,text/uri-list,url"!=a.dataTransfer.types&&"text,text/plain"!=a.dataTransfer.types&&0<a.dataTransfer.files.length)this.onDropFiles(a);a.preventPropagation()};
_.onDropTransferData=function(a){if("svg"==a.type)if(a.url)this.onDropRemoteFile(a.url);else this.unserializeAndPlaceSvgInCurrentLayer_undable(a.data,this.getPen().pointInDocumentSpace);else if("image"==a.type)this.placeRemoteImageToCurrentLayerAsDataURL_undable(a.url);else if("inner-symbol"==a.type){a=a.useElement.cloneNode(!0);this.getActiveLayer().appendChild(a);var b=this.getPen().pointInDocumentSpace;this.centerElementListAtGlobalPoint([a],b.x,b.y);this.createAddElementsToDocumentUndoRedoActions([a])}};
_.onDropRemoteFile=function(a){var b=this,c=this.appRef.progressPanel;c.setProgressBarValue(1);c.open(!0);SendAndLoad(a,null,null,function(a){console.log("onDropRemoteFile",a.target);b.unserializeAndPlaceSvgInCurrentLayer_undable(a.target.responseXML.querySelector("svg"),b.getPen().pointInDocumentSpace)},function(a){b.appRef.alertModalDialog.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occured during loading file")+": "+_fileData.name)},function(a){console.log("loading total: "+
a.total+"   loaded: "+a.loaded);c.setProgressValues(a.total,a.loaded)})};
_.onDropFiles=function(a){a=a.dataTransfer.files;var b=this;if(0<a.length)for(var c=0,d;d=a[c];c++){var e=d.name.split(".");e=e[e.length-1].toLowerCase();if("svg"==e||"htm"==e||"html"==e)this.importFile_SVG(d);else if("jpg"==e||"jpeg"==e||"png"==e||"gif"==e)this.importFile_IMG(d,function(a){var c=b.getPen().pointInDocumentSpace;b.centerElementListAtGlobalPoint([a],c.x,c.y)});else if("dxf"==e)this.onDropFile_DXF(d);else this.appRef.alertModalDialog.open("Unsupported file type","You can drop only svg,jpg,png file types.")}};
_.onPaste=function(a){console.log("onPaste");this.isTextEditing?this.editableSVGTextElement.pasteText(a.clipboardData.getData("Text")):this.pasteElements(a);a.preventPropagation()};_.onCopy=function(a){console.log("onCopy");this.isTextEditing?this.editableSVGTextElement.copySelectedText(a):this.copySelectedElements(a);a.preventPropagation()};_.onCut=function(a){console.log("onCut");this.isTextEditing?this.editableSVGTextElement.cutSelectedText(a):this.cutSelectedElements(a);a.preventPropagation()};
_.onKeyDown=function(a){var b=a.keyCode,c=a.metaKey||a.ctrlKey;console.log("document keyDown keyCode",b);if(c)switch(b){case KeyboardEvent.CODES.keyCode_Z:return a.shiftKey?(this.redo(),this.appRef.tools.activeTool.onRedo()):(this.undo(),this.appRef.tools.activeTool.onUndo()),a.preventPropagation();case KeyboardEvent.CODES.keyCode_A:return a.shiftKey?(this.deselectAllElements(),this.updateInteraction()):this.selectAll(),a.preventPropagation();case KeyboardEvent.CODES.keyCode_D:return this.duplicateElementList_undable(this.selectionList),
a.preventPropagation();case KeyboardEvent.CODES.keyCode_L:return a.shiftKey?this.unlockAllElements():this.lockElementList(this.selectionList),a.preventPropagation();case KeyboardEvent.CODES.keyCode_F:return a.shiftKey?this.setElementListOrderZ_undable(this.selectionList,"bringUp"):this.setElementListOrderZ_undable(this.selectionList,"bringToFront"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_B:return a.shiftKey?this.setElementListOrderZ_undable(this.selectionList,"sendDown"):this.setElementListOrderZ_undable(this.selectionList,
"sendToBack"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_G:return a.shiftKey?this.ungroupElementList_undable(this.selectionList):this.groupElementList_undable(this.selectionList),a.preventPropagation();case KeyboardEvent.CODES.keyCode_R:return b=SVGUtils.getBBoxPointByLocationName("center-center",this.getElementListGlobalBBox(this.selectionList)),a.shiftKey?this.rotateElementList_undable(this.selectionList,-this.rotationStep,b):this.rotateElementList_undable(this.selectionList,this.rotationStep,
b),a.preventPropagation()}else{switch(b){case KeyboardEvent.CODES.keyCode_arrowLeft:b=this.translationStep*this.content.currentScale;"POINT_SELECTION"==this.appRef.tools.activeTool.selectionMode&&0<this.selectionPointList.length?this.translateSelectedPointList_undable(-b,0,null,!0):this.translateElementList_undable(this.selectionList,-b,0);break;case KeyboardEvent.CODES.keyCode_arrowUp:b=this.translationStep*this.content.currentScale;"POINT_SELECTION"==this.appRef.tools.activeTool.selectionMode&&
0<this.selectionPointList.length?this.translateSelectedPointList_undable(0,-b,null,!0):this.translateElementList_undable(this.selectionList,0,-b);break;case KeyboardEvent.CODES.keyCode_arrowRight:b=this.translationStep*this.content.currentScale;"POINT_SELECTION"==this.appRef.tools.activeTool.selectionMode&&0<this.selectionPointList.length?this.translateSelectedPointList_undable(b,0,null,!0):this.translateElementList_undable(this.selectionList,b,0);break;case KeyboardEvent.CODES.keyCode_arrowDown:b=
this.translationStep*this.content.currentScale;"POINT_SELECTION"==this.appRef.tools.activeTool.selectionMode&&0<this.selectionPointList.length?this.translateSelectedPointList_undable(0,b,null,!0):this.translateElementList_undable(this.selectionList,0,b);break;case KeyboardEvent.CODES.keyCode_backspace:case KeyboardEvent.CODES.keyCode_delete:"POINT_SELECTION"==this.appRef.tools.activeTool.selectionMode?0<this.selectionPointList.length?0<this.getFilteredElementListByNodeName(this.selectionList,"path").length&&
this.removePathSegments_undable(this.selectionPointList):this.removeElementList_undable(this.selectionList):this.removeElementList_undable(this.selectionList)}this.appRef.tools.activeTool.onKeyDown(a)}};_.onKeyUp=function(a){this.appRef.tools.activeTool.onKeyUp(a)};_.onChange=function(){0==this.isChanged&&(this.isChanged=!0)};_.undo=function(){this.history.undo()};_.redo=function(){this.history.redo()};_.setUnits=function(a){this.unitKey=a;this.unitValue=this.units[this.unitKey]};
_.valueToUnit=function(a){return parseFloat((a*this.unitValue*this.drawingScale).toFixed(this.fixedDecimals))+" "+this.unitKeyShortNames[this.unitKey]};_.unitToValue=function(a){return a/this.unitValue/this.drawingScale};_.valueToUnitNoScale=function(a){return(a*this.unitValue).toFixed(this.fixedDecimals)};_.unitToValueNoScale=function(a){return a/this.unitValue};_.valueToFixed=function(a){return parseFloat(Number(a).toFixed(this.fixedDecimals))};_=SVGPage.prototype;
_.disableSelectionPointerEvents=function(){this.classList.add("disabled-selection-pointer-events")};_.enableSelectionPointerEvents=function(){this.classList.remove("disabled-selection-pointer-events")};_.setDrawingProperty=function(a,b){this.drawingProperties[a]=b};_.getDrawingProperty=function(a){return this.drawingProperties[a]};
_.createLayer=function(a,b){a=a||LOCALIZER.translate("Layer");b=b||"#fb0094";var c=this.createGroup();c.setAttribute("name",a);c.dataset.color=b;c.classList.add("layer");return c};_.setSize=function(a,b){a&&(this.dataset.width=a);b&&(this.dataset.height=b)};_.getSize=function(){return{width:this.dataset.width,height:this.dataset.height}};_.getLayersContainer=function(){return this.content.querySelector(".layers")};_.addLayer=function(a){this.getLayersContainer().appendChild(a);SelectElement(a);return a};
_.removeLayer=function(a){var b=a.previousElementSibling||a.nextElementSibling;a.parentElement.removeChild(a);this.setActivePageLayer(b)};_.setActivePageLayer=function(a){a&&SelectElement(a)};_.getActiveLayer=function(){return this.content.querySelector(".layers>.layer.selected")};_.getElementListAtPoint=function(a,b){this.hitRect.x=a-2-DOCUMENT_OFFSET.x;this.hitRect.y=b-2-DOCUMENT_OFFSET.y;return this.getIntersectionList(this.hitRect,null)};
_.getElementAtPoint=function(a,b){this.hitRect.x=a-2-DOCUMENT_OFFSET.x;this.hitRect.y=b-2-DOCUMENT_OFFSET.y;for(var c=this.getIntersectionList(this.hitRect,null),d=c.length,e=0;e<d;e++)c[e].classList.add("precise-hit-test");var f=document.elementFromPoint(a,b);for(e=0;e<d;e++)c[e].classList.remove("precise-hit-test");return f&&"svg"!=f.nodeName?f:null};
_.selectAll=function(){var a=this.getActiveLayer().classList.contains("isolate-layer")?this.content.querySelectorAll(".layers>.layer.selected>*:not(.locked)"):this.content.querySelectorAll(".layers>.layer:not(.locked):not(.hidden)>*:not(.locked):not(.hidden)");a=this.getFilteredElementListByNodeName(a,"line,rect,ellipse,path,g,text,use,image,foreignObject");this.selectElementList(a);this.updateInteraction()};
_.deselectAllElements=function(){for(var a=0;a<this.selectionList.length;a++)this.selectionList[a].removeAttribute("selected"),delete this.selectionList[a].selectionInfo;this.selectionList=[];this.currentEditableElement=null;this.appRef.interaction2D.segment2D.setInteractivePathSegment(null,null);this.setCurrentEditablePoint(null);this.deselectAllPoints()};
_.deselectElement=function(a){a.removeAttribute("selected");delete a.selectionInfo;this.selectionList.remove(a);0<this.selectionList.length?this.setCurrentEditableElement(this.selectionList[this.selectionList.length-1]):this.currentEditableElement=null};_.selectElementList=function(a){this.deselectAllElements();for(var b=0;b<a.length;b++)this.selectElement(a[b]);0<a.length&&this.setCurrentEditableElement(this.selectionList[this.selectionList.length-1])};
_.selectElement=function(a){a&&a instanceof SVGGraphicsElement&&!a.isSelected()&&(this.selectionList.push(a),a.setAttribute("selected",""))};_.setCurrentEditableElement=function(a){if(this.currentEditableElement=a)this.setActivePageLayer(a.getLayerOwner()),this.updateDrawingProperties(a)};
_.setCurrentEditablePoint=function(a){this.currentEditablePoint&&delete this.currentEditablePoint.isFocused;if(this.currentEditablePoint=a)this.currentEditablePoint.isFocused=!0;this.appRef.path2DPanel.update();console.log("setCurrentEditablePoint",a)};_.deselectElementPoints=function(a){for(var b=a.getGeometryPointList(),c=b.length,d=0;d<c;d++)a=b[d],a.isSelected&&this.deselectPoint(a)};
_.deselectAllPoints=function(){var a;var b=this.selectionPointList.length;for(a=0;a<b;a++)this.selectionPointList[a].isSelected=!1,delete this.selectionPointList[a].editable;this.selectionPointList=[]};_.deselectPoint=function(a){a.isSelected=!1;delete a.editable;this.selectionPointList.remove(a)};_.selectPointList=function(a){this.deselectAllPoints();for(var b=0;b<a.length;b++)this.selectPoint(a[b])};_.selectPoint=function(a){1!=a.isSelected&&(this.selectionPointList.push(a),a.isSelected=!0)};
_.updateDrawingProperties=function(a){a&&(this.setDrawingProperty("fill",a.getFill()),a.hasAttribute("fill-opacity")?this.setDrawingProperty("fill-opacity",a.getAttribute("fill-opacity")):this.setDrawingProperty("fill-opacity",1),this.setDrawingProperty("stroke",a.getStroke()),a.hasAttribute("stroke-opacity")?this.setDrawingProperty("stroke-opacity",a.getAttribute("stroke-opacity")):this.setDrawingProperty("stroke-opacity",1),a.hasAttribute("stroke-width")&&this.setDrawingProperty("stroke-width",
a.getAttribute("stroke-width")),a.hasAttribute("stroke-linecap")&&this.setDrawingProperty("stroke-linecap",a.getAttribute("stroke-linecap")),a.hasAttribute("stroke-linejoin")&&this.setDrawingProperty("stroke-linejoin",a.getAttribute("stroke-linejoin")),a.hasAttribute("stroke-miterlimit")&&this.setDrawingProperty("stroke-miterlimit",a.getAttribute("stroke-miterlimit")),a.hasAttribute("stroke-dasharray")?this.setDrawingProperty("stroke-dasharray",a.getAttribute("stroke-dasharray")):this.setDrawingProperty("stroke-dasharray",
""),a.hasAttribute("opacity")&&this.setDrawingProperty("opacity",a.getAttribute("opacity")),a.style.mixBlendMode?this.setDrawingProperty("mixBlendMode",a.style.mixBlendMode):this.setDrawingProperty("mixBlendMode","normal"),a.hasAttribute("paint-order")?this.setDrawingProperty("paint-order",a.getAttribute("paint-order")):this.setDrawingProperty("paint-order","normal"),a.hasAttribute("vector-effect")?this.setDrawingProperty("vector-effect",a.getAttribute("vector-effect")):this.setDrawingProperty("vector-effect",
""),a.hasAttribute("font-family")&&this.setDrawingProperty("font-family",a.getAttribute("font-family")),a.hasAttribute("text-decoration")&&this.setDrawingProperty("text-decoration",a.getAttribute("text-decoration")),a.hasAttribute("font-size")&&this.setDrawingProperty("font-size",a.getAttribute("font-size")),a.hasAttribute("text-align")&&this.setDrawingProperty("text-align",a.getAttribute("text-align")),a.hasAttribute("font-weight")&&this.setDrawingProperty("font-weight",a.getAttribute("font-weight")),
a.hasAttribute("font-style")&&this.setDrawingProperty("font-style",a.getAttribute("font-style")),a.hasAttribute("letter-spacing")&&this.setDrawingProperty("letter-spacing",a.getAttribute("letter-spacing")),a.hasAttribute("word-spacing")&&this.setDrawingProperty("word-spacing",a.getAttribute("word-spacing")),a.hasAttribute("line-height")&&this.setDrawingProperty("line-height",a.getAttribute("line-height")),a.hasAttribute("marker-start")?this.setDrawingProperty("marker-start",a.getAttribute("marker-start")):
this.setDrawingProperty("marker-start",""),a.hasAttribute("marker-mid")?this.setDrawingProperty("marker-mid",a.getAttribute("marker-mid")):this.setDrawingProperty("marker-mid",""),a.hasAttribute("marker-end")?this.setDrawingProperty("marker-end",a.getAttribute("marker-end")):this.setDrawingProperty("marker-end",""))};_.updateDrawingPropertiesByObjectKeyValue=function(a){for(var b in a)this.setDrawingProperty(b,a[b])};
_.removeAllInteractions=function(){this.appRef.interaction2D.elementPreviews.removeChildren();this.appRef.interaction2D.points2D.removeAllInteractionPoints();HideElements(this.appRef.interaction2D.children);this.appRef.interaction2D.smartGuides.resetGuideState();this.appRef.interaction2D.smartGuides.hideGuides();this.appRef.interaction2D.smartPoints.hidePoints();this.appRef.interaction2D.lengthPropertyLabel.hide();this.appRef.interaction2D.segment2D.hideSegments()};
_.updateInteraction=function(a){function b(){0==c.selectionList.length?c.showSelectionProperties():c.appRef.tools.activeTool.showInteraction()}console.log("updateInteraction");var c=this;this.removeAllInteractions();a?setTimeout(b,a):b()};
_.showSelectionProperties=function(){1==this.selectionList.length?this.currentEditableElement=this.selectionList[0]:0==this.selectionList.length&&(this.currentEditableElement=null);this.appRef.container.setAttribute("document-selection-state",this.selectionList.length);this.appRef.transform2DPanel.update();this.appRef.line2DPanel.update();this.appRef.rectangle2DPanel.update();this.appRef.ellipse2DPanel.update();this.appRef.image2DPanel.update();this.appRef.iframe2DPanel.update();this.appRef.text2DPanel.update();
this.appRef.clipPath2DPanel.update();this.appRef.mask2DPanel.update();this.appRef.path2DPanel.update();this.appRef.group2DPanel.update();this.appRef.use2DPanel.update();this.appRef.fillStroke2DPanel.update();this.appRef.stroke2DPanel.update();this.appRef.strokeDashArrayLibrary2DPanel.update();this.appRef.appearance2DPanel.update();this.appRef.layers2DPanel.update();this.appRef.interactivity2DPanel.update();this.appRef.filter2DPanel.update();this.appRef.markersEditor2DPanel.update();this.appRef.snaps2DPanel.update();
this.appRef.colorLibrary2DPanel.updateDynamicLibraries();this.appRef.gradientLibrary2DPanel.updateDynamicLibraries();this.appRef.patternLibrary2DPanel.updateDynamicLibraries();this.appRef.markerLibrary2DPanel.updateDynamicLibraries()};
_.getElementListGlobalBBox=function(a){if(0!=a.length){for(var b=a[0].getGlobalBBox(),c={x:b.x,y:b.y},d={x:b.x+b.width,y:b.y+b.height},e,f,g=1;g<a.length;g++){var h=a[g].getGlobalBBox();e=h.x+h.width;f=h.y+h.height;h.x<c.x&&(c.x=h.x);h.y<c.y&&(c.y=h.y);e>d.x&&(d.x=e);f>d.y&&(d.y=f)}b.min=c;b.max=d;b.x=c.x;b.y=c.y;b.width=d.x-c.x;b.height=d.y-c.y;b.center={x:b.x+b.width/2,y:b.y+b.height/2};return b}};_.mousePointInDocumentSpace=function(a){return this.createSVGPoint(a.x-DOCUMENT_OFFSET.x,a.y-DOCUMENT_OFFSET.y)};
_.normalizeScaleElementList=function(a,b){b||(b={},b.scaleStrokeAndEffects=this.drawingProperties.scaleStrokeAndEffects,b.scaleText=this.drawingProperties.scaleText);var c=this.content.getTransform(),d=c.matrix.clone();c.matrix.identity();var e,f=a.length;for(e=0;e<f;e++)a[e].prepareToNormalizeScale(b);for(e=0;e<f;e++)a[e].normalizeScale(b);for(e=0;e<f;e++)a[e].normalizationData&&delete a[e].normalizationData;c.setMatrix(d)};
_.createElementListPreviews=function(a,b,c){var d=!1;a||(a=this.appRef.interaction2D.elementPreviews,d=!0);var e=b.length;for(var f=0;f<e;f++){var g=b[f];if(g.createElementPreview){var h=d?g.getCTM():g.getTransform().matrix.clone();var k=g.getLayerOwner();k=c||k.dataset.color;if(g instanceof SVGGElement){var l=SVGUtils.createGroup();l.getTransform().setMatrix(h);a.appendChild(l);this.createElementListPreviews(l,g.childNodes,k)}else if(g=g.createElementPreview(h))g.style.stroke=k,a.appendChild(g)}}};
_.setPropertyElementList=function(a,b,c){if(0!=a.length){var d,e=a.length;if("string"===typeof b){var f=b;for(d=0;d<e;d++)a[d][f]=c}else if(b instanceof Object)for(d=0;d<e;d++)for(f in b)c=b[f],null==c||void 0==c?delete a[d][f]:a[d][f]=c}};_.translateElementList=function(a,b,c,d){c=this.createSVGMatrix().translate(b,c);for(var e=a.length,f=0;f<e;f++)b=a[f],d?b.getTransform().setMatrix(c.multiply(b.getTransform().matrix)):b.getTransform().setMatrix(b.globalMatrixToLocalMatrix(c.multiply(b.getCTM())))};
_.scaleElementList=function(a,b,c,d,e){for(var f,g=a.length,h,k=this.createSVGMatrix(),l=0;l<g;l++)f=a[l],f.storedGlobalMatrix?h=f.storedGlobalMatrix.clone():(h=f.getCTM(),e&&(d=f.globalToLocal(d.x,d.y))),e?(h=h.translate(d.x,d.y),h=h.scaleNonUniform(b,c),h=h.translate(-d.x,-d.y)):(k=k.identity().translate(-d.x,-d.y),h=k.multiply(h),k=k.identity().scaleNonUniform(b,c),h=k.multiply(h),k=k.identity().translate(d.x,d.y),h=k.multiply(h)),f.getTransform().setMatrix(f.globalMatrixToLocalMatrix(h))};
_.skewElementList=function(a,b,c,d,e){for(var f,g=a.length,h,k=this.createSVGMatrix(),l=0;l<g;l++)f=a[l],f.storedGlobalMatrix?h=f.storedGlobalMatrix.clone():(h=f.getCTM(),e&&(d=f.globalToLocal(d.x,d.y))),e?(h=h.translate(d.x,d.y),b&&(h=h.skewX(b)),c&&(h=h.skewY(c)),h=h.translate(-d.x,-d.y)):(k=k.identity().translate(-d.x,-d.y),h=k.multiply(h),b&&(k=k.identity().skewX(b)),c&&(k=k.identity().skewY(c)),h=k.multiply(h),k=k.identity().translate(d.x,d.y),h=k.multiply(h)),f.getTransform().setMatrix(f.globalMatrixToLocalMatrix(h))};
_.rotateElementList=function(a,b,c){for(var d,e=a.length,f,g=this.createSVGMatrix(),h=0;h<e;h++)d=a[h],f=d.storedGlobalMatrix?d.storedGlobalMatrix:d.getCTM(),g=g.identity().translate(-c.x,-c.y),f=g.multiply(f),g=g.identity().rotate(b),f=g.multiply(f),g=g.identity().translate(c.x,c.y),f=g.multiply(f),d.getTransform().setMatrix(d.globalMatrixToLocalMatrix(f))};
_.rotateTransformDataPointList=function(a,b,c){for(var d,e,f,g,h=this.createSVGMatrix(),k,l,n,m=a.length,y=0;y<m;y++){e=a[y];k=e.element;g=k.getCTM();h=h.identity().translate(-c.x,-c.y);g=h.multiply(g);h=h.identity().rotate(b);g=h.multiply(g);h=h.identity().translate(c.x,c.y);g=h.multiply(g);g=k.getCTM().inverse().multiply(g);e=e.pointDataList;n=e.length;for(l=0;l<n;l++)d=e[l],d=d.point,f=d.matrixTransform(g),d.x=f.x,d.y=f.y;k.interactiveElement.renderRequest()}};
_.translateTransformDataPointList=function(a,b,c,d,e){for(var f,g,h,k,l,n,m=a.length,y=0;y<m;y++){h=a[y];k=h.element;d?g=this.createSVGPoint(b,c):(g=k.getScreenCTM().inverse(),g=this.createSVGPoint(b,c).matrixTransform(g).subtract(this.createSVGPoint().matrixTransform(g)));h=h.pointDataList;n=h.length;for(l=0;l<n;l++)f=h[l],f=f.point,f.x+=g.x,f.y+=g.y;e?k.render():k.interactiveElement.renderRequest()}};
_.translatePointList=function(a,b,c,d){for(var e,f,g,h,k,l,n=a.length,m=0;m<n;m++){h=a[m];d?f=this.createSVGPoint(b,c):(e=h.getScreenCTM().inverse(),f=this.createSVGPoint(b,c).matrixTransform(e).subtract(this.createSVGPoint().matrixTransform(e)));g=h.interactiveElement.pointListToTransform;console.log("pointList",g);l=g.length;for(k=0;k<l;k++)e=g[k],e.x+=f.x,e.y+=f.y;h.interactiveElement.renderRequest()}};
_.scaleTransformDataPointList=function(a,b,c,d,e){e=SVGUtils.createSVGPoint();for(var f,g=this.createSVGMatrix(),h,k=a.length,l=0;l<k;l++){var n=a[l];h=n.element;f=h.getCTM();g=g.identity().translate(-d.x,-d.y);f=g.multiply(f);g=g.identity().scaleNonUniform(b,c);f=g.multiply(f);g=g.identity().translate(d.x,d.y);f=g.multiply(f);f=h.getCTM().inverse().multiply(f);for(var m=n.pointDataList,y=m.length,p=0;p<y;p++){var K=m[p];n=K.point;e.set(K.values.x,K.values.y);K=e.matrixTransform(f);n.x=K.x;n.y=K.y}h.interactiveElement.renderRequest()}};
_.duplicateElementList=function(a){a=this.sortElementListByIndexZ(a);a=a.reverse();for(var b=a[a.length-1],c=b.parentElement,d=[],e,f=0;f<a.length;f++)e=a[f].cloneNode(!0),d.push(e),c.insertBefore(e,b.nextElementSibling),e.createUniqueFillStrokeDefReferences();return d};_.setOrigin=function(a){this.origin.x=a.x;this.origin.y=a.y;this.appRef.workspace.updateRulersAndGrid();this.appRef.workspace.updateOrigin()};
_.updateCursorState=function(a){a.elementAtPoint?(this.appRef.documentsContainer.classList.add("over-element"),this.focusedElement.classList.remove("pointer-hover"),this.focusedElement=a.elementAtPoint,this.focusedElement.classList.add("pointer-hover"),a.snappedPoint?this.appRef.documentsContainer.classList.add("over-vertex"):this.appRef.documentsContainer.classList.remove("over-vertex"),a.pointOnSegment?this.appRef.documentsContainer.classList.add("over-segment"):this.appRef.documentsContainer.classList.remove("over-segment")):
(this.appRef.documentsContainer.classList.remove("over-element"),this.focusedElement.classList.remove("pointer-hover"),this.appRef.documentsContainer.classList.remove("over-vertex"),this.appRef.documentsContainer.classList.remove("over-segment"));a.overGuide?this.appRef.documentsContainer.classList.add("over-guide"):this.appRef.documentsContainer.classList.remove("over-guide")};
_.hitTestAtPoint=function(a,b){var c={elementListAtPoint:null,elementAtPoint:null};this.hitRect.x=a-this.snapDistance-DOCUMENT_OFFSET.x;this.hitRect.y=b-this.snapDistance-DOCUMENT_OFFSET.y;this.hitRect.width=2*this.snapDistance;this.hitRect.height=2*this.snapDistance;var d=this.getIntersectionList(this.hitRect,null);if(0<d.length){c.elementListAtPoint=d;for(var e=d.length,f=0;f<e;f++)d[f].classList.add("precise-hit-test");var g=document.elementFromPoint(a,b);for(f=0;f<e;f++)d[f].classList.remove("precise-hit-test");
g&&"svg"!=g.nodeName&&(c.elementAtPoint=g)}return c};_.setPen=function(a){this.pen=a};_.getPen=function(){return this.pen};_.createPen=function(a){this.appRef.interaction2D.smartGuides.hideGuides();var b=this.mousePointInDocumentSpace(a),c=this.content.globalToLocal(b.x,b.y),d=this.hitTestAtPoint(a.x,a.y);return{pointInScreenSpace:a,pointInDocumentSpace:b,pointInContentSpace:c,hitTestResult:d,elementListAtPoint:d.elementListAtPoint,elementAtPoint:d.elementAtPoint}};
_.screenPointToPen=function(a,b,c,d){a=this.createPen(a);var e=this.snapDistance/this.content.currentScale;if(this.snapToPoint){if(b&&a.elementListAtPoint){b=a.elementListAtPoint;for(var f=0;f<b.length;f++)if(this.applySnapTo_elementPoints(b[f],a,e,c),a.snappedPoint)return this.snapToSmartGuides&&(this.appRef.interaction2D.smartPoints.onPenSnappedToPoint(a),this.appRef.interaction2D.smartGuides.onPenSnappedToSegment(a)),a}else if(a.elementAtPoint&&(this.applySnapTo_elementPoints(a.elementAtPoint,
a,e,c),a.snappedPoint))return this.snapToSmartGuides&&(this.appRef.interaction2D.smartPoints.onPenSnappedToPoint(a),this.appRef.interaction2D.smartGuides.onPenSnappedToSegment(a)),a;if(this.snapToSmartGuides&&(this.applySnapTo_smartPoints(a,this.snapDistance,this.snapDistance,[{x:this.appRef.interaction2D.smartPoints.point0.cx.baseVal.value,y:this.appRef.interaction2D.smartPoints.point0.cy.baseVal.value},{x:this.appRef.interaction2D.smartPoints.point1.cx.baseVal.value,y:this.appRef.interaction2D.smartPoints.point1.cy.baseVal.value},
{x:this.appRef.interaction2D.smartPoints.point2.cx.baseVal.value,y:this.appRef.interaction2D.smartPoints.point2.cy.baseVal.value}]),this.appRef.interaction2D.smartGuides.findSnapTo_smartGuides(a,this.snapDistance),a.intersectionPoint))return a}if(a.elementAtPoint&&this.snapToSegments&&(this.applySnapTo_segments(a,e),a.pointOnSegment))return a;this.updateCursorState(a);this.snapToGrid&&this.applySnapTo_grid(a);if(d)return a;if(this.snapToBBoxProjections){c=this.applySnapTo_bboxProjections(a.pointInDocumentSpace,
a.snapDistanceX||this.snapDistance,a.snapDistanceY||this.snapDistance);if(null!=c.x||null!=c.y)null!=c.x&&(a.pointInDocumentSpace.x=c.x),null!=c.y&&(a.pointInDocumentSpace.y=c.y),a.pointInContentSpace=this.content.globalToLocal(a.pointInDocumentSpace.x,a.pointInDocumentSpace.y);a.snapDistanceX=c.snapDistanceX;a.snapDistanceY=c.snapDistanceY}this.snapToPageBorders&&(c=this.appRef.workspace.page.getGlobalBBox(),this.insetBBox(c,this.pageMargin*this.content.currentScale),this.applySnapTo_smartPoints(a,
a.snapDistanceX,a.snapDistanceY,[c.min,c.center,c.max]));return a};
_.applySnapTo_segments=function(a,b){if("line"==a.elementAtPoint.nodeName){var c=a.elementAtPoint.globalToLocal(a.pointInDocumentSpace.x,a.pointInDocumentSpace.y);var d=GeometryUtils.isPointOnLine(a.elementAtPoint.getPt1(),a.elementAtPoint.getPt2(),c,b,!0);if(d&&(a.pointInLocalSpace=d,a.pointInDocumentSpace=a.elementAtPoint.localToGlobal(d.x,d.y),a.pointInContentSpace=this.content.globalToLocal(a.pointInDocumentSpace.x,a.pointInDocumentSpace.y),a.pointOnSegment=c,this.updateCursorState(a),this.snapToSmartGuides))this.appRef.interaction2D.smartGuides.onPenSnappedToSegment(a)}else if("path"==
a.elementAtPoint.nodeName&&(c=a.elementAtPoint.findSegmentLineToAtPoint(a.pointInDocumentSpace,b))&&(a.pointInLocalSpace=c.pointOnSegment,a.pointInDocumentSpace=a.elementAtPoint.localToGlobal(a.pointInLocalSpace.x,a.pointInLocalSpace.y),a.pointInContentSpace=this.content.globalToLocal(a.pointInDocumentSpace.x,a.pointInDocumentSpace.y),a.pointOnSegment=c.pointOnSegment,a.segment=c.segment,this.updateCursorState(a),this.snapToSmartGuides))this.appRef.interaction2D.smartGuides.onPenSnappedToSegment(a)};
_.applySnapTo_elementPoints=function(a,b,c,d){a.findSnapToPoint&&(c=a.findSnapToPoint(b.pointInDocumentSpace,c,d))&&(b.elementAtPoint=a,b.pointInLocalSpace=c,b.pointInDocumentSpace=a.localToGlobal(c.x,c.y),b.pointInContentSpace=this.content.globalToLocal(b.pointInDocumentSpace.x,b.pointInDocumentSpace.y),b.snappedPoint=c,this.updateCursorState(b))};
_.applySnapTo_angle=function(a,b,c,d){c=c||this.snapDistance;var e=Math.abs(a.x-b.x),f=Math.abs(a.y-b.y);if(e<c||f<c)return e<c&&(a.x=b.x),f<c&&(a.y=b.y),a;d=d||Math.PI/180*this.snapAngle;a={x:a.x-b.x,y:a.y-b.y};a=SVGUtils.createSVGPointPolar(Math.sqrt(a.x*a.x+a.y*a.y),Math.round(Math.atan2(a.y,a.x)/d)*d);a.x=b.x+a.x;a.y=b.y+a.y;return a};
_.applySnapTo_grid=function(a){a.pointInContentSpace.x=this.origin.x+this.gridStep*Math.round((a.pointInContentSpace.x-this.origin.x)/this.gridStep);a.pointInContentSpace.y=this.origin.y+this.gridStep*Math.round((a.pointInContentSpace.y-this.origin.y)/this.gridStep);a.pointInDocumentSpace=this.content.localToGlobal(a.pointInContentSpace.x,a.pointInContentSpace.y)};
_.applySnapTo_bboxProjections=function(a,b,c){var d=null,e=null,f=Math.abs,g=this.createSVGRect();g.x=0;g.y=a.y-c;g.width=this.clientWidth;g.height=2*c;var h=this.getIntersectionList(g,null);var k=c;var l=h.length;for(c=0;c<l;c++){var n=h[c].getGlobalBBox();var m=f(n.min.y-a.y);m<k?(e=n.min.y,k=m):(m=f(n.max.y-a.y),m<k?(e=n.max.y,k=m):(m=f(n.center.y-a.y),m<k&&(e=n.center.y,k=m)))}g.x=a.x-b;g.y=0;g.width=2*b;g.height=this.clientHeight;h=this.getIntersectionList(g,null);l=h.length;for(c=0;c<l;c++)n=
h[c].getGlobalBBox(),m=f(n.min.x-a.x),m<b?(d=n.min.x,b=m):(m=f(n.max.x-a.x),m<b?(d=n.max.x,b=m):(m=f(n.center.x-a.x),m<b&&(d=n.center.x,b=m)));d&&this.appRef.interaction2D.smartGuides.showGuideX(d);e&&this.appRef.interaction2D.smartGuides.showGuideY(e);return{x:d,y:e,snapDistanceX:b,snapDistanceY:k}};
_.applySnapTo_smartPoints=function(a,b,c,d){for(var e=null,f=null,g=Math.abs,h=a.pointInDocumentSpace,k,l=0;l<d.length;l++)k=g(d[l].x-h.x),k<b&&(e=d[l].x,b=k);for(l=0;l<d.length;l++)k=g(d[l].y-h.y),k<c&&(f=d[l].y,c=k);if(null!=e||null!=f)null!=e&&(a.projectionSnapOnX=!0,a.pointInDocumentSpace.x=e,this.appRef.interaction2D.smartGuides.showGuideX(e)),null!=f&&(a.projectionSnapOnY=!0,a.pointInDocumentSpace.y=f,this.appRef.interaction2D.smartGuides.showGuideY(f)),a.pointInContentSpace=this.content.globalToLocal(a.pointInDocumentSpace.x,
a.pointInDocumentSpace.y);a.snapDistanceX=b;a.snapDistanceY=c};_.enterTo_HTMLTextEditing=function(a){this.deselectAllElements();this.selectElement(a);this.setCurrentEditableElement(a);this.removeAllInteractions();this.appRef.interaction2D.smartGuides.hideGuides();a=a.firstChild;a.setAttribute("contenteditable","true");a.focus();this.isHTMLTextEditing=!0;this.showSelectionProperties()};
_.exitFrom_HTMLTextEditing=function(){var a=this.querySelector("[contenteditable]"),b=a.parentElement;a.offsetHeight>b.getAttribute("height")&&b.setAttribute("height",a.offsetHeight);a.blur();a.removeAttribute("contenteditable");this.isHTMLTextEditing=!1;this.onChange();this.updateInteraction()};_.enterTo_TextEditing=function(a){this.deselectAllElements();this.selectElement(a);this.setCurrentEditableElement(a);this.removeAllInteractions();this.isTextEditing=!0;this.editableSVGTextElement=a;a.onEnterToTextEditing()};
_.exitFrom_TextEditing=function(){this.editableSVGTextElement.onExitFromTextEditing();this.isTextEditing=!1;this.editableSVGTextElement=null;this.onChange();this.updateInteraction()};
_.getSelectedTransformablePointData=function(){var a=[],b,c=this.selectionList,d,e=c.length;for(d=0;d<e;d++){var f=c[d];var g=f.getSelectedTransformableGeometryPointList();var h={element:f,pointDataList:[]};var k=g.length;for(b=0;b<k;b++)f=g[b],h.pointDataList.push({point:f,values:{x:f.x,y:f.y}});0<g.length&&a.push(h)}console.log("transformDataPointList",a);return a};
_.getUsedColorList=function(a,b){for(var c=b||[],d=this.content.querySelectorAll(".layers>.layer ["+a+"]:not(["+a+'^="url"]):not(['+a+'="none"]):not(['+a+'=""])'),e,f=d.length,g=0;g<f;g++)e=d[g].getAttribute(a),-1==c.indexOf(e)&&c.push(e);return c};
_.getUsedGradientList=function(a,b){for(var c=document.querySelectorAll("#PROJECT_DEFS defs linearGradient, #PROJECT_DEFS defs radialGradient"),d=[],e=c.length,f=0;f<e;f++)d.push("url(#"+c[f].getAttribute("id")+")");c=b||[];var g=this.content.querySelectorAll(".layers>.layer ["+a+'^="url"]');e=g.length;for(f=0;f<e;f++){var h=g[f].getAttribute(a);-1<d.indexOf(h)&&-1==c.indexOf(h)&&c.push(h)}return c};
_.getUsedPatternList=function(a,b){for(var c=document.querySelectorAll("#PROJECT_DEFS defs pattern"),d=[],e=c.length,f=0;f<e;f++)d.push("url(#"+c[f].getAttribute("id")+")");c=b||[];var g=this.content.querySelectorAll(".layers>.layer ["+a+'^="url"]');e=g.length;for(f=0;f<e;f++){var h=g[f].getAttribute(a);-1<d.indexOf(h)&&-1==c.indexOf(h)&&c.push(h)}return c};
_.getUsedMarkerList=function(a,b){for(var c=document.querySelectorAll("#PROJECT_DEFS defs marker"),d=[],e=c.length,f=0;f<e;f++)d.push("url(#"+c[f].getAttribute("id")+")");c=b||[];var g=this.content.querySelectorAll(".layers>.layer ["+a+'^="url"]');e=g.length;for(f=0;f<e;f++){var h=g[f].getAttribute(a);-1<d.indexOf(h)&&-1==c.indexOf(h)&&c.push(h)}return c};_.getFilteredElementListByNodeName=function(a,b){for(var c=[],d=b.split(","),e=a.length,f=0;f<e;f++)-1<d.indexOf(a[f].nodeName)&&c.push(a[f]);return c};
_.removeElementList=function(a){for(var b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])};_.sortElementListByIndexZ=function(a){var b=a[0].parentElement,c,d=b.children.length;for(c=0;c<d;c++)b.children[c].sortIndex=c;a=a.sort(function(a,b){return a.sortIndex-b.sortIndex});for(c=0;c<d;c++)delete b.children[c].sortIndex;return a};_.areElementListChildrenOfTheSameParent=function(a){if(0==a.length)return!1;var b=a[0].parentElement,c,d=a.length;for(c=0;c<d;c++)if(a[c].parentElement!=b)return!1;return!0};
_.groupElementList=function(a){if(1!=this.areElementListChildrenOfTheSameParent(a))return this.appRef.alertModalDialog.open(LOCALIZER.translate("Invalid operation"),LOCALIZER.translate("To make a group the elements must be inside the same level or group!")),null;a=this.sortElementListByIndexZ(a);var b=a[0].parentElement,c=this.getElementListGlobalBBox(a),d=b.globalToLocal(c.center.x,c.center.y);c=this.createGroup(d.x,d.y);var e=this.createSVGMatrix();e=e.translate(-d.x,-d.y);var f,g=a.length;for(f=
0;f<g;f++)d=a[f].cloneNode(!0),d.getTransform().setMatrix(e.multiply(d.getTransform().matrix)),c.appendChild(d);b.appendChild(c);this.removeElementList(a);return c};
_.ungroupElementList=function(a){if(0==a.length)return null;for(var b=a[0].parentElement,c=[],d,e,f,g,h=a.length,k,l,n=0;n<h;n++){k=a[n];l=k.getTransform().matrix;e=k.childNodes.length;for(d=0;d<e;d++)f=k.childNodes[d],!(f instanceof SVGClipPathElement)&&f instanceof SVGGraphicsElement&&(g=f.getTransform().matrix,f=f.cloneNode(!0),b.appendChild(f),f.getTransform().setMatrix(l.multiply(g)),c.push(f));if(k.hasAttribute("clip-path")){var m=k.querySelector("clipPath");e=m.childNodes.length;for(d=0;d<
e;d++)f=m.childNodes[d],f instanceof SVGGraphicsElement&&(g=f.getTransform().matrix,f=f.cloneNode(!0),b.appendChild(f),f.getTransform().setMatrix(l.multiply(g)),c.push(f))}if(k.hasAttribute("mask"))for(m=k.querySelector("mask"),e=m.childNodes.length,d=0;d<e;d++)f=m.childNodes[d],f instanceof SVGGraphicsElement&&(g=f.getTransform().matrix,f=f.cloneNode(!0),b.appendChild(f),f.getTransform().setMatrix(l.multiply(g)),c.push(f));k.remove()}return c};
_.lockElementList=function(a){for(var b=0,c=a.length;b<c;b++)a[b].classList.add("locked");this.deselectAllElements();this.updateInteraction()};_.unlockAllElements=function(){for(var a=this.content.querySelectorAll(".layers .layer.selected *.locked"),b=0,c=a.length;b<c;b++)a[b].classList.remove("locked");this.selectElementList(a);this.updateInteraction()};
_.convertElementListToPath=function(a){a=this.getFilteredElementListByNodeName(a,"path,ellipse,rect,line");var b,c=[];var d=a.length;for(b=0;b<d;b++){var e=a[b];if("path"!=e.nodeName){var f=SVGUtils.createPath();f.getTransform().setMatrix(e.getTransform().matrix.clone());f.setPathData(e.getPathData({normalize:!0}));f.setGraphicAttributesByElement(e);e.parentNode.replaceChild(f,e);c.push(f)}else c.push(e)}return c};
_.booleanPathsOperation=function(a,b,c){var d={};paper.install(d);paper.setup([640,480]);a=d.project.importSVG(a);b=d.project.importSVG(b);switch(c){case "unite":var e=a.unite(b);break;case "intersect":e=a.intersect(b);break;case "subtract":e=a.subtract(b);break;case "exclude":e=a.exclude(b);break;case "divide":e=a.divide(b)}c=e.exportSVG();e=[];"g"==c.nodeName?e=c.querySelectorAll("path"):e.push(c);return e};
_.enterTo_isolateLayerEditing=function(a){this.deselectAllElements();this.removeAllInteractions();var b=a.nodeName.toUpperCase();a.hasAttribute("id")&&(b=a.getAttribute("id"));var c=this.createLayer(b);c.classList.add("isolate-layer");var d={document:this,editableElement:a};a.hasAttribute("clip-path")?(c.setAttribute("name",LOCALIZER.translate("clip-path")),c.connectController(ClipEditing_layer,d)):a.hasAttribute("mask")?(c.setAttribute("name",LOCALIZER.translate("mask")),c.connectController(MaskEditing_layer,
d)):"symbol"==a.nodeName?(c.setAttribute("name",LOCALIZER.translate("symbol")+":"+b),c.connectController(SymbolEditing_layer,d)):"pattern"==a.nodeName?(c.setAttribute("name",LOCALIZER.translate("pattern")+":"+b),c.connectController(PatternEditing_layer,d)):"marker"==a.nodeName?(c.setAttribute("name",LOCALIZER.translate("marker")+":"+b),c.connectController(MarkerEditing_layer,d)):c.connectController(GroupEditing_layer,d);this.addLayer_undable(c);c.enterToEditing();this.showSelectionProperties()};
_.is_isolateLayerEditing=function(){var a=this.getLayersContainer().children;return a[a.length-1].classList.contains("isolate-layer")?!0:!1};
_.updateIsolateLayerEditingState=function(){var a=this.appRef.activeEditablePage.getLayersContainer().children;a=a[a.length-1];document.body.style.backgroundColor="";for(this.appRef.workspace.page.classList.remove("hidden");a;){a.classList.remove("temporary-hidden");if(a.classList.contains("isolate-layer")&&(a.classList.contains("symbol")||a.classList.contains("pattern")||a.classList.contains("marker"))){document.body.style.backgroundColor="white";this.appRef.workspace.page.classList.add("hidden");
for(a=a.previousElementSibling;a;)a.classList.add("temporary-hidden"),a=a.previousElementSibling;break}a=a.previousElementSibling}this.is_isolateLayerEditing()?(this.appRef.container.setAttribute("app-state","locked"),this.appRef.container.setAttribute("document-state","locked"),this.classList.add("isolate-layer-editing"),ShowElement(this.appRef.isolateLayerEditingToolbar)):(this.appRef.container.setAttribute("app-state",""),this.appRef.container.setAttribute("document-state",""),this.classList.remove("isolate-layer-editing"),
HideElements([this.appRef.isolateLayerEditingToolbar]),this.appRef.page2DPanel.update(),this.appRef.pages2DPanel.update())};
_.exitFrom_isolateLayerEditing=function(){this.isHTMLTextEditing&&this.exitFrom_HTMLTextEditing();this.isTextEditing&&this.exitFrom_TextEditing();this.deselectAllElements();var a=this.getLayersContainer().children,b=a[a.length-1];a=new ReplaceElements_action(this);var c=new ReplaceElements_action(this);a.setElementsToReplace([b.editableElementRef]);c.setElementsToInsert([b.editableElementRef]);try{var d=b.exitFromEditing();if(d){a.setElementsToInsert([d]);c.setElementsToReplace([d]);var e=this;a.onExecuteEnd=
function(){e.deselectAllElements();e.removeLayer(b);e.removeAllInteractions();e.showSelectionProperties()};c.onExecuteEnd=function(){e.deselectAllElements();e.addLayer(b);e.removeAllInteractions();e.showSelectionProperties()};this.history.addUndoRedoActions(c,a)}else this.removeElementList_undable([b.editableElementRef])}catch(f){console.error(f)}this.removeLayer(b);this.removeAllInteractions();this.showSelectionProperties();this.appRef.activateTool("selectionGlobal2D_tool")};
_.evalMathExpression=function(a){return parseFloat(a)};_.createPageView=function(a,b,c){var d=this.dataset.width,e=this.dataset.height,f=d,g=e;b&&c&&(g=Math.min(b/d,c/e),f=d*g,g*=e);a=a.cloneNode(!0);b="svg"===a.nodeName?a:a.querySelector("svg");b.setAttribute("viewBox","0 0 "+d+" "+e);b.setAttribute("width",f);b.setAttribute("height",g);b.querySelector("use").setAttribute("xlink:href","#"+this.querySelector(".layers").getAttribute("id"));a.pageRef=this;return a};
_.createClippedContent=function(a){if(2>a.length)return null;if(1!=this.areElementListChildrenOfTheSameParent(a))return this.appRef.alertModalDialog.open(LOCALIZER.translate("Invalid operation"),LOCALIZER.translate("To make a clipped contet the elements must be inside the same level or group!")),null;a=[].slice.call(a,0);if(a=this.sortElementListByIndexZ(a)){var b=a[0],c=b.parentElement,d=CreateUniqueIDI(),e=SVGUtils.createClipPath(d),f=SVGUtils.createGroup();f.getTransform().setMatrix(b.getTransform().matrix.clone());
c.appendChild(f);f.appendChild(e);c=b.getTransformToElement(f);b=b.cloneNode(!0);f.appendChild(b);b.getTransform().setMatrix(c);for(b=1;b<a.length;b++){c=a[b];var g=c.getTransformToElement(e);c=c.cloneNode(!0);e.appendChild(c);c.getTransform().setMatrix(g)}f.setAttribute("clip-path","url(#"+d+")");return f}};_.removeClippedContent=function(a){};
_.createMaskedContent=function(a,b){var c=a.parentElement,d=CreateUniqueIDI(),e=SVGUtils.createMask(d),f=SVGUtils.createGroup();f.getTransform().setMatrix(a.getTransform().matrix.clone());c.appendChild(f);f.appendChild(e);c=a.getTransformToElement(f);a=a.cloneNode(!0);f.appendChild(a);a.getTransform().setMatrix(c);for(c=0;c<b.length;c++){var g=b[c],h=g.getTransformToElement(f);g=g.cloneNode(!0);e.appendChild(g);g.getTransform().setMatrix(h)}f.setAttribute("mask","url(#"+d+")");return f};
_.createTextPathContent=function(a,b){var c=CreateUniqueIDI(),d=b.parentElement,e=SVGUtils.createGroup();e.getTransform().setMatrix(b.getTransform().matrix.clone());var f=b.cloneNode();f.getTransform().matrix.identity();f.setAttribute("id",c);e.appendChild(f);f=a.cloneNode(!1);f.setAttribute("data-type","TextOnPath");f.getTransform().matrix.identity();var g=document.createElementNS(SVGElement.SVG_NS,"textPath");g.setAttributeNS(SVGElement.XLINK_NS,"href","#"+c);c=document.createTextNode("");g.appendChild(c);
f.textData=a.getTextData();f.appendChild(g);e.appendChild(f);d.appendChild(e);return e};_.convertTextElementListAsPaths=function(a,b){function c(){f.appRef.alertModalDialog.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The Font file could not be loaded."))}function d(c){e.push(c);e.length==a.length&&b(e)}for(var e=[],f=this,g=0;g<a.length;g++)a[g].convertTextToPath(d,c)};
_.getAsImage=function(a,b,c,d){var e=this.content.querySelectorAll("text");console.log("textElementList",e);var f=this,g;if(0<e.length){var h=function(a){for(var b=0;b<g.length;b++)g[b].parentElement.replaceChild(e[b],g[b]);c(a)};this.convertTextElementListAsPaths(e,function(c){g=c;console.log("textElementListAsGroupList",g);for(var k=0;k<e.length;k++)e[k].parentElement.replaceChild(c[k],e[k]);f.serializePageAsImage(a,b,h,d)})}else this.serializePageAsImage(a,b,c,d)};
_.serializePageAsImage=function(a,b,c,d){a=a||"image/png";b=b||1;var e=this.content.getTransform().matrix.clone();this.content.getTransform().matrix.identity();var f=this.appRef.getActiveDocument();f=(new Document2DSerializer(this)).serializeDocument(f,this,this.dataset.width,this.dataset.height);f=(new XMLSerializer).serializeToString(f);this.content.getTransform().setMatrix(e);var g=window.URL;e=new Blob([f],{type:"image/svg+xml;charset=utf-8"});var h=g.createObjectURL(e),k=new Image,l=document.createElement("canvas");
l.width=Math.floor(this.dataset.width*b);l.height=Math.floor(this.dataset.height*b);var n=l.getContext("2d");k.onload=function(){"image/jpeg"==a&&(n.fillStyle="#FFFFFF",n.fillRect(0,0,l.width,l.height));n.drawImage(k,0,0);d?l.toBlob(function(a){c(a);g.revokeObjectURL(h)},a):(c(l.toDataURL(a)),g.revokeObjectURL(h))};k.src=h};
_.getElementAsBitmap=function(a,b,c,d){c=c||0;d=this.content.getTransform().matrix.clone();this.content.getTransform().matrix.identity();var e=this.createSVG(this.dataset.width,this.dataset.height),f=document.querySelector("#PROJECT_DEFS defs");e.appendChild(f.cloneNode(!0));var g=a.getGlobalBBox();f=a.cloneNode(!0);f.getTransform().setMatrix(a.getTransformToElement(this));e.appendChild(f);this.content.getTransform().setMatrix(d);d=(new XMLSerializer).serializeToString(e);var h=document.createElement("canvas");
h.width=Math.floor(g.width)+2*c;h.height=Math.floor(g.height)+2*c;var k=h.getContext("2d"),l=window.URL,n=new Image;d=new Blob([d],{type:"image/svg+xml;charset=utf-8"});var m=l.createObjectURL(d),y=this;n.onload=function(){k.drawImage(n,-Math.floor(g.x)+c,-Math.floor(g.y)+c);var d=document.createElementNS(SVGElement.SVG_NS,"image");d.setAttributeNS(SVGElement.XLINK_NS,"href",h.toDataURL("image/png"));var e=SVGUtils.createSVGMatrix();e=e.translate(g.x-c,g.y-c);d.getTransform().setMatrix(e);y.getActiveLayer().appendChild(d);
d.getTransform().setMatrix(d.getTransformToElement(a.parentNode));l.revokeObjectURL(m);b(d)};n.src=m};_.centerElementListInDocumentView=function(a){this.centerElementListAtGlobalPoint(a,this.clientWidth/2,this.clientHeight/2)};_.centerElementListAtGlobalPoint=function(a,b,c){if(0<a.length){var d=this.getElementListGlobalBBox(a);this.translateElementList(a,b-d.center.x,c-d.center.y);this.updateInteraction();this.onChange()}};
_.onDropFileEntry=function(a){var b=this,c=a.fileExtension;if("jpg"==c||"jpeg"==c||"png"==c||"gif"==c)this.deselectAllElements(),LOCAL_FILE_SYSTEM.getFileEntryAsObjectURL(a,function(c){var d=SVGUtils.createSVGImage(c,0,0,null,null,function(){b.selectElement(d);b.centerElementListInDocumentView([d])});d.dataset.fullPath=a.fullPath;d.dataset.mantainAspectRatio="true";b.getActiveLayer().appendChild(d);b.createAddElementsToDocumentUndoRedoActions([d])})};
_.cutSelectedElements=function(a){this.copySelectedElements(a);this.removeElementList_undable(this.selectionList);this.onChange()};
_.copySelectedElements=function(a){for(var b=0;b<this.selectionList.length;b++)this.selectionList[b].classList.add("toClipboard");var c=this.querySelectorAll(".toClipboard");for(b=0;b<this.selectionList.length;b++)this.selectionList[b].classList.remove("toClipboard");b=(new Document2DSerializer(this.appRef)).serializeItemList(c);a.clipboardData.setData("text/plain",(new XMLSerializer).serializeToString(b));return a.preventPropagation()};
_.pasteElements=function(a){console.log("pasteElements",a);if(a.clipboardData&&a.clipboardData.items){for(var b=this,c,d=a.clipboardData.items,e=0;e<d.length;e++)c=d[e],console.log("past item",c),console.log("past item type",c.type),console.log("past item kind",c.kind),"file"==c.kind?-1<c.type.indexOf("image")&&this.importFile_IMG(c.getAsFile(),function(a){b.centerElementListInDocumentView([a])}):"string"==c.kind&&"text/plain"==c.type&&c.getAsString(function(c){console.log("onGetString",c);console.log("_pasteEvent.shiftKey",
a.shiftKey);c=(new DOMParser).parseFromString(c,"text/xml").documentElement;var d=null;Event.isShiftKeyPressed||(d={x:b.clientWidth/2,y:b.clientHeight/2});b.unserializeAndPlaceSvgInCurrentLayer_undable(c,d)});return a.preventPropagation()}};_.onPasteTextAsSvg=function(a,b){var c=(new DOMParser).parseFromString(a,"text/xml").documentElement,d=null;b||(d={x:this.clientWidth/2,y:this.clientHeight/2});this.unserializeAndPlaceSvgInCurrentLayer_undable(c,d)};
_.addElementToProjectDefs=function(a,b){var c=document.querySelector("#PROJECT_DEFS defs");b=b||CreateUniqueIDI();a.setAttribute("id",b);c.appendChild(a);return"url(#"+a.getAttribute("id")+")"};_.getElementFromProjectDefs=function(a){a=String.extractIdFromUrl(a);return document.querySelector('#PROJECT_DEFS defs [id="'+a+'"]')};String.extractIdFromUrl=function(a){a=a.split("#")[1].split(")")[0];return a=a.split('"')[0]};
_.importFile_IMG=function(a,b){var c=this;LOCAL_FILE_SYSTEM.readImageFile(a,function(a){var d=c.createSVGImage(a,0,0,null,null,function(){b&&b(d)});d.dataset.mantainAspectRatio="true";c.getActiveLayer().appendChild(d)})};_.importFile_SVG=function(a){var b=this;LOCAL_FILE_SYSTEM.readXMLFile(a,function(a){a.hasAttribute("data-version")?"6.2"==a.dataset.version&&b.appRef.unserializeAndAddPagesInCurrentDocument(a):b.unserializeAndPlaceSvgInCurrentLayer_undable(a)})};_=SVGPage.prototype;
_.addLayer_undable=function(a){var b=this.getActiveLayer();console.log("addLayer_undable",a);this.addLayer(a);var c=new RemoveElements_action(this);c.setElements([a]);var d=new InsertElements_action(this);d.setElements([a]);var e=this;c.onExecuteEnd=function(){e.deselectAllElements();e.setActivePageLayer(b);e.removeAllInteractions();e.showSelectionProperties()};d.onExecuteEnd=function(){e.deselectAllElements();e.setActivePageLayer(a);e.removeAllInteractions();e.showSelectionProperties()};this.history.addUndoRedoActions(c,
d);this.onChange();return a};
_.removeLayer_undable=function(a){if(1!=this.getLayersContainer().children.length){this.deselectAllElements();this.removeAllInteractions();var b=new InsertElements_action(this);b.setElements([a]);b.onExecuteEnd=function(){this.pageRef.deselectAllElements();this.pageRef.setActivePageLayer(a);this.pageRef.removeAllInteractions();this.pageRef.showSelectionProperties()};var c=new RemoveElements_action(this);c.setElements([a]);this.history.addUndoRedoActions(b,c);this.removeLayer(a);this.onChange();this.showSelectionProperties()}};
_.placeElementListInLayer_undable=function(a,b){if(0==a.length)return null;var c=new ReplaceElements_action(this),d=new ReplaceElements_action(this);c.setElementsToReplace(a);d.setElementsToInsert(a);b.appendChildren(a);c.setElementsToInsert(a);d.setElementsToReplace(a);this.history.addUndoRedoActions(d,c);this.onChange();this.selectElementList(a);this.updateInteraction()};
_.setGradientsPointsElementList_undable=function(a,b,c,d){var e=a.length;if(0!=e){for(var f,g,h,k=0;k<e;k++)if(f=a[k],g=f.getGradient(b))h=f.globalToLocal(c.x,c.y),f=f.globalToLocal(d.x,d.y),g instanceof SVGRadialGradientElement?this.setAttributeElementList_undable([g],{cx:h.x,cy:h.y,r:f.getDistanceFromPoint(h),gradientUnits:"userSpaceOnUse"},!1):g instanceof SVGLinearGradientElement&&this.setAttributeElementList_undable([g],{x1:h.x,y1:h.y,x2:f.x,y2:f.y,gradientUnits:"userSpaceOnUse"},!1);this.onChange()}};
_.setTextAttribute_undable=function(a,b,c,d){c=c||a.storedTextSelectionRange.textDataStartOffset;var e=d||a.storedTextSelectionRange.textDataEndOffset;d=new SetTextDataStyle_action(this);d.setTextDataStyleRange(a,c,e);this.setAttributeElementList([a],b);b=new SetTextDataStyle_action(this);b.setTextDataStyleRange(a,c,e);this.history.addUndoRedoActions(d,b)};
_.setAttributeElementList_undable=function(a,b,c){if(0!=a.length)if(this.isTextEditing&&"true"==a[0].dataset.useRichText)this.setTextAttribute_undable(a[0],b);else{!1!==c&&(c=!0);var d=new SetAttributes_action(this);d.addElementList(a,b);d.updateDocumentSelection=c;this.setAttributeElementList(a,b);var e=new SetAttributes_action(this);e.addElementList(a,b);e.updateDocumentSelection=c;this.history.addUndoRedoActions(d,e);this.onChange();return{undoAction:d,redoAction:e}}};
_.setPropertyElementList_undable=function(a,b,c){if(0!=a.length){c=c||!1;var d=new SetProperties_action(this);d.addElementList(a,b);d.updateDocumentSelection=c;this.setPropertyElementList(a,b);var e=new SetProperties_action(this);e.addElementList(a,b);e.updateDocumentSelection=c;this.history.addUndoRedoActions(d,e);this.onChange();return{undoAction:d,redoAction:e}}};
_.applyFontElementList_undable=function(a,b,c){if(0!=a.length&&(a=this.getFilteredElementListByNodeName(a,"text"),0!=a.length)){c=c||b.variants[0];var d=window.GoogleFonts.getGoogleFontStyleAndWeightByVariantName(c);this.setAttributeElementList_undable(a,{"font-family":b.family,"font-style":d["font-style"],"font-weight":d["font-weight"]},!0);this.setDrawingProperty("font-family",b.family);this.setDrawingProperty("font-style",d["font-style"]);this.setDrawingProperty("font-weight",d["font-weight"]);
this.onChange();var e=this;window.GoogleFonts.loadGoogleFont(b,c,null,function(){e.updateInteraction(202)})}};
_.translateSelectedPointList_undable=function(a,b,c,d){var e=new SetGeometryPoint2D_action(this),f=new SetGeometryPoint2D_action(this),g=this.getSelectedTransformablePointData();e.setTransformDataPointList(g);console.log("transformDataPointList",g);this.translateTransformDataPointList(g,a,b,c,d);f.setTransformDataPointList(this.getSelectedTransformablePointData());this.history.addUndoRedoActions(e,f);this.updateInteraction();this.onChange()};
_.translateElementList_undable=function(a,b,c,d){var e=new SetMatrix2D_action(this);e.addElementList(a);this.translateElementList(a,b,c,d);b=new SetMatrix2D_action(this);b.addElementList(a);this.history.addUndoRedoActions(e,b);this.updateInteraction();this.onChange()};
_.rotateElementList_undable=function(a,b,c){var d=new SetMatrix2D_action(this);d.addElementList(a);this.rotateElementList(a,b,c);b=new SetMatrix2D_action(this);b.addElementList(a);this.history.addUndoRedoActions(d,b);this.updateInteraction();this.onChange()};_.scaleElementList_undable=function(a,b,c,d,e){this.scaleElementList(a,b,c,d,e);this.normalizeScaleElementList(a);this.createScaleUndoRedoActions(a,b,c,d,e);this.updateInteraction();this.onChange()};
_.createScaleUndoRedoActions=function(a,b,c,d,e,f){f||(f={},f.scaleStrokeAndEffects=this.drawingProperties.scaleStrokeAndEffects,f.scaleText=this.drawingProperties.scaleText);var g=new Scale2D_action(this);g.setElements(a,f);var h=new Scale2D_action(this);h.setElements(a,f);this.history.addUndoRedoActions(g,h);h.localMode=g.localMode=e;h.pivotPt=g.pivotPt=d;g.scaleX=1/b;g.scaleY=1/c;h.scaleX=b;h.scaleY=c;g.options=h.options=f};
_.skewElementList_undable=function(a,b,c,d,e){this.skewElementList(a,b,c,d,e);this.normalizeScaleElementList(a);this.createSkewUndoRedoActions(a,b,c,d,e);this.updateInteraction();this.onChange()};
_.createSkewUndoRedoActions=function(a,b,c,d,e,f){f||(f={},f.scaleStrokeAndEffects=this.drawingProperties.scaleStrokeAndEffects,f.scaleText=this.drawingProperties.scaleText);var g=new Skew2D_action(this);g.setElements(a,f);var h=new Skew2D_action(this);h.setElements(a,f);this.history.addUndoRedoActions(g,h);h.localMode=g.localMode=e;h.pivotPt=g.pivotPt=d;g.skewX=-b;g.skewY=-c;h.skewX=b;h.skewY=c;g.options=h.options=f};
_.createGradientStopColorOffsetUndoRedoActions=function(a,b,c){var d=new SetAttributes_action(this);d.elementList.push(a);d.attributeList.push({offset:b});b=new SetAttributes_action(this);b.elementList.push(a);b.attributeList.push({offset:c});this.history.addUndoRedoActions(d,b);d.onExecuteEnd=b.onExecuteEnd=function(){this.elementList[0].parentElement.sortStopColors();this.pageRef.onChange();this.pageRef.showSelectionProperties();this.pageRef.updateInteraction()}};
_.removeGradientStopColor_undable=function(a){this.history.addUndoRedoActions(new function(b){this.pageRef=b;this.gradientRef=a.parentElement;this.stopColor=a;this.execute=function(){this.gradientRef.appendChild(this.stopColor);this.gradientRef.sortStopColors();this.pageRef.onChange();this.pageRef.showSelectionProperties()}}(this),new function(b){this.pageRef=b;this.gradientRef=a.parentElement;this.stopColor=a;this.execute=function(){this.gradientRef.removeChild(this.stopColor);this.pageRef.onChange();
this.pageRef.showSelectionProperties()}}(this));a.parentElement.removeChild(a)};
_.createAddGradientStopColor_undable=function(a,b){this.history.addUndoRedoActions(new function(c){this.pageRef=c;this.gradientRef=a;this.stopColor=b;this.execute=function(){console.log("undoAction newStopColor",this.stopColor);this.gradientRef.removeChild(this.stopColor);this.gradientRef.sortStopColors();this.pageRef.onChange();this.pageRef.showSelectionProperties()}}(this),new function(c){this.pageRef=c;this.gradientRef=a;this.stopColor=b;this.execute=function(){console.log("redoAction newStopColor",
this.stopColor);this.gradientRef.appendChild(this.stopColor);this.gradientRef.sortStopColors();this.pageRef.onChange();this.pageRef.showSelectionProperties()}}(this))};_.createAddElementsToDocumentUndoRedoActions=function(a,b){!1!==b&&(b=!0);var c=new RemoveElements_action(this);c.setElements(a);c.updateDocumentSelection=b;var d=new InsertElements_action(this);d.setElements(a);d.updateDocumentSelection=b;this.history.addUndoRedoActions(c,d)};
_.setElementListOrderZ_undable=function(a,b){if(0==a.length)return null;var c=new SetElementOrderZ_action(this);c.setElements(a);var d,e=a.length;if("bringToFront"==b)for(d=0;d<e;d++)a[d].bringToFront();else if("sendToBack"==b)for(d=0;d<e;d++)a[d].sendToBack();else if("bringUp"==b)for(d=0;d<e;d++)a[d].bringUp();else if("sendDown"==b)for(d=0;d<e;d++)a[d].sendDown();d=new SetElementOrderZ_action(this);d.setElements(a);this.history.addUndoRedoActions(c,d);this.onChange()};
_.reflectElementList_undable=function(a,b){if(0!=a.length){var c=this.getElementListGlobalBBox(a),d=1,e=1;switch(b){case "horizontally":d=-1;break;case "vertically":e=-1}this.scaleElementList_undable(a,d,e,c.center,!1)}};
_.unserializeAndPlaceSvgInCurrentLayer_undable=function(a,b){console.log("unserializeAndPlaceSvgInCurrentLayer_undable",a);var c=("clipboard_v62"==a.getAttribute("id")?new Document2DUnserializer_v601(this.appRef):a.querySelector('g[id="jvs-content"]')?new Document2DUnserializer_v501(this.appRef):new SvgUnserializer(this.appRef)).unserializeAndPlaceElementListInCurrentLayer(a);console.log("elementListAddedInCurrentLayer",c);b&&this.centerElementListAtGlobalPoint(c,b.x,b.y);this.createAddElementsToDocumentUndoRedoActions(c);
this.selectElementList(c);this.setCurrentEditableElement(c[c.length-1]);this.updateInteraction();this.onChange()};_.replaceElementList_undable=function(a,b,c){var d=new ReplaceElements_action(this),e=new ReplaceElements_action(this);d.updateDocumentSelection=e.updateDocumentSelection=c;d.setElementsToReplace(a);e.setElementsToInsert(a);for(c=0;c<a.length;c++)a[c].parentElement.replaceChild(b[c],a[c]);d.setElementsToInsert(b);e.setElementsToReplace(b);this.history.addUndoRedoActions(e,d);this.onChange()};
_.removeElementList_undable=function(a){if(0==a.length)return null;var b=new InsertElements_action(this);b.setElements(a);var c=new RemoveElements_action(this);c.setElements(a);this.history.addUndoRedoActions(b,c);this.removeElementList(a);this.deselectAllElements();this.updateInteraction();this.onChange()};
_.duplicateElementList_undable=function(a,b,c){if(0==a.length)return null;this.deselectAllElements();a=this.duplicateElementList(a);void 0==b?this.applyLastTransformAction&&this.applyLastTransformAction(a):this.translateElementList(a,b,c);b=new RemoveElements_action(this);b.setElements(a);c=new InsertElements_action(this);c.setElements(a);this.history.addUndoRedoActions(b,c);this.selectElementList(a);this.updateInteraction();this.onChange();return a};
_.groupElementList_undable=function(a){if(0==a.length)return null;this.deselectAllElements();var b=new ReplaceElements_action(this),c=new ReplaceElements_action(this);b.setElementsToReplace(a);c.setElementsToInsert(a);if(a=this.groupElementList(a))b.setElementsToInsert([a]),c.setElementsToReplace([a]),this.history.addUndoRedoActions(c,b),this.selectElementList([a]),this.updateInteraction(),this.onChange()};
_.ungroupElementList_undable=function(a){if(0==a.length)return null;var b=this.getFilteredElementListByNodeName(a,"g");if(0==b.length)return null;a=new ReplaceElements_action(this);var c=new ReplaceElements_action(this);a.setElementsToReplace(b);c.setElementsToInsert(b);b=this.ungroupElementList(b);a.setElementsToInsert(b);c.setElementsToReplace(b);this.history.addUndoRedoActions(c,a);this.selectElementList(b);this.updateInteraction();this.onChange()};
_.convertElementListToPath_undable=function(a){a=this.getFilteredElementListByNodeName(a,"ellipse,rect,line");var b,c=[];var d=a.length;for(b=0;b<d;b++){var e=SVGUtils.createPath();var f=a[b];e.getTransform().setMatrix(f.getTransform().matrix.clone());e.setPathData(f.getPathData({normalize:!0}));c.push(e)}var g=new ReplaceElements_action(this),h=new ReplaceElements_action(this);this.history.addUndoRedoActions(h,g);g.setElementsToReplace(a);h.setElementsToInsert(a);for(b=0;b<d;b++)f=a[b],e=c[b],e.setGraphicAttributesByElement(f),
f.parentNode.replaceChild(e,f);g.setElementsToInsert(c);h.setElementsToReplace(c);this.selectElementList(c);this.updateInteraction();this.onChange()};_.createInsertTextDataUndoRedoActions=function(a,b){var c=new DeleteTextData_action(this);c.setDeleteTextDataProperties(a,b.offset,b.text.length);var d=new InsertTextData_action(this);d.setInsertTextDataProperties(a,b);this.history.addUndoRedoActions(c,d)};
_.createDeleteTextDataUndoRedoActions=function(a,b){var c=new InsertTextData_action(this);c.setInsertTextDataProperties(a,b);var d=new DeleteTextData_action(this);d.setDeleteTextDataProperties(a,b.offset,b.text.length);this.history.addUndoRedoActions(c,d)};
_.createSymbol_undable=function(a,b){if(0==a.length)return null;this.deselectAllElements();var c=new ReplaceElements_action(this),d=new ReplaceElements_action(this);c.setElementsToReplace(a);d.setElementsToInsert(a);var e=b||CreateUniqueIDI(),f=SVGUtils.createSymbol(e),g=this.getElementListGlobalBBox(a);g=this.content.globalToLocal(g.x,g.y);this.translateElementList(a,-g.x,-g.y,!0);for(var h=0;h<a.length;h++)f.appendChild(a[h].cloneNode(!0));this.translateElementList(a,g.x,g.y,!0);document.querySelector("#PROJECT_DEFS defs").appendChild(f);
e=SVGUtils.createUse(e);a[0].parentElement.appendChild(e);this.translateElementList([e],g.x,g.y,!0);c.setElementsToInsert([f,e]);d.setElementsToReplace([f,e]);this.history.addUndoRedoActions(d,c);this.removeElementList(a);this.selectElementList([e]);this.updateInteraction()};
_.createPattern_undable=function(a,b){if(0==a.length)return null;this.deselectAllElements();var c=b||CreateUniqueIDI(),d=this.getElementListGlobalBBox(a),e=this.content.globalToLocal(d.x,d.y);d=SVGUtils.createPattern(c,0,0,1/this.content.currentScale*d.width,1/this.content.currentScale*d.height);console.log("newPattern",d);this.translateElementList(a,-e.x,-e.y,!0);for(var f=0;f<a.length;f++)d.appendChild(a[f].cloneNode(!0));this.translateElementList(a,e.x,e.y,!0);document.querySelector("#PROJECT_DEFS defs").appendChild(d);
this.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,"url(#"+c+")");this.removeElementList_undable(a);this.enterTo_isolateLayerEditing(d);this.updateInteraction()};
_.createMarker_undable=function(a,b){if(0==a.length)return null;this.deselectAllElements();var c=b||CreateUniqueIDI(),d=this.getElementListGlobalBBox(a),e=this.content.globalToLocal(d.x,d.y);d=SVGUtils.createMarker(c,1/this.content.currentScale*d.width,1/this.content.currentScale*d.height);console.log("newMarker",d);this.translateElementList(a,-e.x,-e.y,!0);for(var f=0;f<a.length;f++)d.appendChild(a[f].cloneNode(!0));this.translateElementList(a,e.x,e.y,!0);document.querySelector("#PROJECT_DEFS defs").appendChild(d);
e=this.appRef.markersEditor2DPanel.getActiveMarkerSideName();this.setDrawingProperty(e,"url(#"+c+")");this.removeElementList_undable(a);this.enterTo_isolateLayerEditing(d);this.updateInteraction()};
_.createClippedContent_undable=function(a){if(2>a.length)return null;this.deselectAllElements();var b=new ReplaceElements_action(this),c=new ReplaceElements_action(this);b.setElementsToReplace(a);c.setElementsToInsert(a);var d=this.createClippedContent(a);d&&(b.setElementsToInsert([d]),c.setElementsToReplace([d]),this.history.addUndoRedoActions(c,b),this.removeElementList(a),this.selectElementList([d]),this.updateInteraction())};
_.createMaskedContent_undable=function(a){if(2>a.length)return null;if(1!=this.areElementListChildrenOfTheSameParent(a))return this.appRef.alertModalDialog.open(LOCALIZER.translate("Invalid operation"),LOCALIZER.translate("To make a masked content the elements must be inside the same level or group!")),null;a=[].slice.call(a,0);a=this.sortElementListByIndexZ(a);var b=a[0],c=a.slice(1);this.deselectAllElements();var d=new ReplaceElements_action(this),e=new ReplaceElements_action(this);d.setElementsToReplace(a);
e.setElementsToInsert(a);if(b=this.createMaskedContent(b,c))d.setElementsToInsert([b]),e.setElementsToReplace([b]),this.history.addUndoRedoActions(e,d),this.removeElementList(a),this.selectElementList([b]),this.updateInteraction()};
_.createTextPathContent_undable=function(a){if(1==a.length&&"text"==a[0].nodeName){var b=a[0];var c=b.getLocalBBox();var d=SVGUtils.createEllipse(c.center.x,c.center.x,c.width/2,c.width/2);c=SVGUtils.createPath();c.setPathData(d.getPathData());c.getTransform().setMatrix(b.getTransform().matrix.clone());c.setAttribute("fill","none");c.setAttribute("stroke","#000000");c.setAttribute("stroke-width","0");b.parentElement.insertBefore(c,b.nextElementSibling)}else{if(2!=a.length)return null;a[0]instanceof
SVGTextElement?(b=a[0],c=a[1]):(c=a[0],b=a[1]);if("path"!=c.nodeName)return this.appRef.alertModalDialog.open(LOCALIZER.translate("Graphic Path element required"),LOCALIZER.translate("Please convert the graphic element into a path.")),null}this.deselectAllElements();d=new ReplaceElements_action(this);var e=new ReplaceElements_action(this);d.setElementsToReplace(a);e.setElementsToInsert(a);if(b=this.createTextPathContent(b,c))d.setElementsToInsert([b]),e.setElementsToReplace([b]),this.history.addUndoRedoActions(e,
d),this.removeElementList(a),this.selectElementList([b]),this.updateInteraction()};
_.placeRemoteImageToCurrentLayerAsDataURL_undable=function(a,b,c,d){function e(){f.centerElementListInDocumentView([h]);f.createAddElementsToDocumentUndoRedoActions([h]);f.selectElementList([h]);f.setCurrentEditableElement(h);f.updateInteraction();f.onChange();k.endVirtualProgress();d&&d(h)}var f=this,g=this.getActiveLayer(),h,k=this.appRef.progressPanel;k.setProgressBarValue(1);k.open(!0);k.startVirtualProgress(1E5);SVGUtils.loadImageAndGetDataURL(a,function(a){h=SVGUtils.createSVGImage(a,0,0,b,
c,e);h.dataset.mantainAspectRatio=!0;g.appendChild(h)})};
_.refactorElementID_undable=function(a,b){if(document.querySelector('[id="'+b+'"]'))return this.appRef.alertModalDialog.open(LOCALIZER.translate("ID already exists"),LOCALIZER.translate("An element with that id already exists!")),!1;var c=a.getAttribute("id");this.history.addUndoRedoActions(new function(b){this.pageRef=b;this.elementTarget=a;this.idValue=c;this.execute=function(){this.pageRef.refactorElementID(this.elementTarget,this.idValue);this.pageRef.deselectAllElements();this.pageRef.onChange();
this.pageRef.updateInteraction()}}(this),new function(c){this.pageRef=c;this.elementTarget=a;this.idValue=b;this.execute=function(){this.pageRef.refactorElementID(this.elementTarget,this.idValue);this.pageRef.deselectAllElements();this.pageRef.onChange();this.pageRef.updateInteraction()}}(this));this.refactorElementID(a,b);return!0};
_.joinPaths_undable=function(a){a=this.getFilteredElementListByNodeName(a,"path");if(!(2>a.length)){var b={};paper.install(b);paper.setup([640,480]);var c=b.project.importSVG(a[0]);b=b.project.importSVG(a[1]);c.join(b,2);if(c=c.exportSVG()){var d=a[0].getIndex(),e=a[1].getIndex();b=a[0];e>d&&(b=a[1]);b.parentElement.insertBefore(c,b.nextElementSibling);this.deselectAllElements();d=new ReplaceElements_action(this);e=new ReplaceElements_action(this);d.setElementsToReplace(a);e.setElementsToInsert(a);
this.removeElementList(a);c.setGraphicAttributesByElement(b);d.setElementsToInsert([c]);e.setElementsToReplace([c]);this.history.addUndoRedoActions(e,d);this.selectElementList([c]);this.updateInteraction();this.onChange()}}};
_.smoothPath_undable=function(a){a=this.getFilteredElementListByNodeName(a,"path");var b=new ReplaceElements_action(this),c=new ReplaceElements_action(this);this.history.addUndoRedoActions(c,b);b.setElementsToReplace(a);c.setElementsToInsert(a);var d={};paper.install(d);paper.setup([640,480]);for(var e=0;e<a.length;e++){var f=a[e],g=d.project.importSVG(f);g.smooth();g=g.exportSVG();f.parentElement.replaceChild(g,f);g.getPathData({normalize:!0})}b.setElementsToInsert([g]);c.setElementsToReplace([g]);
this.deselectAllElements();this.selectElementList([g]);this.updateInteraction();this.onChange()};
_.simplifyPath_undable=function(a){a=this.getFilteredElementListByNodeName(a,"path");var b=new ReplaceElements_action(this),c=new ReplaceElements_action(this);this.history.addUndoRedoActions(c,b);b.setElementsToReplace(a);c.setElementsToInsert(a);var d={};paper.install(d);paper.setup([640,480]);for(var e=0;e<a.length;e++){var f=a[e],g=d.project.importSVG(f);g.simplify();g=g.exportSVG();f.parentElement.replaceChild(g,f);g.getPathData({normalize:!0})}b.setElementsToInsert([g]);c.setElementsToReplace([g]);
this.deselectAllElements();this.selectElementList([g]);this.updateInteraction();this.onChange()};
_.splitPathAtLocation_undable=function(a,b,c){var d=a.parentElement.globalToLocal(c.x,c.y),e={};paper.install(e);paper.setup([640,480]);a.removeAttribute("selected");c=a.getSubPathList();var f=c[b];var g=a.cloneNode();g.setGeometryPointList(f.geometryPointList);g.render();f=e.project.importSVG(g);d=f.getNearestLocation(d);f.splitAt(d);d=e.project.layers[0].children;console.log("resultList",d);if(0!=d.length){e=[];if(1==c.length)for(b=0;b<d.length;b++)e.push(d[b].exportSVG()),a.parentElement.insertBefore(e[b],
a.nextElementSibling),e[b].setGraphicAttributesByElement(a);else{c=a.cloneNode();c.setSubPathGeometryPointList(b,[]);for(b=0;b<d.length;b++)f=d[b].exportSVG(),f.transformGeometryPointList(c.getTransform().matrix.inverse()),c.setGeometryPointList(c.getGeometryPointList().concat(f.getGeometryPointList()));a.parentElement.insertBefore(c,a.nextElementSibling);e.push(c);c.render()}this.deselectAllElements();b=new ReplaceElements_action(this);c=new ReplaceElements_action(this);b.setElementsToReplace([a]);
c.setElementsToInsert([a]);this.removeElementList([a]);b.setElementsToInsert(e);c.setElementsToReplace(e);this.history.addUndoRedoActions(c,b);this.selectElementList([e[0]]);this.updateInteraction()}};
_.dividePathAtLocation_undable=function(a,b,c){c=a.parentElement.globalToLocal(c.x,c.y);var d={};paper.install(d);paper.setup([640,480]);a.removeAttribute("selected");var e=a.getSubPathList()[b];var f=a.cloneNode();f.setGeometryPointList(e.geometryPointList);f.render();e=d.project.importSVG(f);c=e.getNearestLocation(c);e.divideAt(c);f=d.project.layers[0].children;if(0!=f.length){e=[];for(d=0;d<f.length;d++){var g=f[d].exportSVG(),h=a.cloneNode();g.transformGeometryPointList(h.getTransform().matrix.inverse());
h.setSubPathGeometryPointList(b,g.getGeometryPointList());a.parentElement.insertBefore(h,a.nextElementSibling);e.push(h)}this.deselectAllElements();b=new ReplaceElements_action(this);d=new ReplaceElements_action(this);b.setElementsToReplace([a]);d.setElementsToInsert([a]);this.removeElementList([a]);b.setElementsToInsert(e);d.setElementsToReplace(e);this.history.addUndoRedoActions(d,b);this.selectElementList(e);if(a=this.selectionList[0])for(b=a.getGeometryPointList(),d=a.parentElement.getTransformToElement(a),
c=SVGUtils.createSVGPoint(c._point.x,c._point.y).matrixTransform(d),d=0;d<b.length;d++)if(b[d].x&&.01>Math.abs(b[d].x-c.x)&&.01>Math.abs(b[d].y-c.y)){this.setPen({pointInDocumentSpace:a.localToGlobal(b[d].x,b[d].y)});this.selectPointList([b[d]]);b[d].editable=!0;break}this.updateInteraction()}};
_.separateSubPath_undable=function(a){a=this.getFilteredElementListByNodeName(a,"path");if(0!=a.length){var b=new ReplaceElements_action(this),c=new ReplaceElements_action(this);b.setElementsToReplace(a);c.setElementsToInsert(a);for(var d,e,f,g=[],h=0;h<a.length;h++)if(d=a[h],d.removeAttribute("selected"),f=d.getSubPathList(),console.log("path.selectionInfo",d.selectionInfo),d.selectionInfo&&-1<d.selectionInfo.subPathId){var k=d.parentElement;e=d.cloneNode();e.removeSubPath(d.selectionInfo.subPathId);
k.replaceChild(e,d);e.render();g.push(e);e=d.cloneNode();e.setGeometryPointList(e.clonePointList(f[d.selectionInfo.subPathId].geometryPointList));k.appendChild(e);e.render();g.push(e)}else{for(k=0;k<f.length;k++)e=d.cloneNode(),e.setGeometryPointList(e.clonePointList(f[k].geometryPointList)),d.parentElement.appendChild(e),e.render(),g.push(e);d.parentElement.removeChild(d)}b.setElementsToInsert(g);c.setElementsToReplace(g);this.history.addUndoRedoActions(c,b);this.selectElementList(g);this.updateInteraction()}};
_.removeSubPath_undable=function(a){for(var b,c,d=[],e=[],f=0;f<a.length;f++)b=a[f],b.selectionInfo&&-1<b.selectionInfo.subPathId?(d.push(b),b.removeAttribute("selected"),c=b.cloneNode(),c.removeSubPath(b.selectionInfo.subPathId),e.push(c)):(d.push(b),b.removeAttribute("selected"),e.push(null));if(0!=d.length){this.deselectAllElements();a=new ReplaceElements_action(this);var g=new ReplaceElements_action(this);a.setElementsToReplace(d);g.setElementsToInsert(d);for(f=0;f<d.length;f++)b=d[f],e[f]?(c=
e[f],b.parentElement.replaceChild(c,b),c.renderRequest()):b.parentElement.removeChild(b);e=e.filter(function(a){return null!=a});a.setElementsToInsert(e);g.setElementsToReplace(e);this.history.addUndoRedoActions(g,a);this.selectElementList(e);this.updateInteraction()}};
_.removePathSegments_undable=function(a){console.log("_selectedPointList",a);for(var b,c,d=[],e=0;e<a.length;e++)b=a[e],b.removable=!0,c=b.ownerShapeElement,"path"==c.nodeName&&-1==d.indexOf(c)&&d.push(c);this.deselectAllElements();a=new ReplaceElements_action(this);var f=new ReplaceElements_action(this);a.setElementsToReplace(d);f.setElementsToInsert(d);console.log("ownerPathList",d);var g=[];for(e=0;e<d.length;e++){c=d[e];var h=[];var k=c.getSubPathList();console.log("subPathList",k);for(var l=
0;l<k.length;l++){b=k[l];var n=b.geometryPointList;for(var m=0;m<n.length;m++)b=n[m],"M"!=b.type&&b.removable?console.log("rimosso",b):h.push(b),delete b.removable}b=c.cloneNode();g.push(b);b.setGeometryPointList(b.clonePointList(h));c.parentElement.replaceChild(b,c);b.render()}a.setElementsToInsert(g);f.setElementsToReplace(g);this.history.addUndoRedoActions(f,a);this.selectElementList(g);this.updateInteraction();this.onChange()};
_.convertPathSegmentToRoundedCorner_undable=function(a){var b=a.ownerShapeElement,c=b.getGeometryPointList(),d=c.indexOf(a);if(-1!=d){var e=c[d-1],f=d+1,g=c[f],h=null;if(g&&"Z"==g.type){var k=b.getSubPathMoveToSegmentId(a);if(-1==k)return;h=c[k];f=k+1;g=c[f]}var l="L"!=a.type?b.createGeometryPoint_LINETO(a.x,a.y):b.cloneSegment(a);var n="L"!=g.type?b.createGeometryPoint_LINETO(g.x,g.y):b.cloneSegment(g);var m=a.getAngleFromPoint(e),y=a.getAngleFromPoint(g);g=SVGUtils.createSVGPointPolar(30,m+(y-m)/
2);g.x+=a.x;g.y+=a.y;e=SVGUtils.createSVGPointPolar(30,m);e.x+=a.x;e.y+=a.y;var p=SVGUtils.createSVGPointPolar(30,y);p.x+=a.x;p.y+=a.y;l.x=e.x;l.y=e.y;m=SVGUtils.createSVGPointPolar(30-30*.551915,m);m.x+=a.x;m.y+=a.y;y=SVGUtils.createSVGPointPolar(30-30*.551915,y);y.x+=a.x;y.y+=a.y;a=b.createGeometryPoint_CURVETO_CUBIC(m.x,m.y,y.x,y.y,p.x,p.y);l.ownerShapeElement=n.ownerShapeElement=a.ownerShapeElement=b;console.log("moveToSegment",h);h&&(h=b.createGeometryPoint_MOVETO(e.x,e.y),h.ownerShapeElement=
b,c.replaceAt(h,k),console.log("editableMoveToSegment",h));c.replaceAt(l,d);c.replaceAt(n,f);c.addAt(a,f);b.render();this.updateInteraction();g=b.localToGlobal(g.x,g.y);this.appRef.interaction2D.smartPoints.showPoint1(g.x,g.y);this.onChange()}};
_.convertPathSegmentToCurve_undable=function(a){var b=a.ownerShapeElement,c=b.getGeometryPointList(),d=c.indexOf(a);if(-1==d)return!1;var e=d+1,f=c[e];if(!f)return!1;if(f&&"Z"==f.type){var g=b.getSubPathMoveToSegmentId(a);if(-1==g)return;e=g+1;f=c[e]}var h={};g={};var k=this;this.history.addUndoRedoActions(h,g);h.execute=function(){console.log("undoAction path",b);c.replaceAt(a,d);c.replaceAt(f,e);b.render();k.selectElementList([b]);k.updateInteraction()};var l="L"==a.type?b.createGeometryPoint_CURVETO_QUADRATIC(a.x,
a.y,a.x,a.y):b.cloneSegment(a);var n="L"==f.type?b.createGeometryPoint_CURVETO_QUADRATIC(f.x,f.y,f.x,f.y):b.cloneSegment(f);h=[];"C"==l.type?(l.controlPt2.x=a.x,l.controlPt2.y=a.y,h.push(l.controlPt2)):(l.controlPt1.x=a.x,l.controlPt1.y=a.y,h.push(l.controlPt1));n.controlPt1.x=a.x;n.controlPt1.y=a.y;l.ownerShapeElement=n.ownerShapeElement=b;h.push(n.controlPt1);h.reverse();c.replaceAt(l,d);c.replaceAt(n,e);b.render();this.appRef.tools.translateControlPoint2D_tool.createUndoRedoActionsFlag=!1;this.appRef.tools.translateControlPoint2D_tool.setDraggableControlPointList(h);
this.updateInteraction();g.execute=function(){console.log("redoAction path",b);c.replaceAt(l,d);c.replaceAt(n,e);b.render();k.selectElementList([b]);k.updateInteraction()};this.onChange();return!0};
_.convertPathSegmentToCorner_undable=function(a){var b=a.ownerShapeElement,c=b.getGeometryPointList(),d=c.indexOf(a);console.log("convertPathSegmentToCorner_undable",a);if(-1==d||"M"==a.type)return!1;var e=d+1,f=c[e];if(!f)return!1;if(f&&"Z"==f.type){var g=b.getSubPathMoveToSegmentId(a);if(-1==g)return!1;e=g+1;f=c[e]}g={};var h={},k=this;this.history.addUndoRedoActions(g,h);g.execute=function(){console.log("undoAction path",b);c.replaceAt(a,d);c.replaceAt(f,e);b.render();k.selectElementList([b]);
k.updateInteraction()};var l="L"!=a.type?b.createGeometryPoint_LINETO(a.x,a.y):b.cloneSegment(a);var n="L"!=f.type?b.createGeometryPoint_LINETO(f.x,f.y):b.cloneSegment(f);l.ownerShapeElement=n.ownerShapeElement=b;c.replaceAt(l,d);c.replaceAt(n,e);b.render();h.execute=function(){console.log("redoAction path",b);c.replaceAt(l,d);c.replaceAt(n,e);b.render();k.selectElementList([b]);k.updateInteraction()};this.onChange();return!0};
_.replacePathSegment_undable=function(a,b){var c=b.ownerShapeElement,d=c.getGeometryPointList(),e=d.indexOf(b);a.ownerShapeElement=c;var f={},g={},h=this;this.history.addUndoRedoActions(f,g);f.execute=function(){d.replaceAt(b,e);c.render();h.selectElementList([c]);h.updateInteraction()};d.replaceAt(a,e);c.renderRequest();g.execute=function(){d.replaceAt(a,e);c.render();h.selectElementList([c]);h.updateInteraction()};this.onChange()};
_.booleanPathsOperation_undable=function(a){var b=this.getFilteredElementListByNodeName(this.selectionList,"path,rect,ellipse");if(!(2>b.length)){this.deselectAllElements();var c=new ReplaceElements_action(this),d=new ReplaceElements_action(this);c.setElementsToReplace(b);d.setElementsToInsert(b);b=this.convertElementListToPath(b);if(b=this.sortElementListByIndexZ(b)){var e=b[0];a=this.booleanPathsOperation(e,b[1],a);for(var f=0;f<a.length;f++)e.parentElement.insertBefore(a[f],e.nextElementSibling),
a[f].setGraphicAttributesByElement(e);this.removeElementList(b);c.setElementsToInsert(a);d.setElementsToReplace(a);this.history.addUndoRedoActions(d,c);this.selectElementList(a);this.updateInteraction()}}};
_.unifyPaths_undable=function(a){a=this.getFilteredElementListByNodeName(a,"path");if(!(2>a.length)){a=this.sortElementListByIndexZ(a);this.deselectAllElements();var b=a[0].cloneNode();a[0].parentElement.appendChild(b);for(var c=1;c<a.length;c++)b.unifyPathSegments(a[c]);b.render();c=new ReplaceElements_action(this);var d=new ReplaceElements_action(this);c.setElementsToReplace(a);d.setElementsToInsert(a);this.removeElementList(a);c.setElementsToInsert([b]);d.setElementsToReplace([b]);this.history.addUndoRedoActions(d,
c);this.selectElementList([b]);this.updateInteraction()}};
_.reversePath_undable=function(a){var b=[],c=this.getFilteredElementListByNodeName(a,"path");if(0!=c.length){var d=new ReplaceElements_action(this),e=new ReplaceElements_action(this);d.setElementsToReplace(c);e.setElementsToInsert(c);for(var f=0;f<c.length;f++){a=c[f];a.removeAttribute("selected");var g=a.cloneNode();b.push(g);a.selectionInfo&&-1<a.selectionInfo.subPathId?g.reverseSegments(a.selectionInfo.subPathId):g.reverseSegments();a.parentElement.replaceChild(g,a)}d.setElementsToInsert(b);e.setElementsToReplace(b);
this.history.addUndoRedoActions(e,d);this.selectElementList(b);this.updateInteraction()}};
_.closePath_undable=function(a){var b=[],c=this.getFilteredElementListByNodeName(a,"path");if(0!=c.length){var d=new ReplaceElements_action(this),e=new ReplaceElements_action(this);d.setElementsToReplace(c);e.setElementsToInsert(c);for(var f=0;f<c.length;f++){a=c[f];a.removeAttribute("selected");var g=a.cloneNode();b.push(g);a.selectionInfo&&-1<a.selectionInfo.subPathId?g.closePath(a.selectionInfo.subPathId):g.closePath();g.renderRequest();a.parentElement.replaceChild(g,a)}d.setElementsToInsert(b);
e.setElementsToReplace(b);this.history.addUndoRedoActions(e,d);this.selectElementList(b);this.updateInteraction()}};
_.convertTextElementListToPath_undable=function(a){function b(b){if(d.length==a.length){b=new ReplaceElements_action(e);var c=new ReplaceElements_action(e);e.history.addUndoRedoActions(c,b);b.setElementsToReplace(a);c.setElementsToInsert(a);for(var f=0;f<a.length;f++)a[f].parentElement.replaceChild(d[f],a[f]);b.setElementsToInsert(d);c.setElementsToReplace(d);e.deselectAllElements();e.updateInteraction();e.onChange()}}function c(){e.appRef.alertModalDialog.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The Font file could not be loaded."))}
for(var d=[],e=this,f=0;f<a.length;f++)"TextOnPath"==a[f].getAttribute("data-type")?d.push(a[f].convertTextOnPathToPath(b,c)):d.push(a[f].convertTextBoxToPath(b,c))};function Editing_layer(a){this.pageRef=a.document;this.editableElementRef=a.editableElement}_=Editing_layer.prototype;_.onAdded=function(){console.log("onAdded this.editableElementRef",this.editableElementRef);this.editableElementRef&&this.editableElementRef.classList.add("hidden");this.pageRef.updateIsolateLayerEditingState()};
_.onRemoved=function(){console.log("onRemoved this.editableElementRef",this.editableElementRef);this.editableElementRef&&this.editableElementRef.classList.remove("hidden");this.pageRef.updateIsolateLayerEditingState()};_.cloneAndAppendElementListInPlace=function(a,b,c){c=c||b.getScreenCTM();c=c.inverse();var d=[],e,f=a.length;for(e=0;e<f;e++){var g=a[e];if(g.getScreenCTM){var h=c.multiply(g.getScreenCTM());g=g.cloneNode(!0);g.getTransform().setMatrix(h)}else g=g.cloneNode(!0);b.appendChild(g);d.push(g)}return d};
Extends(ClipEditing_layer,Editing_layer);function ClipEditing_layer(a){ClipEditing_layer.superConstructor.call(this,a);this.classList.add("clip-path")}_=ClipEditing_layer.prototype;
_.enterToEditing=function(){var a=[],b=null,c,d=this.editableElementRef.children.length;for(c=0;c<d;c++){var e=this.editableElementRef.children[c];"clipPath"==e.nodeName?b=e:a.push(e)}console.log("enterToEditing max",d);if(2<d){d=a.length;e=SVGUtils.createGroup();for(c=0;c<d;c++)e.appendChild(a[c].cloneNode(!0));a=[e]}this.cloneAndAppendElementListInPlace(a,this);b&&this.cloneAndAppendElementListInPlace(b.children,this)};
_.exitFromEditing=function(){this.editableElementRef.classList.remove("hidden");if(2>this.children.length)return null;var a=this.pageRef.createClippedContent(this.children);this.editableElementRef.parentElement.replaceChild(a,this.editableElementRef);return a};Extends(GroupEditing_layer,Editing_layer);function GroupEditing_layer(a){GroupEditing_layer.superConstructor.call(this,a);this.editableElementRef=a.editableElement;this.classList.add("g")}_=GroupEditing_layer.prototype;
_.enterToEditing=function(){this.cloneAndAppendElementListInPlace(this.editableElementRef.children,this)};_.exitFromEditing=function(){this.editableElementRef.classList.remove("hidden");if(0==this.children.length)return null;var a=this.editableElementRef.cloneNode();this.cloneAndAppendElementListInPlace(this.children,a,this.editableElementRef.getScreenCTM());this.editableElementRef.parentElement.replaceChild(a,this.editableElementRef);return a};Extends(MaskEditing_layer,Editing_layer);
function MaskEditing_layer(a){MaskEditing_layer.superConstructor.call(this,a);this.classList.add("mask")}_=MaskEditing_layer.prototype;_.enterToEditing=function(){var a=null,b=[],c,d=this.editableElementRef.children.length;for(c=0;c<d;c++){var e=this.editableElementRef.children[c];"mask"==e.nodeName?a=e:b.push(e)}this.cloneAndAppendElementListInPlace(b,this);a&&this.cloneAndAppendElementListInPlace(a.children,this)};
_.exitFromEditing=function(){this.editableElementRef.classList.remove("hidden");if(2>this.children.length)return null;var a=this.children[0],b=[].slice.call(this.children,1);a=this.pageRef.createMaskedContent(a,b);this.editableElementRef.parentElement.replaceChild(a,this.editableElementRef);return a};Extends(SymbolEditing_layer,Editing_layer);
function SymbolEditing_layer(a){SymbolEditing_layer.superConstructor.call(this,a);this.editableElementRef=a.editableElement;this.classList.add("symbol");this.savedViewMatrix=this.savedContentViewMatrix=null}_=SymbolEditing_layer.prototype;_.onAdded=function(){this.savedViewMatrix&&this.pageRef.appRef.workspace.setPageViewByMatrix(this.savedViewMatrix);this.pageRef.setOrigin({x:0,y:0});this.pageRef.updateIsolateLayerEditingState()};_.onRemoved=function(){this.pageRef.updateIsolateLayerEditingState()};
_.onBeforeRemove=function(){this.savedViewMatrix=this.pageRef.content.getTransform().matrix.clone();this.pageRef.appRef.workspace.setPageViewByMatrix(this.savedContentViewMatrix)};
_.enterToEditing=function(){this.savedContentViewMatrix=this.pageRef.content.getTransform().matrix.clone();this.cloneAndAppendElementList(this.editableElementRef.children,this);var a=this.getBBox(),b=parseFloat(this.pageRef.appRef.workspace.parentElement.offsetWidth),c=parseFloat(this.pageRef.appRef.workspace.parentElement.offsetHeight);console.log("enterToEditing bbox",a);this.pageRef.appRef.workspace.fitRectToView(a,b/3,c/3)};
_.exitFromEditing=function(){this.editableElementRef.classList.remove("hidden");if(0==this.children.length)return null;var a=this.editableElementRef.cloneNode();this.cloneAndAppendElementList(this.children,a);this.editableElementRef.parentElement.replaceChild(a,this.editableElementRef);return a};_.cloneAndAppendElementList=function(a,b){var c=[],d,e=a.length;for(d=0;d<e;d++){var f=a[d];f=f.cloneNode(!0);b.appendChild(f);c.push(f)}return c};Extends(PatternEditing_layer,Editing_layer);
function PatternEditing_layer(a){PatternEditing_layer.superConstructor.call(this,a);this.editableElementRef=a.editableElement;this.classList.add("pattern");this.savedViewMatrix=this.savedContentViewMatrix=null}_=PatternEditing_layer.prototype;_.onAdded=function(){this.savedViewMatrix&&this.pageRef.appRef.workspace.setPageViewByMatrix(this.savedViewMatrix);this.pageRef.setOrigin({x:0,y:0});this.pageRef.updateIsolateLayerEditingState()};_.onRemoved=function(){this.pageRef.updateIsolateLayerEditingState()};
_.onBeforeRemove=function(){this.savedViewMatrix=this.pageRef.content.getTransform().matrix.clone();this.pageRef.appRef.workspace.setPageViewByMatrix(this.savedContentViewMatrix)};
_.enterToEditing=function(){this.savedContentViewMatrix=this.pageRef.content.getTransform().matrix.clone();this.cloneAndAppendElementList(this.editableElementRef.children,this);if(this.editableElementRef.hasAttribute("viewBox")){var a=this.editableElementRef.getAttribute("viewBox").split(" ");var b=parseFloat(a[0]);var c=parseFloat(a[1]);var d=parseFloat(a[2]);a=parseFloat(a[3])}else"objectBoundingBox"==this.editableElementRef.getAttribute("patternUnits")?(a=this.pageRef.getElementListGlobalBBox(this.editableElementRef.children),
b=a.x,c=a.y,d=a.width,a=a.height):(b=this.editableElementRef.getAttribute("x")||0,c=this.editableElementRef.getAttribute("y")||0,d=this.editableElementRef.getAttribute("width")||100,a=this.editableElementRef.getAttribute("height")||100);this.patternViewBox=SVGUtils.createRect(b,c,d,a);this.patternViewBox.setAttribute("fill","none");this.patternViewBox.setAttribute("stroke","red");this.patternViewBox.setAttribute("stroke-width","2");this.patternViewBox.classList.add("view-box");this.appendChild(this.patternViewBox);
this.pageRef.appRef.workspace.fitRectToView({x:b,y:c,width:d,height:a},100,100)};
_.exitFromEditing=function(){if(0==this.children.length)return null;var a=this.editableElementRef.cloneNode();if(this.patternViewBox.parentElement){var b=this.patternViewBox.getBBox();var c=SVGUtils.getBBoxPointByLocationName("left-top",b).matrixTransform(this.patternViewBox.getTransformToElement(this.patternViewBox.parentElement));a.setAttribute("viewBox",c.x+" "+c.y+" "+b.width+" "+b.height);console.log("viewBox",c.x+" "+c.y+" "+b.width+" "+b.height)}else b=this.getBBox(),a.setAttribute("viewBox",
"0 0 "+b.width+" "+b.height);a.setAttribute("x","0");a.setAttribute("y","0");a.setAttribute("width",b.width);a.setAttribute("height",b.height);console.log("exitFromEditing newPattern",a);this.cloneAndAppendElementList(this.children,a);document.querySelector("#PROJECT_DEFS defs").replaceChild(a,this.editableElementRef);return a};_.cloneAndAppendElementList=function(a,b){var c=[],d,e=a.length;for(d=0;d<e;d++){var f=a[d];f!=this.patternViewBox&&(f=f.cloneNode(!0),b.appendChild(f),c.push(f))}};
Extends(MarkerEditing_layer,Editing_layer);function MarkerEditing_layer(a){MarkerEditing_layer.superConstructor.call(this,a);this.editableElementRef=a.editableElement;this.classList.add("marker");this.savedViewMatrix=this.savedContentViewMatrix=null}_=MarkerEditing_layer.prototype;_.onAdded=function(){this.savedViewMatrix&&this.pageRef.appRef.workspace.setPageViewByMatrix(this.savedViewMatrix);this.pageRef.setOrigin({x:0,y:0});this.pageRef.updateIsolateLayerEditingState()};_.onRemoved=function(){this.pageRef.updateIsolateLayerEditingState()};
_.onBeforeRemove=function(){this.savedViewMatrix=this.pageRef.content.getTransform().matrix.clone();this.pageRef.appRef.workspace.setPageViewByMatrix(this.savedContentViewMatrix)};
_.enterToEditing=function(){this.savedContentViewMatrix=this.pageRef.content.getTransform().matrix.clone();this.cloneAndAppendElementList(this.editableElementRef.children,this);if(this.editableElementRef.hasAttribute("viewBox")){console.log("il marker contiene la viewBox");var a=this.editableElementRef.getAttribute("viewBox").split(" ");var b=parseFloat(a[0]);var c=parseFloat(a[1]);var d=parseFloat(a[2]);a=parseFloat(a[3])}else c=b=0,d=this.editableElementRef.getAttribute("markerWidth")||20,a=this.editableElementRef.getAttribute("markerHeight")||
20;this.markerViewBox=SVGUtils.createRect(b,c,d,a);this.markerViewBox.setAttribute("fill","none");this.markerViewBox.setAttribute("stroke","red");this.markerViewBox.setAttribute("stroke-width","2");this.markerViewBox.classList.add("view-box");this.appendChild(this.markerViewBox);this.pageRef.appRef.workspace.fitRectToView({x:b,y:c,width:d,height:a},100,100)};
_.exitFromEditing=function(){if(0==this.children.length)return null;var a=this.editableElementRef.cloneNode();if(this.markerViewBox.parentElement){var b=this.markerViewBox.getBBox();var c=SVGUtils.getBBoxPointByLocationName("left-top",b).matrixTransform(this.markerViewBox.getTransformToElement(this.markerViewBox.parentElement));a.setAttribute("viewBox",c.x+" "+c.y+" "+b.width+" "+b.height);c=b.width;b=b.height}else c=this.editableElementRef.getAttribute("markerWidth"),b=this.editableElementRef.getAttribute("markerHeight"),
a.setAttribute("viewBox","0 0 "+c+" "+b);a.setAttribute("markerWidth",c);a.setAttribute("markerHeight",b);this.cloneAndAppendElementList(this.children,a);document.querySelector("#PROJECT_DEFS defs").replaceChild(a,this.editableElementRef);return a};_.cloneAndAppendElementList=function(a,b){var c=[],d,e=a.length;for(d=0;d<e;d++){var f=a[d];f!=this.markerViewBox&&(f=f.cloneNode(!0),b.appendChild(f),c.push(f))}};
function SetAttributes_action(a){this.pageRef=a;this.elementList=[];this.attributeList=[];this.updateDocumentSelection=!0}_=SetAttributes_action.prototype;_.execute=function(){for(var a=this.elementList.length,b=0;b<a;b++)this.pageRef.setAttributeElementList([this.elementList[b]],this.attributeList[b]);this.onExecuteEnd()};
_.onExecuteEnd=function(){this.pageRef.onChange();this.updateDocumentSelection&&(this.pageRef.selectElementList(this.elementList),this.pageRef.setCurrentEditableElement(this.elementList[this.elementList.length-1]));this.pageRef.showSelectionProperties();this.pageRef.updateInteraction()};_.addElementList=function(a,b){for(var c,d,e=a.length,f=0;f<e;f++){c=a[f];this.elementList.push(a[f]);d={};for(var g in b)d[g]=c.getAttribute(g);this.attributeList.push(d)}};
function SetProperties_action(a){this.pageRef=a;this.elementList=[];this.propertyList=[];this.updateDocumentSelection=!1}_=SetProperties_action.prototype;_.execute=function(){for(var a=this.elementList.length,b=0;b<a;b++)this.pageRef.setPropertyElementList([this.elementList[b]],this.propertyList[b]);this.onExecuteEnd()};
_.onExecuteEnd=function(){this.pageRef.onChange();this.updateDocumentSelection&&(this.pageRef.selectElementList(this.elementList),this.pageRef.setCurrentEditableElement(this.elementList[this.elementList.length-1]),this.pageRef.updateInteraction());this.pageRef.showSelectionProperties()};_.addElementList=function(a,b){for(var c,d,e=a.length,f=0;f<e;f++){c=a[f];this.elementList.push(a[f]);d={};for(var g in b)d[g]=c[g];this.propertyList.push(d)}};
function SetMatrix2D_action(a){this.pageRef=a;this.elementList=[];this.matrixList=[];this.updateDocumentSelection=!0;this.isScaleAction=!1;this.contentViewMatrix=null;this.options={}}_=SetMatrix2D_action.prototype;_.execute=function(){var a,b=this.elementList.length;for(a=0;a<b;a++)this.elementList[a].getTransform().setMatrix(this.matrixList[a]);this.onExecuteEnd()};
_.onExecuteEnd=function(){this.pageRef.onChange();this.updateDocumentSelection&&(this.pageRef.selectElementList(this.elementList),this.pageRef.setCurrentEditableElement(this.elementList[this.elementList.length-1]),this.pageRef.updateInteraction())};_.addElementList=function(a){for(var b=a.length,c=0;c<b;c++)this.elementList.push(a[c]),this.matrixList.push(a[c].getTransform().matrix.clone())};
function Scale2D_action(a){this.pageRef=a;this.elementList=[];this.scaleY=this.scaleX=1;this.pivotPt={x:0,y:0};this.localMode=!1;this.contentViewMatrix=null;this.options={}}_=Scale2D_action.prototype;
_.execute=function(){var a=this.pageRef.content.getTransform().matrix.clone();this.pageRef.content.getTransform().setMatrix(this.contentViewMatrix);this.pageRef.scaleElementList(this.elementList,this.scaleX,this.scaleY,this.pivotPt,this.localMode);this.pageRef.content.getTransform().setMatrix(a);this.pageRef.normalizeScaleElementList(this.elementList,this.options);this.pageRef.selectElementList(this.elementList);this.pageRef.onChange();this.pageRef.showSelectionProperties();this.pageRef.updateInteraction()};
_.setElements=function(a,b){this.contentViewMatrix=this.pageRef.content.getTransform().matrix.clone();this.options=b||{scaleStrokeAndEffects:!1,scaleText:!1};for(var c=a.length,d=0;d<c;d++)this.elementList.push(a[d])};function Skew2D_action(a){this.pageRef=a;this.elementList=[];this.skewY=this.skewX=1;this.pivotPt={x:0,y:0};this.localMode=!1;this.contentViewMatrix=null;this.options={}}_=Skew2D_action.prototype;
_.execute=function(){var a=this.pageRef.content.getTransform().matrix.clone();this.pageRef.content.getTransform().setMatrix(this.contentViewMatrix);this.pageRef.skewElementList(this.elementList,this.skewX,this.skewY,this.pivotPt,this.localMode);this.pageRef.content.getTransform().setMatrix(a);this.pageRef.normalizeScaleElementList(this.elementList,this.options);this.pageRef.selectElementList(this.elementList);this.pageRef.onChange();this.pageRef.updateInteraction()};
_.setElements=function(a,b){this.contentViewMatrix=this.pageRef.content.getTransform().matrix.clone();this.options=b||{scaleStrokeAndEffects:!1,scaleText:!1};for(var c=a.length,d=0;d<c;d++)this.elementList.push(a[d])};function InsertElements_action(a){this.pageRef=a;this.actionDataList=[];this.updateDocumentSelection=!0}_=InsertElements_action.prototype;
_.execute=function(){for(var a,b=this.actionDataList.length,c=0;c<b;c++)a=this.actionDataList[c],a.parentElement.appendChild(a.element),a.element.setIndex(a.id);this.onExecuteEnd()};_.onExecuteEnd=function(){this.pageRef.onChange();if(this.updateDocumentSelection){this.pageRef.deselectAllElements();for(var a,b=this.actionDataList.length,c=0;c<b;c++)a=this.actionDataList[c],this.pageRef.selectElement(a.element)}this.pageRef.updateInteraction()};
_.setElements=function(a){for(var b,c=a.length,d=0;d<c;d++)b=a[d],this.actionDataList.push({parentElement:b.parentNode,element:b,id:b.getIndex()})};function RemoveElements_action(a){this.pageRef=a;this.elementList=[];this.updateDocumentSelection=!0}_=RemoveElements_action.prototype;_.execute=function(){this.pageRef.isTextEditing&&this.pageRef.exitFrom_TextEditing();for(var a,b=this.elementList.length,c=0;c<b;c++)a=this.elementList[c],a.parentNode.removeChild(a);this.onExecuteEnd()};
_.onExecuteEnd=function(){this.pageRef.onChange();1==this.updateDocumentSelection&&(this.pageRef.deselectAllElements(),this.pageRef.updateInteraction())};_.setElements=function(a){for(var b=a.length,c=0;c<b;c++)this.elementList.push(a[c])};function SetElementOrderZ_action(a){this.pageRef=a;this.actionDataList=[]}_=SetElementOrderZ_action.prototype;
_.execute=function(){for(var a,b=this.actionDataList.length,c=0;c<b;c++)a=this.actionDataList[c],a.element.setIndex(a.id),this.pageRef.selectElement(a.element);this.pageRef.onChange();this.pageRef.updateInteraction()};_.setElements=function(a){for(var b=a.length,c=0;c<b;c++)this.actionDataList.push({element:a[c],id:a[c].getIndex()})};function SetTextDataStyle_action(a){this.pageRef=a;this.textDataStyle=this.textElement=null;this.updateDocumentSelection=!0}_=SetTextDataStyle_action.prototype;
_.execute=function(){for(var a=this.textDataStyle.length,b=0;b<a;b++)this.textElement.textData.style[this.textDataStartOffset+b]=this.textDataStyle[b];this.textElement.renderRequest();this.onExecuteEnd()};_.onExecuteEnd=function(){this.pageRef.onChange();this.updateDocumentSelection&&!this.textElement.hasAttribute("contenteditable")&&(this.pageRef.selectElementList([this.textElement]),this.pageRef.setCurrentEditableElement(this.textElement),this.pageRef.updateInteraction());this.pageRef.showSelectionProperties()};
_.setTextDataStyleRange=function(a,b,c){this.textElement=a;this.textDataStartOffset=b;this.maxChars=c-this.textDataStartOffset;var d;this.textDataStyle=Array(this.maxChars);for(c=0;c<=this.maxChars;c++)if(a=this.textElement.textData.style[this.textDataStartOffset+c]){b={};for(d in a)b[d]=a[d];this.textDataStyle[c]=b}console.log("undo redo this.textDataStyle",this.textDataStyle);console.log("this.textDataStartOffset",this.textDataStartOffset);console.log("this.maxChars",this.maxChars)};
function InsertTextData_action(a){this.pageRef=a;this.textData=this.textElement=null;this.replaceCharNum=0;this.updateDocumentSelection=!0}_=InsertTextData_action.prototype;_.execute=function(){this.textElement.insertTextData(this.textData.offset,this.textData,this.replaceCharNum);var a=this;this.textElement.renderRequest(null,function(){a.onExecuteEnd()})};
_.onExecuteEnd=function(){this.pageRef.onChange();this.updateDocumentSelection&&(this.textElement.hasAttribute("contenteditable")?this.textElement.setCaretPosition(this.textData.offset+this.textData.text.length):(this.pageRef.deselectAllElements(),this.pageRef.updateInteraction()))};_.setInsertTextDataProperties=function(a,b,c){this.textElement=a;this.textData=b;this.replaceCharNum=c};
function DeleteTextData_action(a){this.pageRef=a;this.textElement=null;this.replaceCharNum=this.offset=0;this.updateDocumentSelection=!0}_=DeleteTextData_action.prototype;_.execute=function(){this.textElement.deleteTextData(this.offset,this.replaceCharNum);var a=this;this.textElement.renderRequest(null,function(){a.onExecuteEnd()})};
_.onExecuteEnd=function(){this.pageRef.onChange();this.updateDocumentSelection&&(this.textElement.hasAttribute("contenteditable")?this.textElement.setCaretPosition(this.offset):(this.pageRef.deselectAllElements(),this.pageRef.updateInteraction()))};_.setDeleteTextDataProperties=function(a,b,c){this.textElement=a;this.offset=b;this.replaceCharNum=c};function SetGeometryPoint2D_action(a){this.pageRef=a;this.actionDataList=[]}_=SetGeometryPoint2D_action.prototype;
_.execute=function(){this.pageRef.deselectAllElements();for(var a,b,c,d,e=this.actionDataList.length,f=0;f<e;f++){b=this.actionDataList[f];a=b.element;b=b.pointDataList;for(var g=b.length,h=0;h<g;h++)c=b[h].point,d=b[h].values,c.x=d.x,c.y=d.y;a.render();this.pageRef.selectElement(a)}this.pageRef.onChange();this.pageRef.updateInteraction()};_.setTransformDataPointList=function(a){this.actionDataList=a};_.addTransformDataPointList=function(a){this.actionDataList.push(a)};
_.addElementAndPointList=function(a,b){b=b||a.getGeometryPointList();for(var c={element:a,pointDataList:[]},d,e=b.length,f=0;f<e;f++)d=b[f],c.pointDataList.push({point:d,values:{x:d.x,y:d.y}});this.actionDataList.push(c)};function ReplaceElements_action(a){this.pageRef=a;this.elementListToAdd_data=[];this.elementListToRemove=[];this.updateDocumentSelection=!0}_=ReplaceElements_action.prototype;
_.execute=function(){var a;var b=this.elementListToRemove.length;for(a=0;a<b;a++){var c=this.elementListToRemove[a];c.parentNode.removeChild(c)}b=this.elementListToAdd_data.length;for(a=0;a<b;a++)c=this.elementListToAdd_data[a],c.parentElement.appendChild(c.element),c.element.setIndex(c.id);this.pageRef.onChange();if(this.updateDocumentSelection)this.onExecuteEnd()};
_.onExecuteEnd=function(){this.pageRef.deselectAllElements();for(var a,b=this.elementListToAdd_data.length,c=0;c<b;c++)a=this.elementListToAdd_data[c],this.pageRef.selectElement(a.element);this.pageRef.updateInteraction()};_.setElementsToReplace=function(a){for(var b=a.length,c=0;c<b;c++)a[c]&&this.elementListToRemove.push(a[c])};_.setElementsToInsert=function(a){for(var b=a.length,c=0;c<b;c++)a[c]&&this.elementListToAdd_data.push({parentElement:a[c].parentNode,element:a[c],id:a[c].getIndex()})};
Extends(Filter2D_panel,Panel);
function Filter2D_panel(a){Filter2D_panel.superConstructor.call(this,a);this.querySelector("#ShadowFilter_contentPanel").connectController(ShadowFilter_contentPanel,a);this.querySelector("#BlurFilter_contentPanel").connectController(BlurFilter_contentPanel,a);this.querySelector("#BevelFilter_contentPanel").connectController(BevelFilter_contentPanel,a);this.querySelector("#ContrastBrightnessFilter_contentPanel").connectController(ContrastBrightnessFilter_contentPanel,a);this.querySelector("#RGBFilter_contentPanel").connectController(RGBFilter_contentPanel,
a);this.querySelector("#SaturateFilter_contentPanel").connectController(SaturateFilter_contentPanel,a);this.querySelector("#HueRotateFilter_contentPanel").connectController(HueRotateFilter_contentPanel,a);this.querySelector("#BrushFilter_contentPanel").connectController(BrushFilter_contentPanel,a);this.querySelector("#FancyGooFilter_contentPanel").connectController(FancyGooFilter_contentPanel,a);this.querySelector("#GenericFilter_contentPanel").connectController(GenericFilter_contentPanel,a);this.connectEvents()}
_=Filter2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){console.log("filter panel",this.isHidden());if(!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){var a=this.appRef.activeEditablePage,b=a.currentEditableElement,c=this.querySelector("#NoneFilter_contentPanel");b&&b.hasAttribute("filter")&&""!=b.getAttribute("filter")&&(a=a.getElementFromProjectDefs(b.getAttribute("filter")),console.log("filter",a),a&&(a.hasAttribute("data-inspector")?(b=this.querySelector('.content > [id="'+a.getAttribute("data-inspector")+
'_contentPanel"]'))&&(c=b):c=this.querySelector("#GenericFilter_contentPanel"),c.update(a)));ShowElement(c)}};_.onClick_showFilterLibrary=function(a){this.appRef.contextPanels.showContextPanel("FILTER_LIBRARY_2D_CONTEXT_PANEL")};Extends(Interactivity2D_panel,Panel);function Interactivity2D_panel(a){Interactivity2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=Interactivity2D_panel.prototype;
_.update=function(){if(!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){var a=this.appRef.activeEditablePage.currentEditableElement;if(a){this.controlledElements.id.value=a.getAttribute("id")||"";this.controlledElements.anchorLink.value=a.getAttribute("data-xlink-href")||"";this.controlledElements.anchorLinkTarget.value=a.getAttribute("data-xlink-target")||"";var b="",c=a.querySelector("title");c&&(b=c.innerHTML);this.controlledElements.title.value=b;b=
"";if(a=a.querySelector("desc"))b=a.innerHTML;this.controlledElements.desc.value=b}else this.controlledElements.id.value="",this.controlledElements.anchorLink.value="",this.controlledElements.anchorLinkTarget.value="",this.controlledElements.title.value="",this.controlledElements.desc.value=""}};_.onChange_id=function(a){var b=this.appRef.activeEditablePage;a=a.target.value;console.log("onChange_id",a);""==a&&(a=null);b.setAttributeElementList_undable(b.selectionList,{id:a})};
_.onChange_title=function(a){var b=this.appRef.activeEditablePage.currentEditableElement,c=b.querySelector("title");""==a.target.value?c&&c.remove():(c||(c=document.createElementNS(SVGElement.SVG_NS,"title"),b.appendChild(c)),c.innerHTML=a.target.value)};_.onChange_desc=function(a){var b=this.appRef.activeEditablePage.currentEditableElement,c=b.querySelector("desc");""==a.target.value?c&&c.remove():(c||(c=document.createElementNS(SVGElement.SVG_NS,"desc"),b.appendChild(c)),c.innerHTML=a.target.value)};
_.onChange_anchorLink=function(a){var b=this.appRef.activeEditablePage;a=a.target.value;""==a&&(a=null);b.setAttributeElementList_undable(b.selectionList,{"data-xlink-href":a})};_.onChange_anchorLinkTarget=function(a){var b=this.appRef.activeEditablePage;a=a.target.value;""==a&&(a=null);b.setAttributeElementList_undable(b.selectionList,{"data-xlink-target":a})};Extends(Transform2D_panel,Panel);
function Transform2D_panel(a){Transform2D_panel.superConstructor.call(this,a);this.bboxPivotLocationName="left-top";this.isLocalMode=!0;this.mantainAspectRatio=!1;this.controlledElements=this.connectEvents()}_=Transform2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};_.onClick_pivot=function(a){SelectElement(a.target);this.bboxPivotLocationName=a.target.getAttribute("id");this.update()};
_.onChange_globalMode=function(a){this.isLocalMode=!a.target.checked;this.appRef.activeEditablePage.updateInteraction()};
_.update=function(){if(this.appRef.activeEditablePage.currentEditableElement){if(this.classList.remove("hidden"),!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){this.activeDoc=this.appRef.activeEditablePage;console.log("update di Transform2D_panel this.activeDoc.selectionList",this.activeDoc.selectionList);this.isLocalMode=1==this.activeDoc.selectionList.length?!0:!1;this.controlledElements.globalMode.checked&&(this.isLocalMode=!1);if(this.isLocalMode){var a=
this.activeDoc.selectionList[0],b=a.getTransform().matrix.decompose();this.controlledElements.rotation.value=this.activeDoc.valueToFixed(180/Math.PI*b.rotation)+" \u00b0";var c=a.getLocalBBox();this.controlledElements.sizeX.value=this.activeDoc.valueToUnit(c.width*b.scaleX);this.controlledElements.sizeY.value=this.activeDoc.valueToUnit(c.height*b.scaleY);var d=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,c).matrixTransform(a.getTransformToElement(a.parentElement));this.controlledElements.positionX.value=
this.activeDoc.valueToUnit(d.x);this.controlledElements.positionY.value=this.activeDoc.valueToUnit(d.y);this.controlledElements.scaleX.value=this.activeDoc.valueToFixed(100*b.scaleX)+" %";this.controlledElements.scaleY.value=this.activeDoc.valueToFixed(100*b.scaleY)+" %";this.controlledElements.skewX.value="0 \u00b0";this.controlledElements.skewY.value="0 \u00b0";c=a.getCTM().getRotation();this.controlledElements["pivot-display"].querySelector(".bbox").setAttribute("style","transform:rotate("+c+"deg)")}else c=
this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList),d=this.activeDoc.content.getCTM().inverse(),c.min=SVGUtils.createSVGPoint(c.min.x,c.min.y).matrixTransform(d),c.max=SVGUtils.createSVGPoint(c.max.x,c.max.y).matrixTransform(d),c.min.x-=this.activeDoc.origin.x,c.min.y-=this.activeDoc.origin.y,c.max.x-=this.activeDoc.origin.x,c.max.y-=this.activeDoc.origin.y,c.x=c.min.x,c.y=c.min.y,c.width=c.max.x-c.min.x,c.height=c.max.y-c.min.y,d=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,
c),console.log("this.activeDoc.origin",this.activeDoc.origin),this.controlledElements.positionX.value=this.activeDoc.valueToUnit(d.x),this.controlledElements.positionY.value=this.activeDoc.valueToUnit(d.y),this.controlledElements.sizeX.value=this.activeDoc.valueToUnit(c.width),this.controlledElements.sizeY.value=this.activeDoc.valueToUnit(c.height),this.controlledElements.rotation.value="0 \u00b0",this.controlledElements.scaleX.value="100 %",this.controlledElements.scaleY.value="100 %",this.controlledElements.skewX.value=
"0 \u00b0",this.controlledElements.skewY.value="0 \u00b0",this.controlledElements["pivot-display"].querySelector(".bbox").setAttribute("style","transform:rotate(0deg)");this.controlledElements.moveX.value="";this.controlledElements.moveY.value="";this.update_mantainAspectRatio()}}else this.classList.add("hidden")};
_.update_mantainAspectRatio=function(a){DeselectElements([this.controlledElements["mantain-aspect-ratio-button"]]);this.isLocalMode?"true"==this.activeDoc.selectionList[0].dataset.mantainAspectRatio&&SelectElement(this.controlledElements["mantain-aspect-ratio-button"]):1==this.mantainAspectRatio&&SelectElement(this.controlledElements["mantain-aspect-ratio-button"])};
_.onChange_positionX=function(a){a=Math.evalExpression(a.target.value);if(!isNaN(a)){a=this.activeDoc.unitToValue(a);if(this.isLocalMode){var b=this.activeDoc.selectionList[0];b=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,b.getLocalBBox()).matrixTransform(b.getTransformToElement(b.parentElement));a-=b.x}else b=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList)),a=SVGUtils.createSVGPoint(a+this.activeDoc.origin.x,
0).matrixTransform(this.activeDoc.content.getCTM()).x-b.x;this.activeDoc.translateElementList_undable(this.activeDoc.selectionList,a,0,this.isLocalMode)}};
_.onChange_positionY=function(a){a=Math.evalExpression(a.target.value);if(!isNaN(a)){a=this.activeDoc.unitToValue(a);if(this.isLocalMode){var b=this.activeDoc.selectionList[0];b=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,b.getLocalBBox()).matrixTransform(b.getTransformToElement(b.parentElement));a-=b.y}else b=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList)),a=SVGUtils.createSVGPoint(0,a+this.activeDoc.origin.y).matrixTransform(this.activeDoc.content.getCTM()).y-
b.y;this.activeDoc.translateElementList_undable(this.activeDoc.selectionList,0,a,this.isLocalMode)}};_.onChange_sizeX=function(a){this.applySizeX(a.target.value)};
_.applySizeX=function(a){var b=Math.evalExpression(a);a=this.appRef.activeEditablePage;if(!isNaN(b)&&0!=b){b=a.unitToValue(b);if(this.isLocalMode){var c=a.selectionList[0].getLocalBBox();var d=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,c);d=d.matrixTransform(a.selectionList[0].getCTM())}else{c=a.getElementListGlobalBBox(a.selectionList);d=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,c);var e=a.content.getCTM().inverse();c.min=SVGUtils.createSVGPoint(c.min.x,c.min.y).matrixTransform(e);
c.max=SVGUtils.createSVGPoint(c.max.x,c.max.y).matrixTransform(e);c.width=c.max.x-c.min.x;c.height=c.max.y-c.min.y}b/=c.width;c=1;this.isLocalMode?"true"==a.selectionList[0].dataset.mantainAspectRatio&&(c=b):1==this.mantainAspectRatio&&(c=b);a.scaleElementList_undable(a.selectionList,b,c,d,this.isLocalMode)}};_.onChange_sizeY=function(a){this.applySizeY(a.target.value)};
_.applySizeY=function(a){var b=Math.evalExpression(a);a=this.appRef.activeEditablePage;if(!isNaN(b)&&0!=b){b=a.unitToValue(b);if(this.isLocalMode){var c=a.selectionList[0].getLocalBBox();var d=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,c);d=d.matrixTransform(a.selectionList[0].getCTM())}else{c=a.getElementListGlobalBBox(a.selectionList);d=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,c);var e=a.content.getCTM().inverse();c.min=SVGUtils.createSVGPoint(c.min.x,c.min.y).matrixTransform(e);
c.max=SVGUtils.createSVGPoint(c.max.x,c.max.y).matrixTransform(e);c.width=c.max.x-c.min.x;c.height=c.max.y-c.min.y}e=1;b/=c.height;this.isLocalMode?"true"==a.selectionList[0].dataset.mantainAspectRatio&&(e=b):1==this.mantainAspectRatio&&(e=b);a.scaleElementList_undable(a.selectionList,e,b,d,this.isLocalMode)}};
_.onChange_rotation=function(a){a=Math.evalExpression(a.target.value);if(!isNaN(a)){if(this.isLocalMode){var b=this.activeDoc.selectionList[0];a-=b.getTransform().matrix.getRotation();b=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,b.getLocalBBox()).matrixTransform(b.getCTM())}else b=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList));this.appRef.activeEditablePage.rotateElementList_undable(this.appRef.activeEditablePage.selectionList,
a,b)}};
_.onChange_scaleX=function(a){a=Math.evalExpression(a.target.value);if(!isNaN(a)&&0!=a){a/=100;if(this.isLocalMode){var b=this.activeDoc.selectionList[0];var c=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,b.getLocalBBox());c=c.matrixTransform(b.getCTM());a/=b.getTransform().matrix.decompose().scaleX}else c=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList));this.activeDoc.scaleElementList_undable(this.activeDoc.selectionList,a,
1,c,this.isLocalMode)}};
_.onChange_scaleY=function(a){a=Math.evalExpression(a.target.value);if(!isNaN(a)&&0!=a){a/=100;if(this.isLocalMode){var b=this.activeDoc.selectionList[0];var c=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,b.getLocalBBox());c=c.matrixTransform(b.getCTM());a/=b.getTransform().matrix.decompose().scaleY}else c=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList));this.activeDoc.scaleElementList_undable(this.activeDoc.selectionList,1,
a,c,this.isLocalMode)}};_.onChange_skewX=function(a){a=Math.evalExpression(a.target.value);if(!isNaN(a)){var b=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList));this.activeDoc.skewElementList_undable(this.activeDoc.selectionList,a,null,b,!1)}};
_.onChange_skewY=function(a){a=Math.evalExpression(a.target.value);if(!isNaN(a)){var b=SVGUtils.getBBoxPointByLocationName(this.bboxPivotLocationName,this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList));this.activeDoc.skewElementList_undable(this.activeDoc.selectionList,null,a,b,!1)}};
_.onChange_moveX=function(a){a=Math.evalExpression(this.controlledElements.moveX.value);isNaN(a)||0==a||(this.activeDoc.moveX=this.activeDoc.unitToValue(a),this.activeDoc.translateElementList_undable(this.activeDoc.selectionList,this.activeDoc.moveX,0,this.isLocalMode))};
_.onChange_moveY=function(a){a=Math.evalExpression(this.controlledElements.moveY.value);isNaN(a)||0==a||(this.activeDoc.moveY=this.activeDoc.unitToValue(a),this.activeDoc.translateElementList_undable(this.activeDoc.selectionList,0,this.activeDoc.moveY,this.isLocalMode))};_.onClick_moveX=function(a){this.onChange_moveX()};_.onClick_moveY=function(a){this.onChange_moveY()};
_.onClick_mantainAspectRatio=function(a){0!=this.activeDoc.selectionList.length&&(a=this.activeDoc.selectionList[0],this.isLocalMode?a.dataset.mantainAspectRatio="true"==a.dataset.mantainAspectRatio?!1:!0:this.mantainAspectRatio=1==this.mantainAspectRatio?!1:!0,this.update_mantainAspectRatio())};_.onClick_reflectHorizontally=function(a){this.appRef.activeEditablePage.reflectElementList_undable(this.appRef.activeEditablePage.selectionList,"horizontally")};
_.onClick_reflectVertically=function(a){this.appRef.activeEditablePage.reflectElementList_undable(this.appRef.activeEditablePage.selectionList,"vertically")};Extends(Pages2D_panel,Panel);function Pages2D_panel(a){Pages2D_panel.superConstructor.call(this,a);this.pageViewList=this.querySelector(".page-view-list");this.pageViewTemplate=this.pageViewList.querySelector(".page-view");this.connectEvents()}_=Pages2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.onClose=function(){this.disablePageRendering()};_.onCollapse=function(){this.disablePageRendering()};_.disablePageRendering=function(){var a=this.pageViewList.querySelector(".selected");a&&(console.log("selectedPageView"),a=a.querySelector("use"),a.storedHref=a.getAttribute("xlink:href"),a.setAttribute("xlink:href",""))};_.enablePageRendering=function(){var a=this.pageViewList.querySelector(".selected");a&&(console.log("selectedPageView"),a=a.querySelector("use"),a.setAttribute("xlink:href",a.storedHref))};
_.update=function(){if(!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){console.log("update di Pages2D_panel");var a=this.appRef.getActiveDocument().querySelectorAll(".page-2D");this.pageViewList.removeChildren();var b,c=a.length;for(b=0;b<c;b++){var d=a[b];var e=d.createPageView(this.pageViewTemplate,120,120);this.pageViewList.appendChild(e);d.classList.contains("showed")?e.classList.add("selected"):e.classList.remove("selected")}}};
_.onClick_newPage=function(){var a=this.appRef.getActiveDocument(),b=a.getActivePage();b=a.addNewPage(b.dataset.width,b.dataset.height);a.setActivePage(b);this.update()};_.onClick_removePage=function(){if(1!=this.pageViewList.children.length){var a=this.pageViewList.querySelector(".selected"),b=a.nextElementSibling||a.previousElementSibling;a.pageRef.remove();a.remove();SelectElement(b);this.appRef.getActiveDocument().setActivePage(b.pageRef)}};
_.onClick_bringPageUp=function(){var a=this.pageViewList.querySelector(".selected");a.sendDown();a.pageRef.sendDown()};_.onClick_sendPageDown=function(){var a=this.pageViewList.querySelector(".selected");a.bringUp();a.pageRef.bringUp()};_.onClick_pageViewList=function(a){"UL"!=a.target.nodeName&&(SelectElement(a.target.parentElement),a=a.target.parentElement.pageRef,this.appRef.getActiveDocument().setActivePage(a))};Extends(Page2D_panel,Panel);
function Page2D_panel(a){Page2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents();this.pageViewTemplate=this.querySelector(".page-view svg");this.pageViewContainer=this.pageViewTemplate.parentElement}_=Page2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};_.onClose=function(){this.disablePageRendering()};_.onCollapse=function(){this.disablePageRendering()};
_.disablePageRendering=function(){this.pageViewContainer.querySelector("use").setAttribute("xlink:href","")};_.enablePageRendering=function(){this.update()};
_.update=function(){if(!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){console.log("update di Page2D_panel");var a=this.appRef.activeEditablePage;this.pageViewContainer.removeChildren();var b=a.createPageView(this.pageViewTemplate,120,120);this.pageViewContainer.appendChild(b);this.controlledElements.pageWidth.value=a.valueToUnit(a.dataset.width);this.controlledElements.pageHeight.value=a.valueToUnit(a.dataset.height);this.controlledElements.drawingScale.value=
a.drawingScale;this.controlledElements.gridStep.value=a.valueToUnit(a.gridStep);this.controlledElements.unitKey.value=a.unitKey;this.controlledElements.fixedDecimals.value=a.fixedDecimals;this.controlledElements.snapAngle.value=a.snapAngle+" \u00b0";this.controlledElements.snapDistance.value=a.snapDistance+" px";this.controlledElements.translationStep.value=a.valueToUnit(a.translationStep);this.controlledElements.rotationStep.value=a.rotationStep+" \u00b0";this.controlledElements.pageMargin.value=
a.valueToUnit(a.pageMargin);this.controlledElements.elementsMargin.value=a.valueToUnit(a.elementsMargin);console.log("Page2D_panel controlledElements",this.controlledElements);this.controlledElements.selectGroupChildren.checked=a.selectGroupChildren;this.controlledElements.scaleStrokeAndEffects.checked=a.drawingProperties.scaleStrokeAndEffects;b="";var c=a.querySelector("title");c&&(b=c.innerHTML);this.controlledElements.title.value=b;b="";if(a=a.querySelector("desc"))b=a.innerHTML;this.controlledElements.desc.value=
b}};_.onClick_layoutTab=function(a){SelectElement(a.target);ShowElement(this.querySelector("#EDIT_PAGE_LAYOUT"))};_.onClick_settingsTab=function(a){SelectElement(a.target);ShowElement(this.querySelector("#EDIT_PAGE_SETTINGS"))};
_.onChange_pageWidth=function(a){a=this.appRef.activeEditablePage;var b=Math.evalExpression(this.controlledElements.pageWidth.value);isNaN(b)||(b=a.unitToValue(b),a.dataset.width=b,this.appRef.workspace.updateActivePageBackground(),this.appRef.workspace.fitActivePageToView(),this.appRef.getActiveDocument().setActivePage(a),this.appRef.pages2DPanel.update())};
_.onChange_pageHeight=function(a){a=this.appRef.activeEditablePage;var b=Math.evalExpression(this.controlledElements.pageHeight.value);isNaN(b)||(b=a.unitToValue(b),a.dataset.height=b,this.appRef.workspace.updateActivePageBackground(),this.appRef.workspace.fitActivePageToView(),this.appRef.getActiveDocument().setActivePage(a),this.appRef.pages2DPanel.update())};
_.onChange_drawingScale=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.drawingScale.value);isNaN(b)||(a.drawingScale=b,this.appRef.getActiveDocument().setActivePage(a))};_.onChange_unitKey=function(a){a=this.appRef.activeEditablePage;a.setUnits(this.controlledElements.unitKey.value);this.appRef.getActiveDocument().setActivePage(a)};
_.onChange_fixedDecimals=function(a){a=this.appRef.activeEditablePage;var b=parseInt(this.controlledElements.fixedDecimals.value);isNaN(b)&&(b=2);a.fixedDecimals=b;this.appRef.getActiveDocument().setActivePage(a)};_.onChange_snapAngle=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.snapAngle.value);isNaN(b)||(a.snapAngle=b)};
_.onChange_snapDistance=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.snapDistance.value);isNaN(snapAngle)||(a.snapDistance=b)};_.onChange_selectGroupChildren=function(a){this.appRef.activeEditablePage.selectGroupChildren=this.controlledElements.selectGroupChildren.checked};_.onChange_scaleStrokeAndEffects=function(a){this.appRef.activeEditablePage.drawingProperties.scaleStrokeAndEffects=this.controlledElements.scaleStrokeAndEffects.checked};
_.onChange_title=function(a){var b=this.appRef.activeEditablePage,c=b.querySelector("title");""==a.target.value?c&&c.remove():(c||(c=document.createElementNS(SVGElement.SVG_NS,"title"),b.appendChild(c)),c.innerHTML=a.target.value)};_.onChange_desc=function(a){var b=this.appRef.activeEditablePage,c=b.querySelector("desc");""==a.target.value?c&&c.remove():(c||(c=document.createElementNS(SVGElement.SVG_NS,"desc"),b.appendChild(c)),c.innerHTML=a.target.value)};
_.onChange_pagePresets=function(a){var b=a.target.value.split(",");a=parseFloat(b[0]);var c=parseFloat(b[1]),d=1;"mm"==b[2]&&(d=this.appRef.activeEditablePage.units.MILLIMETER);b=this.appRef.activeEditablePage;b.dataset.width=a/d;b.dataset.height=c/d;this.appRef.workspace.updateActivePageBackground();this.appRef.pages2DPanel.update();this.appRef.page2DPanel.update();this.appRef.workspace.fitActivePageToView()};
_.onChange_gridStep=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.gridStep);isNaN(b)||(a.gridStep=a.unitToValue(b))};_.onChange_translationStep=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.translationStep.value);isNaN(b)||(b=a.unitToValue(b),a.translationStep=b)};
_.onChange_rotationStep=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.rotationStep.value);isNaN(b)||(a.rotationStep=b)};_.onChange_pageMargin=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.pageMargin.value);isNaN(b)||(b=a.unitToValue(b),a.pageMargin=b)};
_.onChange_elementsMargin=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.elementsMargin.value);isNaN(b)||(b=a.unitToValue(b),a.elementsMargin=b)};_.onClick_applyPageFormatToAllPages=function(a){for(var b=this.appRef.activeEditablePage,c=this.appRef.getActiveDocument().querySelectorAll(".page-2D"),d=0;d<c.length;d++)a=c[d],a.setSize(b.dataset.width,b.dataset.height);this.appRef.pages2DPanel.update()};
_.onClick_applyPageSettingToAllPages=function(a){for(var b=this.appRef.activeEditablePage,c=this.appRef.getActiveDocument().querySelectorAll(".page-2D"),d=0;d<c.length;d++)a=c[d],a.drawingScale=b.drawingScale,a.setUnits(this.controlledElements.unitKey.value),a.fixedDecimals=b.fixedDecimals,a.snapAngle=b.snapAngle,a.snapDistance=b.snapDistance,a.translationStep=b.translationStep,a.rotationStep=b.rotationStep,a.selectGroupChildren=this.controlledElements.selectGroupChildren.checked,a.drawingProperties.scaleStrokeAndEffects=
b.drawingProperties.scaleStrokeAndEffects;this.appRef.workspace.updateActivePageBackground();this.appRef.pages2DPanel.update()};Extends(Layers2D_panel,Panel);function Layers2D_panel(a){Layers2D_panel.superConstructor.call(this,a);this.layerList=this.querySelector(".layer-list");this.layerListItemTemplate=this.layerList.querySelector(".layer-list-item");ConnectEvent("mousedown",this,this.onMouseDown,this);this.connectEvents()}_=Layers2D_panel.prototype;
_.update=function(){var a=this.appRef.activeEditablePage;if(!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){console.log("update di Layers2D_panel");this.layerList.removeChildren();a=a.getLayersContainer().children;var b;for(b=a.length-1;-1<b;b--){var c=a[b];var d=this.layerListItemTemplate.cloneNode(!0);c.classList.contains("hidden")?d.classList.remove("visible"):d.classList.add("visible");c.classList.contains("locked")&&d.classList.add("locked");c.classList.contains("selected")&&
d.classList.add("selected");d.querySelector(".label").innerHTML=c.getAttribute("name");d.querySelector(".color-button").style.backgroundColor=c.dataset.color;d.layerRef=c;this.layerList.appendChild(d)}}};_.onMouseDown=function(a){this.lastMouseDownTime=(new Date).getTime()};
_.onClick_layerList=function(a){a=a.target;if("INPUT"!=a.nodeName&&"UL"!=a.nodeName){var b=a;console.log("clickedElement",a);console.log("parentElement.parentElement",a.parentElement.parentElement);if(!a.classList.contains("color-button"))if(a.classList.contains("item-visible_icon"))b=a.parentElement.parentElement,this.onClick_hide(b);else if(a.classList.contains("item-locked_icon"))b=a.parentElement.parentElement,this.onClick_lock(b);else if(a.classList.contains("label")&&(b=a.parentElement,b.classList.contains("selected")&&
250<(new Date).getTime()-this.lastMouseDownTime)){this.editLayerName(a);return}console.log("element_li",b);this.appRef.activeEditablePage.setActivePageLayer(b.layerRef);this.appRef.activeEditablePage.showSelectionProperties()}};
_.editLayerName=function(a){console.log("editLayerName",a);var b=a.textContent;a.removeChildren();var c=document.createElement("input");c.setAttribute("type","text");c.setAttribute("class","inputNodeName");c.setAttribute("value",b);c.previousValue=b;var d=this;ConnectEvent("change",c,function(a){this.blur()});ConnectEvent("blur",c,function(b){this.value!=this.previousValue&&(a.innerHTML=d.onEndEditLayerName(this));a.innerHTML=this.value});a.appendChild(c);c.focus();console.log("editLayerName",a)};
_.onEndEditLayerName=function(a){a.parentElement.parentElement.layerRef.setAttribute("name",a.value);return a.value};_.onClick_hide=function(a){a.classList.toggle("visible");a.layerRef.classList.toggle("hidden");this.appRef.activeEditablePage.deselectAllElements();this.appRef.activeEditablePage.updateInteraction()};_.onClick_lock=function(a){a.classList.toggle("locked");a.layerRef.classList.toggle("locked");this.appRef.activeEditablePage.deselectAllElements();this.appRef.activeEditablePage.updateInteraction()};
_.onClick_newLayer=function(){var a=this.layerList.childNodes.length;a=this.appRef.activeEditablePage.createLayer(LOCALIZER.translate("Layer")+" "+a,ColorUtils.rainbow(12,a));this.appRef.activeEditablePage.addLayer_undable(a);this.appRef.activeEditablePage.showSelectionProperties()};_.onClick_removeLayer=function(){var a=this.layerList.querySelector(".selected");a.remove();this.appRef.activeEditablePage.removeLayer_undable(a.layerRef);this.appRef.activeEditablePage.showSelectionProperties()};
_.onClick_bringLayerUp=function(){var a=this.layerList.querySelector(".selected");a.sendDown();a.layerRef.bringUp()};_.onClick_sendLayerDown=function(){var a=this.layerList.querySelector(".selected");a.bringUp();a.layerRef.sendDown()};_.onClick_placeSelectionInActiveLayer=function(){var a=this.layerList.querySelector(".selected");this.appRef.activeEditablePage.placeElementListInLayer_undable(this.appRef.activeEditablePage.selectionList,a.layerRef)};Extends(FillStroke2D_panel,Panel);
function FillStroke2D_panel(a){FillStroke2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents();this.colorEditor2DPanel=this.querySelector("#COLOR_EDITOR").connectController(ColorEditor2D_panel,a);this.gradientEditor2DPanel=this.querySelector("#GRADIENT_EDITOR").connectController(GradientEditor2D_panel,a);this.noneEditor2DPanel=this.querySelector("#NONE_EDITOR");this.activeGraphicSideTarget="stroke";this.fillStrokeDisplay=document.querySelector("#FILL_STROKE_DISPLAY");
this.strokeDisplay=this.fillStrokeDisplay.querySelector("#STROKE_DISPLAY");this.fillDisplay=this.fillStrokeDisplay.querySelector("#FILL_DISPLAY");this.editablePatternDef=this.editableGradientDef=null;this.editableGradientInstance=document.querySelector("#EDITABLE_GRADIENT_INSTANCE");this.lastUsedGradientInstance=document.querySelector("#LAST_USED_GRADIENT_INSTANCE")}_=FillStroke2D_panel.prototype;
_.update=function(){if(!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){var a=this.appRef.activeEditablePage;this.editableGradientDef||(this.editableGradientDef=document.querySelector("#IDI_DEFAULT_GRADIENT").cloneNode(!0),a.addElementToProjectDefs(this.editableGradientDef),this.editablePatternDef=document.querySelector("#IDI_DEFAULT_PATTERN").cloneNode(!0),a.addElementToProjectDefs(this.editablePatternDef));this.update_strokeDisplay();this.update_fillDisplay();
this.update_activeGraphicSideTarget()}};
_.update_activeGraphicSideTarget=function(a){a=this.appRef.activeEditablePage;var b=a.getDrawingProperty(this.activeGraphicSideTarget);if("none"==b)SelectElement(this.querySelector("#STYLE_TYPES #NONE_STYLE")),ShowElement(this.querySelector("#LIBRARY_BUTTONS #COLORS")),ShowElement(this.noneEditor2DPanel);else if(-1<b.indexOf("url"))if(a=a.getElementFromDocumentByIRI(b),"pattern"==a.nodeName)this.editablePatternDef=a,SelectElement(this.querySelector("#STYLE_TYPES #PATTERN_STYLE")),ShowElement(this.querySelector("#LIBRARY_BUTTONS #PATTERNS")),
a=this.editablePatternDef.getAttribute("id"),document.querySelector("#PATTERN_DISPLAY").setAttribute("fill","url(#"+a+")");else{if("linearGradient"==a.nodeName||"radialGradient"==a.nodeName)this.editableGradientDef=a,SelectElement(this.querySelector("#STYLE_TYPES #GRADIENT_STYLE")),ShowElement(this.querySelector("#LIBRARY_BUTTONS #GRADIENTS")),ShowElement(this.gradientEditor2DPanel),this.gradientEditor2DPanel.update(a)}else SelectElement(this.querySelector("#STYLE_TYPES #COLOR_STYLE")),ShowElement(this.querySelector("#LIBRARY_BUTTONS #COLORS")),
ShowElement(this.colorEditor2DPanel),this.colorEditor2DPanel.update();this.lastUsedGradientInstance.setAttribute("xlink:href","#"+this.editableGradientDef.getAttribute("id"))};_.update_strokeDisplay=function(a){a=this.appRef.activeEditablePage;this.strokeDisplay.setAttribute("stroke",a.getDrawingProperty("stroke"));this.strokeDisplay.setAttribute("stroke-opacity",a.getDrawingProperty("stroke-opacity"))};
_.update_fillDisplay=function(a){a=this.appRef.activeEditablePage;var b=a.getDrawingProperty("fill");if(-1<b.indexOf("url")){var c=a.getElementFromDocumentByIRI(b);console.log("update_fillDisplay",c);"radialGradient"==c.nodeName?(this.editableGradientInstance.setAttribute("xlink:href","#"+c.getAttribute("id")),b="url(#EDITABLE_GRADIENT_RADIAL)"):"linearGradient"==c.nodeName&&(this.editableGradientInstance.setAttribute("xlink:href","#"+c.getAttribute("id")),b="url(#EDITABLE_GRADIENT_LINEAR)")}this.fillDisplay.setAttribute("fill",
b);this.fillDisplay.setAttribute("fill-opacity",a.getDrawingProperty("fill-opacity"))};_.setCurrentGraphicSideTarget=function(a){this.activeGraphicSideTarget=a;"fill"==this.activeGraphicSideTarget?(this.fillDisplay.parentElement.appendChild(this.fillDisplay),SelectElement(this.fillDisplay)):"stroke"==this.activeGraphicSideTarget&&(this.strokeDisplay.parentElement.appendChild(this.strokeDisplay),SelectElement(this.strokeDisplay));this.update()};
_.onClick_strokeDisplay=function(a){this.activeGraphicSideTarget="stroke";a.target.parentElement.parentElement.appendChild(a.target.parentElement);var b=a.target.parentElement.classList.contains("selected");SelectElement(a.target.parentElement);this.update();b&&(a=this.querySelector("#STYLE_TYPES>.selected").getAttribute("id"),"COLOR_STYLE"==a?this.colorEditor2DPanel.showColorPicker():"GRADIENT_STYLE"==a?this.appRef.contextPanels.showContextPanel("GRADIENT_PROPERTIES_CONTEXT_PANEL"):"PATTERN_STYLE"==
a&&this.appRef.contextPanels.showContextPanel("PATTERN_PROPERTIES_CONTEXT_PANEL"))};
_.onClick_fillDisplay=function(a){this.activeGraphicSideTarget="fill";a.target.parentElement.parentElement.appendChild(a.target.parentElement);var b=a.target.parentElement.classList.contains("selected");SelectElement(a.target.parentElement);this.update();b&&(a=this.querySelector("#STYLE_TYPES>.selected").getAttribute("id"),"COLOR_STYLE"==a?this.colorEditor2DPanel.showColorPicker():"GRADIENT_STYLE"==a?this.appRef.contextPanels.showContextPanel("GRADIENT_PROPERTIES_CONTEXT_PANEL"):"PATTERN_STYLE"==
a&&this.appRef.contextPanels.showContextPanel("PATTERN_PROPERTIES_CONTEXT_PANEL"))};
_.onClick_colorStyle=function(a){console.log("onClick_colorStyle",a.target);a.target.classList.contains("selected");a=this.appRef.activeEditablePage;var b=this.colorEditor2DPanel.colorDisplay.getAttribute("fill"),c=this.colorEditor2DPanel.colorDisplay.getAttribute("fill-opacity");if(0<a.selectionList.length){var d={};d[this.activeGraphicSideTarget]=b;d[this.activeGraphicSideTarget+"-opacity"]=c;a.setAttributeElementList_undable(a.selectionList,d)}a.setDrawingProperty(this.activeGraphicSideTarget,
b);a.setDrawingProperty(this.activeGraphicSideTarget+"-opacity",c);this.update()};
_.onClick_gradientStyle=function(a){a.target.classList.contains("selected");console.log("onClick_gradientStyle",a.target);a=this.appRef.activeEditablePage;var b="url(#"+this.editableGradientDef.getAttribute("id")+")";if(0<a.selectionList.length){this.editableGradientDef=this.editableGradientDef.cloneNode(!0);b=a.addElementToProjectDefs(this.editableGradientDef);var c={};c[this.activeGraphicSideTarget]=b;a.setAttributeElementList_undable(a.selectionList,c)}a.setDrawingProperty(this.activeGraphicSideTarget,
b);this.update()};_.onClick_patternStyle=function(a){a.target.classList.contains("selected");console.log("onClick_patternStyle",a.target);a=this.appRef.activeEditablePage;var b=this.editablePatternDef.getAttribute("id");if(0<a.selectionList.length){var c={};c[this.activeGraphicSideTarget]="url(#"+b+")";a.setAttributeElementList_undable(a.selectionList,c)}a.setDrawingProperty(this.activeGraphicSideTarget,"url(#"+b+")");this.update()};
_.onClick_noneStyle=function(a){a=this.appRef.activeEditablePage;if(0<a.selectionList.length){var b={};b[this.activeGraphicSideTarget]="none";a.setAttributeElementList_undable(a.selectionList,b);a.setCurrentEditableElement(a.currentEditableElement)}else a.setDrawingProperty(this.activeGraphicSideTarget,"none");this.update()};
_.onClick_swapFillStroke=function(a){a=this.appRef.activeEditablePage;var b={};b.stroke=a.getDrawingProperty("fill");b["stroke-opacity"]=a.getDrawingProperty("fill-opacity");b.fill=a.getDrawingProperty("stroke");b["fill-opacity"]=a.getDrawingProperty("stroke-opacity");a.setAttributeElementList_undable(a.selectionList,b);a.updateDrawingPropertiesByObjectKeyValue(b);"fill"==this.activeGraphicSideTarget?this.setCurrentGraphicSideTarget("stroke"):this.setCurrentGraphicSideTarget("fill")};
_.onClick_popupMenuEdit2D=function(a){this.appRef.contextPanels.showContextPanel("EDIT_2D_CONTEXT_MENU")};_.onClick_showColorLibrary=function(a){this.appRef.contextPanels.showContextPanel("COLOR_LIBRARY_2D_CONTEXT_PANEL")};_.onClick_showGradientLibrary=function(a){this.appRef.contextPanels.showContextPanel("GRADIENT_LIBRARY_2D_CONTEXT_PANEL")};_.onClick_showPatternLibrary=function(a){this.appRef.contextPanels.showContextPanel("PATTERN_LIBRARY_2D_CONTEXT_PANEL")};Extends(Stroke2D_panel,Panel);
function Stroke2D_panel(a){Stroke2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents();this.strokeLineCapDisplay=this.querySelector("#STROKE_LINE_CAP_DISPLAY");this.strokeLineJoinDisplay=this.querySelector("#STROKE_LINE_JOIN_DISPLAY");document.querySelector("#STROKE_LINE_JOIN_MENU").connectEvents(this,this.controlledElements);document.querySelector("#STROKE_LINE_CAP_MENU").connectEvents(this,this.controlledElements)}_=Stroke2D_panel.prototype;_.onOpen=function(){this.update()};
_.onExpand=function(){this.update()};
_.update=function(){if(!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){var a=this.appRef.activeEditablePage;this.controlledElements.strokeWidth.value=a.valueToFixed(a.getDrawingProperty("stroke-width"))+" px";this.controlledElements.strokeMiterLimit.value=a.getDrawingProperty("stroke-miterlimit")+" px";"non-scaling-stroke"==a.getDrawingProperty("vector-effect")?this.controlledElements.nonScalingStroke.checked=!0:this.controlledElements.nonScalingStroke.checked=!1;
this.update_strokeLineCap();this.update_strokeLineJoin()}};_.onClick_strokeWidthButton=function(a){this.appRef.contextPanels.showContextPanel("STROKE_WIDTH_LIBRARY_2D_CONTEXT_PANEL")};_.onClick_strokeDashButton=function(a){this.appRef.contextPanels.showContextPanel("STROKE_DASH_ARRAY_LIBRARY_2D_CONTEXT_PANEL")};_.onClick_strokeLineJoinButton=function(a){this.appRef.contextPanels.showContextPanel("STROKE_LINE_JOIN_MENU")};_.onClick_strokeLineCapButton=function(a){this.appRef.contextPanels.showContextPanel("STROKE_LINE_CAP_MENU")};
_.update_strokeLineCap=function(a){a=this.appRef.activeEditablePage.getDrawingProperty("stroke-linecap");this.strokeLineCapDisplay.querySelector("a").setAttribute("class","strokeLineCap_"+a+"_icon")};_.update_strokeLineJoin=function(a){a=this.appRef.activeEditablePage.getDrawingProperty("stroke-linejoin");this.strokeLineJoinDisplay.querySelector("a").setAttribute("class","strokeLineJoin_"+a+"_icon")};
_.onClick_strokeCapList=function(a){var b=this.appRef.activeEditablePage;a=a.target.getAttribute("value");0<b.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,{"stroke-linecap":a});b.setDrawingProperty("stroke-linecap",a);this.update_strokeLineCap()};
_.onClick_strokeJoinList=function(a){var b=this.appRef.activeEditablePage;a=a.target.getAttribute("value");0<b.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,{"stroke-linejoin":a});b.setDrawingProperty("stroke-linejoin",a);this.update_strokeLineJoin()};
_.onChange_strokeWidth=function(a){a=parseFloat(a.target.value);isNaN(a)&&(a=1);var b=this.appRef.activeEditablePage;0<b.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,{"stroke-width":a});b.setDrawingProperty("stroke-width",a)};
_.onChange_strokeMiterLimit=function(a){a=parseFloat(a.target.value);console.log("onChange_strokeMiterLimit",a);1>a&&(a=1);var b=this.appRef.activeEditablePage;0<b.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,{"stroke-miterlimit":a});b.setDrawingProperty("stroke-miterlimit",a)};
_.onChange_nonScalingStroke=function(a){var b=this.appRef.activeEditablePage,c=null;a.target.checked&&(c="non-scaling-stroke");0<b.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,{"vector-effect":c})};Extends(Appearance2D_panel,Panel);function Appearance2D_panel(a){Appearance2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=Appearance2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){if(!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){var a=this.appRef.activeEditablePage;this.controlledElements.opacitySlider.value=a.valueToFixed(100*a.getDrawingProperty("opacity"));this.controlledElements.opacity.value=this.controlledElements.opacitySlider.value+" %";this.controlledElements.mixBlendMode.value=a.getDrawingProperty("mixBlendMode");this.controlledElements.paintOrder.value=a.getDrawingProperty("paint-order")}};
_.onChange_opacity=function(a){var b=this.appRef.activeEditablePage;0<b.selectionList.length&&(a=parseFloat(a.target.value),isNaN(a)||(0<a&&(a/=100),b.setAttributeElementList_undable(b.selectionList,{opacity:a})))};_.onInputRange_opacity=function(a){this.controlledElements.opacity.value=a.target.value+" %"};_.onChange_paintOrder=function(a){var b=this.appRef.activeEditablePage;0<b.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,{"paint-order":a.target.value})};
_.onChange_nonScalingStroke=function(a){var b=this.appRef.activeEditablePage,c=null;a.target.checked&&(c="non-scaling-stroke");0<b.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,{"vector-effect":c})};
_.onChange_mixBlendMode=function(a){for(var b=this.appRef.activeEditablePage,c=[],d=0;d<b.selectionList.length;d++)b.selectionList[d].style&&c.push(b.selectionList[d].style);b.setPropertyElementList_undable(c,{mixBlendMode:a.target.value});b.setDrawingProperty("mixBlendMode",a.target.value)};function ColorEditor2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.colorDisplay=document.querySelector("#COLOR_DISPLAY");this.controlledElements=this.connectEvents()}_=ColorEditor2D_panel.prototype;
_.onShow=function(){this.appRef.colorPickerPanel.setOnChangeEvents()};_.update=function(){var a=this.appRef.activeEditablePage,b=this.appRef.fillStroke2DPanel,c=a.getDrawingProperty(b.activeGraphicSideTarget);a=a.getDrawingProperty(b.activeGraphicSideTarget+"-opacity");this.colorDisplay.setAttribute("fill",c);this.colorDisplay.setAttribute("fill-opacity",a);this.appRef.colorPickerPanel.setColor(c,a)};_.onClick_colorDisplay=function(a){this.showColorPicker()};
_.showColorPicker=function(){var a=this.appRef.activeEditablePage,b=this.appRef.fillStroke2DPanel;this.appRef.contextPanels.showContextPanel("COLOR_PICKER_CONTEXT_PANEL");var c=this;this.appRef.colorPickerPanel.setOnChangeEvents(function(d){var e=d.getColorAsHex();c.colorDisplay.setAttribute("fill",e);c.colorDisplay.setAttribute("fill-opacity",d.alpha);a.setDrawingProperty(b.activeGraphicSideTarget,e);a.setDrawingProperty(b.activeGraphicSideTarget+"-opacity",d.alpha);var f={};f[b.activeGraphicSideTarget]=
e;f[b.activeGraphicSideTarget+"-opacity"]=d.alpha;a.setAttributeElementList_undable(a.selectionList,f);"stroke"==b.activeGraphicSideTarget?b.update_strokeDisplay():b.update_fillDisplay()})};_.onClick_showColorLibrary=function(a){this.appRef.contextPanels.showContextPanel("COLOR_LIBRARY_2D_CONTEXT_PANEL")};_.onClick_showUsedColors=function(a){this.appRef.contextPanels.showContextPanel("COLOR_USED_2D_PANEL")};
function GradientEditor2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.gradientColorList=this.querySelector("#GRADIENT_COLOR_LIST");this.gradientColorTemplate=this.querySelector(".templates #EDITABLE_GRADIENT_COLOR");this.editableGradientInstance=document.querySelector("#EDITABLE_GRADIENT_INSTANCE");this.controlledElements=this.connectEvents()}_=GradientEditor2D_panel.prototype;_.onShow=function(){this.appRef.colorPickerPanel.setOnChangeEvents()};
_.update=function(){var a=this.appRef.fillStroke2DPanel.editableGradientDef;a&&(a=a.getAttribute("id"),this.editableGradientInstance.setAttribute("xlink:href","#"+a),this.createEditableStopColorViews())};
_.createEditableStopColorViews=function(){var a=this.appRef.fillStroke2DPanel.editableGradientDef;a.sortStopColors();this.gradientColorList.removeChildren();for(var b=a.children.length,c=0;c<b;c++){var d=a.children[c];d.stylePropertiesToAttributes();var e=this.gradientColorTemplate.cloneNode(!0);e.stopColorRef=d;e.setAttribute("fill",d.getAttribute("stop-color"));this.gradientColorList.appendChild(e);e.placeAt(150*d.offset.baseVal,12)}};
_.onMouseUp_gradientColorList=function(a){console.log("onMouseUp_gradientColorList");this.appRef.contextPanels.showContextPanel("COLOR_PICKER_CONTEXT_PANEL")};
_.onMouseDown_gradientColorList=function(a){console.log("onMouseDown_gradientColorList",a.target);var b=this.appRef.fillStroke2DPanel.editableGradientDef;"rect"==a.target.nodeName?this.selectGradientColorView(a.target.parentElement):"svg"==a.target.nodeName&&(a=this.gradientColorList.screenToLocal(GMOUSE.mouseMovePt.x,GMOUSE.mouseMovePt.y).x/150,a=b.insertNewStopColor(a),this.appRef.activeEditablePage.createAddGradientStopColor_undable(b,a),this.appRef.colorPickerPanel.setColor(a.getAttribute("stop-color"),
a.getAttribute("stop-opacity")),this.update(),this.appRef.interaction2D.gradientPoints2D.update(),this.selectGradientColorView(this.gradientColorList.querySelector('g[fill="'+a.getAttribute("stop-color")+'"]')))};
_.selectGradientColorView=function(a){SelectElement(a);var b=a.stopColorRef,c=b.getAttribute("stop-color"),d=b.getAttribute("stop-opacity")||1;this.appRef.colorPickerPanel.setColor(c,d);var e=this;this.appRef.colorPickerPanel.setOnChangeEvents(function(c){var d=c.getColorAsHex();a.setAttribute("fill",d);e.appRef.activeEditablePage.setAttributeElementList_undable([b],{"stop-color":d,"stop-opacity":c.alpha},!1);"stroke"==e.appRef.fillStroke2DPanel.activeGraphicSideTarget?e.appRef.fillStroke2DPanel.update_strokeDisplay():
e.appRef.fillStroke2DPanel.update_fillDisplay();e.update();e.appRef.interaction2D.gradientPoints2D.update();e.refreshPanels()});GMOUSE.globalMouseTargetDelegate=this};_.refreshPanels=function(a){this.editableGradientInstance.setAttribute("xlink:href","#"+this.appRef.fillStroke2DPanel.editableGradientDef.getAttribute("id"));this.appRef.activeEditablePage.refresh();this.appRef.fillStroke2DPanel.fillStrokeDisplay.refresh()};
_.onGlobalMouseStartDrag=function(a){a=this.gradientColorList.querySelector(".selected").stopColorRef;a.storedOffsetValue=a.getAttribute("offset")};
_.onGlobalMouseDrag=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=this.gradientColorList.querySelector(".selected"),c=b.stopColorRef,d=this.gradientColorList.screenToLocal(GMOUSE.mouseMovePt.x,GMOUSE.mouseMovePt.y);b.classList.remove("hidden");0>d.x&&(2<this.gradientColorList.children.length?b.classList.add("hidden"):d.x=0);150<d.x&&(2<this.gradientColorList.children.length?b.classList.add("hidden"):d.x=150);b.placeAt(d.x,12);c.setAttribute("offset",String(d.x/150));a.sortStopColors();
this.refreshPanels()};
_.onGlobalMouseEndDrag=function(a){a=this.gradientColorList.querySelector(".selected");var b=a.stopColorRef;a.classList.contains("hidden")?(b.setAttribute("offset",b.storedOffsetValue),delete b.storedOffsetValue,this.appRef.activeEditablePage.removeGradientStopColor_undable(b),this.createEditableStopColorViews()):(this.appRef.activeEditablePage.createGradientStopColorOffsetUndoRedoActions(b,b.storedOffsetValue,b.getAttribute("offset")),delete b.storedOffsetValue);this.update();this.appRef.interaction2D.gradientPoints2D.update()};
function GradientProperties2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.controlledElements=this.connectEvents()}_=GradientProperties2D_panel.prototype;_.onShow=function(){this.update()};
_.update=function(){var a=this.appRef.fillStroke2DPanel.editableGradientDef,b=a.nodeName;console.log("gradientType",b);SelectElement(this.querySelector("#GRADIENT_TYPE_"+b));var c=a.getAttribute("spreadMethod")||"pad";SelectElement(this.querySelector("#GRADIENT_SPREAD_METHOD_"+c));c=a.getAttribute("gradientUnits")||"objectBoundingBox";this.controlledElements.gradientUnits.value=c;this.controlledElements.id.value=a.getAttribute("id");var d=this.appRef.activeEditablePage;if("linearGradient"==b){ShowElement(this.querySelector("#LINEAR_GRADIENT_PROPERTIES"));
b=d.valueToFixed(a.getAttribute("x1"));var e=d.valueToFixed(a.getAttribute("y1"));var f=d.valueToFixed(a.getAttribute("x2"));a=d.valueToFixed(a.getAttribute("y2"));"objectBoundingBox"!=c&&"userSpaceOnUse"==c&&(b+=" px",e+=" px",f+=" px",a+=" px");this.controlledElements.x1.value=b;this.controlledElements.y1.value=e;this.controlledElements.x2.value=f;this.controlledElements.y2.value=a}else{ShowElement(this.querySelector("#RADIAL_GRADIENT_PROPERTIES"));var g="",h="";b=d.valueToFixed(a.getAttribute("cx"));
e=d.valueToFixed(a.getAttribute("cy"));f=d.valueToFixed(a.getAttribute("r"));a.hasAttribute("fx")&&(g=d.valueToFixed(a.getAttribute("fx")));a.hasAttribute("fy")&&(h=d.valueToFixed(a.getAttribute("fy")));"objectBoundingBox"!=c&&"userSpaceOnUse"==c&&(b+=" px",e+=" px",f+=" px",""!=g&&(g+=" px"),""!=h&&(h+=" px"));this.controlledElements.cx.value=b;this.controlledElements.cy.value=e;this.controlledElements.r.value=f;this.controlledElements.fx.value=g;this.controlledElements.fy.value=h}};
_.onChange_gradientID=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.appRef.fillStroke2DPanel.editableGradientDef,a)&&(this.appRef.activeEditablePage.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,"url(#"+a+")"),this.appRef.fillStroke2DPanel.update(),this.update())};
_.onClick_cloneGradient=function(a){var b=this.appRef.activeEditablePage,c=this.appRef.fillStroke2DPanel.editableGradientDef.cloneNode(!0);c=b.addElementToProjectDefs(c);var d={};d[this.appRef.fillStroke2DPanel.activeGraphicSideTarget]=c;b.setAttributeElementList_undable(b.selectionList,d);b.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,c);b.showSelectionProperties();this.update();FlipElement(a.target.parentElement.parentElement.parentElement)};
_.onClick_gradientType=function(a){var b=this.appRef.fillStroke2DPanel.editableGradientDef,c=b.nodeName,d=null,e=a.target.parentElement.getAttribute("id").split("_")[2];console.log("newGradientType",e);a=this.appRef.activeEditablePage;"radialGradient"==e&&"linearGradient"==c?d=SVGUtils.createSVGRadialGradient(b.id,.5,.5,.5,"objectBoundingBox",b.getAttribute("spreadMethod")):"linearGradient"==e&&"radialGradient"==c&&(d=SVGUtils.createSVGLinearGradient(b.id,0,.5,1,.5,"objectBoundingBox",b.getAttribute("spreadMethod")));
console.log("newGradient",d);d&&(b.cloneChildrenTo(d),b=a.addElementToProjectDefs(d),c={},c[this.appRef.fillStroke2DPanel.activeGraphicSideTarget]=b,a.setAttributeElementList_undable(a.selectionList,c),a.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,b),this.update(),this.appRef.fillStroke2DPanel.update(),this.appRef.interaction2D.gradientPoints2D.update())};
_.onClick_spreadMethod=function(a){var b=this.appRef.fillStroke2DPanel.editableGradientDef;a=a.target.parentElement.getAttribute("id").split("_")[3];"pad"==a&&(a=null);this.appRef.activeEditablePage.setAttributeElementList_undable([b],{spreadMethod:a},!1);this.update()};
_.onChange_gradientUnits=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=a.nodeName,c=this.controlledElements.gradientUnits.value,d={};d.gradientUnits=c;"objectBoundingBox"==c?"linearGradient"==b?(d.x1=0,d.y1=.5,d.x2=1,d.y2=.5):"radialGradient"==b&&(d.cx=.5,d.cy=.5,d.r=.5):"userSpaceOnUse"==c&&("linearGradient"==b?(d.x1=0,d.y1=0,d.x2=50,d.y2=50):"radialGradient"==b&&(d.cx=50,d.cy=50,d.r=50));this.appRef.activeEditablePage.setAttributeElementList_undable([a],d,!1);this.update();
this.appRef.interaction2D.gradientPoints2D.update()};_.onChange_linearGradient_x1=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=Math.evalExpression(this.controlledElements.x1.value);isNaN(b)||(this.appRef.activeEditablePage.setAttributeElementList_undable([a],{x1:b},!1),this.appRef.interaction2D.gradientPoints2D.update())};
_.onChange_linearGradient_y1=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=Math.evalExpression(this.controlledElements.y1.value);isNaN(b)||(this.appRef.activeEditablePage.setAttributeElementList_undable([a],{y1:b},!1),this.appRef.interaction2D.gradientPoints2D.update())};
_.onChange_linearGradient_x2=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=Math.evalExpression(this.controlledElements.x2.value);isNaN(b)||(this.appRef.activeEditablePage.setAttributeElementList_undable([a],{x2:b},!1),this.appRef.interaction2D.gradientPoints2D.update())};
_.onChange_linearGradient_y2=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=Math.evalExpression(this.controlledElements.y2.value);isNaN(b)||(this.appRef.activeEditablePage.setAttributeElementList_undable([a],{y2:b},!1),this.appRef.interaction2D.gradientPoints2D.update())};
_.onChange_radialGradient_cx=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=Math.evalExpression(this.controlledElements.cx.value);isNaN(b)||(this.appRef.activeEditablePage.setAttributeElementList_undable([a],{cx:b},!1),this.appRef.interaction2D.gradientPoints2D.update())};
_.onChange_radialGradient_cy=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=Math.evalExpression(this.controlledElements.cy.value);isNaN(b)||(this.appRef.activeEditablePage.setAttributeElementList_undable([a],{cy:b},!1),this.appRef.interaction2D.gradientPoints2D.update())};
_.onChange_radialGradient_fx=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=Math.evalExpression(this.controlledElements.fx.value);isNaN(b)&&(b=null);this.appRef.activeEditablePage.setAttributeElementList_undable([a],{fx:b},!1);this.appRef.interaction2D.gradientPoints2D.update()};
_.onChange_radialGradient_fy=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=Math.evalExpression(this.controlledElements.fy.value);isNaN(b)&&(b=null);this.appRef.activeEditablePage.setAttributeElementList_undable([a],{fy:b},!1);this.appRef.interaction2D.gradientPoints2D.update()};
_.onChange_radialGradient_r=function(a){a=this.appRef.fillStroke2DPanel.editableGradientDef;var b=Math.evalExpression(this.controlledElements.r.value);isNaN(b)||(this.appRef.activeEditablePage.setAttributeElementList_undable([a],{r:b},!1),this.appRef.interaction2D.gradientPoints2D.update())};
function PatternEditor2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.patternColorList=this.querySelector("#PATTERN_COLOR_LIST");this.patternColorTemplate=this.querySelector(".templates #EDITABLE_PATTERN_COLOR");this.controlledElements=this.connectEvents()}_=PatternEditor2D_panel.prototype;_.onShow=function(){this.appRef.colorPickerPanel.setOnChangeEvents()};
_.update=function(){var a=this.appRef.fillStroke2DPanel.editablePatternDef;a&&(a=a.getAttribute("id"),document.querySelector("#PATTERN_DISPLAY").setAttribute("fill","url(#"+a+")"),this.createEditableColors())};
_.createEditableColors=function(){function a(a){var d=b.querySelectorAll("["+a+"]"),f,g=d.length;for(f=0;f<g;f++){var h=c.patternColorTemplate.cloneNode(!0);var k=d[f].getAttribute(a);"none"!=k&&-1==k.indexOf("url(")&&(h.querySelector("svg").setAttribute("fill",k),k=1,d[f].hasAttribute(a+"-opacity")&&(k=d[f].getAttribute(a+"-opacity")),h.querySelector("svg").setAttribute("fill-opacity",k),h.colorOwner=d[f],h.graphicSide=a,c.patternColorList.appendChild(h))}}this.patternColorList.removeChildren();
var b=this.appRef.fillStroke2DPanel.editablePatternDef,c=this;a("fill");a("stroke")};
_.onClick_patternColorList=function(a){var b=this.appRef.activeEditablePage;if("rect"==a.target.nodeName){var c=a.target.parentElement.parentElement;SelectElement(c);var d=a.target.parentElement;a=d.getAttribute("fill");var e=d.getAttribute("fill-opacity");this.appRef.colorPickerPanel.setColor(a,e);this.appRef.contextPanels.showContextPanel("COLOR_PICKER_CONTEXT_PANEL");var f=this;this.appRef.colorPickerPanel.setOnChangeEvents(function(a){var e=a.getColorAsHex();d.setAttribute("fill",e);d.setAttribute("fill-opacity",
a.alpha);var g={};g[c.graphicSide]=e;g[c.graphicSide+"-opacity"]=a.alpha;f.appRef.activeEditablePage.setAttributeElementList_undable([c.colorOwner],g,!1);"stroke"==f.appRef.fillStroke2DPanel.activeGraphicSideTarget?f.appRef.fillStroke2DPanel.update_strokeDisplay():f.appRef.fillStroke2DPanel.update_fillDisplay();b.getTransform().matrix.identity()})}};function PatternProperties2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.controlledElements=this.connectEvents()}_=PatternProperties2D_panel.prototype;
_.onShow=function(){this.update()};
_.update=function(a){a=this.appRef.fillStroke2DPanel.editablePatternDef;var b=a.getAttribute("id"),c=this.appRef.activeEditablePage;this.controlledElements.id.value=b;b=a.getAttribute("patternUnits")||"objectBoundingBox";this.controlledElements.patternUnits.value=b;var d=c.valueToFixed(a.getAttribute("x"));var e=c.valueToFixed(a.getAttribute("y"));var f=c.valueToFixed(a.getAttribute("width"));c=c.valueToFixed(a.getAttribute("height"));"objectBoundingBox"!=b&&"userSpaceOnUse"==b&&(d+=" px",e+=" px",
f+=" px",c+=" px");this.controlledElements.patternX.value=d;this.controlledElements.patternY.value=e;this.controlledElements.patternWidth.value=f;this.controlledElements.patternHeight.value=c;a=SVGUtils.parseTransformString(a.getAttribute("patternTransform"));c=0;b=1;a.rotate&&(c=a.rotate.value);a.scale&&(b=a.scale.x);this.controlledElements.patternRotation.value=c+" \u00b0";this.controlledElements.patternScale.value=100*b+" %"};
_.onChange_patternID=function(a){a=this.appRef.fillStroke2DPanel.editablePatternDef;var b=this.controlledElements.id.value;""==b&&(b=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(a,b)&&(this.appRef.activeEditablePage.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,"url(#"+b+")"),this.appRef.fillStroke2DPanel.update())};
_.onClick_clonePattern=function(a){var b=this.appRef.activeEditablePage,c=this.appRef.fillStroke2DPanel.editablePatternDef.cloneNode(!0),d=b.addElementToProjectDefs(c),e={};e[this.appRef.fillStroke2DPanel.activeGraphicSideTarget]=d;b.setAttributeElementList_undable(b.selectionList,e);b.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,d);b.showSelectionProperties();this.update(c);FlipElement(a.target.parentElement.parentElement.parentElement)};
_.onChange_patternX=function(a){a=this.appRef.fillStroke2DPanel.editablePatternDef;var b=Math.evalExpression(this.controlledElements.patternX.value);isNaN(b)||this.appRef.activeEditablePage.setAttributeElementList_undable([a],{x:b},!1)};_.onChange_patternY=function(a){a=this.appRef.fillStroke2DPanel.editablePatternDef;var b=Math.evalExpression(this.controlledElements.patternY.value);isNaN(b)||this.appRef.activeEditablePage.setAttributeElementList_undable([a],{y:b},!1)};
_.onChange_patternWidth=function(a){a=this.appRef.fillStroke2DPanel.editablePatternDef;var b=Math.evalExpression(this.controlledElements.patternWidth.value);isNaN(b)||this.appRef.activeEditablePage.setAttributeElementList_undable([a],{width:b},!1)};_.onChange_patternHeight=function(a){a=this.appRef.fillStroke2DPanel.editablePatternDef;var b=Math.evalExpression(this.controlledElements.patternHeight.value);isNaN(b)||this.appRef.activeEditablePage.setAttributeElementList_undable([a],{height:b},!1)};
_.onChange_patternScaleRotation=function(a){a=this.appRef.fillStroke2DPanel.editablePatternDef;var b=Math.evalExpression(this.controlledElements.patternScale.value/100);if(!isNaN(b)){var c=Math.evalExpression(this.controlledElements.patternRotation.value);isNaN(c)||this.appRef.activeEditablePage.setAttributeElementList_undable([a],{patternTransform:"rotate("+c+") scale("+b+")"},!1)}};
_.onChange_patternUnits=function(a){a=this.appRef.fillStroke2DPanel.editablePatternDef;var b=this.controlledElements.patternUnits.value,c={};c.patternUnits=b;"objectBoundingBox"==b?(c.x=0,c.y=0,c.width=1,c.height=1):"userSpaceOnUse"==b&&(b=this.appRef.activeEditablePage.getElementListGlobalBBox(a.children),console.log("editablePattern bbox",b),c.x=0,c.y=0,c.width=b.width,c.height=b.height);this.appRef.activeEditablePage.setAttributeElementList_undable([a],c,!1);this.update()};
_.onChange_patternContentUnits=function(a){a=this.appRef.fillStroke2DPanel.editablePatternDef;var b={};b.patternContentUnits=this.controlledElements.patternContentUnits.value;this.appRef.activeEditablePage.setAttributeElementList_undable([a],b,!1);this.update()};_.onClick_editPattern=function(a){this.appRef.activeEditablePage.enterTo_isolateLayerEditing(this.appRef.fillStroke2DPanel.editablePatternDef)};Extends(Text2D_panel,Panel);
function Text2D_panel(a){Text2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=Text2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){var a=this.appRef.activeEditablePage.currentEditableElement;if(a&&"text"==a.nodeName){if(this.classList.remove("hidden"),!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")&&(a=this.appRef.activeEditablePage,0!=a.selectionList.length)){var b=a.currentEditableElement;if(b instanceof SVGTextElement){this.controlledElements.fontSize.value=a.valueToFixed(a.getDrawingProperty("font-size"));this.controlledElements.lineHeight.value=a.getDrawingProperty("line-height");
this.controlledElements.letterSpacing.value=a.valueToFixed(a.getDrawingProperty("letter-spacing"));this.controlledElements.wordSpacing.value=a.valueToFixed(a.getDrawingProperty("word-spacing"));this.controlledElements.textAlign.value=a.getDrawingProperty("text-align");var c=this.controlledElements.textAlign.querySelector("[value="+a.getDrawingProperty("text-align")+"]");SelectElement(c);this.controlledElements.fontFamily.value=a.getDrawingProperty("font-family");this.fontObject=window.GoogleFonts.getGoogleFontObjectByFamilyName(this.controlledElements.fontFamily.value);
this.updateFontVariantsMenu();console.log("Text2D_panel update editableElement",b);console.log("this.fontObject ",this.fontObject);console.log("drawingProperties ",a.drawingProperties);this.controlledElements.textDecoration.value=a.getDrawingProperty("text-decoration")||"none";this.controlledElements.useRichText.checked="true"==b.dataset.useRichText?!0:!1;"TextOnPath"==b.getAttribute("data-type")?(this.controlledElements.startOffset.parentElement.classList.remove("hidden"),this.controlledElements.startOffset.value=
parseFloat(b.querySelector("textPath").getAttribute("startOffset")||0)):this.controlledElements.startOffset.parentElement.classList.add("hidden")}}}else this.classList.add("hidden")};
_.updateFontVariantsMenu=function(){var a=this.appRef.activeEditablePage;this.controlledElements.fontVariants.removeChildren();if(null!=this.fontObject){var b;for(b=0;b<this.fontObject.variants.length;b++){var c=this.fontObject.variants[b];var d=document.createElement("option");var e=window.GoogleFonts.getGoogleFontStyleAndWeightByVariantName(c);d.appendChild(document.createTextNode(e.name));d.setAttribute("value",c);this.controlledElements.fontVariants.appendChild(d)}b=a.getDrawingProperty("font-weight");
a=a.getDrawingProperty("font-style");this.controlledElements.fontVariants.value=window.GoogleFonts.getGoogleFontVariantNameByStyleAndWeight(a,b)}};_.onChange_useRichText=function(a){var b=this.appRef.activeEditablePage,c=b.getFilteredElementListByNodeName(b.selectionList,"text");console.log("onChange_useRichText",c);0!=c.length&&(b.setAttributeElementList_undable(c,{"data-use-rich-text":String(a.target.checked)}),c[0].focus())};
_.onChange_fontFamily=function(a){var b=this.appRef.activeEditablePage,c=b.getFilteredElementListByNodeName(b.selectionList,"text");0!=c.length&&(b.setAttributeElementList_undable(c,{"font-family":a.target.value}),b.setDrawingProperty("font-family",a.target.value),b.updateInteraction(202),c[0].focus())};_.onChange_fontVariants=function(a){var b=this.appRef.activeEditablePage;b.applyFontElementList_undable(b.selectionList,this.fontObject,a.target.value);b.selectionList[0].focus()};
_.onChange_textDecoration=function(a){var b=this.appRef.activeEditablePage,c=b.getFilteredElementListByNodeName(b.selectionList,"text");0!=c.length&&(b.setAttributeElementList_undable(c,{"text-decoration":a.target.value}),b.updateInteraction(202),c[0].focus())};
_.onChange_fontSize=function(a){var b=this.appRef.activeEditablePage,c=b.getFilteredElementListByNodeName(b.selectionList,"text");0!=c.length&&(b.setAttributeElementList_undable(c,{"font-size":a.target.value}),b.setDrawingProperty("font-size",a.target.value),b.updateInteraction(202),c[0].focus())};_.onClick_showFontLibrary=function(a){this.appRef.fontLibrary2D_panel.open(!0)};
_.onChange_lineHeight=function(a){""==a.target.value&&(a.target.value="normal");var b=this.appRef.activeEditablePage,c=b.getFilteredElementListByNodeName(b.selectionList,"text");0!=c.length&&(b.setAttributeElementList_undable(c,{"line-height":a.target.value}),b.setDrawingProperty("line-height",a.target.value),b.updateInteraction(202),c[0].focus())};
_.onChange_letterSpacing=function(a){var b=this.appRef.activeEditablePage,c=b.getFilteredElementListByNodeName(b.selectionList,"text");0!=c.length&&(b.setAttributeElementList_undable(c,{"letter-spacing":a.target.value}),b.setDrawingProperty("letter-spacing",a.target.value),b.updateInteraction(202),c[0].focus())};
_.onChange_wordSpacing=function(a){var b=this.appRef.activeEditablePage,c=b.getFilteredElementListByNodeName(b.selectionList,"text");0!=c.length&&(b.setAttributeElementList_undable(c,{"word-spacing":a.target.value}),b.setDrawingProperty("word-spacing",a.target.value),b.updateInteraction(202),c[0].focus())};
_.onChange_startOffset=function(a){var b=this.appRef.activeEditablePage,c=b.selectionList[0].querySelector("textPath");c&&b.setAttributeElementList_undable([c],{startOffset:a.target.value});b.updateInteraction();b.selectionList[0].focus()};
_.onClick_textAlign=function(a){var b=this.appRef.activeEditablePage,c=b.getFilteredElementListByNodeName(b.selectionList,"text");0!=c.length&&(b.setAttributeElementList_undable(c,{"text-align":a.target.getAttribute("value")}),b.setDrawingProperty("text-align",a.target.getAttribute("value")),SelectElement(a.target))};_.onClick_convertToPath=function(a){a=this.appRef.activeEditablePage;var b=a.getFilteredElementListByNodeName(a.selectionList,"text");a.convertTextElementListToPath_undable(b)};
_.onClick_textOnPath=function(a){this.appRef.activeEditablePage.createTextPathContent_undable(this.appRef.activeEditablePage.selectionList)};function Align2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.connectEvents()}_=Align2D_panel.prototype;_.onClick_align=function(a){a=a.target.getAttribute("data-action");-1!=a.indexOf("align")?this.alignElements(a):-1!=a.indexOf("distribuite")&&this.distribuiteElements(a)};
_.alignElements=function(a){var b=this.appRef.activeEditablePage;if(1==b.selectionList.length){console.log("this.appRef.workspace.page",this.appRef.workspace.page);var c=this.appRef.workspace.page.getGlobalBBox()}else if(1<b.selectionList.length)c=b.getElementListGlobalBBox(b.selectionList);else return;var d=new SetMatrix2D_action(b);d.addElementList(b.selectionList);for(var e,f,g=b.selectionList.length,h=0;h<g;h++)switch(e=b.selectionList[h],f=e.getGlobalBBox(),a){case "alignLeft":e.translateInGlobal(c.min.x-
f.min.x,0);break;case "alignVCenter":e.translateInGlobal(c.center.x-f.center.x,0);break;case "alignRight":e.translateInGlobal(c.max.x-f.max.x,0);break;case "alignTop":e.translateInGlobal(0,c.min.y-f.min.y);break;case "alignHCenter":e.translateInGlobal(0,c.center.y-f.center.y);break;case "alignBottom":e.translateInGlobal(0,c.max.y-f.max.y)}a=new SetMatrix2D_action(b);a.addElementList(b.selectionList);b.history.addUndoRedoActions(d,a);b.onChange();b.updateInteraction()};
_.distribuiteElements=function(a){var b=this.appRef.activeEditablePage;if(!(3>b.selectionList.length)){var c=b.getElementListGlobalBBox(b.selectionList),d=b.selectionList.length;switch(a){case "distribuiteCenterX":b.selectionList.sort(function(a,b){return a.getGlobalBBox().min.x-b.getGlobalBBox().min.x});var e=b.selectionList[0].getGlobalBBox();var f=b.selectionList[d-1].getGlobalBBox();c.min.x=e.center.x;c.max.x=f.center.x;var g=c.width/(d-1);break;case "distribuiteCenterY":b.selectionList.sort(function(a,
b){return a.getGlobalBBox().min.y-b.getGlobalBBox().min.y});f=b.selectionList[0].getGlobalBBox();e=b.selectionList[d-1].getGlobalBBox();c.min.y=f.center.y;c.max.y=e.center.y;c.height=c.max.y-c.min.y;var h=c.height/(d-1);break;case "distribuiteHSpace":b.selectionList.sort(function(a,b){return a.getGlobalBBox().min.x-b.getGlobalBBox().min.x});for(f=g=0;f<d;f++)g+=b.selectionList[f].getGlobalBBox().width;g=(c.width-g)/(d-1);e=b.selectionList[0].getGlobalBBox();f=b.selectionList[d-1].getGlobalBBox();
c.min.x=e.max.x;c.max.x=f.min.x;break;case "distribuiteVSpace":b.selectionList.sort(function(a,b){return a.getGlobalBBox().min.y-b.getGlobalBBox().min.y});for(f=h=0;f<d;f++)h+=b.selectionList[f].getGlobalBBox().height;h=(c.height-h)/(d-1);f=b.selectionList[0].getGlobalBBox();e=b.selectionList[d-1].getGlobalBBox();c.min.y=f.max.y;c.max.y=e.min.y}e=new SetMatrix2D_action(b);e.addElementList(b.selectionList);for(f=1;f<d-1;f++){var k=b.selectionList[f];var l=k.getGlobalBBox();switch(a){case "distribuiteCenterX":k.translateInGlobal(c.min.x+
g-l.width/2-l.min.x,0);g+=g;break;case "distribuiteCenterY":k.translateInGlobal(0,c.min.y+h-l.height/2-l.min.y);h+=h;break;case "distribuiteHSpace":k.translateInGlobal(c.min.x+g-l.min.x,0);c.min.x=c.min.x+g+l.width;break;case "distribuiteVSpace":k.translateInGlobal(0,c.min.y+h-l.min.y),c.min.y=c.min.y+h+l.height}}a=new SetMatrix2D_action(b);a.addElementList(b.selectionList);b.history.addUndoRedoActions(e,a);b.onChange();b.updateInteraction()}};Extends(Line2D_panel,Panel);
function Line2D_panel(a){Line2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=Line2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){var a=this.appRef.activeEditablePage.currentEditableElement;if(a&&"line"==a.nodeName){if(this.classList.remove("hidden"),console.log("update di Line2D_panel"),!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){var b=this.appRef.activeEditablePage,c=a.getGeometryPointList();var d=c[0].clone();c=c[1].clone();this.appRef.transform2DPanel.isLocalMode?(a=a.getTransformToElement(a.parentElement),d=d.matrixTransform(a),c=c.matrixTransform(a)):
(a=a.getTransformToElement(b.content),d=d.matrixTransform(a),c=c.matrixTransform(a),d.x-=b.origin.x,d.y-=b.origin.y,c.x-=b.origin.x,c.y-=b.origin.y);this.controlledElements.x1.value=b.valueToUnit(d.x);this.controlledElements.y1.value=b.valueToUnit(d.y);this.controlledElements.x2.value=b.valueToUnit(c.x);this.controlledElements.y2.value=b.valueToUnit(c.y);a=c.getDistanceFromPoint(d);this.controlledElements.lineLength.value=b.valueToUnit(a);this.controlledElements.lineOrientation.value=b.valueToFixed(d.getAngleFromPoint(c,
!0))+" \u00b0"}}else this.classList.add("hidden")};
_.onChange_x1_y1=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.x1.value);if(!isNaN(b)){b=a.unitToValue(b);var c=parseFloat(this.controlledElements.y1.value);if(!isNaN(c)){c=a.unitToValue(c);var d=a.currentEditableElement,e=d.getGeometryPointList(),f=new SetGeometryPoint2D_action(a),g=new SetGeometryPoint2D_action(a);a.history.addUndoRedoActions(f,g);f.addElementAndPointList(d,[e[0]]);f=e[0].clone();this.appRef.transform2DPanel.isLocalMode?(f.x=b,f.y=c,b=d.parentElement.getTransformToElement(d)):
(f.x=b+a.origin.x,f.y=c+a.origin.y,b=a.content.getTransformToElement(d));f=f.matrixTransform(b);e[0].x=f.x;e[0].y=f.y;g.addElementAndPointList(d,[e[0]]);d.render();a.updateInteraction()}}};
_.onChange_x2_y2=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.x2.value);if(!isNaN(b)){b=a.unitToValue(b);var c=parseFloat(this.controlledElements.y2.value);if(!isNaN(c)){c=a.unitToValue(c);var d=a.currentEditableElement,e=d.getGeometryPointList(),f=new SetGeometryPoint2D_action(a),g=new SetGeometryPoint2D_action(a);a.history.addUndoRedoActions(f,g);f.addElementAndPointList(d,[e[1]]);f=e[1].clone();this.appRef.transform2DPanel.isLocalMode?(f.x=b,f.y=c,b=d.parentElement.getTransformToElement(d)):
(f.x=b+a.origin.x,f.y=c+a.origin.y,b=a.content.getTransformToElement(d));f=f.matrixTransform(b);e[1].x=f.x;e[1].y=f.y;g.addElementAndPointList(d,[e[1]]);d.render();a.updateInteraction()}}};_.onChange_lineLength=function(a){this.setLineLength(this.controlledElements.lineLength.value)};
_.setLineLength=function(a){var b=this.appRef.activeEditablePage,c=parseFloat(a);if(!isNaN(c)){c=b.unitToValue(c);a=b.currentEditableElement;var d=a.getGeometryPointList(),e=d[0];d=d[1];console.log("pt1.editable",e.isFocused);console.log("pt2.editable",d.isFocused);if(e.isFocused){var f=d;d=e;e=f}var g=new SetGeometryPoint2D_action(b);f=new SetGeometryPoint2D_action(b);b.history.addUndoRedoActions(g,f);g.addElementAndPointList(a,[d]);g=d.getDistanceFromPoint(e);c/=g;d.x=e.x+(d.x-e.x)*c;d.y=e.y+(d.y-
e.y)*c;f.addElementAndPointList(a,[d]);a.render();b.updateInteraction()}};
_.onChange_lineOrientation=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.lineOrientation.value);if(!isNaN(b)){b=a.unitToValue(b);var c=a.currentEditableElement,d=c.getGeometryPointList(),e=d[0];d=d[1];var f=new SetGeometryPoint2D_action(a),g=new SetGeometryPoint2D_action(a);a.history.addUndoRedoActions(f,g);f.addElementAndPointList(c,[d]);b=SVGUtils.createSVGPointPolar(d.getDistanceFromPoint(e),Math.PI/180*b);d.x=e.x+b.x;d.y=e.y+b.y;g.addElementAndPointList(c,
[d]);c.render();a.updateInteraction()}};_.onClick_convertToPath=function(a){a=this.appRef.activeEditablePage;a.convertElementListToPath_undable(a.selectionList)};Extends(Rectangle2D_panel,Panel);function Rectangle2D_panel(a){Rectangle2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=Rectangle2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){var a=this.appRef.activeEditablePage.currentEditableElement;if(a&&"rect"==a.nodeName){this.classList.remove("hidden");a=this.appRef.activeEditablePage;var b=a.selectionList[0];b.hasAttribute("rx")?this.controlledElements.rx.value=a.valueToUnit(b.getAttribute("rx")):this.controlledElements.rx.value="";b.hasAttribute("ry")?this.controlledElements.ry.value=a.valueToUnit(b.getAttribute("ry")):this.controlledElements.ry.value=""}else this.classList.add("hidden")};
_.onChange_rx=function(a){a=this.appRef.activeEditablePage;var b={rx:null,ry:null};""!=this.controlledElements.rx.value&&(b=a.unitToValue(this.controlledElements.rx.value),b={rx:b,ry:b});a.setAttributeElementList_undable(a.selectionList,b)};_.onChange_ry=function(a){a=this.appRef.activeEditablePage;var b={rx:null,ry:null};""!=this.controlledElements.ry.value&&(b={ry:a.unitToValue(this.controlledElements.ry.value)});a.setAttributeElementList_undable(a.selectionList,b)};
_.onClick_convertToPath=function(a){a=this.appRef.activeEditablePage;a.convertElementListToPath_undable(a.selectionList)};Extends(Ellipse2D_panel,Panel);function Ellipse2D_panel(a){Ellipse2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=Ellipse2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){var a=this.appRef.activeEditablePage.currentEditableElement;if(a&&"ellipse"==a.nodeName){this.classList.remove("hidden");a=this.appRef.activeEditablePage;var b=a.selectionList[0];this.controlledElements.rx.value=a.valueToUnit(b.getAttribute("rx"));this.controlledElements.ry.value=a.valueToUnit(b.getAttribute("ry"))}else this.classList.add("hidden")};
_.onChange_rx=function(a){a=this.appRef.activeEditablePage;var b=a.unitToValue(this.controlledElements.rx.value);a.setAttributeElementList_undable(a.selectionList,{rx:b});a.updateInteraction()};_.onChange_ry=function(a){a=this.appRef.activeEditablePage;var b=a.unitToValue(this.controlledElements.ry.value);a.setAttributeElementList_undable(a.selectionList,{ry:b});a.updateInteraction()};_.onClick_convertToPath=function(a){a=this.appRef.activeEditablePage;a.convertElementListToPath_undable(a.selectionList)};
Extends(Image2D_panel,Panel);function Image2D_panel(a){Image2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents();console.log("Image2D_panel this.controlledElements",this.controlledElements)}_=Image2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){var a=this.appRef.activeEditablePage.currentEditableElement;if(a&&"image"==a.nodeName){this.classList.remove("hidden");var b=a.getAttributeNS(SVGElement.XLINK_NS,"href");b&&(-1<b.indexOf("data:")&&(b="data:*"),this.controlledElements.href.value=b);b=a.getAttribute("width");var c=a.getAttribute("height");b||(a=a.getLocalBBox(),b=a.width,c=a.height);a=this.appRef.activeEditablePage;this.controlledElements.imageSizeX.value=a.valueToUnit(b);this.controlledElements.imageSizeY.value=
a.valueToUnit(c)}else this.classList.add("hidden")};_.onChange_href=function(a){console.log("onChange_href");var b=this.appRef.activeEditablePage;b.setAttributeElementList_undable(b.selectionList,{href:a.target.value});b.currentEditableElement.initializeWithOriginalSize(function(){b.updateInteraction()})};Extends(IFrame2D_panel,Panel);
function IFrame2D_panel(a){IFrame2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents();console.log("IFrame2D_panel this.controlledElements",this.controlledElements)}_=IFrame2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){var a=this.appRef.activeEditablePage.currentEditableElement;a&&"iframe"==a.nodeName?(this.classList.remove("hidden"),this.controlledElements.iframeSource.value=this.appRef.activeEditablePage.selectionList[0].querySelector("iframe").getAttribute("src")):this.classList.add("hidden")};_.onChange_href=function(a){var b=this.appRef.activeEditablePage;b.setAttributeElementList_undable(b.selectionList,{href:a.target.value});b.updateInteraction()};
_.onChange_iframeSource=function(a){var b=this.appRef.activeEditablePage.selectionList[0];a=a.target.value;-1<a.indexOf("<iframe")&&-1<a.indexOf('src="')&&(a=a.split('src="')[1].split('"')[0]);b.querySelector("iframe").setAttribute("src",a)};Extends(ClipPath2D_panel,Panel);function ClipPath2D_panel(a){ClipPath2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=ClipPath2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){var a=this.appRef.activeEditablePage.currentEditableElement;a&&"g"==a.nodeName&&a.hasAttribute("clip-path")?this.classList.remove("hidden"):this.classList.add("hidden")};
_.onClick_removeClipPath=function(a){a=this.appRef.activeEditablePage;var b=a.currentEditableElement;a.deselectAllElements();var c=b.cloneNode(!0);c.querySelector("clipPath").remove();c.removeAttribute("clip-path");var d=new ReplaceElements_action(a),e=new ReplaceElements_action(a);a.history.addUndoRedoActions(e,d);d.setElementsToReplace([b]);e.setElementsToInsert([b]);b.parentNode.replaceChild(c,b);d.setElementsToInsert([c]);e.setElementsToReplace([c]);a.selectElementList([c]);a.updateInteraction()};
_.onClick_editClipPath=function(a){this.appRef.activeEditablePage.enterTo_isolateLayerEditing(this.appRef.activeEditablePage.currentEditableElement)};Extends(Mask2D_panel,Panel);function Mask2D_panel(a){Mask2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=Mask2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){var a=this.appRef.activeEditablePage.currentEditableElement;a&&"g"==a.nodeName&&a.hasAttribute("mask")?this.classList.remove("hidden"):this.classList.add("hidden")};
_.onClick_removeMask=function(a){a=this.appRef.activeEditablePage;var b=a.currentEditableElement;a.deselectAllElements();var c=b.cloneNode(!0);c.querySelector("mask").remove();c.removeAttribute("mask");var d=new ReplaceElements_action(a),e=new ReplaceElements_action(a);a.history.addUndoRedoActions(e,d);d.setElementsToReplace([b]);e.setElementsToInsert([b]);b.parentNode.replaceChild(c,b);d.setElementsToInsert([c]);e.setElementsToReplace([c]);a.selectElementList([c]);a.updateInteraction()};
_.onClick_editMask=function(a){this.appRef.activeEditablePage.enterTo_isolateLayerEditing(this.appRef.activeEditablePage.currentEditableElement)};Extends(Path2D_panel,Panel);function Path2D_panel(a){Path2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents();this.pathPointInfoContainer=this.querySelector("#PATH_POINT_INFO")}_=Path2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){var a=this.appRef.activeEditablePage,b=a.currentEditableElement;if(b&&"path"==b.nodeName)if(this.classList.remove("hidden"),a.currentEditablePoint){this.pathPointInfoContainer.classList.remove("hidden");b=a.currentEditablePoint.ownerShapeElement;var c=a.currentEditablePoint.clone();this.appRef.transform2DPanel.isLocalMode?(b=b.getTransformToElement(b.parentElement),c=c.matrixTransform(b)):(b=b.getTransformToElement(a.content),c=c.matrixTransform(b),c.x-=a.origin.x,c.y-=a.origin.y);
this.controlledElements.posX.value=a.valueToUnit(c.x);this.controlledElements.posY.value=a.valueToUnit(c.y);if(this.appRef.interaction2D.segment2D.currentSegmentRef){c=this.appRef.interaction2D.segment2D.previousSegmentRef;b=this.appRef.interaction2D.segment2D.currentSegmentRef;var d=b.getDistanceFromPoint(c);this.controlledElements.lineLength.value=a.valueToUnit(d);this.controlledElements.lineOrientation.value=a.valueToFixed(c.getAngleFromPoint(b,!0))+" \u00b0"}}else this.pathPointInfoContainer.classList.add("hidden");
else this.classList.add("hidden")};
_.onChangePointPosition_XY=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.posX.value);if(!isNaN(b)){b=a.unitToValue(b);var c=parseFloat(this.controlledElements.posY.value);if(!isNaN(c)){c=a.unitToValue(c);var d=a.currentEditablePoint.ownerShapeElement,e=new SetGeometryPoint2D_action(a),f=new SetGeometryPoint2D_action(a);a.history.addUndoRedoActions(e,f);var g=a.getSelectedTransformablePointData();e.setTransformDataPointList(g);e=a.currentEditablePoint.clone();
this.appRef.transform2DPanel.isLocalMode?(e.x=b,e.y=c,d=d.parentElement.getTransformToElement(d),e=e.matrixTransform(d),a.translateTransformDataPointList(g,e.x-a.currentEditablePoint.x,e.y-a.currentEditablePoint.y,!0)):(d=d.getTransformToElement(a.content),e=e.matrixTransform(d),a.translateTransformDataPointList(g,b+a.origin.x-e.x,c+a.origin.y-e.y));f.setTransformDataPointList(a.getSelectedTransformablePointData());a.updateInteraction()}}};_.onChange_lineToLength=function(a){this.setLineToLength(this.controlledElements.lineLength.value)};
_.setLineToLength=function(a){var b=this.appRef.activeEditablePage,c=parseFloat(a);if(!isNaN(c)){c=b.unitToValue(c);var d=this.appRef.interaction2D.segment2D.previousSegmentRef;a=this.appRef.interaction2D.segment2D.currentSegmentRef;var e=a.getDistanceFromPoint(d);e=c/e;c=d.x+(a.x-d.x)*e;e=d.y+(a.y-d.y)*e;a.isFocused?(d=c-a.x,a=e-a.y):(console.log("pt1.isFocused",d.isFocused),d=a.x-c,a=a.y-e);console.log("translateX",d);console.log("translateY",a);b.translateSelectedPointList_undable(d,a,!0,!0)}};
_.onChange_lineToOrientation=function(a){a=this.appRef.activeEditablePage;var b=parseFloat(this.controlledElements.lineOrientation.value);if(!isNaN(b)){b=a.unitToValue(b);var c=this.appRef.interaction2D.segment2D.previousSegmentRef,d=this.appRef.interaction2D.segment2D.currentSegmentRef,e=c.ownerShapeElement,f=new SetGeometryPoint2D_action(a),g=new SetGeometryPoint2D_action(a);a.history.addUndoRedoActions(f,g);f.addElementAndPointList(e,[d]);b=SVGUtils.createSVGPointPolar(d.getDistanceFromPoint(c),
Math.PI/180*b);d.x=c.x+b.x;d.y=c.y+b.y;g.addElementAndPointList(e,[d]);e.render();a.updateInteraction()}};_.onClick_unifyPaths=function(a){this.appRef.activeEditablePage.unifyPaths_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_separatePaths=function(a){this.appRef.activeEditablePage.separateSubPath_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_revertPathSegment=function(a){this.appRef.activeEditablePage.reversePath_undable(this.appRef.activeEditablePage.selectionList)};
_.onClick_closePath=function(a){this.appRef.activeEditablePage.closePath_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_joinSelectedPaths=function(a){this.appRef.activeEditablePage.joinPaths_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_unifyPaths=function(a){this.appRef.activeEditablePage.unifyPaths_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_separatePaths=function(a){this.appRef.activeEditablePage.separateSubPath_undable(this.appRef.activeEditablePage.selectionList)};
_.onClick_revertPathSegment=function(a){this.appRef.activeEditablePage.reversePath_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_closePath=function(a){this.appRef.activeEditablePage.closePath_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_joinSelectedPaths=function(a){this.appRef.activeEditablePage.joinPaths_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_simplifyPath=function(a){this.appRef.activeEditablePage.simplifyPath_undable(this.appRef.activeEditablePage.selectionList)};
_.onClick_smoothPath=function(a){this.appRef.activeEditablePage.smoothPath_undable(this.appRef.activeEditablePage.selectionList)};Extends(Group2D_panel,Panel);function Group2D_panel(a){Group2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=Group2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){var a=this.appRef.activeEditablePage.currentEditableElement;!a||"g"!=a.nodeName||a.hasAttribute("mask")||a.hasAttribute("clip-path")?this.classList.add("hidden"):this.classList.remove("hidden")};_.onClick_ungroup=function(a){a=this.appRef.activeEditablePage;var b=a.getFilteredElementListByNodeName(a.selectionList,"g");a.ungroupElementList_undable(b)};_.onClick_editGroup=function(a){a=this.appRef.activeEditablePage;a.enterTo_isolateLayerEditing(a.currentEditableElement)};
Extends(Use2D_panel,Panel);function Use2D_panel(a){Use2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=Use2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};_.update=function(){var a=this.appRef.activeEditablePage.currentEditableElement;a&&"use"==a.nodeName?(this.classList.remove("hidden"),a=a.getAttribute("href")||a.getAttribute("xlink:href"),this.controlledElements.id.value=a.split("#")[1]):this.classList.add("hidden")};
_.onClick_editSymbol=function(a){a=document.querySelector(this.appRef.activeEditablePage.currentEditableElement.getAttribute("href"));this.appRef.activeEditablePage.enterTo_isolateLayerEditing(a)};
_.onChange_symbolID=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());var b=document.querySelector(this.appRef.activeEditablePage.currentEditableElement.getAttribute("href"));this.appRef.activeEditablePage.refactorElementID_undable(b,a)&&(this.appRef.activeEditablePage.currentEditableElement.setAttribute("href","#"+a),this.appRef.symbolLibrary2DPanel.update())};
_.onClick_cloneSymbol=function(a){a=this.appRef.activeEditablePage;var b=document.querySelector(this.appRef.activeEditablePage.currentEditableElement.getAttribute("href")).cloneNode(!0);b={href:"#"+String.extractIdFromUrl(a.addElementToProjectDefs(b))};a.setAttributeElementList_undable(a.selectionList,b);this.update();this.appRef.symbolLibrary2DPanel.update()};Extends(Arrange2D_panel,Panel);
function Arrange2D_panel(a){Arrange2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=Arrange2D_panel.prototype;_.onClick_bringUp=function(a){this.appRef.activeEditablePage.setElementListOrderZ_undable(this.appRef.activeEditablePage.selectionList,"bringUp")};_.onClick_sendDown=function(a){this.appRef.activeEditablePage.setElementListOrderZ_undable(this.appRef.activeEditablePage.selectionList,"sendDown")};
_.onClick_bringToFront=function(a){this.appRef.activeEditablePage.setElementListOrderZ_undable(this.appRef.activeEditablePage.selectionList,"bringToFront")};_.onClick_sendToBack=function(a){this.appRef.activeEditablePage.setElementListOrderZ_undable(this.appRef.activeEditablePage.selectionList,"sendToBack")};Extends(BooleanOperations2D_panel,Panel);function BooleanOperations2D_panel(a){BooleanOperations2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=BooleanOperations2D_panel.prototype;
_.onClick_booleanPathsOperation=function(a){a=a.target.getAttribute("data-action");this.appRef.activeEditablePage.booleanPathsOperation_undable(a)};function InputProperty2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.controlledElements=this.connectEvents();this.sourceInteractionProperty=null;this.labelNameElement=this.querySelector(".label")}_=InputProperty2D_panel.prototype;_.show=function(a,b){this.sourceInteractionProperty=a;this.labelNameElement.innerHTML=b;this.appRef.contextPanels.showContextPanel("INPUT_PROPERTY_2D_PANEL")};
_.onShow=function(a){this.controlledElements.propertyValue.value=this.sourceInteractionProperty.getValue?this.sourceInteractionProperty.getValue():this.sourceInteractionProperty.textContent;this.controlledElements.propertyValue.focus();this.controlledElements.propertyValue.select()};_.onChangeInputProperty=function(a){this.sourceInteractionProperty.onChangeCallback(a.target.value);this.appRef.contextPanels.hideAllContextPanel()};Extends(StrokeWidthLibrary2D_panel,Panel);
function StrokeWidthLibrary2D_panel(a){StrokeWidthLibrary2D_panel.superConstructor.call(this,a);this.connectEvents()}_=StrokeWidthLibrary2D_panel.prototype;_.update=function(){};_.onClick_strokeWidthList=function(a){var b=this.appRef.activeEditablePage;a=a.target.querySelector("line").getAttribute("stroke-width");0<b.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,{"stroke-width":a});b.setDrawingProperty("stroke-width",a)};Extends(StrokeDashArrayLibrary2D_panel,Panel);
function StrokeDashArrayLibrary2D_panel(a){StrokeDashArrayLibrary2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=StrokeDashArrayLibrary2D_panel.prototype;
_.update=function(){if(!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){var a=this.appRef.activeEditablePage;this.controlledElements.strokeDashArray.value=a.getDrawingProperty("stroke-dasharray");this.controlledElements.strokeDashOffset.value=a.getDrawingProperty("stroke-dashoffset")+" px"}};
_.onClick_strokeDashList=function(a){var b=this.appRef.activeEditablePage;a=a.target.querySelector("line").getAttribute("stroke-dasharray");0<b.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,{"stroke-dasharray":a});b.setDrawingProperty("stroke-dasharray",a);this.update()};
_.onChange_strokeDashArray=function(a){a=a.target.value;var b=this.appRef.activeEditablePage;0<b.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,{"stroke-dasharray":a});b.setDrawingProperty("stroke-dasharray",a)};_.onChange_strokeDashOffset=function(a){console.log("onChange_strokeDashOffset",a);var b=this.appRef.activeEditablePage;0<b.selectionList.length&&(a=parseFloat(a.target.value),isNaN(a)||b.setAttributeElementList_undable(b.selectionList,{"stroke-dashoffset":a}))};
Extends(FontLibrary2D_panel,Panel);function FontLibrary2D_panel(a){FontLibrary2D_panel.superConstructor.call(this,a);this.fontListContainer=this.querySelector("ul");this.fontCategoriesMenu=this.querySelector("select");this.connectEvents()}_=FontLibrary2D_panel.prototype;
_.popolateFontList=function(a){var b=this.fontCategoriesMenu.options[this.fontCategoriesMenu.selectedIndex].value;if(a)var c=!0;else"selectedFonts"==b?(a=GoogleFonts.getSelectedFontList(),c=!0):"defaultFonts"==b?(a=GoogleFonts.defaultFontFamilyList,c=!1):(a=GoogleFonts.fontCategories[b],c=!0);this.fontListContainer.removeChildren();var d,e=a.length;for(d=0;d<e;d++){b=a[d];console.log("fontItem",b.family);var f=document.createElement("li");f.data=b;if(c){var g=document.createElement("input");g.setAttribute("type",
"checkbox");f.data.isSelected&&(g.checked=!0);f.appendChild(g)}g=document.createElement("a");g.appendChild(document.createTextNode(b.family));f.appendChild(g);g=document.createElement("img");g.setAttribute("src","/data/janvas_6.2/fonts/_previews/"+b.family.replace(/ /g,"-")+".png");f.appendChild(g);this.fontListContainer.appendChild(f)}};_.onOpen=function(){""==this.fontListContainer.innerHTML&&this.popolateFontList()};_.onExpand=function(){""==this.fontListContainer.innerHTML&&this.popolateFontList()};
_.onChange_fontCategory=function(a){console.log("onChange_fontCategory",a.target.value);"searchFonts"==a.target.value?(this.classList.add("search-fonts"),this.querySelector('input[type="search"]').value=""):this.classList.remove("search-fonts");this.popolateFontList()};
_.onChange_searchFont=function(a){console.log("onChange_searchFont",a.target.value);var b=this;clearTimeout(this.searchChangeTimeout);this.searchChangeTimeout=setTimeout(function(){b.searchChangeTimeout=void 0;b.popolateFontList(GoogleFonts.findFontList(a.target.value))},250)};
_.onClick_fonts=function(a){console.log("onClick_fonts",a);if("UL"!=a.target.nodeName)if("INPUT"==a.target.nodeName){var b=a.target.parentElement.data;b.isSelected=a.target.checked;"selectedFonts"==this.fontCategoriesMenu.options[this.fontCategoriesMenu.selectedIndex].value&&this.popolateFontList()}else{b=a.target.querySelector("a").innerHTML;console.log("fontName",b);var c=this.appRef.getActiveDocument().getActivePage();b=a.target.data;console.log("googleFontObject",b);c.applyFontElementList_undable(c.selectionList,
b)}};Extends(Library2D_panel,Panel);function Library2D_panel(a){Library2D_panel.superConstructor.call(this,a);this.connectEvents()}_=Library2D_panel.prototype;_.onClick_showLibrary=function(a){console.log(a.target);SelectElement(a.target);ShowElement(this.querySelector("#"+a.target.getAttribute("panel-target")))};Extends(ColorLibrary2D_panel,Panel);
function ColorLibrary2D_panel(a){ColorLibrary2D_panel.superConstructor.call(this,a);this.none_template=this.querySelector("ul.itemList .none-fill-stroke");this.controlledElements=this.connectEvents();this.update()}_=ColorLibrary2D_panel.prototype;
_.update=function(){function a(a){b.removeChildren();b.appendChild(c.cloneNode(!0));for(var d,e=0,f=a.length;e<f;e++)d=document.createElement("li"),d.style.backgroundColor=a[e],b.appendChild(d)}var b=this.querySelector("ul.itemList");b.scrollTop=0;var c=this.none_template,d=this.controlledElements.colorCategoryMenu.value,e=[];"application_colors"==d?(window.onLoadColorLibrary=function(b){a(b)},IncludeJS("/data/janvas_6.2/colors/coloria-colors.js")):("fill-stroke"==d?(this.appRef.activeEditablePage.getUsedColorList("stroke",
e),this.appRef.activeEditablePage.getUsedColorList("fill",e)):"stroke"==d?this.appRef.activeEditablePage.getUsedColorList("stroke",e):"fill"==d&&this.appRef.activeEditablePage.getUsedColorList("fill",e),a(e))};_.updateDynamicLibraries=function(a){a=this.controlledElements.colorCategoryMenu.value;"fill-stroke"!=a&&"stroke"!=a&&"fill"!=a||this.update()};_.onChange_colorCategoryMenu=function(a){this.update()};
_.onClickColorList=function(a){var b=this.appRef.activeEditablePage,c={};a.target.classList.contains("none-fill-stroke")?(c[this.appRef.fillStroke2DPanel.activeGraphicSideTarget]="none",b.setAttributeElementList_undable(b.selectionList,c),b.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,"none")):(c[this.appRef.fillStroke2DPanel.activeGraphicSideTarget]=a.target.style.backgroundColor,b.setAttributeElementList_undable(b.selectionList,c),b.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,
a.target.style.backgroundColor));b.showSelectionProperties()};Extends(GradientLibrary2D_panel,Panel);function GradientLibrary2D_panel(a){GradientLibrary2D_panel.superConstructor.call(this,a);this.none_template=this.querySelector("ul.itemList .none-fill-stroke");this.gradientPreview_template=this.querySelector("ul.itemList .gradientPreview");this.controlledElements=this.connectEvents();this.update()}_=GradientLibrary2D_panel.prototype;_.onShow=function(a){};
_.update=function(){var a=this.querySelector("ul.itemList"),b=this.gradientPreview_template,c=this.none_template,d,e=[];var f=this.controlledElements.gradientCategoryMenu.value;if("application_gradients"==f){var g=document.querySelectorAll("#GRADIENTS_DEFS defs > *");f=0;for(d=g.length;f<d;f++)e.push("url(#"+g[f].getAttribute("id")+")")}else"fill-stroke"==f?(this.appRef.activeEditablePage.getUsedGradientList("stroke",e),this.appRef.activeEditablePage.getUsedGradientList("fill",e)):"stroke"==f?this.appRef.activeEditablePage.getUsedGradientList("stroke",
e):"fill"==f&&this.appRef.activeEditablePage.getUsedGradientList("fill",e);a.removeChildren();a.appendChild(c.cloneNode(!0));f=0;for(d=e.length;f<d;f++)c=b.cloneNode(!0),c.querySelector("rect").setAttribute("fill",e[f]),a.appendChild(c)};_.updateDynamicLibraries=function(a){a=this.controlledElements.gradientCategoryMenu.value;"fill-stroke"!=a&&"stroke"!=a&&"fill"!=a||this.update()};_.onChange_gradientCategoryMenu=function(a){this.update()};
_.onClickGradientList=function(a){var b=this.appRef.activeEditablePage;if(a.target.classList.contains("none-fill-stroke"))a={},a[this.appRef.fillStroke2DPanel.activeGraphicSideTarget]="none",b.setAttributeElementList_undable(b.selectionList,a),b.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,"none");else{a=a.target.querySelector("rect").getAttribute("fill");a=b.getElementFromDocumentByIRI(a).cloneNode(!0);var c=b.addElementToProjectDefs(a);a={};a[this.appRef.fillStroke2DPanel.activeGraphicSideTarget]=
c;b.setAttributeElementList_undable(b.selectionList,a);b.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,c)}b.showSelectionProperties();this.appRef.interaction2D.gradientPoints2D.update()};Extends(PatternLibrary2D_panel,Panel);
function PatternLibrary2D_panel(a){PatternLibrary2D_panel.superConstructor.call(this,a);this.none_template=this.querySelector("ul.itemList .none-fill-stroke");this.patternPreview_template=this.querySelector("ul.itemList .patternPreview");this.controlledElements=this.connectEvents();this.update()}_=PatternLibrary2D_panel.prototype;_.onShow=function(a){};
_.update=function(){var a=this.querySelector("ul.itemList"),b=this.patternPreview_template,c=this.none_template,d,e=[],f=this.controlledElements.patternCategoryMenu.value;if("application_patterns"==f){var g=document.querySelectorAll("#PATTERNS_DEFS defs > *");var h=0;for(d=g.length;h<d;h++)e.push("url(#"+g[h].getAttribute("id")+")")}else if("document_patterns"==f)for(g=document.querySelectorAll("#PROJECT_DEFS defs > pattern"),h=0,d=g.length;h<d;h++)e.push("url(#"+g[h].getAttribute("id")+")");"fill-stroke"==
f?(this.appRef.activeEditablePage.getUsedPatternList("stroke",e),this.appRef.activeEditablePage.getUsedPatternList("fill",e)):"stroke"==f?this.appRef.activeEditablePage.getUsedPatternList("stroke",e):"fill"==f&&this.appRef.activeEditablePage.getUsedPatternList("fill",e);a.removeChildren();a.appendChild(c.cloneNode(!0));h=0;for(d=e.length;h<d;h++)c=b.cloneNode(!0),c.querySelector("rect").setAttribute("fill",e[h]),a.appendChild(c)};
_.updateDynamicLibraries=function(a){a=this.controlledElements.patternCategoryMenu.value;"document_patterns"!=a&&"fill-stroke"!=a&&"stroke"!=a&&"fill"!=a||this.update()};_.onChange_patternCategoryMenu=function(a){this.update()};
_.onClickPatternList=function(a){var b=this.appRef.activeEditablePage;if(a.target.classList.contains("none-fill-stroke"))a={},a[this.appRef.fillStroke2DPanel.activeGraphicSideTarget]="none",b.setAttributeElementList_undable(b.selectionList,a),b.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,"none");else{a=a.target.querySelector("rect").getAttribute("fill");var c=String.extractIdFromUrl(a);"application_patterns"==this.querySelector("select").value?(a=document.querySelector("#PATTERNS_DEFS defs > #"+
c).cloneNode(!0),c=b.addElementToProjectDefs(a)):c=a;a={};a[this.appRef.fillStroke2DPanel.activeGraphicSideTarget]=c;b.setAttributeElementList_undable(b.selectionList,a);b.setDrawingProperty(this.appRef.fillStroke2DPanel.activeGraphicSideTarget,c)}b.showSelectionProperties()};
function ShapeLibrary2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.none_template=this.querySelector("ul.itemList .none-fill-stroke");this.shapePreview_template=this.querySelector("ul.itemList .shapePreview");this.controlledElements=this.connectEvents();this.update()}_=ShapeLibrary2D_panel.prototype;
_.update=function(){var a=this.controlledElements.shapeCategoryMenu;a=a.options[a.selectedIndex].dataset.url;var b=a.split(".");b=b[b.length-1];var c=this;"svg"==b?SendAndLoad(a,null,null,function(a){c.drawShapeList(a)}):"json"==b&&SendAndLoad(a,null,null,function(a){c.drawItemList(a)})};
_.drawShapeList=function(a){function b(a){c.appRef.contextPanels.classList.remove("active");SetTransferData({type:"svg",data:a.target.querySelector("svg").cloneNode(!0)})}var c=this;a=document.body.appendChild(a.target.responseXML.firstChild);for(var d=a.querySelectorAll(".layers > .layer > *:not(.locked)"),e,f=0,g=d.length;f<g;f++)e=d[f],e.sortingData=e.getBoundingClientRect(),e.translateInGlobal(-e.sortingData.x+(128-e.sortingData.width)/2,-e.sortingData.y+(128-e.sortingData.height)/2);d=[].slice.call(d,
0).sort(function(a,b){return a.sortingData.x-b.sortingData.x&&a.sortingData.y-b.sortingData.y});var h=this.querySelector("ul.itemList");h.removeChildren();f=0;for(g=d.length;f<g;f++){e=d[f];var k=this.shapePreview_template.cloneNode(!0);k.ondragstart=b;k.querySelector("svg").appendChild(e);h.appendChild(k)}a.remove()};
_.drawItemList=function(a){function b(a){SetTransferData({type:"svg",url:a.target.data.url||a.target.data.urlPreview})}a=a.responseToJSON(a);var c=this.querySelector("ul.itemList");c.removeChildren();for(var d,e=0,f=a.length;e<f;e++)d=document.createElement("li"),d.data=a[e],d.style.backgroundImage='url("'+a[e].urlPreview+'")',d.style.backgroundRepeat="no-repeat",d.style.backgroundSize="50%",d.style.backgroundPosition="center center",d.setAttribute("draggable","true"),d.ondragstart=b,c.appendChild(d)};
_.onChange_shapeCategoryMenu=function(a){this.update()};function MaskLibrary2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.controlledElements=this.connectEvents();this.update()}_=MaskLibrary2D_panel.prototype;_.update=function(){var a=this.controlledElements.maskCategoryMenu,b=this;SendAndLoad(a.options[a.selectedIndex].dataset.url,null,null,function(a){b.drawItemList(a)})};
_.drawItemList=function(a){function b(a){SetTransferData({type:"image",url:a.target.data.url||a.target.data.urlPreview})}a=a.responseToJSON(a);var c=this.querySelector("ul.itemList");c.removeChildren();for(var d,e=0,f=a.length;e<f;e++)d=document.createElement("li"),d.data=a[e],d.style.backgroundImage='url("'+a[e].urlPreview+'")',d.style.backgroundRepeat="no-repeat",d.style.backgroundSize="50%",d.style.backgroundPosition="center center",d.setAttribute("draggable","true"),d.ondragstart=b,c.appendChild(d)};
_.onChange_maskCategoryMenu=function(a){this.update()};
_.onClickMaskList=function(a){if("LI"==a.target.nodeName){console.log("onClickMaskList");var b=this.appRef.activeEditablePage;if(1==b.selectionList.length){var c=b.selectionList[0];b.deselectAllElements();"g"==c.nodeName&&c.hasAttribute("mask")?SVGUtils.createSVGImage(a.target.data.url||a.target.data.urlPreview,0,0,null,null,function(a){var d=c.querySelector("mask"),f=d.firstElementChild.getBBox(),g=d.firstElementChild.getTransform().matrix.getScale();d=f.width*g.x;g=f.height*g.y;console.log("currentMaskLocalBBox",
f);console.log("currentMaskSizeX",d);console.log("currentMaskSizeY",g);var h=CreateUniqueIDI();f=c.parentElement.insertBefore(c.cloneNode(!0),c.nextElementSibling);var k=f.querySelector("mask");k.setAttribute("id",h);f.setAttribute("mask","url(#"+h+")");k.removeChildren();k.appendChild(a);h=a.getLocalBBox();d/=h.width;g/=h.height;a.getTransform().setMatrix(a.getTransform().matrix.scaleNonUniform(d,g));a=new ReplaceElements_action(b);d=new ReplaceElements_action(b);a.setElementsToReplace([c]);d.setElementsToInsert([c]);
a.setElementsToInsert([f]);d.setElementsToReplace([f]);b.history.addUndoRedoActions(d,a);c.remove();b.selectElementList([f]);b.setCurrentEditableElement(f);b.updateInteraction()}):SVGUtils.createSVGImage(a.target.data.url||a.target.data.urlPreview,0,0,null,null,function(a){var d=c.getGlobalBBox();c.parentElement.insertBefore(a,c.nextElementSibling);var f=a.getGlobalBBox(),g=c.parentElement.globalToLocal(d.x,d.y),h=d.width/f.width;d=d.height/f.height;a.getTransform().setMatrix(a.getTransform().matrix.translate(g.x,
g.y).scaleNonUniform(h,d));g=b.createMaskedContent(c,[a]);a.remove();a=new ReplaceElements_action(b);h=new ReplaceElements_action(b);a.setElementsToReplace([c]);h.setElementsToInsert([c]);a.setElementsToInsert([g]);h.setElementsToReplace([g]);b.history.addUndoRedoActions(h,a);c.remove();b.selectElementList([g]);b.setCurrentEditableElement(g);b.updateInteraction()})}}};
function SymbolLibrary2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.symbolPreview_template=this.querySelector("ul.itemList .symbolPreview");this.controlledElements=this.connectEvents();this.invalidInnerSymbolList=!0;this.update()}_=SymbolLibrary2D_panel.prototype;_.onShow=function(a){this.update()};_.updateDynamicLibraries=function(a){"symbols-inner"==this.controlledElements.symbolCategoryMenu.value&&this.invalidInnerSymbolList&&this.update()};
_.update=function(){if(!this.isHidden()){var a=this.controlledElements.symbolCategoryMenu;if("symbols-inner"==a.value)this.drawInnerSymbolList(document.querySelectorAll("#PROJECT_DEFS defs > symbol")),this.invalidInnerSymbolList=!1;else{var b=this;(a=a.options[a.selectedIndex].dataset.url)&&SendAndLoad(a,null,null,function(a){b.drawOuterSymbolList(a.responseToJSON(a))})}}};
_.drawInnerSymbolList=function(a){function b(a){SetTransferData({type:"inner-symbol",useElement:a.target.querySelector("use")})}var c=this.querySelector("ul.itemList");c.removeChildren();for(var d,e,f,g=0,h=a.length;g<h;g++)e=a[g],d=this.symbolPreview_template.cloneNode(!0),d.ondragstart=b,e=e.getAttribute("id"),d.querySelector(".title").innerHTML=e,f=SVGUtils.createUse(e),e=d.querySelector("svg"),e.appendChild(f),c.appendChild(d),d=f.getBBox(),e.setAttribute("viewBox",d.x+" "+d.y+" "+d.width+" "+
d.height)};_.drawOuterSymbolList=function(a){function b(a){SetTransferData({type:"outer-symbol",useElement:a.target.querySelector("use")})}var c=this.querySelector("ul.itemList");c.removeChildren();for(var d,e,f,g=0,h=a.length;g<h;g++)e=a[g],d=this.symbolPreview_template.cloneNode(!0),d.ondragstart=b,f=SVGUtils.createUse(e.getAttribute("id")),e=d.querySelector("svg"),e.appendChild(f),c.appendChild(d),d=f.getBBox(),e.setAttribute("viewBox",d.x+" "+d.y+" "+d.width+" "+d.height)};
_.onChange_symbolCategoryMenu=function(a){this.update()};
_.onClickSymbolList=function(a){if(Event.isDoubleClick){var b=this.appRef.promptModalDialog,c=this.appRef.alertModalDialog,d=a.target.querySelector("use"),e=a.target.querySelector("use").getAttribute("href").split("#")[1];if(d){a=function(){var a=f.getElementFromProjectDefs("#"+e);console.log("symbol",a);var h=b.getPromptValue();""==h&&(h=CreateUniqueIDI());f.getElementFromProjectDefs("#"+h)?c.open(LOCALIZER.translate("Invalid operation"),LOCALIZER.translate("An element with that name already exists!")):(f.refactorElementID(a,
h),d.setAttribute("href","#"+h),d.parentElement.parentElement.querySelector(".title").innerHTML=h,f.showSelectionProperties())};var f=this.appRef.activeEditablePage;Event.isDoubleClick&&(b.setPromptValue(e,"auto",/[a-zA-Z]+/g),b.open(LOCALIZER.translate("Symbol name"),LOCALIZER.translate("Give a custom symbol name."),a))}}};
function PageTemplateLibrary2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.pageTemplatePreview_template=this.querySelector("ul.itemList .pageTemplatePreview");this.controlledElements=this.connectEvents();this.update()}_=PageTemplateLibrary2D_panel.prototype;_.update=function(){var a=this.controlledElements.pageTemplateCategoryMenu,b=this;SendAndLoad(a.options[a.selectedIndex].dataset.url,null,null,function(a){b.drawItemList(a)})};
_.drawItemList=function(a){a=a.responseToJSON(a);var b=this.querySelector("ul.itemList");b.removeChildren();for(var c,d=0,e=a.length;d<e;d++)c=this.pageTemplatePreview_template.cloneNode(!0),c.data=a[d],c.querySelector("img").setAttribute("src",c.data.urlPreview),b.appendChild(c)};_.onChange_pageTemplateCategoryMenu=function(a){this.update()};
_.onDoubleClick_itemList=function(a){var b=this;a=a.target;console.log(a);SendAndLoad(a.data.url,"GET",null,function(a){console.log("onLoadTemplate",a);a=a.target.responseXML.querySelector("svg");console.log("loadedSVGDocument",a);a.hasAttribute("data-version")&&"6.2"==a.dataset.version&&(b.appRef.unserializeAndAddPagesInCurrentDocument(a),a=b.appRef.getActiveDocument(),a.setActivePage(a.lastElementChild))},function(a){b.appRef.alertModalDialog.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occured during loading file"))},
function(a){console.log("loading total: "+a.total+"   loaded: "+a.loaded);b.appRef.progressPanel.setProgressValues(a.total,a.loaded)})};Extends(FilterLibrary2D_panel,Panel);function FilterLibrary2D_panel(a){FilterLibrary2D_panel.superConstructor.call(this,a);this.connectEvents();this.update()}_=FilterLibrary2D_panel.prototype;
_.update=function(){var a=this.querySelector("ul.itemList");if(""==a.innerHTML){var b=document.querySelectorAll("#FILTERS_DEFS defs > *"),c=this.querySelector(".templates .textFilterPreview"),d=this.querySelector(".templates .imageFilterPreview");console.log("drawFilterList",b);a.removeChildren();a.appendChild(this.querySelector(".templates .none-filter").cloneNode(!0));for(var e,f,g=0,h=b.length;g<h;g++)e=b[g],f=e.hasAttribute("data-preview")&&"textFilterPreview"==e.getAttribute("data-preview")?
c.cloneNode(!0):d.cloneNode(!0),f.querySelector("[filter]").setAttribute("filter","url(#"+e.getAttribute("id")+")"),f.querySelector(".title").innerHTML=e.getAttribute("data-name"),a.appendChild(f)}};
_.onClickFilterList=function(a){var b=this.appRef.activeEditablePage;0==b.selectionList.length?this.appRef.alertModalDialog.open(LOCALIZER.translate("Selection required"),LOCALIZER.translate("You must select an element.")):(a.target.classList.contains("none-filter")?b.setAttributeElementList_undable(b.selectionList,{filter:null},!1):(a=a.target.querySelector("[filter]").getAttribute("filter"),a=String.extractIdFromUrl(a),a=document.querySelector("#FILTERS_DEFS defs > #"+a).cloneNode(!0),a=b.addElementToProjectDefs(a),
b.setAttributeElementList_undable(b.selectionList,{filter:a},!1)),this.appRef.activeEditablePage.showSelectionProperties())};Extends(MarkerLibrary2D_panel,Panel);function MarkerLibrary2D_panel(a){MarkerLibrary2D_panel.superConstructor.call(this,a);this.none_template=this.querySelector("ul.itemList .none-marker");this.markerPreview_template=this.querySelector("ul.itemList .markerPreview");this.controlledElements=this.connectEvents();this.update()}_=MarkerLibrary2D_panel.prototype;
_.update=function(){var a=this.querySelector("ul.itemList");a.scrollTop=0;var b=this.markerPreview_template,c=this.none_template,d,e=[];var f=this.controlledElements.markerOptionsMenu.value;if("application_markers"==f){var g=document.querySelectorAll("#MARKERS_DEFS defs > *");f=0;for(d=g.length;f<d;f++)e.push("url(#"+g[f].getAttribute("id")+")")}else if("document_markers"==f)for(g=document.querySelectorAll("#PROJECT_DEFS defs > marker"),f=0,d=g.length;f<d;f++)e.push("url(#"+g[f].getAttribute("id")+
")");else"start-mid-end"==f?(this.appRef.activeEditablePage.getUsedMarkerList("marker-start",e),this.appRef.activeEditablePage.getUsedMarkerList("marker-mid",e),this.appRef.activeEditablePage.getUsedMarkerList("marker-end",e)):"start"==f?this.appRef.activeEditablePage.getUsedMarkerList("marker-start",e):"mid"==f?this.appRef.activeEditablePage.getUsedMarkerList("marker-mid",e):"end"==f&&this.appRef.activeEditablePage.getUsedMarkerList("marker-end",e);a.removeChildren();a.appendChild(c.cloneNode(!0));
f=0;for(d=e.length;f<d;f++)c=b.cloneNode(!0),c.querySelector("line").setAttribute("marker-start",e[f]),a.appendChild(c)};_.updateDynamicLibraries=function(a){a=this.controlledElements.markerOptionsMenu.value;"document_markers"!=a&&"start-mid-end"!=a&&"start"!=a&&"mid"!=a&&"end"!=a||this.update()};_.onChange_markerOptionsMenu=function(a){this.update()};
_.onClickMarkerList=function(a){var b=this.appRef.activeEditablePage,c={},d=this.appRef.markersEditor2DPanel.getActiveMarkerSideName(),e="";a.target.classList.contains("none-marker")?0<b.selectionList.length&&(c[d]=null,b.setAttributeElementList_undable(b.selectionList,c)):(a=a.target.querySelector("[marker-start]").getAttribute("marker-start"),"application_markers"==this.controlledElements.markerOptionsMenu.value?(a=b.getElementFromDocumentByIRI(a),e=b.addElementToProjectDefs(a.cloneNode(!0))):e=
a,0<b.selectionList.length&&(c[d]=e,b.setAttributeElementList_undable(b.selectionList,c)));this.appRef.activeEditablePage.setDrawingProperty(d,e);this.appRef.activeEditablePage.showSelectionProperties()};Extends(PixabayLibrary2D_panel,Panel);
function PixabayLibrary2D_panel(a){PixabayLibrary2D_panel.superConstructor.call(this,a);this.imageListContainer=this.querySelector(".content ul");this.imageViewer=document.querySelector("#PIXABAY_IMAGE_PANEL");this.connectEvents();this.imageViewer.connectEvents(this);this.imageTemplate=this.querySelector(".imagePreview");this.imageTemplate.remove();this.loadedPages=0}_=PixabayLibrary2D_panel.prototype;
_.popolateImageList=function(a){a?this.loadedPages++:(this.imageListContainer.removeChildren(),this.loadedPages=1);a=this.querySelector('select[name="category"]').value;var b=this.querySelector('select[name="image_type"]').value,c=this.querySelector('select[name="colors"]').value,d=this.querySelector('select[name="order"]').value,e=this.querySelector('input[name="searchKeywords"]').value,f="https://pixabay.com/api/?key=9717984-0c5ac01fa5e45b18417200266&callback=onLoadPixabayLibrary";"all"!=a&&(f+=
"&category="+a);"all"!=b&&(f+="&image_type="+b);"all"!=c&&(f+="&colors="+c);f=f+("&order="+d)+("&page="+this.loadedPages);""!=e&&(f+="&q="+e.split(" ").join("+"));console.log("query",f);var g=this,h,k;window.onLoadPixabayLibrary=function(a){console.log("_jsonData",a);h=a.hits;a=0;for(var b=h.length;a<b;a++)k=g.imageTemplate.cloneNode(!0),k.data=h[a],k.querySelector("img").setAttribute("src",h[a].previewURL),g.imageListContainer.appendChild(k);g.imageListContainer.scrollTop+=400};IncludeJS(f)};
_.onChange_queryProperty=function(a){this.popolateImageList()};_.onClick_more=function(a){this.popolateImageList(!0)};_.onClick_item=function(a){ShowElement(this.imageViewer);var b=a.target;"IMG"==b.nodeName&&(b=a.target.parentElement);a=this.imageViewer.querySelector("img");a.data=b.data;a.setAttribute("src",b.data.webformatURL);"vector/svg"==b.data.type?this.imageViewer.querySelector('button[event="click:onClick_importSVG"]').classList.remove("hidden"):this.imageViewer.querySelector('button[event="click:onClick_importSVG"]').classList.add("hidden")};
_.onClick_importImage=function(a){a=a.target.dataset.size;var b=this.imageViewer.querySelector("img");if("640"==a)var c=b.data.webformatURL;else"1280"==a?c=b.data.largeImageURL:"1920"==a?c=b.data.fullHDURL:"hig-res"==a&&(c=b.data.imageURL);this.appRef.getActiveDocument().getActivePage().placeRemoteImageToCurrentLayerAsDataURL_undable(c)};
_.onClick_importSVG=function(a){a=this.imageViewer.querySelector("img");var b=this,c=this.appRef.progressPanel;c.setProgressBarValue(1);c.open(!0);c.startVirtualProgress(2E5);SendAndLoad(a.data.vectorURL,"POST",null,function(a){console.log("onLoadSVG",a.target.responseXML.querySelector("svg"));b.appRef.getActiveDocument().getActivePage().unserializeAndPlaceSvgInCurrentLayer_undable(a.target.responseXML.querySelector("svg"));c.endVirtualProgress()},function(a){b.appRef.alertModalDialog.open(LOCALIZER.translate("Error"),
LOCALIZER.translate("An error occured during loading file"))})};function OpenClipArtLibrary2D_panel(a){a.appRef&&(this.appRef=a.appRef);this.imageListContainer=this.querySelector(".content ul");this.imageViewer=document.querySelector("#OPENCLIPART_IMAGE_PANEL");this.connectEvents();this.imageViewer.connectEvents(this);this.imageTemplate=this.querySelector(".imagePreview");this.imageTemplate.remove();this.loadedPages=0}_=OpenClipArtLibrary2D_panel.prototype;
_.popolateImageList=function(a){a?this.loadedPages++:(this.imageListContainer.removeChildren(),this.loadedPages=1);var b=this.querySelector('select[name="order"]').value;a=this.querySelector('input[name="searchKeywords"]').value;b="https://openclipart.org/search/json/?callback=onLoadOpenclipartLibrary&play&amount=20&order="+b+("&page="+this.loadedPages);""!=a&&(b+="&query="+a.split(" ").join("+"));console.log("query",b);var c=this,d,e;window.onLoadOpenclipartLibrary=function(a){console.log("_jsonData",
a);d=a.payload;a=0;for(var b=d.length;a<b;a++)e=c.imageTemplate.cloneNode(!0),e.data=d[a],e.querySelector("img").setAttribute("src",d[a].svg.png_thumb),c.imageListContainer.appendChild(e);c.imageListContainer.scrollTop+=400};IncludeJS(b)};_.onChange_queryProperty=function(a){this.popolateImageList()};_.onClick_more=function(a){this.popolateImageList(!0)};
_.onClick_item=function(a){ShowElement(this.imageViewer);var b=a.target;"IMG"==b.nodeName&&(b=a.target.parentElement);a=this.imageViewer.querySelector("img");a.data=b.data;a.setAttribute("src",b.data.svg.png_full_lossy)};_.onClick_importImage=function(a){a=a.target.dataset.size;var b=this.imageViewer.querySelector("img");if("250"==a)var c=b.data.svg.png_thumb;else"800"==a?c=b.data.svg.png_full_lossy:"2400"==a&&(c=b.data.svg.png_2400px);this.appRef.getActiveDocument().getActivePage().placeRemoteImageToCurrentLayerAsDataURL_undable(c)};
_.onClick_importSVG=function(a){a=this.imageViewer.querySelector("img");var b=this,c=this.appRef.progressPanel;c.setProgressBarValue(1);c.open(!0);c.startVirtualProgress(2E5);a=a.data.svg.url.replace("http:","https:");SendAndLoad(a,"POST",null,function(a){console.log("onLoadSVG",a.target.responseXML.querySelector("svg"));b.appRef.getActiveDocument().getActivePage().unserializeAndPlaceSvgInCurrentLayer_undable(a.target.responseXML.querySelector("svg"));c.endVirtualProgress()},function(a){b.appRef.alertModalDialog.open(LOCALIZER.translate("Error"),
LOCALIZER.translate("An error occured during loading file"))})};Extends(MarkersEditor2D_panel,Panel);function MarkersEditor2D_panel(a){MarkersEditor2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents();this.defaultMarkerEndUrl=this.defaultMarkerMidUrl=this.defaultMarkerStartUrl=null}_=MarkersEditor2D_panel.prototype;_.onOpen=function(){this.update()};_.onExpand=function(){this.update()};
_.update=function(){if(!this.isHidden()&&!this.classList.contains("closed")&&!this.classList.contains("collapsed")){var a=this.appRef.activeEditablePage;this.editableMarkerDef=this.editableElement=null;this.defaultMarkerStartUrl=a.getDrawingProperty("marker-start");this.defaultMarkerMidUrl=a.getDrawingProperty("marker-mid");this.defaultMarkerEndUrl=a.getDrawingProperty("marker-end");a=this.querySelector("svg path[marker-start]");a.setAttribute("marker-start",this.defaultMarkerStartUrl);a=this.querySelector("svg path[marker-mid]");
a.setAttribute("marker-mid",this.defaultMarkerMidUrl);a=this.querySelector("svg path[marker-end]");a.setAttribute("marker-end",this.defaultMarkerEndUrl);this.updateActiveMarkerData()}};_.getActiveMarkerSideName=function(){return this.querySelector(".markers-display .selected").getAttribute("name")};
_.updateActiveMarkerData=function(){var a=this.appRef.activeEditablePage;this.editableMarkerDef=null;var b=this.getActiveMarkerSideName();console.log("selectedMarkerSideName",b);b=this.querySelector(".markers-display .selected svg path["+b+"]").getAttribute(b);console.log("markerIRI",b);this.querySelector(".markers-properties").classList.add("hidden");""!=b&&(b=a.getElementFromProjectDefs(b))&&(this.querySelector(".markers-properties").classList.remove("hidden"),this.editableMarkerDef=b,this.controlledElements.id.value=
b.getAttribute("id"),this.controlledElements.markerUnits.value=b.getAttribute("markerUnits")||"strokeWidth",this.controlledElements.refX.value=a.valueToUnit(this.editableMarkerDef.getAttribute("refX")),this.controlledElements.refY.value=a.valueToUnit(this.editableMarkerDef.getAttribute("refY")),this.controlledElements.markerWidth.value=a.valueToUnit(this.editableMarkerDef.getAttribute("markerWidth")),this.controlledElements.markerHeight.value=a.valueToUnit(this.editableMarkerDef.getAttribute("markerHeight")),
this.controlledElements.orient.value=this.editableMarkerDef.getAttribute("orient"),this.controlledElements.orientMode.value="auto"!=this.controlledElements.orient.value&&"auto-start-reverse"!=this.controlledElements.orient.value?"angle":this.controlledElements.orient.value)};
_.createEditableMarkerColors=function(a){function b(b){var e=a.querySelectorAll("["+b+"]"),g,h=e.length;for(g=0;g<h;g++){var k=d.cloneNode(!0);var l=e[g].getAttribute(b);"none"!=l&&-1==l.indexOf("url(")&&(k.querySelector("svg").setAttribute("fill",l),l=1,e[g].hasAttribute(b+"-opacity")&&(l=e[g].getAttribute(b+"-opacity")),k.querySelector("svg").setAttribute("fill-opacity",l),k.colorOwner=e[g],k.graphicSide=b,c.appendChild(k))}}var c=this.querySelector("#MARKER_COLOR_LIST"),d=this.querySelector(".templates #EDITABLE_MARKER_COLOR");
b("fill");b("stroke")};_.onClick_markerDisplay=function(a){this.appRef.contextPanels.showContextPanel("MARKER_LIBRARY_2D_CONTEXT_PANEL");SelectElement(a.target);this.updateActiveMarkerData()};_.onChange_id=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.editableMarkerDef,a);this.appRef.activeEditablePage.setDrawingProperty(this.getActiveMarkerSideName(),"url(#"+a+")");this.update()};
_.onClick_cloneMarker=function(a){var b=this.appRef.activeEditablePage;this.editableMarkerDef=this.editableMarkerDef.cloneNode(!0);var c=b.addElementToProjectDefs(this.editableMarkerDef),d={};d[this.getActiveMarkerSideName()]=c;b.setAttributeElementList_undable(b.selectionList,d);b.setDrawingProperty(this.getActiveMarkerSideName(),c);this.update();FlipElement(a.target.parentElement.parentElement.parentElement)};_.onClick_editMarker=function(a){this.appRef.activeEditablePage.enterTo_isolateLayerEditing(this.editableMarkerDef)};
_.onChange_markerUnits=function(a){a={};a.markerUnits=this.controlledElements.markerUnits.value;this.appRef.activeEditablePage.setAttributeElementList_undable([this.editableMarkerDef],a,!1)};
_.onClick_markerColorList=function(a){var b=this.appRef.activeEditablePage;if("rect"==a.target.nodeName){var c=a.target.parentElement.parentElement;SelectElement(c);var d=a.target.parentElement;a=d.getAttribute("fill");var e=d.getAttribute("fill-opacity");this.appRef.colorPickerPanel.setColor(a,e);this.appRef.contextPanels.showContextPanel("COLOR_PICKER_CONTEXT_PANEL");var f=this;this.appRef.colorPickerPanel.setOnChangeEvents(function(a){var e=a.getColorAsHex();d.setAttribute("fill",e);d.setAttribute("fill-opacity",
a.alpha);var g={};g[c.graphicSide]=e;g[c.graphicSide+"-opacity"]=a.alpha;f.appRef.activeEditablePage.setAttributeElementList_undable([c.colorOwner],g,!1);"stroke"==f.appRef.fillStroke2DPanel.activeGraphicSideTarget?f.appRef.fillStroke2DPanel.update_strokeDisplay():f.appRef.fillStroke2DPanel.update_fillDisplay();b.getTransform().matrix.identity()})}};
_.onChange_refX=function(a){var b=this.appRef.activeEditablePage;b.setAttributeElementList_undable([this.editableMarkerDef],{refX:b.unitToValue(a.target.value)},!1)};_.onChange_refY=function(a){var b=this.appRef.activeEditablePage;b.setAttributeElementList_undable([this.editableMarkerDef],{refY:b.unitToValue(a.target.value)},!1)};
_.onChange_markerWidth=function(a){var b=this.appRef.activeEditablePage;b.setAttributeElementList_undable([this.editableMarkerDef],{markerWidth:b.unitToValue(a.target.value)},!1)};_.onChange_markerHeight=function(a){var b=this.appRef.activeEditablePage;b.setAttributeElementList_undable([this.editableMarkerDef],{markerHeight:b.unitToValue(a.target.value)},!1)};
_.onChange_orientMode=function(a){"angle"==a.target.value?this.controlledElements.orient.value="0":(this.appRef.activeEditablePage.setAttributeElementList_undable([this.editableMarkerDef],{orient:a.target.value},!1),this.controlledElements.orient.value=a.target.value)};_.onChange_orient=function(a){""==a.target.value&&(a.target.value="auto");this.appRef.activeEditablePage.setAttributeElementList_undable([this.editableMarkerDef],{orient:a.target.value},!1)};Extends(Snaps2D_panel,Panel);
function Snaps2D_panel(a){Snaps2D_panel.superConstructor.call(this,a);this.controlledElements=this.connectEvents()}_=Snaps2D_panel.prototype;
_.update=function(a){a=this.appRef.activeEditablePage;this.controlledElements.snapToGrid.checked=a.snapToGrid;this.controlledElements.snapToPoint.checked=a.snapToPoint;this.controlledElements.snapToSegments.checked=a.snapToSegments;this.controlledElements.snapToSmartGuides.checked=a.snapToSmartGuides;this.controlledElements.snapToBBoxProjections.checked=a.snapToBBoxProjections;this.controlledElements.snapToPageBorders.checked=a.snapToPageBorders;this.controlledElements.showGrid.checked=a.showGrid;
this.controlledElements.showRulers.checked=a.showRulers};_.onChange_snapToGrid=function(a){this.appRef.activeEditablePage.snapToGrid=this.controlledElements.snapToGrid.checked};_.onChange_snapToPageBorders=function(a){this.appRef.activeEditablePage.snapToPageBorders=this.controlledElements.snapToPageBorders.checked};_.onChange_snapToPoint=function(a){this.appRef.activeEditablePage.snapToPoint=this.controlledElements.snapToPoint.checked};
_.onChange_snapToSegments=function(a){this.appRef.activeEditablePage.snapToSegments=this.controlledElements.snapToSegments.checked};_.onChange_snapToSmartGuides=function(a){this.appRef.activeEditablePage.snapToSmartGuides=this.controlledElements.snapToSmartGuides.checked};_.onChange_snapToBBoxProjections=function(a){this.appRef.activeEditablePage.snapToBBoxProjections=this.controlledElements.snapToBBoxProjections.checked};
_.onChange_showGrid=function(a){this.appRef.activeEditablePage.showGrid=this.controlledElements.showGrid.checked;this.appRef.workspace.updateGridVisibility()};_.onChange_showRulers=function(a){this.appRef.activeEditablePage.showRulers=this.controlledElements.showRulers.checked;this.appRef.workspace.updateRulersVisibility()};function IsolateLayerEditing_bar(a){a.appRef&&(this.appRef=a.appRef);this.connectEvents()}_=IsolateLayerEditing_bar.prototype;
_.onShow=function(){var a=this.appRef.activeEditablePage.getLayersContainer(),b="";for(a=a.children[a.children.length-1];a.classList.contains("isolate-layer");)b=a.getAttribute("name")+" / "+b,a=a.previousElementSibling;this.querySelector(".label").innerHTML=b};_.onClick_exitFromIsolateLayerEditing=function(){this.appRef.activeEditablePage.exitFrom_isolateLayerEditing()};
function ShadowFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.controlledElements=this.connectEvents()}_=ShadowFilter_contentPanel.prototype;
_.update=function(a){this.filter=a||this.filter;this.controlledElements.id.value=this.filter.getAttribute("id");this.colorMatrix=this.filter.querySelector("feColorMatrix").getAttribute("values").split(" ");this.controlledElements.shadowOffsetX.value=this.controlledElements.shadowOffsetX_slider.value=this.controlledElements.shadowOffsetX_slider.startValue=parseInt(this.filter.querySelector("feOffset").getAttribute("dx"));this.controlledElements.shadowOffsetY.value=this.controlledElements.shadowOffsetY_slider.value=
this.controlledElements.shadowOffsetY_slider.startValue=parseInt(this.filter.querySelector("feOffset").getAttribute("dy"));this.controlledElements.shadowBlur.value=this.controlledElements.shadowBlur_slider.value=this.controlledElements.shadowBlur_slider.startValue=parseInt(this.filter.querySelector("feGaussianBlur").getAttribute("stdDeviation"));this.controlledElements.shadowColor.style.backgroundColor=ColorUtils.rgbaToHtmlString(parseFloat(this.colorMatrix[0]),parseFloat(this.colorMatrix[6]),parseFloat(this.colorMatrix[12]),
parseFloat(this.colorMatrix[18]))};_.onClick_cloneFilter=function(a){a=this.appRef.activeEditablePage;var b=this.filter.cloneNode(!0),c=a.addElementToProjectDefs(b);a.setAttributeElementList_undable(a.selectionList,{filter:c},!1);this.update(b)};_.onChange_id=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.filter,a)};
_.onChange_shadowOffsetX=function(a){a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feOffset")],{dx:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feOffset")],{dx:a.target.value},!1);this.update()};
_.onInputRange_shadowOffsetX=function(a){this.controlledElements.shadowOffsetX.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feOffset")],{dx:a.target.value})};
_.onChange_shadowOffsetY=function(a){a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feOffset")],{dy:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feOffset")],{dy:a.target.value},!1);this.update()};
_.onInputRange_shadowOffsetY=function(a){this.controlledElements.shadowOffsetY.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feOffset")],{dy:a.target.value})};
_.onChange_shadowBlur=function(a){a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feGaussianBlur")],{stdDeviation:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feGaussianBlur")],{stdDeviation:a.target.value},!1);this.update()};
_.onInputRange_shadowBlur=function(a){this.controlledElements.shadowBlur.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feGaussianBlur")],{stdDeviation:a.target.value})};
_.onClick_editShadowColor=function(a){var b=this.appRef.activeEditablePage;this.appRef.colorPickerPanel.setColor(this.controlledElements.shadowColor.style.backgroundColor);this.appRef.contextPanels.showContextPanel("COLOR_PICKER_CONTEXT_PANEL");var c=this;this.appRef.colorPickerPanel.setOnChangeEvents(function(a){a=a.getColorAsRGBA();a=a.r+" 0 0 0 0 0 "+a.g+" 0 0 0 0 0 "+a.b+" 0 0 0 0 0 "+a.a+" 0";b.setAttributeElementList_undable([c.filter.querySelector("feColorMatrix")],{values:a},!1);c.update()})};
function BlurFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.controlledElements=this.connectEvents()}_=BlurFilter_contentPanel.prototype;
_.update=function(a){this.filter=a||this.filter;this.controlledElements.id.value=this.filter.getAttribute("id");this.shadowBlurValues=this.filter.querySelector("feGaussianBlur").getAttribute("stdDeviation").split(" ");this.controlledElements.blurDeviationX.value=this.controlledElements.blurDeviationX_slider.value=this.controlledElements.blurDeviationX_slider.startValue=parseInt(this.shadowBlurValues[0]);this.controlledElements.blurDeviationY.value=this.controlledElements.blurDeviationY_slider.value=
this.controlledElements.blurDeviationY_slider.startValue=parseInt(this.shadowBlurValues[1]);console.log("BlurFilter_contentPanel update")};_.onClick_cloneFilter=function(a){a=this.appRef.activeEditablePage;var b=this.filter.cloneNode(!0),c=a.addElementToProjectDefs(b);a.setAttributeElementList_undable(a.selectionList,{filter:c},!1);this.update(b)};
_.onChange_id=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.filter,a)};
_.onChange_blurDeviationX=function(a){a.target.startValue&&(this.shadowBlurValues[0]=a.target.startValue,this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feGaussianBlur")],{stdDeviation:this.shadowBlurValues.join(" ")}));this.shadowBlurValues[0]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feGaussianBlur")],{stdDeviation:this.shadowBlurValues.join(" ")},!1);this.update()};
_.onInputRange_blurDeviationX=function(a){this.controlledElements.blurDeviationX.value=this.shadowBlurValues[0]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feGaussianBlur")],{stdDeviation:this.shadowBlurValues.join(" ")})};
_.onChange_blurDeviationY=function(a){a.target.startValue&&(this.shadowBlurValues[1]=a.target.startValue,this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feGaussianBlur")],{stdDeviation:this.shadowBlurValues.join(" ")}));this.shadowBlurValues[1]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feGaussianBlur")],{stdDeviation:this.shadowBlurValues.join(" ")},!1);this.update()};
_.onInputRange_blurDeviationY=function(a){this.controlledElements.blurDeviationY.value=this.shadowBlurValues[1]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feGaussianBlur")],{stdDeviation:this.shadowBlurValues.join(" ")})};function BevelFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.controlledElements=this.connectEvents()}_=BevelFilter_contentPanel.prototype;
_.update=function(a){this.filter=a||this.filter;this.controlledElements.id.value=this.filter.getAttribute("id");a=parseFloat(this.filter.querySelector("feGaussianBlur").getAttribute("stdDeviation"));var b=parseFloat(this.filter.querySelector("feSpecularLighting").getAttribute("specularConstant")),c=parseFloat(this.filter.querySelector("feSpecularLighting").getAttribute("specularExponent"));this.controlledElements.shadowBlur.value=this.controlledElements.shadowBlur_slider.value=this.controlledElements.shadowBlur_slider.startValue=
a;this.controlledElements.specularConstant.value=this.controlledElements.specularConstant_slider.value=this.controlledElements.specularConstant_slider.startValue=b;this.controlledElements.specularExponent.value=this.controlledElements.specularExponent_slider.value=this.controlledElements.specularExponent_slider.startValue=c;this.controlledElements.lightingColor.style.backgroundColor=this.filter.querySelector("feSpecularLighting").getAttribute("lighting-color")};
_.onClick_cloneFilter=function(a){a=this.appRef.activeEditablePage;var b=this.filter.cloneNode(!0),c=a.addElementToProjectDefs(b);a.setAttributeElementList_undable(a.selectionList,{filter:c},!1);this.update(b)};_.onChange_id=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.filter,a)};
_.onChange_shadowBlur=function(a){console.log("_e.target.startValue",a.target.startValue);console.log("_e.target.value",a.target.value);a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feGaussianBlur")],{stdDeviation:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feGaussianBlur")],{stdDeviation:a.target.value},!1);console.log("history",this.appRef.activeEditablePage.history);this.update()};
_.onInputRange_shadowBlur=function(a){this.controlledElements.shadowBlur.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feGaussianBlur")],{stdDeviation:a.target.value})};
_.onChange_specularConstant=function(a){a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feSpecularLighting")],{specularConstant:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feSpecularLighting")],{specularConstant:a.target.value},!1);this.update()};
_.onInputRange_specularConstant=function(a){this.controlledElements.specularConstant.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feSpecularLighting")],{specularConstant:a.target.value})};
_.onChange_specularExponent=function(a){a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feSpecularLighting")],{specularExponent:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feSpecularLighting")],{specularExponent:a.target.value},!1);this.update()};
_.onInputRange_specularExponent=function(a){this.controlledElements.specularExponent.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feSpecularLighting")],{specularExponent:a.target.value})};
_.onClick_lightingColor=function(a){var b=this.appRef.activeEditablePage;this.appRef.colorPickerPanel.setColor(this.controlledElements.lightingColor.style.backgroundColor);this.appRef.contextPanels.showContextPanel("COLOR_PICKER_CONTEXT_PANEL");var c=this;this.appRef.colorPickerPanel.setOnChangeEvents(function(a){b.setAttributeElementList_undable([c.filter.querySelector("feSpecularLighting")],{"lighting-color":a.getColorAsHex()},!1);c.update()})};
function ContrastBrightnessFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.controlledElements=this.connectEvents()}_=ContrastBrightnessFilter_contentPanel.prototype;
_.update=function(a){this.filter=a||this.filter;this.controlledElements.id.value=this.filter.getAttribute("id");a=parseFloat(this.filter.querySelector("feFuncR").getAttribute("slope"));var b=parseFloat(this.filter.querySelector("feFuncR").getAttribute("intercept"));this.controlledElements.contrast.value=this.controlledElements.contrast_slider.value=this.controlledElements.contrast_slider.startValue=a;this.controlledElements.brightness.value=this.controlledElements.brightness_slider.value=this.controlledElements.brightness_slider.startValue=
b};_.onClick_cloneFilter=function(a){a=this.appRef.activeEditablePage;var b=this.filter.cloneNode(!0),c=a.addElementToProjectDefs(b);a.setAttributeElementList_undable(a.selectionList,{filter:c},!1);this.update(b)};_.onChange_id=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.filter,a)};
_.onChange_contrast=function(a){var b=this.filter.querySelectorAll("feFuncR,feFuncG,feFuncB");a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList(b,{slope:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable(b,{slope:a.target.value},!1);this.update()};
_.onInputRange_contrast=function(a){this.controlledElements.contrast.value=a.target.value;var b=this.filter.querySelectorAll("feFuncR,feFuncG,feFuncB");this.appRef.activeEditablePage.setAttributeElementList(b,{slope:a.target.value})};
_.onChange_brightness=function(a){var b=this.filter.querySelectorAll("feFuncR,feFuncG,feFuncB");a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList(b,{intercept:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable(b,{intercept:a.target.value},!1);this.update()};
_.onInputRange_brightness=function(a){this.controlledElements.brightness.value=a.target.value;var b=this.filter.querySelectorAll("feFuncR,feFuncG,feFuncB");this.appRef.activeEditablePage.setAttributeElementList(b,{intercept:a.target.value})};function RGBFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.controlledElements=this.connectEvents();this.filter=null}_=RGBFilter_contentPanel.prototype;
_.update=function(a){this.filter=a||this.filter;this.controlledElements.id.value=this.filter.getAttribute("id");this.colorMatrix=this.filter.querySelector("feColorMatrix").getAttribute("values").split(" ");this.controlledElements.red.value=this.controlledElements.red_slider.value=this.controlledElements.red_slider.startValue=parseFloat(this.colorMatrix[0]);this.controlledElements.green.value=this.controlledElements.green_slider.value=this.controlledElements.green_slider.startValue=parseFloat(this.colorMatrix[6]);
this.controlledElements.blue.value=this.controlledElements.blue_slider.value=this.controlledElements.blue_slider.startValue=parseFloat(this.colorMatrix[12])};_.onClick_cloneFilter=function(a){a=this.appRef.activeEditablePage;var b=this.filter.cloneNode(!0),c=a.addElementToProjectDefs(b);a.setAttributeElementList_undable(a.selectionList,{filter:c},!1);this.update(b)};
_.onChange_id=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.filter,a)};
_.onChange_red=function(a){a.target.startValue&&(this.colorMatrix[0]=a.target.startValue,this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")}));this.colorMatrix[0]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")},!1);this.update()};
_.onInputRange_red=function(a){this.controlledElements.red.value=this.colorMatrix[0]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")})};
_.onChange_green=function(a){a.target.startValue&&(this.colorMatrix[6]=a.target.startValue,this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")}));this.colorMatrix[6]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")},!1);this.update()};
_.onInputRange_green=function(a){this.controlledElements.green.value=this.colorMatrix[6]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")})};
_.onChange_blue=function(a){a.target.startValue&&(this.colorMatrix[12]=a.target.startValue,this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")}));this.colorMatrix[12]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")},!1);this.update()};
_.onInputRange_blue=function(a){this.controlledElements.blue.value=this.colorMatrix[12]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")})};function SaturateFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.controlledElements=this.connectEvents()}_=SaturateFilter_contentPanel.prototype;
_.update=function(a){this.filter=a||this.filter;this.controlledElements.id.value=this.filter.getAttribute("id");this.controlledElements.saturate.value=this.controlledElements.saturate_slider.value=this.controlledElements.saturate_slider.startValue=parseFloat(this.filter.querySelector("feColorMatrix").getAttribute("values"))};
_.onClick_cloneFilter=function(a){a=this.appRef.activeEditablePage;var b=this.filter.cloneNode(!0),c=a.addElementToProjectDefs(b);a.setAttributeElementList_undable(a.selectionList,{filter:c},!1);this.update(b)};_.onChange_id=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.filter,a)};
_.onChange_saturate=function(a){a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feColorMatrix")],{values:a.target.value},!1);this.update()};
_.onInputRange_saturate=function(a){this.controlledElements.saturate.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:a.target.value})};function HueRotateFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.controlledElements=this.connectEvents()}_=HueRotateFilter_contentPanel.prototype;
_.update=function(a){this.filter=a||this.filter;this.controlledElements.id.value=this.filter.getAttribute("id");this.controlledElements.hueRotate.value=this.controlledElements.hueRotate_slider.value=this.controlledElements.hueRotate_slider.startValue=parseFloat(this.filter.querySelector("feColorMatrix").getAttribute("values"))};
_.onClick_cloneFilter=function(a){a=this.appRef.activeEditablePage;var b=this.filter.cloneNode(!0),c=a.addElementToProjectDefs(b);a.setAttributeElementList_undable(a.selectionList,{filter:c},!1);this.update(b)};_.onChange_id=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.filter,a)};
_.onChange_hueRotate=function(a){a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feColorMatrix")],{values:a.target.value},!1);this.update()};
_.onInputRange_hueRotate=function(a){this.controlledElements.hueRotate.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:a.target.value})};function BrushFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.controlledElements=this.connectEvents()}_=BrushFilter_contentPanel.prototype;
_.update=function(a){this.filter=a||this.filter;this.controlledElements.id.value=this.filter.getAttribute("id");a=parseFloat(this.filter.querySelector("feTurbulence").getAttribute("baseFrequency"));var b=parseFloat(this.filter.querySelector("feTurbulence").getAttribute("numOctaves")),c=parseFloat(this.filter.querySelector("feDisplacementMap").getAttribute("scale"));this.controlledElements.baseFrequency.value=this.controlledElements.baseFrequency_slider.value=this.controlledElements.baseFrequency_slider.startValue=
a;this.controlledElements.numOctaves.value=this.controlledElements.numOctaves_slider.value=this.controlledElements.numOctaves_slider.startValue=b;this.controlledElements.displacementMapScale.value=this.controlledElements.displacementMapScale_slider.value=this.controlledElements.displacementMapScale_slider.startValue=c};
_.onClick_cloneFilter=function(a){a=this.appRef.activeEditablePage;var b=this.filter.cloneNode(!0),c=a.addElementToProjectDefs(b);a.setAttributeElementList_undable(a.selectionList,{filter:c},!1);this.update(b)};_.onChange_id=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.filter,a)};
_.onChange_baseFrequency=function(a){a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feTurbulence")],{baseFrequency:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feTurbulence")],{baseFrequency:a.target.value},!1);this.update()};
_.onInputRange_baseFrequency=function(a){this.controlledElements.baseFrequency.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feTurbulence")],{baseFrequency:a.target.value})};
_.onChange_numOctaves=function(a){a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feTurbulence")],{numOctaves:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feTurbulence")],{numOctaves:a.target.value},!1);this.update()};
_.onInputRange_numOctaves=function(a){this.controlledElements.numOctaves.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feTurbulence")],{numOctaves:a.target.value})};
_.onChange_displacementMapScale=function(a){a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feDisplacementMap")],{scale:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feDisplacementMap")],{scale:a.target.value},!1);this.update()};
_.onInputRange_displacementMapScale=function(a){this.controlledElements.displacementMapScale.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feDisplacementMap")],{scale:a.target.value})};function FancyGooFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.controlledElements=this.connectEvents()}_=FancyGooFilter_contentPanel.prototype;
_.update=function(a){this.filter=a||this.filter;this.controlledElements.id.value=this.filter.getAttribute("id");this.colorMatrix=this.filter.querySelector("feColorMatrix").getAttribute("values").split(" ");this.controlledElements.matrixAlpha.value=this.controlledElements.matrixAlpha_slider.value=this.controlledElements.matrixAlpha_slider.startValue=parseFloat(this.colorMatrix[18]);this.controlledElements.blurDeviation.value=this.controlledElements.blurDeviation_slider.value=this.controlledElements.blurDeviation_slider.startValue=
parseFloat(this.filter.querySelector("feGaussianBlur").getAttribute("stdDeviation"))};_.onClick_cloneFilter=function(a){a=this.appRef.activeEditablePage;var b=this.filter.cloneNode(!0),c=a.addElementToProjectDefs(b);a.setAttributeElementList_undable(a.selectionList,{filter:c},!1);this.update(b)};_.onChange_id=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.filter,a)};
_.onChange_matrixAlpha=function(a){a.target.startValue&&(this.colorMatrix[18]=a.target.startValue,this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")}));this.colorMatrix[18]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")},!1);this.update()};
_.onInputRange_matrixAlpha=function(a){this.controlledElements.matrixAlpha.value=this.colorMatrix[18]=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feColorMatrix")],{values:this.colorMatrix.join(" ")})};
_.onChange_blurDeviation=function(a){a.target.startValue&&this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feGaussianBlur")],{stdDeviation:a.target.startValue});this.appRef.activeEditablePage.setAttributeElementList_undable([this.filter.querySelector("feGaussianBlur")],{stdDeviation:a.target.value},!1);this.update()};
_.onInputRange_blurDeviation=function(a){this.controlledElements.blurDeviation.value=a.target.value;this.appRef.activeEditablePage.setAttributeElementList([this.filter.querySelector("feGaussianBlur")],{stdDeviation:a.target.value})};function GenericFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.controlledElements=this.connectEvents()}_=GenericFilter_contentPanel.prototype;
_.update=function(a){this.filter=a||this.filter;this.filter.hasAttribute("data-name")?this.querySelector(".content-title").innerHTML=this.filter.getAttribute("data-name"):this.querySelector(".content-title").innerHTML="Svg filter";this.controlledElements.id.value=this.filter.getAttribute("id")};_.onClick_cloneFilter=function(a){a=this.appRef.activeEditablePage;var b=this.filter.cloneNode(!0),c=a.addElementToProjectDefs(b);a.setAttributeElementList_undable(a.selectionList,{filter:c},!1);this.update(b)};
_.onChange_id=function(a){a=this.controlledElements.id.value;""==a&&(a=CreateUniqueIDI());this.appRef.activeEditablePage.refactorElementID_undable(this.filter,a)};function Edit2D_ctxMenu(a){a.appRef&&(this.appRef=a.appRef);this.connectEvents()}_=Edit2D_ctxMenu.prototype;_.onShow=function(a){console.log("onShow di Edit2D_ctxMenu",this.appRef.activeEditablePage.getPen())};_.onClickShowLibrary=function(a){this.appRef.contextPanels.showContextPanel("LIBRARY_2D_CONTEXT_PANEL")};_.onClickShowPixabay=function(a){this.appRef.contextPanels.showContextPanel("PIXABAY_2D_CONTEXT_PANEL")};
_.onClick_createSymbol=function(a){var b=this.appRef.activeEditablePage,c=this.appRef.promptModalDialog,d=this.appRef.alertModalDialog;if(0==b.selectionList.length)d.open(LOCALIZER.translate("Need selection"),LOCALIZER.translate("Select the elements that you want to convert to symbol."));else{if(1!=b.areElementListChildrenOfTheSameParent(b.selectionList))return d.open(LOCALIZER.translate("Invalid operation"),LOCALIZER.translate("The elements must be inside the same level!")),null;c.setPromptValue("",
"auto");c.open(LOCALIZER.translate("Symbol id"),LOCALIZER.translate("Give a custom symbol name."),function(){var a=c.getPromptValue();""==a&&(a=CreateUniqueIDI());b.getElementFromProjectDefs("#"+a)?d.open(LOCALIZER.translate("Invalid operation"),LOCALIZER.translate("An element with that name already exists!")):(b.createSymbol_undable(b.selectionList,a),b.appRef.symbolLibrary2DPanel.update())})}};
_.onClick_createPattern=function(a){var b=this.appRef.activeEditablePage,c=this.appRef.promptModalDialog,d=this.appRef.alertModalDialog;if(0==b.selectionList.length)d.open(LOCALIZER.translate("Need selection"),LOCALIZER.translate("Select the elements that you want to convert to pattern."));else{if(1!=b.areElementListChildrenOfTheSameParent(b.selectionList))return d.open(LOCALIZER.translate("Invalid operation"),LOCALIZER.translate("The elements must be inside the same level!")),null;c.setPromptValue("",
"auto",/[a-zA-Z]+/g);c.open(LOCALIZER.translate("Pattern id"),LOCALIZER.translate("Give a custom pattern name."),function(){var a=c.getPromptValue();""==a&&(a=CreateUniqueIDI());b.getElementFromProjectDefs("#"+a)?d.open(LOCALIZER.translate("Invalid operation"),LOCALIZER.translate("An element with that name already exists!")):b.createPattern_undable(b.selectionList,a)})}};
_.onClick_createMarker=function(a){var b=this.appRef.activeEditablePage,c=this.appRef.promptModalDialog,d=this.appRef.alertModalDialog;if(0==b.selectionList.length)d.open(LOCALIZER.translate("Need selection"),LOCALIZER.translate("Select the elements that you want to convert to marker."));else{if(1!=b.areElementListChildrenOfTheSameParent(b.selectionList))return d.open(LOCALIZER.translate("Invalid operation"),LOCALIZER.translate("The elements must be inside the same level!")),null;c.setPromptValue("",
"auto",/[a-zA-Z]+/g);c.open(LOCALIZER.translate("Marker id"),LOCALIZER.translate("Give a custom marker name."),function(){var a=c.getPromptValue();""==a&&(a=CreateUniqueIDI());b.getElementFromProjectDefs("#"+a)?d.open(LOCALIZER.translate("Invalid operation"),LOCALIZER.translate("An element with that name already exists!")):b.createMarker_undable(b.selectionList,a)})}};
_.onClick_convertToBitmap=function(a){this.appRef.activeEditablePage.getElementAsBitmap(this.appRef.activeEditablePage.selectionList[0],function(a){console.log("_bitmapCache",a)},50)};_.onClick_createClipPath=function(a){this.appRef.activeEditablePage.createClippedContent_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_createMask=function(a){this.appRef.activeEditablePage.createMaskedContent_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_undo=function(){this.appRef.activeEditablePage.undo()};
_.onClick_redo=function(){this.appRef.activeEditablePage.redo()};_.onClick_bringToFront=function(a){this.appRef.activeEditablePage.setElementListOrderZ_undable(this.appRef.activeEditablePage.selectionList,"bringToFront")};_.onClick_sendToBack=function(a){this.appRef.activeEditablePage.setElementListOrderZ_undable(this.appRef.activeEditablePage.selectionList,"sendToBack")};_.onClick_fitPageToView=function(a){this.appRef.workspace.fitActivePageToView()};_.onClick_fitPageTo=function(a){this.appRef.workspace.viewActivePageAtScale(1)};
_.onClick_selectAll=function(a){this.appRef.activeEditablePage.selectAll()};_.onClick_copy=function(a){this.appRef.activeEditablePage.isTextEditing?this.appRef.activeEditablePage.editableSVGTextElement.copySelectedText(a):document.execCommand("copy")};_.onClick_cut=function(a){this.appRef.activeEditablePage.isTextEditing?this.appRef.activeEditablePage.editableSVGTextElement.cutSelectedText(a):document.execCommand("cut")};
_.onClick_paste=function(a){var b=this;navigator.clipboard.readText().then(function(a){if(b.appRef.activeEditablePage.isTextEditing)b.appRef.activeEditablePage.editableSVGTextElement.pasteText(a);else b.appRef.activeEditablePage.onPasteTextAsSvg(a)})};
_.onClick_pasteInPlace=function(a){var b=this;navigator.clipboard.readText().then(function(a){if(b.appRef.activeEditablePage.isTextEditing)b.appRef.activeEditablePage.editableSVGTextElement.pasteText(a);else b.appRef.activeEditablePage.onPasteTextAsSvg(a,!0)})};_.onClick_lock=function(a){this.appRef.activeEditablePage.lockElementList(this.appRef.activeEditablePage.selectionList)};_.onClick_unlock=function(a){this.appRef.activeEditablePage.unlockAllElements()};_.onClick_lockGuides=function(a){this.appRef.activeEditablePage.guides.classList.add("locked")};
_.onClick_unlockGuides=function(a){this.appRef.activeEditablePage.guides.classList.remove("locked")};_.onClick_duplicate=function(a){this.appRef.activeEditablePage.duplicateElementList_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_group=function(a){this.appRef.activeEditablePage.groupElementList_undable(this.appRef.activeEditablePage.selectionList)};_.onClick_ungroup=function(a){this.appRef.activeEditablePage.ungroupElementList_undable(this.appRef.activeEditablePage.selectionList)};
function Base2D_tool(a){this.appRef=a;this.wheelRangeOfActivation=30;this.sumOfWheelValue=0;this.isWheelStarted=!1;this.counter2=this.counter1=0;this.selectionMode="GLOBAL_SELECTION";"firefox"==BROWSER_TYPE&&(this.wheelRangeOfActivation=1)}_=Base2D_tool.prototype;_.onActivate=function(){};_.onDeactivate=function(){};
_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.showSelectionProperties();a.createElementListPreviews(null,a.selectionList);if(1==a.selectionList.length){var b=a.selectionList[0];if("line"==b.nodeName){b=b.getGeometryPointList();a.selectPointList([b[1]]);a.setCurrentEditablePoint(b[1]);this.appRef.interaction2D.segment2D.setInteractivePathSegment(b[0],b[1]);this.appRef.interaction2D.points2D.show();return}if("path"==b.nodeName&&(b=b.getGeometryPointList(),2==b.length&&"L"==b[1].type)){a.selectPointList([b[1]]);
a.setCurrentEditablePoint(b[1]);this.appRef.interaction2D.segment2D.setInteractivePathSegment(b[0],b[1]);this.appRef.interaction2D.points2D.show();return}}"GLOBAL_SELECTION"==this.selectionMode?(a.setCurrentEditablePoint(null),this.appRef.interaction2D.segment2D.currentSegmentRef=null,this.appRef.interaction2D.bbox2D.show()):"POINT_SELECTION"==this.selectionMode&&(this.appRef.interaction2D.points2D.show(),this.appRef.interaction2D.segment2D.showActiveInteractivePathSegment())};
_.onMouseDownOnInteractionPoint=function(){};_.doSingleElementSelection=function(a){var b=this.appRef.activeEditablePage;b.deselectAllElements();var c=b.screenPointToPen(GMOUSE.mouseDownPt);b.setPen(c);c.elementAtPoint&&(c=c.elementAtPoint,c.isLocked()||a&&c.nodeName!=a||(b.selectElement(c),b.setCurrentEditableElement(c),b.updateInteraction()))};_.onKeyDown=function(a){};_.onKeyUp=function(a){};_.onUndo=function(){};_.onRedo=function(){};_.onMouseDown=function(a){};_.onMouseUp=function(a){if(Event.isDoubleClick)this.onMouseDoubleClick(a)};
_.onMouseMove=function(a){if(!Event.isSpaceKeyPressed){a=this.appRef.activeEditablePage;var b=a.screenPointToPen(GMOUSE.mouseMovePt);a.setPen(b)}};_.onMouseDoubleClick=function(a){this.appRef.workspace.fitActivePageToView()};_.onGlobalMouseStartDrag=function(a){};_.onGlobalMouseDrag=function(a){};_.onGlobalMouseEndDrag=function(a){};_.onTouchEnd=function(a){};_.onGestureStart=function(a){};_.onGestureEnd=function(a){};_.exitByGesture=function(){};
_.onMouseWheel=function(a){function b(){d.isWheelCheck=!0;setTimeout(function(){5<d.counter1&&(console.log("start wheeling!"),d.isWheelStarted=!0,d.appRef.activeEditablePage.removeAllInteractions(),d.appRef.disablePagePreviewsRendering(),c());d.isWheelCheck=!1;d.counter1=0},100)}function c(){d.counter2=d.counter1;setTimeout(function(){if(d.counter2==d.counter1)console.log("stop wheeling!"),d.isWheelStarted=!1,d.counter1=0,d.counter2=0,d.appRef.activeEditablePage.updateInteraction(),d.appRef.enablePagePreviewsRendering();
else{c();var a=1;var b=1/d.appRef.activeEditablePage.content.currentScale*.03*d.counter1;.03>b?b=.03:.2<b&&(b=.2);a=0<d.wheelValue?a+b:a-b;b=d.appRef.activeEditablePage.mousePointInDocumentSpace(GMOUSE.mouseMovePt);d.appRef.workspace.zoom(a,b.x,b.y)}},50)}var d=this;a=window.event||a;d.wheelValue=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));this.counter1+=1;1!=this.isWheelStarted&&1!=this.isWheelCheck&&b()};
_.onTouchStart=function(a){this.fingerTouches=[];if(1==a.targetTouches.length)this.onMouseDown(a);else 2==a.targetTouches.length&&(this.fingerTouches=a.targetTouches,this.gesturePreviousScale=1,this.gesturePreviousCenter={x:this.fingerTouches[0].pageX+(this.fingerTouches[1].pageX-this.fingerTouches[0].pageX)/2,y:this.fingerTouches[0].pageY+(this.fingerTouches[1].pageY-this.fingerTouches[0].pageY)/2},console.log("gesturePreviousCenter",this.gesturePreviousCenter))};
_.onTouchMove=function(a){console.log("onTouchMove");this.fingerTouches=2==a.targetTouches.length&&2==a.touches.length?a.targetTouches:[]};
_.onGestureChange=function(a){console.log("onGestureChange");if(2==this.fingerTouches.length){var b=this.fingerTouches[0].pageX+(this.fingerTouches[1].pageX-this.fingerTouches[0].pageX)/2,c=this.fingerTouches[0].pageY+(this.fingerTouches[1].pageY-this.fingerTouches[0].pageY)/2;this.appRef.activeEditablePage.zoom(a.scale/this.gesturePreviousScale,b,c);this.gesturePreviousScale=a.scale;this.gesturePreviousCenter.x=b;this.gesturePreviousCenter.y=c}};_.exitByGesture=function(){};
Extends(PanView2D_tool,Base2D_tool);function PanView2D_tool(a){PanView2D_tool.superConstructor.call(this,a);this.previousMousePosition={x:0,y:0}}_=PanView2D_tool.prototype;_.onActivate=function(){this.appRef.activeEditablePage.removeAllInteractions()};_.onMouseDown=function(a){this.appRef.activeEditablePage.removeAllInteractions();GMOUSE.globalMouseTargetDelegate=this};_.onMouseMove=function(a){};_.setStartDragPosition=function(a){this.previousMousePosition.x=a.x;this.previousMousePosition.y=a.y};
_.onGlobalMouseStartDrag=function(a){this.previousMousePosition={x:GMOUSE.mouseDownPt.x,y:GMOUSE.mouseDownPt.y}};
_.onGlobalMouseDrag=function(a){if(Event.isAltKeyPressed){var b=this.appRef.activeEditablePage.mousePointInDocumentSpace(GMOUSE.mouseMovePt);this.appRef.workspace.zoom(Math.abs(1+.005*(GMOUSE.mouseMovePt.y-this.previousMousePosition.y)),b.x,b.y)}else this.appRef.workspace.pan(GMOUSE.mouseMovePt.x-this.previousMousePosition.x,GMOUSE.mouseMovePt.y-this.previousMousePosition.y);this.previousMousePosition={x:GMOUSE.mouseMovePt.x,y:GMOUSE.mouseMovePt.y};a.preventPropagation()};
_.onGlobalMouseEndDrag=function(a){this.appRef.activeEditablePage.updateInteraction();a.preventPropagation()};Extends(ZoomView2D_tool,Base2D_tool);function ZoomView2D_tool(a){ZoomView2D_tool.superConstructor.call(this,a);this.previousMousePosition={x:0,y:0}}_=ZoomView2D_tool.prototype;_.onActivate=function(){this.appRef.activeEditablePage.removeAllInteractions()};
_.onMouseDown=function(a){this.appRef.activeEditablePage.removeAllInteractions();if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else GMOUSE.globalMouseTargetDelegate=this};_.onGlobalMouseStartDrag=function(a){this.previousMousePosition={x:GMOUSE.mouseDownPt.x,y:GMOUSE.mouseDownPt.y}};
_.onGlobalMouseDrag=function(a){var b=this.appRef.activeEditablePage.mousePointInDocumentSpace(GMOUSE.mouseDownPt);this.appRef.workspace.zoom(Math.abs(1+.005*(GMOUSE.mouseMovePt.y-this.previousMousePosition.y)),b.x,b.y);this.previousMousePosition={x:GMOUSE.mouseMovePt.x,y:GMOUSE.mouseMovePt.y};a.preventPropagation()};_.onGlobalMouseEndDrag=function(a){this.appRef.activeEditablePage.updateInteraction();a.preventPropagation()};Extends(Selection2D_tool,Base2D_tool);
function Selection2D_tool(a,b){Selection2D_tool.superConstructor.call(this,a);this.selectionMode=b}_=Selection2D_tool.prototype;_.onActivate=function(){this.appRef.activeEditablePage&&this.appRef.activeEditablePage.updateInteraction()};
_.onMouseDown=function(a){var b=this.appRef.activeEditablePage;if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else{var c=b.getPen();null==c&&(c=b.screenPointToPen(GMOUSE.mouseMovePt),b.setPen(c));this.clickedElement=c.elementAtPoint;console.log("this.clickedElement",this.clickedElement);this.clickedElement&&(this.clickedElement=b.getMainElement(this.clickedElement),this.clickedElement.isLocked()&&(this.clickedElement=null),b.is_isolateLayerEditing()&&!this.clickedElement.getLayerOwner().classList.contains("selected")&&
(this.clickedElement=null));if(this.clickedElement){if(0==b.selectGroupChildren&&"GLOBAL_SELECTION"==this.selectionMode&&(this.clickedElement=this.clickedElement.getFirstLevelOfLayerOwner()),!Event.isShiftKeyPressed){this.clickedElement.isSelected()||(b.deselectAllElements(),b.selectElement(this.clickedElement));b.setCurrentEditableElement(this.clickedElement);if("GLOBAL_SELECTION"!=this.selectionMode&&"path"==this.clickedElement.nodeName){console.log("Selection2D_tool pen",c);var d=this.clickedElement.findSegmentAtPoint(c.pointInDocumentSpace,
1/b.content.currentScale*b.snapDistance);if(d){console.log("-------selectionInfo.segment",d.segment);this.appRef.interaction2D.segment2D.setInteractivePathSegment(d.previousSegment,d.segment);this.clickedElement.interactiveElement&&this.clickedElement.interactiveElement.parentElement||b.createElementListPreviews(null,[this.clickedElement],"#0047FF");c.selectionInfo=d;this.clickedElement.selectionInfo=d;if(a.altKey){b.dividePathAtLocation_undable(this.clickedElement,d.subPathId,c.pointInDocumentSpace);
this.appRef.tools.translatePoint2D_tool.onMouseDown();return}if("C"==d.segment.type){this.appRef.tools.translateCubicCurve2D_tool.setTranslationData(c);this.appRef.tools.translateCubicCurve2D_tool.onMouseDown(a);return}if("L"==d.segment.type){b.setCurrentEditablePoint(d.segment);this.appRef.tools.translateSegmentLineTo2D_tool.setTranslationData(c);this.appRef.tools.translateSegmentLineTo2D_tool.onMouseDown(a);return}}}this.appRef.tools.translate2D_tool.onMouseDown(a)}}else this.appRef.tools.selectionByRectArea2D_tool.onMouseDown(a)}};
_.onMouseUp=function(a){console.log("Selection tools onMouseUp");var b=this.appRef.activeEditablePage;if(Event.isShiftKeyPressed)this.clickedElement&&(this.clickedElement.isSelected()?b.deselectElement(this.clickedElement):(b.selectElement(this.clickedElement),b.setCurrentEditableElement(this.clickedElement)),b.updateInteraction());else if(Event.isDoubleClick)this.onMouseDoubleClick(a);else this.clickedElement||b.deselectAllElements(),b.updateInteraction()};
_.onMouseDoubleClick=function(a){this.appRef.activeEditablePage.pen=null;this.clickedElement?(console.log("onMouseDoubleClick",this.clickedElement),"path"==this.clickedElement.nodeName?"POINT_SELECTION"!=this.selectionMode&&this.appRef.activateTool("selectionPoint2D_tool"):"ellipse"==this.clickedElement.nodeName||"rect"==this.clickedElement.nodeName||"line"==this.clickedElement.nodeName?(this.appRef.activeEditablePage.convertElementListToPath_undable([this.clickedElement]),"POINT_SELECTION"!=this.selectionMode&&
this.appRef.activateTool("selectionPoint2D_tool")):"use"==this.clickedElement.nodeName?(a=document.querySelector(this.clickedElement.getAttribute("href")),this.appRef.activeEditablePage.enterTo_isolateLayerEditing(a)):"g"==this.clickedElement.nodeName?this.appRef.activeEditablePage.enterTo_isolateLayerEditing(this.clickedElement):"text"==this.clickedElement.nodeName&&this.appRef.activeEditablePage.enterTo_TextEditing(this.clickedElement)):this.appRef.activeEditablePage.is_isolateLayerEditing()?this.appRef.activeEditablePage.exitFrom_isolateLayerEditing():
"GLOBAL_SELECTION"!=this.selectionMode?this.appRef.activateTool("selectionGlobal2D_tool"):this.appRef.workspace.fitActivePageToView()};Extends(SelectionByRectArea2D_tool,Base2D_tool);function SelectionByRectArea2D_tool(a){SelectionByRectArea2D_tool.superConstructor.call(this,a);this.interactiveElement=document.querySelector("#INTERACTIVE_SELECTION_RECT_AREA")}_=SelectionByRectArea2D_tool.prototype;_.onMouseDown=function(a){GMOUSE.globalMouseTargetDelegate=this};
_.onGlobalMouseStartDrag=function(a){this.appRef.activeEditablePage.removeAllInteractions();this.updateInteractiveElement();ShowElement(this.interactiveElement);this.appRef.documentsContainer.classList.add("element-selection-by-rect-area")};_.onGlobalMouseDrag=function(a){this.updateInteractiveElement()};
_.onGlobalMouseEndDrag=function(a){HideElements([this.interactiveElement]);var b=this.appRef.activeEditablePage,c=b.createSVGRect();c.x=this.interactiveElement.x.baseVal.value;c.y=this.interactiveElement.y.baseVal.value;c.width=this.interactiveElement.width.baseVal.value;c.height=this.interactiveElement.height.baseVal.value;c.left=c.x;c.top=c.y;c.right=c.x+c.width;c.bottom=c.y+c.height;this.interactiveElement.hitRect=c;c=b.elementListFromIntersection(c);this.appRef.documentsContainer.classList.remove("element-selection-by-rect-area");
0==c.length?(a.shiftKey||b.deselectAllElements(),b.updateInteraction()):"GLOBAL_SELECTION"==this.appRef.tools.activeTool.selectionMode?this.selectElements_globalMode(a,c):this.selectElements_localMode(a,c)};
_.updateInteractiveElement=function(){var a=this.appRef.activeEditablePage,b=a.mousePointInDocumentSpace(GMOUSE.mouseDownPt),c=a.mousePointInDocumentSpace(GMOUSE.mouseMovePt);a=Math.min(b.x,c.x);var d=Math.min(b.y,c.y),e=Math.abs(c.x-b.x);b=Math.abs(c.y-b.y);0==e&&(e=1);0==b&&(b=1);this.interactiveElement.updateGeometry(a,d,e,b)};
_.selectElements_globalMode=function(a,b){var c=this.appRef.activeEditablePage,d=[],e,f=b.length;for(e=0;e<f;e++){var g=b[e].getFirstLevelOfLayerOwner();-1==d.indexOf(g)&&d.push(g)}if(a.shiftKey)for(f=d.length,e=0;e<f;e++)g=d[e],g.isSelected()?c.deselectElement(g):c.selectElement(g);else c.selectElementList(d);c.updateInteraction()};
_.selectElements_localMode=function(a,b){var c=this.appRef.activeEditablePage;if(a.shiftKey)for(var d=0;d<b.length;d++)c.selectElement(b[d]);else c.selectElementList(b);c.updateInteraction();this.appRef.interaction2D.classList.add("point-selection-area-mode");var e=this.appRef.interaction2D.getIntersectionList(this.interactiveElement.hitRect,null);console.log("handleList",e);var f=e.length;for(d=0;d<f;d++){var g=e[d].parentElement;g.classList.contains("interaction-point")&&(g.pointRef.isSelected?
(g.classList.remove("selected"),c.deselectPoint(g.pointRef)):(g.classList.add("selected"),c.selectPoint(g.pointRef)))}this.appRef.interaction2D.classList.remove("point-selection-area-mode");c.showSelectionProperties()};Extends(Translate2D_tool,Base2D_tool);function Translate2D_tool(a){Translate2D_tool.superConstructor.call(this,a);this.selectionGlobalBBox=null;this.storedStartTranslationPoint={x:0,y:0};this.storedEndTranslationPoint={x:0,y:0}}_=Translate2D_tool.prototype;
_.onMouseDown=function(a){GMOUSE.globalMouseTargetDelegate=this};
_.onGlobalMouseStartDrag=function(a){var b=this.appRef.activeEditablePage;b.disableSelectionPointerEvents();a.altKey&&(b.duplicateElementList_undable(b.selectionList,0,0),b.setCurrentEditableElement(b.selectionList[b.selectionList.length-1]));this.previousPen=b.getPen();this.startPenInDocumentSpace=this.previousPen.pointInDocumentSpace;this.storedStartTranslationPoint.x=this.previousPen.pointInDocumentSpace.x;this.storedStartTranslationPoint.y=this.previousPen.pointInDocumentSpace.y;b.removeAllInteractions();
this.selectionGlobalBBox=null;b.snapToBBoxProjections&&(this.selectionGlobalBBox=b.getElementListGlobalBBox(b.selectionList),this.selectionGlobalBBox.penOffset=b.createSVGPoint(b.getPen().pointInDocumentSpace.x-this.selectionGlobalBBox.x,b.getPen().pointInDocumentSpace.y-this.selectionGlobalBBox.y));this.undoAction=new SetMatrix2D_action(b);this.redoAction=new SetMatrix2D_action(b);b.history.addUndoRedoActions(this.undoAction,this.redoAction);this.undoAction.addElementList(b.selectionList);this.appRef.disablePagePreviewsRendering()};
_.onGlobalMouseDrag=function(a){var b=this.appRef.activeEditablePage,c=b.screenPointToPen(GMOUSE.mouseMovePt);if(a.shiftKey)c.pointInDocumentSpace=b.applySnapTo_angle(c.pointInDocumentSpace,this.startPenInDocumentSpace);else if(b.snapToBBoxProjections){var d=b.createSVGPoint(c.pointInDocumentSpace.x-this.selectionGlobalBBox.penOffset.x,c.pointInDocumentSpace.y-this.selectionGlobalBBox.penOffset.y);a=b.createSVGPoint(d.x+this.selectionGlobalBBox.width,d.y+this.selectionGlobalBBox.height);var e=b.createSVGPoint(d.x+
this.selectionGlobalBBox.width/2,d.y+this.selectionGlobalBBox.height/2);d=b.applySnapTo_bboxProjections(d,c.snapDistanceX,c.snapDistanceY);d.x&&(c.pointInDocumentSpace.x=d.x+this.selectionGlobalBBox.penOffset.x);d.y&&(c.pointInDocumentSpace.y=d.y+this.selectionGlobalBBox.penOffset.y);d=b.applySnapTo_bboxProjections(a,d.snapDistanceX,d.snapDistanceY);d.x&&(c.pointInDocumentSpace.x=d.x-this.selectionGlobalBBox.width+this.selectionGlobalBBox.penOffset.x);d.y&&(c.pointInDocumentSpace.y=d.y-this.selectionGlobalBBox.height+
this.selectionGlobalBBox.penOffset.y);d=b.applySnapTo_bboxProjections(e,d.snapDistanceX,d.snapDistanceY);d.x&&(c.pointInDocumentSpace.x=d.x-this.selectionGlobalBBox.width/2+this.selectionGlobalBBox.penOffset.x);d.y&&(c.pointInDocumentSpace.y=d.y-this.selectionGlobalBBox.height/2+this.selectionGlobalBBox.penOffset.y)}this.appRef.activeEditablePage.translateElementList(this.appRef.activeEditablePage.selectionList,c.pointInDocumentSpace.x-this.previousPen.pointInDocumentSpace.x,c.pointInDocumentSpace.y-
this.previousPen.pointInDocumentSpace.y);this.previousPen=c};_.onGlobalMouseEndDrag=function(a){a=this.appRef.activeEditablePage;a.updateInteraction();this.redoAction.addElementList(a.selectionList);this.saveTransformAction();a.enableSelectionPointerEvents();this.appRef.enablePagePreviewsRendering()};
_.saveTransformAction=function(){this.storedEndTranslationPoint.x=this.previousPen.pointInDocumentSpace.x;this.storedEndTranslationPoint.y=this.previousPen.pointInDocumentSpace.y;var a=this.storedEndTranslationPoint.x-this.storedStartTranslationPoint.x,b=this.storedEndTranslationPoint.y-this.storedStartTranslationPoint.y,c=this.appRef.activeEditablePage,d=c.content.getTransform().matrix.clone();c.applyLastTransformAction=function(e){var f=c.content.getTransform().matrix.clone();this.content.getTransform().setMatrix(d);
this.translateElementList(e,a,b);this.content.getTransform().setMatrix(f)}};Extends(TransformPoint2D_tool,Base2D_tool);function TransformPoint2D_tool(a){TransformPoint2D_tool.superConstructor.call(this,a);this.transformDataPointList=null;this.createUndoRedoActionsFlag=!0}_=TransformPoint2D_tool.prototype;_.onMouseDown=function(a){GMOUSE.globalMouseTargetDelegate=this};
_.initTransformDataPointList=function(){this.transformDataPointList=this.appRef.activeEditablePage.getSelectedTransformablePointData();for(var a,b=this.transformDataPointList.length,c=0;c<b;c++)a=this.transformDataPointList[c],a=a.element,a.interactiveElement.geometryPointList=a.geometryPointList,a.setGeometryPointList(a.interactiveElement.cloneGeometryPointList())};
_.swapTransformDataPointListFromInteractionElementToElement=function(){var a=this.transformDataPointList.length;console.log("this.transformDataPointList",this.transformDataPointList);for(var b=0;b<a;b++){var c=this.transformDataPointList[b];c=c.element;c.geometryPointList=c.interactiveElement.geometryPointList;c.interactiveElement=null;c.render()}};
_.createUndoRedoActions=function(){var a=[],b,c,d=this.transformDataPointList.length;for(c=0;c<d;c++){var e=this.transformDataPointList[c];var f=e.element;e=e.pointDataList;var g=e.length;f={element:f,pointDataList:[]};for(b=0;b<g;b++){var h=e[b];h=h.point;f.pointDataList.push({point:h,values:{x:h.x,y:h.y}})}a.push(f)}console.log("undoTransformDataPointList",this.transformDataPointList);console.log("redoTransformDataPointList",a);c=this.appRef.activeEditablePage;d=new SetGeometryPoint2D_action(c);
e=new SetGeometryPoint2D_action(c);d.setTransformDataPointList(this.transformDataPointList);e.setTransformDataPointList(a);c.history.addUndoRedoActions(d,e);console.log("activeEditablePage.history",c.history)};
_.onGlobalMouseStartDrag=function(a){var b=this.appRef.activeEditablePage;this.appRef.disablePagePreviewsRendering();this.appRef.interaction2D.points2D.removeAllInteractionPoints();this.appRef.interaction2D.lengthPropertyLabel.hide();this.appRef.interaction2D.segment2D.hideSegments();this.initTransformDataPointList();this.previousPen=b.getPen();this.startPenInDocumentSpace=b.getPen().pointInDocumentSpace;if(b.currentEditablePoint){a=b.currentEditablePoint.ownerShapeElement;console.log("activeEditablePage.currentEditablePoint",
b.currentEditablePoint);b=b.currentEditablePoint.id;console.log("idPoint",b);var c=b-1;0>c&&(c=b+1);b=a.getGeometryPointList()[c];a=a.localToGlobal(b.x,b.y);this.appRef.interaction2D.smartPoints.showPoint0(a.x,a.y)}};_.onGlobalMouseDrag=function(a){};_.onGlobalMouseEndDrag=function(a){this.swapTransformDataPointListFromInteractionElementToElement();this.createUndoRedoActionsFlag&&this.createUndoRedoActions();this.appRef.activeEditablePage.updateInteraction();this.appRef.enablePagePreviewsRendering()};
Extends(TranslatePoint2D_tool,TransformPoint2D_tool);function TranslatePoint2D_tool(a){TranslatePoint2D_tool.superConstructor.call(this,a)}_=TranslatePoint2D_tool.prototype;
_.onGlobalMouseDrag=function(a){var b=this.appRef.activeEditablePage,c=b.screenPointToPen(GMOUSE.mouseMovePt,!0);a.shiftKey&&(c.pointInDocumentSpace=b.applySnapTo_angle(c.pointInDocumentSpace,this.startPenInDocumentSpace));b.translateTransformDataPointList(this.transformDataPointList,c.pointInDocumentSpace.x-this.previousPen.pointInDocumentSpace.x,c.pointInDocumentSpace.y-this.previousPen.pointInDocumentSpace.y);this.previousPen=c};Extends(TranslateControlPoint2D_tool,TransformPoint2D_tool);
function TranslateControlPoint2D_tool(a){TranslateControlPoint2D_tool.superConstructor.call(this,a);this.draggableControlPointList=null;this.smoothCurve=!1}_=TranslateControlPoint2D_tool.prototype;_.setDraggableControlPointList=function(a){this.draggableControlPointList=a};_.isSmoothedCurve=function(a,b,c){var d=b.x-a.x;b=b.y-a.y;var e=c.x-a.x;a=c.y-a.y;return d==e||b==a||.1>Math.abs(b/d-a/e)?!0:!1};
_.initTransformDataPointList=function(){this.transformDataPointList=[];this.pathTarget=this.draggableControlPointList[0].ownerPoint.ownerShapeElement;var a={element:this.pathTarget,pointDataList:[]};this.transformDataPointList.push(a);for(var b=0;b<this.draggableControlPointList.length;b++)a.pointDataList.push({point:this.draggableControlPointList[b],values:{x:this.draggableControlPointList[b].x,y:this.draggableControlPointList[b].y}});this.pathTarget.interactiveElement.geometryPointList=this.pathTarget.geometryPointList;
this.pathTarget.setGeometryPointList(this.pathTarget.interactiveElement.cloneGeometryPointList())};_.onGlobalMouseStartDrag=function(a){TranslateControlPoint2D_tool.superClass.onGlobalMouseStartDrag.call(this,a);this.smoothCurve=!1;if(2==this.draggableControlPointList.length){a=this.draggableControlPointList[0];var b=this.draggableControlPointList[1];this.smoothCurve=this.isSmoothedCurve("CTRL1"==a.type?b.ownerPoint:a.ownerPoint,a,b)}};
_.onGlobalMouseDrag=function(a){var b=this.appRef.activeEditablePage.screenPointToPen(GMOUSE.mouseMovePt),c=this.draggableControlPointList[0].ownerPoint.ownerShapeElement.getScreenCTM().inverse();c=SVGUtils.createSVGPoint(b.pointInDocumentSpace.x-this.previousPen.pointInDocumentSpace.x,b.pointInDocumentSpace.y-this.previousPen.pointInDocumentSpace.y).matrixTransform(c).subtract(SVGUtils.createSVGPoint().matrixTransform(c));var d=this.draggableControlPointList[0];d.x+=c.x;d.y+=c.y;if(2==this.draggableControlPointList.length&&
(c=this.smoothCurve,a.shiftKey&&(c=!1),c)){c=this.draggableControlPointList[1];var e="CTRL1"==d.type?c.ownerPoint:d.ownerPoint;var f=SVGUtils.createSVGPoint(e.x-d.x,e.y-d.y);d=f.normalize();var g=SVGUtils.createSVGPoint(c.x,c.y);a.altKey||this.reflectOppositeControlPoint?(c.x=e.x+f.x,c.y=e.y+f.y):(a=g.getDistanceFromPoint(e),c.x=e.x+d.x*a,c.y=e.y+d.y*a)}this.pathTarget.interactiveElement.renderRequest();this.previousPen=b};
_.onGlobalMouseEndDrag=function(a){this.swapTransformDataPointListFromInteractionElementToElement();this.createUndoRedoActionsFlag&&this.createUndoRedoActions();a=this.appRef.activeEditablePage;"Q"==this.draggableControlPointList[0].ownerPoint.type&&this.draggableControlPointList[0].ownerPoint.ownerShapeElement.convertQuandraticCurveToCubicCurve();a.updateInteraction();this.appRef.enablePagePreviewsRendering();this.appRef.interaction2D.smartGuides.resetGuideState();this.reflectOppositeControlPoint=
!1};Extends(TranslateSegmentCubic2D_tool,TransformPoint2D_tool);function TranslateSegmentCubic2D_tool(a){TranslateSegmentCubic2D_tool.superConstructor.call(this,a);this.interactiveCubicCurveSegmentTarget=this.cubicCurveSegmentTarget=null;this.t=this.weight=0;this.startControlPoint1={x:0,y:0};this.startControlPoint2={x:0,y:0};this.interactiveSegment=document.querySelector("#INTERACTIVE_PATH_SEGMENT_C")}_=TranslateSegmentCubic2D_tool.prototype;
_.setTranslationData=function(a){this.pathTarget=a.selectionInfo.path;this.cubicCurveSegmentTarget=a.selectionInfo.segment;this.startControlPoint1.x=this.cubicCurveSegmentTarget.controlPt1.x;this.startControlPoint1.y=this.cubicCurveSegmentTarget.controlPt1.y;this.startControlPoint2.x=this.cubicCurveSegmentTarget.controlPt2.x;this.startControlPoint2.y=this.cubicCurveSegmentTarget.controlPt2.y;this.t=this.interactiveSegment.getNearestPoint(this.interactiveSegment.globalToLocal(a.pointInDocumentSpace.x,
a.pointInDocumentSpace.y)).t;1==this.t?this.t=.9:0==this.t&&(this.t=.1);var b=this.t;this.weight=b<=1/6?0:.5>=b?Math.pow((6*b-1)/2,3)/2:b<=5/6?(1-Math.pow((6*(1-b)-1)/2,3))/2+.5:1;1==this.weight?this.weight=.9:0==this.weight&&(this.weight=.1);this.ctrlPt1_offset=(1-this.weight)/(3*b*(1-b)*(1-b));this.ctrlPt2_offset=this.weight/(3*b*b*(1-b));this.startDragOriginInLocal=this.pathTarget.globalToLocal(a.pointInDocumentSpace.x,a.pointInDocumentSpace.y)};
_.initTransformDataPointList=function(){this.transformDataPointList=[];this.transformDataPointList.push({element:this.pathTarget,pointDataList:[{point:this.cubicCurveSegmentTarget.controlPt1,values:{x:this.cubicCurveSegmentTarget.controlPt1.x,y:this.cubicCurveSegmentTarget.controlPt1.y}},{point:this.cubicCurveSegmentTarget.controlPt2,values:{x:this.cubicCurveSegmentTarget.controlPt2.x,y:this.cubicCurveSegmentTarget.controlPt2.y}}]});this.pathTarget.interactiveElement.geometryPointList=this.pathTarget.geometryPointList;
this.pathTarget.setGeometryPointList(this.pathTarget.interactiveElement.cloneGeometryPointList())};
_.onGlobalMouseDrag=function(a){if(this.cubicCurveSegmentTarget){var b=this.appRef.activeEditablePage,c=b.screenPointToPen(GMOUSE.mouseMovePt,!0);a.shiftKey&&(c.pointInDocumentSpace=b.applySnapTo_angle(c.pointInDocumentSpace,this.startPenInDocumentSpace));b=b.currentEditableElement.globalToLocal(c.pointInDocumentSpace.x,c.pointInDocumentSpace.y);a=b.x-this.startDragOriginInLocal.x;b=b.y-this.startDragOriginInLocal.y;this.cubicCurveSegmentTarget.controlPt1.x=this.startControlPoint1.x+a*this.ctrlPt1_offset;
this.cubicCurveSegmentTarget.controlPt1.y=this.startControlPoint1.y+b*this.ctrlPt1_offset;this.cubicCurveSegmentTarget.controlPt2.x=this.startControlPoint2.x+a*this.ctrlPt2_offset;this.cubicCurveSegmentTarget.controlPt2.y=this.startControlPoint2.y+b*this.ctrlPt2_offset;this.pathTarget.interactiveElement.renderRequest()}};Extends(TranslateSegmentLineTo2D_tool,TranslatePoint2D_tool);
function TranslateSegmentLineTo2D_tool(a){TranslateSegmentLineTo2D_tool.superConstructor.call(this,a);this.interactiveSegment=document.querySelector("#INTERACTIVE_PATH_SEGMENT_L")}_=TranslateSegmentLineTo2D_tool.prototype;_.setTranslationData=function(a){this.translationData=[a.selectionInfo.subPath.geometryPointList[a.selectionInfo.segmentId-1],a.selectionInfo.segment];a=this.appRef.activeEditablePage;a.selectPointList([this.translationData[1]]);a.setCurrentEditablePoint(this.translationData[1])};
_.onGlobalMouseStartDrag=function(a){this.appRef.activeEditablePage.selectPointList(this.translationData);TranslateSegmentLineTo2D_tool.superClass.onGlobalMouseStartDrag.call(this,a);this.appRef.interaction2D.smartPoints.showPoint0(this.startPenInDocumentSpace.x,this.startPenInDocumentSpace.y)};
_.onGlobalMouseEndDrag=function(a){this.swapTransformDataPointListFromInteractionElementToElement();this.createUndoRedoActionsFlag&&this.createUndoRedoActions();a=this.appRef.activeEditablePage;console.log("this.translationData",this.translationData);a.selectPointList([this.translationData[1]]);a.setCurrentEditablePoint(this.translationData[1]);a.updateInteraction();this.appRef.enablePagePreviewsRendering()};Extends(RotateElement2D_tool,Base2D_tool);
function RotateElement2D_tool(a){RotateElement2D_tool.superConstructor.call(this,a);this.pivotPointInDocumentSpace=null}_=RotateElement2D_tool.prototype;_.onActivate=function(){this.calculateDefaultPivotPoint()};_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.createElementListPreviews(null,a.selectionList);this.appRef.interaction2D.rotation2D.show()};
_.calculateDefaultPivotPoint=function(){var a=this.appRef.activeEditablePage;if(0!=a.selectionList.length){var b=a.getElementListGlobalBBox(a.selectionList);this.pivotPointInDocumentSpace=b.center;this.appRef.interaction2D.rotation2D.setPosition(a.content.globalToLocal(b.center.x,b.center.y));a.updateInteraction()}};_.setPivotPoint=function(a){this.pivotPointInDocumentSpace=a;this.appRef.interaction2D.rotation2D.setPosition(this.appRef.activeEditablePage.content.globalToLocal(a.x,a.y))};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else this.appRef.activeEditablePage.getActiveLayer().isLocked()?this.appRef.alertModalDialog.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):a.metaKey||a.ctrlKey||0==this.appRef.activeEditablePage.selectionList.length?(this.doSingleElementSelection(),this.calculateDefaultPivotPoint()):(this.setPivotPoint(this.appRef.interaction2D.rotation2D.getPivotPositionInDocumentSpace()),
GMOUSE.globalMouseTargetDelegate=this)};_.onMouseDoubleClick=function(a){this.appRef.activateTool("selectionGlobal2D_tool")};
_.onGlobalMouseStartDrag=function(a){this.appRef.disablePagePreviewsRendering();var b=this.appRef.activeEditablePage;b.disableSelectionPointerEvents();a.altKey&&b.duplicateElementList_undable(b.selectionList,0,0);b.removeAllInteractions();var c=b.selectionList,d,e=c.length;for(d=0;d<e;d++)a=c[d],a.storedGlobalMatrix=a.getCTM();this.startAngle=SVGUtils.getAngleBetweenPoints(b.getPen().pointInDocumentSpace,this.pivotPointInDocumentSpace);this.undoAction=new SetMatrix2D_action(b);this.redoAction=new SetMatrix2D_action(b);
b.history.addUndoRedoActions(this.undoAction,this.redoAction);this.undoAction.addElementList(b.selectionList);this.appRef.interaction2D.rotation2D.show()};
_.onGlobalMouseDrag=function(a){var b=this.appRef.activeEditablePage,c=b.screenPointToPen(GMOUSE.mouseMovePt,!0);b.setPen(c);c=c.pointInDocumentSpace;var d=null;a.shiftKey&&(d=Math.PI/180*b.snapAngle);this.rotationValue=SVGUtils.getAngleBetweenPoints(c,this.pivotPointInDocumentSpace,d,this.startAngle);b.rotateElementList(b.selectionList,this.rotationValue/(Math.PI/180),this.pivotPointInDocumentSpace);this.appRef.interaction2D.rotation2D.updateRotation(this.rotationValue/(Math.PI/180))};
_.onGlobalMouseEndDrag=function(a){a=this.appRef.activeEditablePage;var b=a.selectionList,c,d=b.length;for(c=0;c<d;c++)delete b[c].storedGlobalMatrix;a.updateInteraction();this.redoAction.addElementList(a.selectionList);this.storeLastTransformAction();a.enableSelectionPointerEvents();this.appRef.enablePagePreviewsRendering()};
_.storeLastTransformAction=function(){var a=this.appRef.activeEditablePage,b=this.rotationValue/(Math.PI/180),c=this.pivotPointInDocumentSpace,d=a.content.getTransform().matrix.clone();a.applyLastTransformAction=function(e){var f=a.content.getTransform().matrix.clone();this.content.getTransform().setMatrix(d);this.rotateElementList(e,b,c);this.content.getTransform().setMatrix(f)}};Extends(RotatePoint2D_tool,TransformPoint2D_tool);
function RotatePoint2D_tool(a){RotatePoint2D_tool.superConstructor.call(this,a);this.pivotPointInDocumentSpace=null}_=RotatePoint2D_tool.prototype;_.onActivate=function(){this.calculateDefaultPivotPoint()};_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.createElementListPreviews(null,a.selectionList);this.appRef.interaction2D.points2D.show();this.appRef.interaction2D.rotation2D.show()};
_.calculateDefaultPivotPoint=function(){var a=this.appRef.activeEditablePage;if(0!=a.selectionList.length){var b=a.getElementListGlobalBBox(a.selectionList);this.pivotPointInDocumentSpace=b.center;this.appRef.interaction2D.rotation2D.setPosition(a.content.globalToLocal(b.center.x,b.center.y));a.updateInteraction()}};_.setPivotPoint=function(a){this.pivotPointInDocumentSpace=a};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else this.appRef.activeEditablePage.getActiveLayer().isLocked()?this.appRef.alertModalDialog.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):(GMOUSE.globalMouseTargetDelegate=this,this.setPivotPoint(this.appRef.interaction2D.rotation2D.getPivotPositionInDocumentSpace()))};_.onMouseDoubleClick=function(a){this.appRef.activateTool("selectionPoint2D_tool")};
_.onGlobalMouseStartDrag=function(a){RotatePoint2D_tool.superClass.onGlobalMouseStartDrag.call(this,a);this.startAngle=SVGUtils.getAngleBetweenPoints(this.appRef.activeEditablePage.getPen().pointInDocumentSpace,this.pivotPointInDocumentSpace);this.previousRotation=0;this.appRef.interaction2D.rotation2D.show()};
_.onGlobalMouseDrag=function(a){var b=this.appRef.activeEditablePage,c=b.screenPointToPen(GMOUSE.mouseMovePt,!0);b.setPen(c);c=c.pointInDocumentSpace;var d=null;a.shiftKey&&(d=Math.PI/180*b.snapAngle);a=SVGUtils.getAngleBetweenPoints(c,this.pivotPointInDocumentSpace,d,this.startAngle);b.rotateTransformDataPointList(this.transformDataPointList,(a-this.previousRotation)/(Math.PI/180),this.pivotPointInDocumentSpace);this.previousRotation=a;this.appRef.interaction2D.rotation2D.updateRotation(a/(Math.PI/
180))};Extends(EyeDropper2D_tool,Base2D_tool);function EyeDropper2D_tool(a){EyeDropper2D_tool.superConstructor.call(this,a);this.selectionMode="POINT_SELECTION"}_=EyeDropper2D_tool.prototype;_.onActivate=function(){this.appRef.activeEditablePage&&this.appRef.activeEditablePage.updateInteraction()};_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.createElementListPreviews(null,a.selectionList)};_.onMouseMove=function(a){};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else if(a.metaKey||a.ctrlKey||0==this.appRef.activeEditablePage.selectionList.length)this.doSingleElementSelection("path");else{a=this.appRef.activeEditablePage;var b=a.createPen(GMOUSE.mouseDownPt);if(b.elementAtPoint){b=b.elementAtPoint;var c={};c.stroke=b.getAttribute("stroke")||"none";c["stroke-width"]=b.getAttribute("stroke-width")||"0";c["stroke-dasharray"]=b.getAttribute("stroke-dasharray")||
"";c.fill=b.getAttribute("fill")||"none";c.opacity=b.getAttribute("opacity")||1;a.setAttributeElementList_undable(a.selectionList,c);a.showSelectionProperties()}}};_.onMouseDoubleClick=function(a){this.appRef.activateTool("selectionGlobal2D_tool")};Extends(Filling2D_tool,Base2D_tool);function Filling2D_tool(a){Filling2D_tool.superConstructor.call(this,a)}_=Filling2D_tool.prototype;_.onActivate=function(){this.appRef.activeEditablePage&&this.appRef.activeEditablePage.updateInteraction()};
_.showInteraction=function(){};_.onMouseMove=function(a){};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else{a=this.appRef.activeEditablePage;var b=a.createPen(GMOUSE.mouseDownPt);if(b.elementAtPoint){b=b.elementAtPoint;var c={};c.stroke=a.getDrawingProperty("stroke");c["stroke-width"]=a.getDrawingProperty("stroke-width");c["stroke-dasharray"]=a.getDrawingProperty("stroke-dasharray");c.fill=a.getDrawingProperty("fill");c.opacity=a.getDrawingProperty("opacity");a.setAttributeElementList_undable([b],c);
a.showSelectionProperties()}}};_.onMouseDoubleClick=function(a){this.appRef.activateTool("selectionGlobal2D_tool")};Extends(Scale2D_tool,Base2D_tool);function Scale2D_tool(a){Scale2D_tool.superConstructor.call(this,a);this.pivotPoint=null;this.activeScaleTool=this.appRef.tools.scaleElement2D_tool}_=Scale2D_tool.prototype;
_.onActivate=function(){this.activeScaleTool="POINT_SELECTION"==this.appRef.previousActiveTool.selectionMode&&0<this.appRef.activeEditablePage.selectionPointList.length?this.appRef.tools.scalePoint2D_tool:this.appRef.tools.scaleElement2D_tool;this.activeScaleTool.onActivate()};_.showInteraction=function(){this.activeScaleTool.showInteraction()};_.onMouseDown=function(a){this.activeScaleTool.onMouseDown(a)};_.onMouseDoubleClick=function(a){this.activeScaleTool.onMouseDoubleClick()};
_.onGlobalMouseStartDrag=function(a){this.activeScaleTool.onGlobalMouseStartDrag(a)};_.onGlobalMouseDrag=function(a){this.activeScaleTool.onGlobalMouseDrag(a)};_.onGlobalMouseEndDrag=function(a){this.activeScaleTool.onGlobalMouseEndDrag(a)};_.setPivotPoint=function(a){this.activeScaleTool.setPivotPoint(a)};Extends(ScaleElement2D_tool,Base2D_tool);
function ScaleElement2D_tool(a){ScaleElement2D_tool.superConstructor.call(this,a);this.pivotPointInDocumentSpace=SVGUtils.createSVGPoint();this.globalBBoxCenterPoint=SVGUtils.createSVGPoint();this.scaleY=this.scaleX=1;this.isLocalMode=this.scaleAxis=null;this.useTransformPreviews=!0}_=ScaleElement2D_tool.prototype;_.onActivate=function(){this.calculateDefaultPivotPoint()};_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.createElementListPreviews(null,a.selectionList);this.appRef.interaction2D.scale2D.show()};
_.calculateDefaultPivotPoint=function(){var a=this.appRef.activeEditablePage;if(0!=a.selectionList.length){var b=a.getElementListGlobalBBox(a.selectionList);this.setTransformProperties(b.center,b.center,"XY",!1);this.appRef.interaction2D.scale2D.setPosition(a.content.globalToLocal(b.center.x,b.center.y));a.updateInteraction()}};_.setPivotPoint=function(a){this.pivotPointInDocumentSpace=a};
_.setTransformProperties=function(a,b,c,d){this.pivotPointInDocumentSpace.x=b.x;this.pivotPointInDocumentSpace.y=b.y;this.globalBBoxCenterPoint.x=a.x;this.globalBBoxCenterPoint.y=a.y;this.scaleAxis=c;this.isLocalMode=d};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else this.appRef.activeEditablePage.getActiveLayer().isLocked()?this.appRef.alertModalDialog.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):a.metaKey||a.ctrlKey||0==this.appRef.activeEditablePage.selectionList.length?(this.doSingleElementSelection(),this.calculateDefaultPivotPoint()):(a=this.appRef.interaction2D.scale2D.getPivotPositionInDocumentSpace(),
this.setTransformProperties(a,a,"XY",!1),GMOUSE.globalMouseTargetDelegate=this)};
_.onGlobalMouseStartDrag=function(a){a=this.appRef.activeEditablePage;a.disableSelectionPointerEvents();this.startPenPosition=a.getPen().pointInDocumentSpace;this.appRef.disablePagePreviewsRendering();if(this.useTransformPreviews){if(0==this.isLocalMode){var b=a.getElementListGlobalBBox(a.selectionList);a=document.querySelector("#ELEMENT_PREVIEWS");b=SVGUtils.createRect(b.x,b.y,b.width,b.height);b.setAttribute("fill","none");b.setAttribute("stroke","#0047FF");b.setAttribute("vector-effect","non-scaling-stroke");
b.setAttribute("stroke-dasharray","2");a.appendChild(b)}HideElements([this.appRef.interaction2D.bbox2D]);this.elementListToScale=document.querySelectorAll("#ELEMENT_PREVIEWS>*")}else this.elementListToScale=a.selectionList;var c=this.elementListToScale.length;for(b=0;b<c;b++)a=this.elementListToScale[b],a.storedGlobalMatrix=a.getCTM()};
_.onGlobalMouseDrag=function(a){var b=this.pivotPointInDocumentSpace;a.altKey&&(b=this.globalBBoxCenterPoint);this.activeGlobalPivotPoint=b;var c=!1,d=this.appRef.activeEditablePage,e=this.startPenPosition,f=d.screenPointToPen(GMOUSE.mouseMovePt).pointInDocumentSpace;if(this.isLocalMode){var g=this.elementListToScale[0].storedGlobalMatrix.inverse();e=this.startPenPosition.matrixTransform(g);f=f.matrixTransform(g);b=b.matrixTransform(g);"true"==this.elementListToScale[0].dataset.mantainAspectRatio&&
(c=!0)}else c=this.appRef.transform2DPanel.mantainAspectRatio;if("XY"==this.scaleAxis){if(this.scaleX=(f.x-b.x)/(e.x-b.x),this.scaleY=(f.y-b.y)/(e.y-b.y),c||a.shiftKey)Math.abs(this.scaleX)>Math.abs(this.scaleY)?this.scaleY=this.scaleX:this.scaleX=this.scaleY}else"X"==this.scaleAxis?(this.scaleX=(f.x-b.x)/(e.x-b.x),this.scaleY=c||a.shiftKey?this.scaleX:1):"Y"==this.scaleAxis&&(this.scaleY=(f.y-b.y)/(e.y-b.y),this.scaleX=c||a.shiftKey?this.scaleY:1);if(Infinity==this.scaleX||-Infinity==this.scaleX||
isNaN(this.scaleX))this.scaleX=1;if(Infinity==this.scaleY||-Infinity==this.scaleY||isNaN(this.scaleY))this.scaleY=1;d.scaleElementList(this.elementListToScale,this.scaleX,this.scaleY,b,this.isLocalMode)};
_.onGlobalMouseEndDrag=function(a){a=this.appRef.activeEditablePage;var b,c=this.elementListToScale.length;for(b=0;b<c;b++)delete this.elementListToScale[b].storedGlobalMatrix;b={};b.scaleText=a.drawingProperties.scaleText;b.scaleStrokeAndEffects=a.drawingProperties.scaleStrokeAndEffects;this.isLocalMode&&"text"==a.selectionList[0].nodeName&&(b.scaleText=!1);this.useTransformPreviews&&a.scaleElementList(a.selectionList,this.scaleX,this.scaleY,this.activeGlobalPivotPoint,this.isLocalMode);a.createScaleUndoRedoActions(a.selectionList,
this.scaleX,this.scaleY,this.activeGlobalPivotPoint,this.isLocalMode,b);a.normalizeScaleElementList(a.selectionList,b);a.updateInteraction();this.saveTransformAction();a.enableSelectionPointerEvents();this.appRef.enablePagePreviewsRendering()};
_.saveTransformAction=function(){var a=this.appRef.activeEditablePage,b=this.scaleX,c=this.scaleY,d=this.pivotPointInDocumentSpace,e=this.isLocalMode,f=a.content.getTransform().matrix.clone();a.applyLastTransformAction=function(g){var h=a.content.getTransform().matrix.clone();this.content.getTransform().setMatrix(f);this.scaleElementList(g,b,c,d,e);this.content.getTransform().setMatrix(h)}};Extends(ScalePoint2D_tool,TransformPoint2D_tool);
function ScalePoint2D_tool(a){ScalePoint2D_tool.superConstructor.call(this,a);this.pivotPointInDocumentSpace=null;this.selectionMode="POINT_SELECTION"}_=ScalePoint2D_tool.prototype;_.onActivate=function(){this.calculateDefaultPivotPoint()};_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.createElementListPreviews(null,a.selectionList);this.appRef.interaction2D.points2D.show();this.appRef.interaction2D.scale2D.show()};
_.calculateDefaultPivotPoint=function(){var a=this.appRef.activeEditablePage;if(0!=a.selectionList.length){var b=a.getElementListGlobalBBox(a.selectionList);this.pivotPointInDocumentSpace=b.center;this.appRef.interaction2D.scale2D.setPosition(a.content.globalToLocal(b.center.x,b.center.y));a.updateInteraction()}};_.setPivotPoint=function(a){this.pivotPointInDocumentSpace=a};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else this.appRef.activeEditablePage.getActiveLayer().isLocked()?this.appRef.alertModalDialog.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):(this.setPivotPoint(this.appRef.interaction2D.scale2D.getPivotPositionInDocumentSpace()),GMOUSE.globalMouseTargetDelegate=this)};_.onMouseDoubleClick=function(a){this.appRef.activateTool("selectionPoint2D_tool")};
_.onGlobalMouseDrag=function(a){var b=this.appRef.activeEditablePage,c=b.screenPointToPen(GMOUSE.mouseMovePt);a.shiftKey&&(c.pointInDocumentSpace=b.applySnapTo_angle(c.pointInDocumentSpace,this.startPenInDocumentSpace));a=(c.pointInDocumentSpace.x-this.pivotPointInDocumentSpace.x)/(this.startPenInDocumentSpace.x-this.pivotPointInDocumentSpace.x);c=(c.pointInDocumentSpace.y-this.pivotPointInDocumentSpace.y)/(this.startPenInDocumentSpace.y-this.pivotPointInDocumentSpace.y);if(Infinity==a||-Infinity==
a||isNaN(a))a=1;if(Infinity==c||-Infinity==c||isNaN(c))c=1;b.scaleTransformDataPointList(this.transformDataPointList,a,c,this.pivotPointInDocumentSpace,!1)};Extends(Rotate2D_tool,Base2D_tool);function Rotate2D_tool(a){Rotate2D_tool.superConstructor.call(this,a);this.pivotPoint=null;this.activeRotationTool=this.appRef.tools.rotateElement2D_tool}_=Rotate2D_tool.prototype;
_.onActivate=function(){this.activeRotationTool="POINT_SELECTION"==this.appRef.previousActiveTool.selectionMode&&0<this.appRef.activeEditablePage.selectionPointList.length?this.appRef.tools.rotatePoint2D_tool:this.appRef.tools.rotateElement2D_tool;this.activeRotationTool.onActivate()};_.showInteraction=function(){this.activeRotationTool.showInteraction()};_.onMouseDown=function(a){this.activeRotationTool.onMouseDown(a)};
_.onMouseMove=function(a){if(!Event.isSpaceKeyPressed){a=this.appRef.activeEditablePage;var b=a.screenPointToPen(GMOUSE.mouseMovePt);a.setPen(b);this.appRef.interaction2D.rotation2D.updateRotation()}};_.onMouseDoubleClick=function(a){this.activeRotationTool.onMouseDoubleClick()};_.setPivotPoint=function(a){this.activeRotationTool.setPivotPoint(a)};Extends(CreateGuide2D_tool,Base2D_tool);function CreateGuide2D_tool(a){CreateGuide2D_tool.superConstructor.call(this,a);this.rulerSource=null}_=CreateGuide2D_tool.prototype;
_.onMouseDown=function(a){this.rulerSource=a.target.parentElement.getAttribute("id");GMOUSE.globalMouseTargetDelegate=this};_.onGlobalMouseStartDrag=function(a){a=this.appRef.activeEditablePage;a.deselectAll();a.removeAllInteractions()};_.onGlobalMouseDrag=function(a){a=this.appRef.activeEditablePage;var b=a.screenPointToPen(GMOUSE.mouseMovePt);a.setPen(b);"HORIZONTAL_RULER"==this.rulerSource?this.appRef.interaction2D.smartGuides.showGuideY(b.pointInDocumentSpace.y):this.appRef.interaction2D.smartGuides.showGuideX(b.pointInDocumentSpace.x)};
_.onGlobalMouseEndDrag=function(a){this.appRef.interaction2D.smartGuides.hideGuides();a=this.appRef.activeEditablePage;var b=a.getPen();b="HORIZONTAL_RULER"==this.rulerSource?SVGUtils.createLine(0,b.pointInContentSpace.y,a.dataset.width,b.pointInContentSpace.y):SVGUtils.createLine(b.pointInContentSpace.x,0,b.pointInContentSpace.x,a.dataset.height);b.setAttribute("stroke","#ff387c");b.setAttribute("stroke-width","1");a.guides.appendChild(b);a.createAddElementsToDocumentUndoRedoActions([b],!1)};
Extends(SetOrigin2D_tool,Base2D_tool);function SetOrigin2D_tool(a){SetOrigin2D_tool.superConstructor.call(this,a);this.rulerSource=null}_=SetOrigin2D_tool.prototype;_.onMouseDown=function(a){GMOUSE.globalMouseTargetDelegate=this};_.onGlobalMouseStartDrag=function(a){this.appRef.activeEditablePage.removeAllInteractions()};
_.onGlobalMouseDrag=function(a){a=this.appRef.activeEditablePage;var b=a.screenPointToPen(GMOUSE.mouseMovePt);a.setPen(b);this.appRef.interaction2D.smartGuides.showGuideY(b.pointInDocumentSpace.y);this.appRef.interaction2D.smartGuides.showGuideX(b.pointInDocumentSpace.x)};_.onGlobalMouseEndDrag=function(a){this.appRef.interaction2D.smartGuides.hideGuides();a=this.appRef.activeEditablePage;var b=a.getPen();a.setOrigin(b.pointInContentSpace);a.updateInteraction()};Extends(BaseDraw2D_tool,Base2D_tool);
function BaseDraw2D_tool(a){BaseDraw2D_tool.superConstructor.call(this,a);this.pointB=this.pointA=null;this.interactiveElement=document.querySelector("#INTERACTIVE_LINE");this.currentDrawingAction=""}_=BaseDraw2D_tool.prototype;_.onActivate=function(){BaseDraw2D_tool.superClass.onActivate.call(this);this.appRef.activeEditablePage.deselectAllElements();this.appRef.activeEditablePage.removeAllInteractions();this.appRef.activeEditablePage.showSelectionProperties();this.currentDrawingAction=""};
_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.createElementListPreviews(null,a.selectionList);a.showSelectionProperties()};_.onKeyDown=function(a){BaseDraw2D_tool.superClass.onKeyDown.call(this,a);switch(a.keyCode){case KeyboardEvent.CODES.keyCode_ESC:this.appRef.activeEditablePage.removeAllInteractions(),this.currentDrawingAction="",a.preventPropagation()}};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else this.appRef.activeEditablePage.getActiveLayer().isLocked()?this.appRef.alertModalDialog.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):"MOVE"!=this.currentDrawingAction&&(this.appRef.activeEditablePage.deselectAllElements(),this.appRef.activeEditablePage.removeAllInteractions(),this.currentDrawingAction="START",this.definePointA(),
GMOUSE.globalMouseTargetDelegate=this)};_.onMouseUp=function(a){Event.isDoubleClick?(this.onMouseDoubleClick(a),this.currentDrawingAction=""):"START"==this.currentDrawingAction?this.currentDrawingAction="MOVE":"MOVE"==this.currentDrawingAction&&(this.createElement(),this.currentDrawingAction="")};
_.onMouseMove=function(a){BaseDraw2D_tool.superClass.onMouseMove.call(this);Event.isSpaceKeyPressed||(console.log("this.currentDrawingAction",this.currentDrawingAction),"MOVE"==this.currentDrawingAction&&this.definePointB(a))};_.onMouseWheelChangeEnd=function(a){this.interactiveElement.classList.add("showed");this.updateInteractiveElement(a)};_.onGlobalMouseStartDrag=function(a){this.appRef.disablePagePreviewsRendering()};
_.onGlobalMouseDrag=function(a){var b=this.appRef.activeEditablePage,c=b.screenPointToPen(GMOUSE.mouseMovePt);b.setPen(c);this.definePointB(a)};_.onGlobalMouseEndDrag=function(a){this.createElement(a.altKey);this.currentDrawingAction="";this.appRef.enablePagePreviewsRendering()};_.onMouseDoubleClick=function(a){this.appRef.activateTool("selectionPoint2D_tool")};_.definePointA=function(){var a=this.appRef.activeEditablePage.getPen();this.pointB=this.pointA=a.pointInContentSpace;this.updateInteractiveElement()};
_.definePointB=function(a){var b=this.appRef.activeEditablePage,c=b.getPen();this.pointB=a.shiftKey?b.applySnapTo_angle(c.pointInContentSpace,this.pointA,b.snapDistance/b.content.currentScale):c.pointInContentSpace;this.interactiveElement.classList.add("showed");this.updateInteractiveElement(a.altKey)};_.updateInteractiveElement=function(){};_.createElement=function(){};Extends(DrawLine2D_tool,BaseDraw2D_tool);
function DrawLine2D_tool(a){DrawLine2D_tool.superConstructor.call(this,a);this.interactiveElement=document.querySelector("#INTERACTIVE_LINE");this.selectionMode="POINT_SELECTION";this.drawConsecutiveLines=this.convertCreatedElementToPath=!0;this.initPreferencesPanel()}_=DrawLine2D_tool.prototype;
_.initPreferencesPanel=function(){this.preferencesPanel=document.querySelector("#drawLine2D_tool_INFO_PANEL");var a=this;this.preferencesPanel.update=function(){this.controlledElements.drawAsPath.checked=a.convertCreatedElementToPath;this.controlledElements.drawConsecutiveLines.checked=a.drawConsecutiveLines};this.preferencesPanel.onChange_drawAsPath=function(b){a.convertCreatedElementToPath=this.controlledElements.drawAsPath.checked};this.preferencesPanel.onChange_drawConsecutiveLines=function(b){a.drawConsecutiveLines=
this.controlledElements.drawConsecutiveLines.checked};this.preferencesPanel.controlledElements=this.preferencesPanel.connectEvents();this.preferencesPanel.update()};_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.createElementListPreviews(null,a.selectionList);this.appRef.interaction2D.segment2D.showActiveInteractivePathSegment()};
_.onKeyDown=function(a){var b=a.keyCode;console.log("keyCode",b);if(b>=KeyboardEvent.CODES.keyCode_0&&b<=KeyboardEvent.CODES.keyCode_9){var c=this;this.appRef.interaction2D.lengthPropertyLabel.onChangeCallback=function(a){var b=c.pointA.getAngleFromPoint(c.pointB);a=SVGUtils.createSVGPointPolar(c.appRef.activeEditablePage.unitToValue(a),b);c.pointB.x=c.pointA.x+a.x;c.pointB.y=c.pointA.y+a.y;c.createElement(c.drawConsecutiveLines)};this.appRef.interaction2D.lengthPropertyLabel.onClickOn_label()}DrawLine2D_tool.superClass.onKeyDown.call(this,
a)};_.onMouseUp=function(a){Event.isDoubleClick?(this.onMouseDoubleClick(a),this.currentDrawingAction=""):"START"==this.currentDrawingAction?this.currentDrawingAction="MOVE":"MOVE"==this.currentDrawingAction&&this.createElement(this.drawConsecutiveLines)};_.onGlobalMouseEndDrag=function(a){this.createElement(!1);this.currentDrawingAction="";this.appRef.enablePagePreviewsRendering()};
_.updateInteractiveElement=function(){var a=this.appRef.activeEditablePage.content.localToGlobal(this.pointA.x,this.pointA.y),b=this.appRef.activeEditablePage.content.localToGlobal(this.pointB.x,this.pointB.y);this.appRef.interaction2D.smartPoints.showPoint0(a.x,a.y);this.interactiveElement.updateGeometry(a.x,a.y,b.x,b.y);var c=this.appRef.activeEditablePage,d=this.pointB.getDistanceFromPoint(this.pointA);0<d&&this.appRef.interaction2D.lengthPropertyLabel.show(a,b,c.valueToUnit(d),null)};
_.createElement=function(a){var b=this.appRef.activeEditablePage;if(0==this.pointB.getDistanceFromPoint(this.pointA))b.updateInteraction();else{if(this.convertCreatedElementToPath){var c=SVGUtils.createPath();c.setAttribute("d","M"+this.pointA.x+" "+this.pointA.y+" L"+this.pointB.x+" "+this.pointB.y)}else c=SVGUtils.createLine(this.pointA.x,this.pointA.y,this.pointB.x,this.pointB.y);b.getActiveLayer().appendChild(c);this.applyElementStyle(c);b.createAddElementsToDocumentUndoRedoActions([c]);b.onChange();
a?(this.appRef.activeEditablePage.removeAllInteractions(),b.selectElementList([c]),b.setCurrentEditableElement(c),this.currentDrawingAction="MOVE",this.pointA=this.pointB,this.updateInteractiveElement()):(b.selectElement(c),b.setCurrentEditableElement(c),a=c.getGeometryPointList(),b.selectPointList([a[1]]),b.setCurrentEditablePoint(a[1]),this.appRef.interaction2D.segment2D.setInteractivePathSegment(a[0],a[1]),b.updateInteraction(),this.currentDrawingAction="")}};
_.applyElementStyle=function(a){var b=this.appRef.activeEditablePage,c=b.getDrawingProperty("stroke");"none"==c&&(c="#000000");a.setAttribute("stroke",c);a.createUniqueFillStrokeDefReferences();c=b.getDrawingProperty("stroke-width");0==c&&(c=1);a.setAttribute("stroke-width",c);c=b.getDrawingProperty("stroke-dasharray");""!=c&&a.setAttribute("stroke-dasharray",c);c=b.getDrawingProperty("stroke-linecap");"butt"!=c&&a.setAttribute("stroke-linecap",c);c=b.getDrawingProperty("stroke-linejoin");"miter"!=
c&&a.setAttribute("stroke-linejoin",c);c=b.getDrawingProperty("marker-start");""!=c&&a.setAttribute("marker-start",c);c=b.getDrawingProperty("marker-mid");""!=c&&a.setAttribute("marker-mid",c);b=b.getDrawingProperty("marker-end");""!=b&&a.setAttribute("marker-end",b)};Extends(DrawArc2D_tool,Base2D_tool);
function DrawArc2D_tool(a){DrawArc2D_tool.superConstructor.call(this,a);this.interactiveElement=document.querySelector("#INTERACTIVE_PATH_SEGMENT_A");this.selectionMode="POINT_SELECTION";this.convertCreatedElementToPath=!0;this.initPreferencesPanel();this.resetState()}_=DrawArc2D_tool.prototype;_.onActivate=function(){this.appRef.activeEditablePage.deselectAllElements();this.appRef.activeEditablePage.removeAllInteractions();this.appRef.activeEditablePage.showSelectionProperties();this.resetState()};
_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.createElementListPreviews(null,a.selectionList)};_.resetState=function(){this.pointC=this.pointB=this.pointA=null;this.currentDrawingAction=""};_.initPreferencesPanel=function(){};_.onKeyDown=function(a){BaseDraw2D_tool.superClass.onKeyDown.call(this,a);switch(a.keyCode){case 27:this.appRef.activeEditablePage.removeAllInteractions(),this.resetState(),a.preventPropagation()}};
_.setPointA=function(){this.pointA=this.appRef.activeEditablePage.getPen().pointInContentSpace;this.updateInteractiveElement()};_.setPointB=function(){this.pointB=this.appRef.activeEditablePage.getPen().pointInContentSpace;this.updateInteractiveElement()};_.setPointC=function(){this.pointC=this.appRef.activeEditablePage.getPen().pointInContentSpace;this.updateInteractiveElement()};
_.updateInteractiveElement=function(){var a=this.appRef.activeEditablePage;if(this.pointA){var b=a.content.localToGlobal(this.pointA.x,this.pointA.y);this.appRef.interaction2D.smartPoints.showPoint0(b.x,b.y);if(this.pointB){var c=a.content.localToGlobal(this.pointB.x,this.pointB.y);this.pointC&&(a=a.content.localToGlobal(this.pointC.x,this.pointC.y),this.interactiveElement.setAttribute("d",this.createArcByThreePoints(b,c,a)),ShowElement(this.interactiveElement))}}};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else this.appRef.activeEditablePage.getActiveLayer().isLocked()&&this.appRef.alertModalDialog.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it."))};
_.onMouseUp=function(a){Event.isDoubleClick?(this.onMouseDoubleClick(a),this.currentDrawingAction=""):""==this.currentDrawingAction?(this.appRef.activeEditablePage.deselectAllElements(),this.appRef.activeEditablePage.removeAllInteractions(),this.setPointA(),this.currentDrawingAction="EDIT_POINT_B"):"EDIT_POINT_B"==this.currentDrawingAction?(this.setPointB(),this.currentDrawingAction="EDIT_POINT_C"):"EDIT_POINT_C"==this.currentDrawingAction&&(this.createElement(),this.resetState())};
_.onMouseMove=function(a){DrawArc2D_tool.superClass.onMouseMove.call(this);Event.isSpaceKeyPressed||"EDIT_POINT_B"!=this.currentDrawingAction&&"EDIT_POINT_C"==this.currentDrawingAction&&this.setPointC()};
_.createArcByThreePoints=function(a,b,c){function d(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))}var e=d(b,c),f=d(c,a),g=d(a,b),h=Math.acos((e*e+f*f-g*g)/(2*e*f));e=e*f*g/4/(.5*e*f*Math.sin(h));return["M",a.x,a.y,"A",e,e,0,+(Math.PI/2>h),+(0>(b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x)),b.x,b.y].join(" ")};
_.createElement=function(a){a=this.appRef.activeEditablePage;var b=SVGUtils.createPath();b.setAttribute("d",this.createArcByThreePoints(this.pointA,this.pointB,this.pointC));a.getActiveLayer().appendChild(b);this.applyElementStyle(b);a.createAddElementsToDocumentUndoRedoActions([b]);a.onChange();a.selectElement(b);a.setCurrentEditableElement(b);a.updateInteraction()};
_.applyElementStyle=function(a){var b=this.appRef.activeEditablePage,c=b.getDrawingProperty("stroke");"none"==c&&(c="#000000");a.setAttribute("stroke",c);c=b.getDrawingProperty("fill");a.setAttribute("fill",c);a.createUniqueFillStrokeDefReferences();c=b.getDrawingProperty("stroke-width");0==c&&(c=1);a.setAttribute("stroke-width",c);c=b.getDrawingProperty("stroke-dasharray");""!=c&&a.setAttribute("stroke-dasharray",c);c=b.getDrawingProperty("stroke-linecap");"butt"!=c&&a.setAttribute("stroke-linecap",
c);c=b.getDrawingProperty("stroke-linejoin");"miter"!=c&&a.setAttribute("stroke-linejoin",c);c=b.getDrawingProperty("marker-start");""!=c&&a.setAttribute("marker-start",c);c=b.getDrawingProperty("marker-mid");""!=c&&a.setAttribute("marker-mid",c);b=b.getDrawingProperty("marker-end");""!=b&&a.setAttribute("marker-end",b)};Extends(DrawRectangle2D_tool,BaseDraw2D_tool);
function DrawRectangle2D_tool(a){DrawRectangle2D_tool.superConstructor.call(this,a);this.interactiveElement=document.querySelector("#INTERACTIVE_RECTANGLE");this.convertCreatedElementToPath=!0;this.initPreferencesPanel()}_=DrawRectangle2D_tool.prototype;
_.initPreferencesPanel=function(){this.preferencesPanel=document.querySelector("#drawRectangle2D_tool_INFO_PANEL");var a=this;this.preferencesPanel.update=function(){this.controlledElements.drawAsPath.checked=a.convertCreatedElementToPath};this.preferencesPanel.onChange_drawAsPath=function(b){a.convertCreatedElementToPath=this.controlledElements.drawAsPath.checked};this.preferencesPanel.controlledElements=this.preferencesPanel.connectEvents();this.preferencesPanel.update()};
_.updateInteractiveElement=function(a){var b=this.appRef.activeEditablePage.content.localToGlobal(this.pointA.x,this.pointA.y),c=this.appRef.activeEditablePage.content.localToGlobal(this.pointB.x,this.pointB.y),d=Math.min(b.x,c.x),e=Math.min(b.y,c.y),f=Math.abs(c.x-b.x);b=Math.abs(c.y-b.y);0==f&&(f=1);0==b&&(b=1);a&&(d-=.5*f,e-=.5*b);this.interactiveElement.updateGeometry(d,e,f,b)};
_.createElement=function(a){var b=this.appRef.activeEditablePage,c=this.pointA,d=this.pointB,e=Math.min(c.x,d.x),f=Math.min(c.y,d.y),g=Math.abs(d.x-c.x);c=Math.abs(d.y-c.y);a&&(e-=.5*g,f-=.5*c);a=SVGUtils.createRect(e,f,g,c,!0);this.convertCreatedElementToPath&&(e=SVGUtils.createPath(),e.getTransform().setMatrix(a.getTransform().matrix.clone()),e.setPathData(a.getPathData()),a=e);b.getActiveLayer().appendChild(a);this.applyElementStyle(a);b.createAddElementsToDocumentUndoRedoActions([a]);b.selectElement(a);
b.setCurrentEditableElement(a);b.updateInteraction();b.onChange()};
_.applyElementStyle=function(a){var b=this.appRef.activeEditablePage,c=b.getDrawingProperty("stroke");a.setAttribute("stroke",c);c=b.getDrawingProperty("fill");a.setAttribute("fill",c);a.createUniqueFillStrokeDefReferences();c=b.getDrawingProperty("stroke-width");a.setAttribute("stroke-width",c);c=b.getDrawingProperty("stroke-dasharray");""!=c&&a.setAttribute("stroke-dasharray",c);b=b.getDrawingProperty("stroke-linejoin");"miter"!=b&&a.setAttribute("stroke-linejoin",b)};
Extends(DrawRegularPolygon2D_tool,BaseDraw2D_tool);function DrawRegularPolygon2D_tool(a){DrawRegularPolygon2D_tool.superConstructor.call(this,a);this.interactiveElement=document.querySelector("#INTERACTIVE_REGULAR_POLYGON");this.convertCreatedElementToPath=!0;this.numSides=5;this.initPreferencesPanel()}_=DrawRegularPolygon2D_tool.prototype;
_.initPreferencesPanel=function(){this.preferencesPanel=document.querySelector("#drawRegularPolygon2D_tool_INFO_PANEL");var a=this;this.preferencesPanel.update=function(){this.controlledElements.numSides.value=a.numSides};this.preferencesPanel.onChange_numSides=function(b){a.numSides=this.controlledElements.numSides.value};this.preferencesPanel.controlledElements=this.preferencesPanel.connectEvents();this.preferencesPanel.update()};
_.updateInteractiveElement=function(a){a=this.appRef.activeEditablePage.content.localToGlobal(this.pointA.x,this.pointA.y);var b=this.appRef.activeEditablePage.content.localToGlobal(this.pointB.x,this.pointB.y);this.interactiveElement.buildRegularPolygon(a.x,a.y,this.numSides,b.getDistanceFromPoint(a))};
_.createElement=function(){var a=this.appRef.activeEditablePage,b=SVGUtils.createPath();b.buildRegularPolygon(this.pointA.x,this.pointA.y,this.numSides,this.pointB.getDistanceFromPoint(this.pointA));a.getActiveLayer().appendChild(b);this.applyElementStyle(b);a.createAddElementsToDocumentUndoRedoActions([b]);a.selectElement(b);a.setCurrentEditableElement(b);a.updateInteraction();a.onChange()};
_.applyElementStyle=function(a){var b=this.appRef.activeEditablePage,c=b.getDrawingProperty("stroke");a.setAttribute("stroke",c);c=b.getDrawingProperty("fill");a.setAttribute("fill",c);a.createUniqueFillStrokeDefReferences();c=b.getDrawingProperty("stroke-width");a.setAttribute("stroke-width",c);c=b.getDrawingProperty("stroke-dasharray");""!=c&&a.setAttribute("stroke-dasharray",c);b=b.getDrawingProperty("stroke-linejoin");"miter"!=b&&a.setAttribute("stroke-linejoin",b)};
Extends(DrawEllipse2D_tool,BaseDraw2D_tool);function DrawEllipse2D_tool(a){DrawEllipse2D_tool.superConstructor.call(this,a);this.interactiveElement=document.querySelector("#INTERACTIVE_ELLIPSE");this.convertCreatedElementToPath=!0;this.initPreferencesPanel()}_=DrawEllipse2D_tool.prototype;
_.initPreferencesPanel=function(){this.preferencesPanel=document.querySelector("#drawEllipse2D_tool_INFO_PANEL");var a=this;this.preferencesPanel.update=function(){this.controlledElements.drawAsPath.checked=a.convertCreatedElementToPath};this.preferencesPanel.onChange_drawAsPath=function(b){a.convertCreatedElementToPath=this.controlledElements.drawAsPath.checked};this.preferencesPanel.controlledElements=this.preferencesPanel.connectEvents();this.preferencesPanel.update()};
_.updateInteractiveElement=function(a){var b=this.appRef.activeEditablePage.content.localToGlobal(this.pointA.x,this.pointA.y),c=this.appRef.activeEditablePage.content.localToGlobal(this.pointB.x,this.pointB.y),d=Math.abs(c.x-b.x)/2,e=Math.abs(c.y-b.y)/2,f=Math.min(b.x,c.x)+Math.abs(d);b=Math.min(b.y,c.y)+Math.abs(e);0==d&&(d=1);0==e&&(e=1);a&&(f-=d,b-=e);this.interactiveElement.updateGeometry(f,b,d,e)};
_.createElement=function(a){var b=this.appRef.activeEditablePage,c=this.pointA,d=this.pointB,e=Math.abs(d.x-c.x)/2,f=Math.abs(d.y-c.y)/2,g=Math.min(c.x,d.x)+Math.abs(e);c=Math.min(c.y,d.y)+Math.abs(f);a&&(g-=e,c-=f);a=SVGUtils.createEllipse(g,c,e,f);this.convertCreatedElementToPath&&(e=SVGUtils.createPath(),e.setPathData(a.getPathData()),a=e);b.getActiveLayer().appendChild(a);this.applyElementStyle(a);b.createAddElementsToDocumentUndoRedoActions([a]);b.selectElement(a);b.setCurrentEditableElement(a);
b.updateInteraction();b.onChange()};
_.applyElementStyle=function(a){var b=this.appRef.activeEditablePage,c=b.getDrawingProperty("stroke");a.setAttribute("stroke",c);c=b.getDrawingProperty("fill");a.setAttribute("fill",c);a.createUniqueFillStrokeDefReferences();c=b.getDrawingProperty("stroke-width");a.setAttribute("stroke-width",c);c=b.getDrawingProperty("stroke-dasharray");""!=c&&a.setAttribute("stroke-dasharray",c);b=b.getDrawingProperty("stroke-linejoin");"miter"!=b&&a.setAttribute("stroke-linejoin",b)};
Extends(DrawTextBox2D_tool,BaseDraw2D_tool);function DrawTextBox2D_tool(a){DrawTextBox2D_tool.superConstructor.call(this,a);this.interactiveElement=document.querySelector("#INTERACTIVE_RECTANGLE");this.drawAsRichText=!0;this.initPreferencesPanel()}_=DrawTextBox2D_tool.prototype;
_.initPreferencesPanel=function(){this.preferencesPanel=document.querySelector("#drawTextBox2D_tool_INFO_PANEL");var a=this;this.preferencesPanel.update=function(){this.querySelector("input").checked=a.drawAsRichText};this.preferencesPanel.onChange_drawAsRichText=function(b){a.drawAsRichText=this.querySelector("input").checked};this.preferencesPanel.connectEvents();this.preferencesPanel.update()};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else this.appRef.activeEditablePage.getActiveLayer().isLocked()?this.appRef.alertModalDialog.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):(a=this.appRef.activeEditablePage.createPen(GMOUSE.mouseMovePt).elementAtPoint,console.log("clickedElement",a),a&&"tspan"==a.nodeName?(console.log("clickedElement.nodeName",a.nodeName),"text"==
a.parentElement.nodeName?this.appRef.activeEditablePage.enterTo_TextEditing(a.parentElement):"textPath"==a.parentElement.nodeName&&this.appRef.activeEditablePage.enterTo_TextEditing(a.parentElement.parentElement)):"MOVE"!=this.currentDrawingAction&&(this.appRef.activeEditablePage.deselectAllElements(),this.appRef.activeEditablePage.removeAllInteractions(),this.currentDrawingAction="MOVE",this.definePointA(),GMOUSE.globalMouseTargetDelegate=this))};
_.onMouseUp=function(a){Event.isDoubleClick?(this.onMouseDoubleClick(a),this.currentDrawingAction=""):"START"==this.currentDrawingAction?this.currentDrawingAction="MOVE":"MOVE"==this.currentDrawingAction&&(this.createElement(),this.currentDrawingAction="")};
_.updateInteractiveElement=function(){var a=this.appRef.activeEditablePage.content.localToGlobal(this.pointA.x,this.pointA.y),b=this.appRef.activeEditablePage.content.localToGlobal(this.pointB.x,this.pointB.y),c=Math.min(a.x,b.x),d=Math.min(a.y,b.y),e=Math.abs(b.x-a.x);a=Math.abs(b.y-a.y);0==e&&(e=1);0==a&&(a=1);this.interactiveElement.updateGeometry(c,d,e,a)};
_.createElement=function(){var a=this.appRef.activeEditablePage,b=this.pointA,c=this.pointB,d=Math.min(b.x,c.x),e=Math.min(b.y,c.y),f=Math.abs(c.x-b.x);b=Math.abs(c.y-b.y);10>f&&(f=300);10>b&&(b=50);Event.isAltKeyPressed?(d=SVGUtils.createForeingObject(d,e,f,b,'<body class="text-box" ><div>Type your text...</div></body>'),d.setAttribute("data-type","HTMLTextBox"),a.getActiveLayer().appendChild(d)):(d=SVGUtils.createTextBox(d,e,f,b,"","Open Sans","regular",20),d.__setAttribute("data-use-rich-text",
String(this.drawAsRichText)),a.getActiveLayer().appendChild(d),this.applyElementStyle(d),d.setAttribute("tabindex","1"),d.render());a.createAddElementsToDocumentUndoRedoActions([d]);a.selectElement(d);a.setCurrentEditableElement(d);a.updateInteraction();a.onChange();a.enterTo_TextEditing(d)};_.applyElementStyle=function(a){var b=this.appRef.activeEditablePage;a.setAttribute("stroke","none");b=b.getDrawingProperty("fill");"none"==b&&(b="#000000");a.setAttribute("fill",b);a.createUniqueFillStrokeDefReferences()};
Extends(DrawFreehand2D_tool,Base2D_tool);function DrawFreehand2D_tool(a){DrawFreehand2D_tool.superConstructor.call(this,a);this.booleanElementTarget=this.interactiveElement=null;this.booleanAction="unite";this.tolerance=2.5;this.initPreferencesPanel()}_=DrawFreehand2D_tool.prototype;
_.initPreferencesPanel=function(){this.preferencesPanel=document.querySelector("#drawFreehand2D_tool_INFO_PANEL");var a=this;this.preferencesPanel.update=function(){this.controlledElements.tolerance.value=a.tolerance};this.preferencesPanel.onChange_tolerance=function(b){a.tolerance=this.controlledElements.tolerance.value};this.preferencesPanel.controlledElements=this.preferencesPanel.connectEvents();this.preferencesPanel.update()};_.onActivate=function(){this.appRef.activeEditablePage&&this.appRef.activeEditablePage.updateInteraction()};
_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.createElementListPreviews(null,a.selectionList)};
_.onMouseDown=function(a){this.booleanElementTarget=null;var b=this.appRef.activeEditablePage;if(a.metaKey||a.ctrlKey)this.doSingleElementSelection("path");else if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else this.appRef.activeEditablePage.getActiveLayer().isLocked()?this.appRef.alertModalDialog.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):(a.altKey&&1==b.selectionList.length&&"path"==b.selectionList[0].nodeName&&
(this.booleanElementTarget=b.selectionList[0],this.booleanAction=a.shiftKey?"subtract":"unite"),this.appRef.activeEditablePage.deselectAllElements(),this.appRef.activeEditablePage.removeAllInteractions(),a=b.createPen(GMOUSE.mouseDownPt),b.setPen(a),b=a.pointInDocumentSpace,this.interactiveElement=SVGUtils.createPath(),this.interactiveElement.setAttribute("d","M"+b.x+" "+b.y),this.appRef.interaction2D.elementPreviews.appendChild(this.interactiveElement))};
_.onMouseMove=function(a){if(this.interactiveElement){a=this.appRef.activeEditablePage;var b=a.createPen(GMOUSE.mouseMovePt);a.setPen(b);a=b.pointInDocumentSpace;this.interactiveElement.getGeometryPointList().push(this.interactiveElement.createGeometryPoint_LINETO(a.x,a.y));this.interactiveElement.renderRequest()}};
_.onMouseUp=function(a){if(Event.isDoubleClick)this.onMouseDoubleClick(a);else this.booleanElementTarget?this.doBooleanAction():this.interactiveElement&&this.createElement();this.interactiveElement=null};_.onMouseDoubleClick=function(a){this.appRef.activateTool("selectionPoint2D_tool")};
_.doBooleanAction=function(){var a=this.appRef.activeEditablePage,b=a.getActiveLayer();this.interactiveElement.transformGeometryPointList(this.interactiveElement.getTransformToElement(b));this.interactiveElement.renderRequest(0);b={};paper.install(b);paper.setup([640,480]);b=b.project.importSVG(this.interactiveElement);b.simplify(2.5/a.content.currentScale);b.join(null,5/a.content.currentScale);b=b.exportSVG();b=a.booleanPathsOperation(this.booleanElementTarget,b,this.booleanAction);for(var c=0;c<
b.length;c++)this.booleanElementTarget.parentElement.insertBefore(b[c],this.booleanElementTarget.nextElementSibling),b[c].setGraphicAttributesByElement(this.booleanElementTarget);c=new ReplaceElements_action(a);var d=new ReplaceElements_action(a);c.setElementsToReplace([this.booleanElementTarget]);d.setElementsToInsert([this.booleanElementTarget]);a.removeElementList([this.booleanElementTarget]);c.setElementsToInsert(b);d.setElementsToReplace(b);a.history.addUndoRedoActions(d,c);a.selectElementList(b);
a.updateInteraction();a.onChange()};
_.createElement=function(){var a=this.appRef.activeEditablePage,b=a.getActiveLayer();this.interactiveElement.transformGeometryPointList(this.interactiveElement.getTransformToElement(b));this.interactiveElement.renderRequest(0);var c={};paper.install(c);paper.setup([640,480]);c=c.project.importSVG(this.interactiveElement);c.simplify(this.tolerance/a.content.currentScale);c.join(null,5/a.content.currentScale);this.interactiveElement=c.exportSVG();b.appendChild(this.interactiveElement);this.applyElementStyle(this.interactiveElement);
a.createAddElementsToDocumentUndoRedoActions([this.interactiveElement]);a.selectElement(this.interactiveElement);a.setCurrentEditableElement(this.interactiveElement);a.updateInteraction();a.onChange()};
_.applyElementStyle=function(a){var b=this.appRef.activeEditablePage,c=b.getDrawingProperty("stroke");a.setAttribute("stroke",c);c=b.getDrawingProperty("fill");a.setAttribute("fill",c);a.createUniqueFillStrokeDefReferences();c=b.getDrawingProperty("stroke-width");a.setAttribute("stroke-width",c);c=b.getDrawingProperty("stroke-dasharray");""!=c&&a.setAttribute("stroke-dasharray",c);b=b.getDrawingProperty("stroke-linejoin");"miter"!=b&&a.setAttribute("stroke-linejoin",b)};var Brush,BrushTip,Tips={};
(function(){function a(a){return"object"!=typeof a?{}:a}function b(a,b){return"number"!=typeof a?b:a}Brush=function(c){c=a(c);this.path=c.path||null;this.ctx=c.ctx||null;this.spacing=b(c.spacing,0);this.tip=c.tip||new Tips.Rough1;null!=this.path&&(this.pathLength=this.path.getTotalLength())};Brush.prototype={path:null,pathLength:0,v:0,lastV:0,ctx:null,spacing:0,tip:null,getPos:function(a){a=this._cleanV(a);return this.path.getPointAtLength(a*this.pathLength)},draw:function(){var a=this._getV();this._render(a);
this.lastV=a},drawFromLast:function(){var a=this._getV(),b=this.lastV,e=this.spacing;if(0<e){var f=Math.abs(a-b);e=this._lenToV(e);e=f/Math.ceil(f/e);f=b;for(var g=1E3;0<g&&(a>b&&f<=a||a<b&&f>=a);)g--,this._render(f,{rotation:0,pressure:Math.sqrt(1-2*Math.abs(a-.5))}),f+=e}this.lastV=a},_vToLen:function(a){return a*this.pathLength},_lenToV:function(a){return a/this.pathLength},_getV:function(){return this._cleanV(this.v)},_cleanV:function(a){a=b(a,this.v);1<a&&(a=1);0>a&&(a=0);return a},_render:function(c,
d){c=this._cleanV(c);d=a(d);b(d.rotation,0);var e=b(d.pressure,1),f=this.ctx,g=this.getPos(c);f.save();f.translate(g.x,g.y);this.tip.draw(f,{pressure:e});f.restore()}};BrushTip=function(c){c=a(c);this.size=b(c.size,1)};BrushTip.prototype={size:1,_currentCtx:null,_currentOptions:{},draw:function(b,d){d=a(d);this._currentCtx=b;this._render(d)},_render:function(a){},_drawCircle:function(a,d,e,f){d=b(d,0);e=b(e,0);f&&(f=d,d=Math.cos(f)*e,e*=Math.sin(f));f=this._currentCtx;f.beginPath();f.arc(d,e,a,0,
2*Math.PI);f.fill();f.closePath()}};Tips.Round=function(a){BrushTip.call(this,a)};Tips.Round.prototype=Object.create(BrushTip.prototype);Tips.Round.prototype.constructor=Tips.Round;Tips.Round.prototype._render=function(a){BrushTip.prototype._render.call(this,a);b(a.pressure,1);this._currentCtx.scale(1,.4);this._drawCircle(6*this.size)};Tips.Rough1=function(a){BrushTip.call(this,a);this._points=[];for(a=0;15>a;a++){var b=Math.pow(Math.random(),2),c=Math.random()*Math.PI*2,f=.1+4*Math.pow(1-b,2);b*=
4;this._points.push({d:b,a:c,r:f})}console.log(this)};Tips.Rough1.prototype=Object.create(BrushTip.prototype);Tips.Rough1.prototype.constructor=Tips.Rough1;Tips.Rough1.prototype._points=null;Tips.Rough1.prototype._render=function(a){BrushTip.prototype._render.call(this,a);var c=b(a.pressure,1);this._currentCtx.fillStyle="rgba(0,0,0,0.8)";var e=this;this._points.forEach(function(a,b){e._drawCircle(a.r*c,a.a,a.d,!0)})}})();Extends(DrawBrush2D_tool,DrawFreehand2D_tool);
function DrawBrush2D_tool(a){DrawBrush2D_tool.superConstructor.call(this,a)}_=DrawBrush2D_tool.prototype;_.createElement=function(){DrawBrush2D_tool.superClass.createElement.call(this);var a=document.createElement("canvas");a.width=1024;a.height=1024;var b=a.getContext("2d"),c=this.interactiveElement,d=new Brush({path:c,ctx:b,spacing:1});b=new Brush({path:c,ctx:b,spacing:2,tip:new Tips.Round});for(c=0;100>c;c++)d.drawFromLast(),b.drawFromLast();document.body.appendChild(a)};
Extends(DrawPath2D_tool,Base2D_tool);function DrawPath2D_tool(a){DrawPath2D_tool.superConstructor.call(this,a);this.selectionMode="POINT_SELECTION";this.interactiveSegment=this.currentPath=null}_=DrawPath2D_tool.prototype;_.onActivate=function(){DrawPath2D_tool.superClass.onActivate.call(this);this.resetState()};_.showInteraction=function(){};
_.onKeyDown=function(a){var b=a.keyCode;if("INTERACTIVE_PATH_SEGMENT_L"==this.interactiveSegment.getAttribute("id")&&b>=KeyboardEvent.CODES.keyCode_0&&b<=KeyboardEvent.CODES.keyCode_9){var c=this;this.appRef.interaction2D.lengthPropertyLabel.onChangeCallback=function(a){var b=c.interactiveSegment.getGeometryPointList({normalize:!1}),d=b[0].getAngleFromPoint(b[1]),g=c.currentPath.getGeometryPointList();g=g[g.length-1];a=SVGUtils.createSVGPointPolar(c.appRef.activeEditablePage.unitToValue(a),d);a.x=
g.x+a.x;a.y=g.y+a.y;a=c.currentPath.localToGlobal(a.x,a.y);b[1].x=a.x;b[1].y=a.y;c.addSegmentToCurrentPath();c.createNextInteractiveSegment()};this.appRef.interaction2D.lengthPropertyLabel.onClickOn_label()}else switch(b){case KeyboardEvent.CODES.keyCode_ESC:this.resetState();a.preventPropagation();break;case KeyboardEvent.CODES.keyCode_L:this.createNextInteractiveSegment("INTERACTIVE_PATH_SEGMENT_L");a.preventPropagation();break;case KeyboardEvent.CODES.keyCode_C:this.createNextInteractiveSegment(),
a.preventPropagation()}};_.resetState=function(){this.appRef.activeEditablePage.deselectAllElements();this.appRef.activeEditablePage.removeAllInteractions();this.interactiveSegment=this.currentPath=null};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else this.appRef.activeEditablePage.getActiveLayer().isLocked()?this.appRef.alertModalDialog.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):GMOUSE.globalMouseTargetDelegate=this};
_.onMouseUp=function(a){if(this.currentPath&&(a=this.currentPath.getGeometryPointList(),0<a.length)){a=a[a.length-1];a=this.currentPath.localToGlobal(a.x,a.y);var b=this.appRef.activeEditablePage.getPen();if(Math.abs(b.pointInDocumentSpace.x-a.x)<this.appRef.activeEditablePage.snapDistance&&Math.abs(b.pointInDocumentSpace.y-a.y)<this.appRef.activeEditablePage.snapDistance){this.stopCurveContinuity=!0;this.createNextInteractiveSegment("INTERACTIVE_PATH_SEGMENT_L");return}}this.addSegmentToCurrentPath();
this.createNextInteractiveSegment();this.checkForClosePath()};_.onMouseMove=function(a){DrawPath2D_tool.superClass.onMouseMove.call(this);if(!Event.isSpaceKeyPressed&&this.currentPath){var b=this.currentPath.getGeometryPointList(),c=b[b.length-1];b=this.appRef.activeEditablePage.getPen();a.shiftKey&&(a=this.currentPath.localToGlobal(c.x,c.y),b.pointInDocumentSpace=this.appRef.activeEditablePage.applySnapTo_angle(b.pointInDocumentSpace,a));this.updateInteractiveSegment()}};
_.onGlobalMouseStartDrag=function(a){this.appRef.interaction2D.lengthPropertyLabel.hide();this.convertCurrentInteractiveSegment()};_.onGlobalMouseDrag=function(a){this.updateInteractiveSegmentCtrlPoint()};_.onGlobalMouseEndDrag=function(a){this.addSegmentToCurrentPath();this.createNextInteractiveSegment();this.checkForClosePath()};
_.checkForClosePath=function(){var a=this.currentPath.getGeometryPointList();if(2<a.length&&a[0].equals(a[a.length-1])){var b=this.currentPath.createGeometryPoint_CLOSEPATH();a.push(b);this.createAddSegmentUndoRedoActions(this.currentPath,b);this.currentPath.renderRequest();this.resetState()}};
_.createNextInteractiveSegment=function(a){if(a)this.interactiveSegment=document.querySelector("#"+a);else switch(a=this.currentPath.getGeometryPointList(),a[a.length-1].type){case "M":case "L":this.interactiveSegment=document.querySelector("#INTERACTIVE_PATH_SEGMENT_L");break;case "C":case "Q":this.interactiveSegment=document.querySelector("#INTERACTIVE_PATH_SEGMENT_C")}this.updateInteractiveSegment()};
_.convertCurrentInteractiveSegment=function(){if(this.currentPath){if(this.stopCurveContinuity)this.interactiveSegment=document.querySelector("#INTERACTIVE_PATH_SEGMENT_Q"),this.stopCurveContinuity=!1;else{var a=this.currentPath.getGeometryPointList();switch(a[a.length-1].type){case "M":case "L":this.interactiveSegment=document.querySelector("#INTERACTIVE_PATH_SEGMENT_Q");break;case "Q":case "C":this.interactiveSegment=document.querySelector("#INTERACTIVE_PATH_SEGMENT_C")}}this.updateInteractiveSegment()}};
_.updateInteractiveSegment=function(){if(this.currentPath){var a=this.currentPath.getGeometryPointList(),b=a[a.length-1],c=this.appRef.activeEditablePage,d=c.getPen(),e=this.currentPath.localToGlobal(b.x,b.y),f=d.pointInDocumentSpace;this.appRef.interaction2D.smartPoints.showPoint0(e.x,e.y);a=this.interactiveSegment.getGeometryPointList({normalize:!1});a[0].x=e.x;a[0].y=e.y;a[1].x=f.x;a[1].y=f.y;if("INTERACTIVE_PATH_SEGMENT_L"==this.interactiveSegment.getAttribute("id"))a=d.pointInContentSpace.getDistanceFromPoint(b),
0<a&&this.appRef.interaction2D.lengthPropertyLabel.show(e,f,c.valueToUnit(a),null);else if(b.controlPt1){var g;b.controlPt2?g=this.currentPath.localToGlobal(b.controlPt2.x,b.controlPt2.y):b.controlPt1&&(g=this.currentPath.localToGlobal(b.controlPt1.x,b.controlPt1.y));c=a[0];e=a[0].x-(g.x-a[0].x);g=a[0].y-(g.y-a[0].y);Math.abs(e-c.x)>Math.abs(g-c.y)?(b=f.x,f=(f.x-c.x)/(e-c.x),d=c.y+(g-c.y)*f):(d=f.y,f=(f.y-c.y)/(g-c.y),b=c.x+(e-c.x)*f);a[1].controlPt1.x=b;a[1].controlPt1.y=d;a[1].controlPt2&&(a[1].controlPt2.x=
a[1].x,a[1].controlPt2.y=a[1].y)}this.interactiveSegment.renderRequest();this.appRef.interaction2D.segment2D.hideSegments();this.interactiveSegment.style.display="inline"}};
_.updateInteractiveSegmentCtrlPoint=function(){var a=this.appRef.activeEditablePage.screenPointToPen(GMOUSE.mouseMovePt).pointInDocumentSpace,b=this.interactiveSegment.getGeometryPointList({normalize:!1}),c=b[1].x-(a.x-b[1].x);a=b[1].y-(a.y-b[1].y);b[1].controlPt2?(b[1].controlPt2.x=c,b[1].controlPt2.y=a):(b[1].controlPt1.x=c,b[1].controlPt1.y=a);this.interactiveSegment.renderRequest(0)};
_.addSegmentToCurrentPath=function(){var a=this.appRef.activeEditablePage;if(this.currentPath){a=this.interactiveSegment.getAttribute("id");var b=this.interactiveSegment.getGeometryPointList({normalize:!1}),c;"INTERACTIVE_PATH_SEGMENT_Q"==a?c=this.currentPath.quadraticCurveToCubicCurve(b[0],b[1]):"INTERACTIVE_PATH_SEGMENT_C"==a?c=b[1].controlPt2.x==b[1].x&&b[1].controlPt2.y==b[1].y?this.currentPath.quadraticCurveToCubicCurve(b[0],b[1]):this.currentPath.createGeometryPoint_CURVETO_CUBIC(b[1].controlPt1.x,
b[1].controlPt1.y,b[1].controlPt2.x,b[1].controlPt2.y,b[1].x,b[1].y):"INTERACTIVE_PATH_SEGMENT_L"==a&&(c=this.currentPath.createGeometryPoint_LINETO(b[1].x,b[1].y));this.interactiveSegment.transformGeometryPointList(this.interactiveSegment.getTransformToElement(this.currentPath),[c]);c.ownerShapeElement=this.currentPath;a=this.currentPath.getGeometryPointList();a.push(c);c.id=a.length-1;this.currentPath.renderRequest();this.createAddSegmentUndoRedoActions(this.currentPath,c)}else this.currentPath=
SVGUtils.createPath(),c=this.appRef.activeEditablePage.getPen().pointInContentSpace,this.currentPath.setAttribute("d","M"+c.x+" "+c.y),a.getActiveLayer().appendChild(this.currentPath),this.applyElementStyle(this.currentPath),a.createAddElementsToDocumentUndoRedoActions([this.currentPath]),this.appRef.activeEditablePage.selectElementList([this.currentPath])};
_.createAddSegmentUndoRedoActions=function(a,b){this.appRef.activeEditablePage.history.addUndoRedoActions(new function(b){this.pageRef=b;this.execute=function(){a.getGeometryPointList().pop();a.renderRequest();this.pageRef.selectElementList([a]);this.pageRef.setCurrentEditableElement(a);this.pageRef.updateInteraction();this.pageRef.onChange()}}(this.appRef.activeEditablePage),new function(c){this.pageRef=c;this.execute=function(){a.getGeometryPointList().push(b);a.renderRequest();this.pageRef.selectElementList([a]);
this.pageRef.setCurrentEditableElement(a);this.pageRef.updateInteraction();this.pageRef.onChange()}}(this.appRef.activeEditablePage))};
_.applyElementStyle=function(a){var b=this.appRef.activeEditablePage,c=b.getDrawingProperty("stroke");a.setAttribute("stroke",c);c=b.getDrawingProperty("fill");a.setAttribute("fill",c);a.createUniqueFillStrokeDefReferences();c=b.getDrawingProperty("stroke-width");a.setAttribute("stroke-width",c);c=b.getDrawingProperty("stroke-dasharray");""!=c&&a.setAttribute("stroke-dasharray",c);b=b.getDrawingProperty("stroke-linejoin");"miter"!=b&&a.setAttribute("stroke-linejoin",b)};
Extends(DrawForeignObject2D_tool,BaseDraw2D_tool);function DrawForeignObject2D_tool(a){DrawForeignObject2D_tool.superConstructor.call(this,a);this.interactiveElement=document.querySelector("#INTERACTIVE_RECTANGLE");this.initPreferencesPanel()}_=DrawForeignObject2D_tool.prototype;_.initPreferencesPanel=function(){};
_.updateInteractiveElement=function(){var a=this.appRef.activeEditablePage.content.localToGlobal(this.pointA.x,this.pointA.y),b=this.appRef.activeEditablePage.content.localToGlobal(this.pointB.x,this.pointB.y),c=Math.min(a.x,b.x),d=Math.min(a.y,b.y),e=Math.abs(b.x-a.x);a=Math.abs(b.y-a.y);0==e&&(e=1);0==a&&(a=1);this.interactiveElement.updateGeometry(c,d,e,a)};
_.createElement=function(){var a=this.appRef.activeEditablePage,b=this.pointA,c=this.pointB;b=SVGUtils.createForeingObject(Math.min(b.x,c.x),Math.min(b.y,c.y),Math.abs(c.x-b.x),Math.abs(c.y-b.y),'<div style="width:100%; height:100%;" ><iframe src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d2873.287711160343!2d12.884659827726729!3d43.932718950714005!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sit!2sit!4v1541925598383" width="100%" height="100%" frameborder="0" style="width:100%; height:100%;"></iframe></div>');
a.getActiveLayer().appendChild(b);a.createAddElementsToDocumentUndoRedoActions([b]);a.selectElement(b);a.setCurrentEditableElement(b);a.updateInteraction();a.onChange()};Extends(SplitPath2D_tool,Base2D_tool);function SplitPath2D_tool(a){SplitPath2D_tool.superConstructor.call(this,a);this.selectionMode="POINT_SELECTION"}_=SplitPath2D_tool.prototype;_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.createElementListPreviews(null,a.selectionList);this.appRef.interaction2D.points2D.show()};
_.onActivate=function(){this.appRef.activeEditablePage&&this.appRef.activeEditablePage.updateInteraction()};_.onMouseDownOnInteractionPoint=function(a){var b=this.appRef.activeEditablePage,c=a.getTransform().matrix.getTranslation(),d=a.pointRef.ownerShapeElement;"path"==d.nodeName&&(d=d.getSubPathIdBySegment(a.pointRef),b.splitPathAtLocation_undable(a.pointRef.ownerShapeElement,d,c))};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else{a=this.appRef.activeEditablePage;var b=a.getPen();if(b.elementAtPoint&&"path"==b.elementAtPoint.nodeName){var c=b.elementAtPoint,d=c.findSegmentAtPoint(b.pointInDocumentSpace,1/a.content.currentScale*a.snapDistance);d&&a.splitPathAtLocation_undable(c,d.subPathId,b.pointInDocumentSpace)}}};_.onMouseDoubleClick=function(a){this.appRef.activateTool("selectionPoint2D_tool")};
Extends(DividePath2D_tool,Base2D_tool);function DividePath2D_tool(a){DividePath2D_tool.superConstructor.call(this,a);this.selectionMode="POINT_SELECTION"}_=DividePath2D_tool.prototype;_.onActivate=function(){this.appRef.activeEditablePage&&this.appRef.activeEditablePage.updateInteraction()};_.showInteraction=function(){this.appRef.interaction2D.points2D.show()};_.onMouseDownOnInteractionPoint=function(a){this.appRef.activeEditablePage.removePathSegments_undable([a.pointRef])};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else{a=this.appRef.activeEditablePage;var b=a.getPen();if(b.elementAtPoint&&"path"==b.elementAtPoint.nodeName){var c=b.elementAtPoint,d=c.findSegmentAtPoint(b.pointInDocumentSpace,1/a.content.currentScale*a.snapDistance);d&&(a.dividePathAtLocation_undable(c,d.subPathId,b.pointInDocumentSpace),this.appRef.tools.translatePoint2D_tool.onMouseDown())}}};_.onMouseDoubleClick=function(a){this.appRef.activateTool("selectionPoint2D_tool")};
Extends(RoundPathCorner2D_tool,Base2D_tool);function RoundPathCorner2D_tool(a){RoundPathCorner2D_tool.superConstructor.call(this,a);this.selectionMode="POINT_SELECTION"}_=RoundPathCorner2D_tool.prototype;_.onActivate=function(){this.appRef.activeEditablePage.setCurrentEditablePoint(null);this.appRef.interaction2D.segment2D.currentSegmentRef=null;this.appRef.activeEditablePage&&this.appRef.activeEditablePage.updateInteraction()};
_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.showSelectionProperties();a.createElementListPreviews(null,a.selectionList);this.appRef.interaction2D.points2D.showRoundableCornerPoints()};_.onMouseDownOnInteractionPoint=function(a){this.segmentToConvert=a.pointRef;GMOUSE.globalMouseTargetDelegate=this};_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else this.doSingleElementSelection("path")};
_.onMouseUp=function(a){if(Event.isDoubleClick)this.onMouseDoubleClick(a);else this.appRef.activeEditablePage.convertPathSegmentToCorner_undable(this.segmentToConvert),this.appRef.activeEditablePage.updateInteraction()};
_.onGlobalMouseStartDrag=function(a){this.appRef.disablePagePreviewsRendering();this.appRef.interaction2D.points2D.removeAllInteractionPoints();this.cornerDataList=[];this.editablePath=this.segmentToConvert.ownerShapeElement;this.interactivePath=this.editablePath.interactiveElement;this.segmentToConvert=this.interactivePath.getGeometryPointList()[this.segmentToConvert.id];this.roundAllCorners=!1;var b=[];if(a.altKey){this.roundAllCorners=!0;var c=this.interactivePath.getGeometryPointList();a=c.length-
1;for(var d=0;d<a;d++)"L"==c[d].type&&("L"==c[d+1].type?b.push(c[d]):"Z"==c[d+1].type&&b.push(c[d]))}else b=[this.segmentToConvert];a=b.length;for(d=0;d<a;d++)(c=this.initCornerData(b[d]))&&this.cornerDataList.push(c);this.startPen=this.appRef.activeEditablePage.screenPointToPen(GMOUSE.mouseDownPt)};
_.onGlobalMouseDrag=function(a){this.currentPen=this.appRef.activeEditablePage.screenPointToPen(GMOUSE.mouseMovePt);a=this.startPen.pointInContentSpace.getDistanceFromPoint(this.currentPen.pointInContentSpace);for(var b=0;b<this.cornerDataList.length;b++)this.updateRoundedCorner(this.cornerDataList[b],a)};
_.onGlobalMouseEndDrag=function(a){a=this.interactivePath.getGeometryPointList();for(var b=a.length-1,c=0;c<b;c++)"L"==a[c].type&&.001>a[c].getDistanceFromPoint(a[c-1])&&(a.removeAt(c),c--,b--);var d=this.interactivePath.getGeometryPointList(),e=this.appRef.activeEditablePage,f=this;e.history.addUndoRedoActions(new function(){this.pageRef=e;this.editablePath=f.editablePath;this.geometryPointList=f.editablePath.getGeometryPointList();this.execute=function(){this.editablePath.setGeometryPointList(this.geometryPointList);
this.editablePath.render();this.pageRef.onChange();this.pageRef.updateInteraction()}},new function(){this.pageRef=e;this.editablePath=f.editablePath;this.geometryPointList=d;this.execute=function(){this.editablePath.setGeometryPointList(this.geometryPointList);this.editablePath.render();this.pageRef.onChange();this.pageRef.updateInteraction()}});this.editablePath.setGeometryPointList(d);this.editablePath.render();this.appRef.enablePagePreviewsRendering();this.appRef.activeEditablePage.updateInteraction();
this.appRef.activeEditablePage.onChange()};_.onMouseDoubleClick=function(a){this.appRef.activateTool("selectionPoint2D_tool")};
_.initCornerData=function(a){var b=this.interactivePath,c=b.getGeometryPointList(),d=c.indexOf(a);if(-1==d)return null;var e=SVGUtils.createSVGPoint(a.x,a.y),f=c[d-1],g=d+1;if((d=c[g])&&"Z"==d.type){var h=b.getSubPathMoveToSegmentId(a);if(-1==h)return;g=h+1;d=c[g];if("L"!=d.type)return null;var k=b.createGeometryPoint_MOVETO(e.y,e.x);k.ownerShapeElement=this.interactivePath;c.replaceAt(k,h)}h=d;b=b.createGeometryPoint_CURVETO_CUBIC(e.x,e.y,e.x,e.y,e.x,e.y);c.addAt(b,g);b.ownerShapeElement=this.interactivePath;
c=a.getDistanceFromPoint(f);g=d.getDistanceFromPoint(a);c=Math.min(c,g);this.roundAllCorners&&(c/=2);return{cornerPoint:e,distanceLimit:c,startSegment:a,endSegment:h,moveToSegment:k,cubicCurveEditableSegment:b,startSegmentAngle:a.getAngleFromPoint(f),endSegmentAngle:a.getAngleFromPoint(d)}};
_.updateRoundedCorner=function(a,b){b>a.distanceLimit&&(b=a.distanceLimit);var c=this.interactivePath,d=SVGUtils.createSVGPointPolar(b,a.startSegmentAngle);d.x+=a.cornerPoint.x;d.y+=a.cornerPoint.y;var e=SVGUtils.createSVGPointPolar(b,a.endSegmentAngle);e.x+=a.cornerPoint.x;e.y+=a.cornerPoint.y;a.startSegment.x=d.x;a.startSegment.y=d.y;a.moveToSegment&&(a.moveToSegment.x=d.x,a.moveToSegment.y=d.y);d=SVGUtils.createSVGPointPolar(b-.551915*b,a.startSegmentAngle);d.x+=a.cornerPoint.x;d.y+=a.cornerPoint.y;
var f=SVGUtils.createSVGPointPolar(b-.551915*b,a.endSegmentAngle);f.x+=a.cornerPoint.x;f.y+=a.cornerPoint.y;a.cubicCurveEditableSegment.controlPt1.x=d.x;a.cubicCurveEditableSegment.controlPt1.y=d.y;a.cubicCurveEditableSegment.controlPt2.x=f.x;a.cubicCurveEditableSegment.controlPt2.y=f.y;a.cubicCurveEditableSegment.x=e.x;a.cubicCurveEditableSegment.y=e.y;c.renderRequest()};Extends(ConvertPathPoint2D_tool,Base2D_tool);
function ConvertPathPoint2D_tool(a){ConvertPathPoint2D_tool.superConstructor.call(this,a);this.selectionMode="POINT_SELECTION"}_=ConvertPathPoint2D_tool.prototype;_.onActivate=function(){this.appRef.activeEditablePage&&this.appRef.activeEditablePage.updateInteraction()};
_.onMouseDownOnInteractionPoint=function(a){this.segmentToConvert=a.pointRef;GMOUSE.globalMouseTargetDelegate=this;this.appRef.activeEditablePage.removeAllInteractions();this.appRef.activeEditablePage.setCurrentEditablePoint(null);this.appRef.interaction2D.segment2D.currentSegmentRef=null};_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else this.doSingleElementSelection("path")};
_.onMouseUp=function(a){console.log("onMouseUp",this);if(Event.isDoubleClick)this.onMouseDoubleClick(a);else this.appRef.activeEditablePage.convertPathSegmentToCorner_undable(this.segmentToConvert),this.appRef.activeEditablePage.updateInteraction()};
_.onGlobalMouseStartDrag=function(a){"path"==this.segmentToConvert.ownerShapeElement.nodeName&&"M"!=this.segmentToConvert.type&&this.appRef.activeEditablePage.convertPathSegmentToCurve_undable(this.segmentToConvert)&&(this.appRef.tools.translateControlPoint2D_tool.reflectOppositeControlPoint=!0,this.appRef.tools.translateControlPoint2D_tool.onMouseDown(a),this.appRef.tools.translateControlPoint2D_tool.onGlobalMouseStartDrag(a))};_.onMouseDoubleClick=function(a){this.appRef.activateTool("selectionPoint2D_tool")};
Extends(EditGradientPoints2D_tool,BaseDraw2D_tool);function EditGradientPoints2D_tool(a){EditGradientPoints2D_tool.superConstructor.call(this,a);this.interactiveElement=document.querySelector("#INTERACTIVE_LINE");this.selectionMode="POINT_SELECTION"}_=EditGradientPoints2D_tool.prototype;_.onActivate=function(){this.appRef.activeEditablePage&&this.appRef.activeEditablePage.updateInteraction()};
_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.showSelectionProperties();a.createElementListPreviews(null,a.selectionList);this.appRef.fillStroke2DPanel.editableGradientDef&&1==a.selectionList.length?this.appRef.interaction2D.gradientPoints2D.show():a.removeAllInteractions()};
_.onMouseDown=function(a){if(Event.isSpaceKeyPressed)this.appRef.tools.panView2D_tool.onMouseDown(a);else a.metaKey||a.ctrlKey||0==this.appRef.activeEditablePage.selectionList.length?this.doSingleElementSelection():"MOVE"!=this.currentDrawingAction&&(this.appRef.activeEditablePage.removeAllInteractions(),this.currentDrawingAction="START",this.definePointA(),GMOUSE.globalMouseTargetDelegate=this)};
_.definePointA=function(){this.pointA=this.appRef.activeEditablePage.getPen().pointInContentSpace;this.pointB=this.appRef.activeEditablePage.getPen().pointInContentSpace;this.updateInteractiveElement()};_.definePointB=function(a){var b=this.appRef.activeEditablePage,c=b.getPen();this.pointB=a.shiftKey?b.applySnapTo_angle(c.pointInContentSpace,this.pointA,b.snapDistance/b.content.currentScale):c.pointInContentSpace;this.interactiveElement.classList.add("showed");this.updateInteractiveElement()};
_.updateInteractiveElement=function(){var a=this.appRef.activeEditablePage.content.localToGlobal(this.pointA.x,this.pointA.y),b=this.appRef.activeEditablePage.content.localToGlobal(this.pointB.x,this.pointB.y);this.interactiveElement.updateGeometry(a.x,a.y,b.x,b.y)};
_.createElement=function(){var a=this.appRef.activeEditablePage.content.localToGlobal(this.pointA.x,this.pointA.y),b=this.appRef.activeEditablePage.content.localToGlobal(this.pointB.x,this.pointB.y),c=this.appRef.activeEditablePage;c.setGradientsPointsElementList_undable(c.selectionList,this.appRef.fillStroke2DPanel.activeGraphicSideTarget,a,b);c.updateInteraction();c.onChange()};Extends(PerspectiveDeform2D_tool,Base2D_tool);
function PerspectiveDeform2D_tool(a){PerspectiveDeform2D_tool.superConstructor.call(this,a);this.selectionMode="POINT_SELECTION"}_=PerspectiveDeform2D_tool.prototype;_.onActivate=function(){this.appRef.activeEditablePage&&this.appRef.activeEditablePage.updateInteraction()};_.onDeactivate=function(){this.appRef.interaction2D.perspectiveDeform2D.endTransform()};
_.showInteraction=function(){var a=this.appRef.activeEditablePage;a.showSelectionProperties();a.removeAllInteractions();a.createElementListPreviews(null,a.selectionList);1<=a.selectionList.length&&this.appRef.interaction2D.perspectiveDeform2D.show()};_.onMouseUp=function(a){this.appRef.activateTool("selectionGlobal2D_tool")};_.onMouseWheel=function(a){};
var SVG_TAG_ATTRIBUTES={meta:["xmlns:jvs","name"],"jvs:property":["value","name"],link:["xmlns","rel","type","href"],style:[],"#cdata-section":[],"*":"name class id tabindex fill fill-opacity fill-rule stroke stroke-opacity stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-width filter marker-end marker-mid marker-start mask clip-path opacity style transform preserveAspectRatio".split(" "),a:["href","xlink:href","target"],circle:["cx","cy","r"],clipPath:[],
defs:[],desc:[],ellipse:["cx","cy","rx","ry"],feBlend:["in","in2","mode","result"],feColorMatrix:["in","type","values","result"],feComponentTransfer:["in","result"],feComposite:"in in2 k1 k2 k3 k4 result operator".split(" "),feConvolveMatrix:[],feDiffuseLighting:["lighting-color","diffuseConstant","surfaceScale","result"],feDisplacementMap:"in in2 scale xChannelSelector yChannelSelector result".split(" "),feDistantLight:["azimuth","elevation","result"],feDropShadow:["dx","dy","stdDeviation","result"],
feFlood:["flood-color","flood-opacity","result"],feFuncA:"amplitude exponent intercept offset slope tableValues type result".split(" "),feFuncB:"amplitude exponent intercept offset slope tableValues type result".split(" "),feFuncG:"amplitude exponent intercept offset slope tableValues type result".split(" "),feFuncR:"amplitude exponent intercept offset slope tableValues type result".split(" "),feGaussianBlur:["in","stdDeviation","endgeMode","result"],feImage:"xlink:href href width height x y preserveAspectRatio result".split(" "),
feMerge:["result"],feMergeNode:["in","result"],feMorphology:["in","operator","radius","result"],feOffset:["in","dx","dy","result"],fePointLight:["x","y","z","result"],feSpecularLighting:"specularExponent specularConstant surfaceScale lighting-color result in".split(" "),feSpotLight:"limitingConeAngle pointsAtX pointsAtY pointsAtZ specularExponent x y z result".split(" "),feTile:"in width height x y result".split(" "),feTurbulence:["baseFrequency","numOctaves","seed","stitchTiles","result"],filter:"filterUnits primitiveUnits width height x y".split(" "),
foreignObject:["height","width","x","y"],g:[],iframe:["src"],image:"height href xlink:href width x y".split(" "),line:["x1","x2","y1","y2"],linearGradient:"gradientTransform gradientUnits href xlink:href spreadMethod x1 x2 y1 y2".split(" "),marker:"markerHeight markerUnits markerWidth viewBox orient refX refY".split(" "),mask:"maskContentUnits maskUnits height width mask-type x y".split(" "),path:["d"],pattern:"height patternContentUnits patternTransform patternUnits viewBox width height href xlink:href x y".split(" "),
polygon:["points"],polyline:["points"],radialGradient:"cx cy fr fx fy gradientTransform gradientUnits href xlink:href r spreadMethod".split(" "),rect:"height rx ry width x y".split(" "),script:["xlink:href","href","type"],stop:["offset","stop-color","stop-opacity"],svg:"height viewBox width x y xmlns xmlns:xlink".split(" "),"switch":[],symbol:"height viewBox width x y refX refY".split(" "),text:"alignment-baseline baseline-shift direction font-family font-size font-size-adjust font-stretch font-style font-variant font-weight kerning lengthAdjust letter-spacing lighting-color line-height text-anchor text-decoration text-rendering textLength text-align unicode-bidi word-spacing width height x y".split(" "),
textArea:[],textPath:"method side spacing startOffset href xlink:href".split(" "),title:[],tspan:"alignment-baseline baseline-shift direction font-family font-size font-size-adjust font-stretch font-style font-variant font-weight kerning lengthAdjust letter-spacing lighting-color line-height text-anchor text-decoration text-rendering textLength unicode-bidi word-spacing dx dy rotate x y".split(" "),use:"href xlink:href height viewBox width x y refX refY".split(" ")};
function Document2DSerializer(a,b){this.appRef=a;this.timestamp=(new Date).getTime();this.options={};this.options.renameDynamicSymbols=!1;this.options.renameDynamicPatterns=!1;this.options.renameDynamicGradients=!0;this.options.renameDynamicMarkers=!1;this.options.renameDynamicFilters=!1;this.options.removeUnusedSymbols=!0;this.options.removeUnusedPatterns=!0;this.options.removeUnusedGradients=!0;this.options.removeUnusedMarkers=!0;this.options.removeUnusedFilters=!0;b&&(void 0!=b.removeUnusedSymbols&&
(this.removeUnusedSymbols=b.removeUnusedSymbols),void 0!=b.removeUnusedPatterns&&(this.removeUnusedPatterns=b.removeUnusedPatterns),void 0!=b.removeUnusedGradients&&(this.removeUnusedGradients=b.removeUnusedGradients),void 0!=b.removeUnusedMarkers&&(this.removeUnusedMarkers=b.removeUnusedMarkers),void 0!=b.removeUnusedFilters&&(this.removeUnusedFilters=b.removeUnusedFilters));this.options=b||this.options}_=Document2DSerializer.prototype;
_.serializeDocument=function(a,b,c){b=b||a.getActivePage().dataset.width;c=c||a.getActivePage().dataset.height;b=SVGUtils.createSVG(b,c);b.appendChild(document.querySelector("#PROJECT_DEFS defs").cloneNode(!0));c=a.querySelectorAll(".page-2D");var d=0,e,f=c.length;for(e=0;e<f;e++){a=c[e];var g=this.serializePage(a);g.setAttribute("y",d);b.appendChild(g);d+=parseFloat(a.dataset.height)}b.setAttribute("height",d);this.fixAttributes(g);console.log("svgOutput",b);b.removeUnusedDefsItems(this.options);
b.rebuildDynamicIDs(this.options);this.serializeFontLinks(b);this.serializeComponents(b);this.createSVGXlinks(b);this.serializeImages(b);return b};
_.serializeItemList=function(a){var b=SVGUtils.createSVG("100%","100%");b.setAttribute("id","clipboard_v62");b.setAttribute("documentRef",this.appRef.getActiveDocument().getAttribute("id"));b.appendChild(document.querySelector("#PROJECT_DEFS defs").cloneNode(!0));var c=SVGUtils.createGroup();c.setAttribute("id","content");b.appendChild(c);for(var d,e,f=0;f<a.length;f++)d=a[f],e=d.getLayerOwner(),e=d.getTransformToElement(e),d=d.cloneNode(!0),d.removeAttribute("selected"),d.getTransform().setMatrix(e),
c.appendChild(d);this.fixAttributes(b);b.removeUnusedDefsItems(this.options);b.rebuildDynamicIDs(this.options);this.serializeFontLinks(b);this.serializeComponents(b);this.createSVGXlinks(b);this.serializeImages(b);return b};
_.fixAttributes=function(a){var b=a.querySelectorAll("[systemLanguage]"),c,d=b.length;for(c=0;c<d;c++)b[c].removeAttribute("systemLanguage");b=a.querySelectorAll("[requiredExtensions]");d=b.length;for(c=0;c<d;c++)b[c].removeAttribute("requiredExtensions");b=a.querySelectorAll("[selected]");d=b.length;for(c=0;c<d;c++)b[c].removeAttribute("selected");b=a.querySelectorAll(".pointer-hover");d=b.length;for(c=0;c<d;c++)b[c].classList.remove("pointer-hover");b=a.querySelectorAll("text tspan[data-start-offset]");
d=b.length;for(c=0;c<d;c++)b[c].removeAttribute("data-start-offset");b=a.querySelectorAll("svg>title");d=b.length;for(c=0;c<d;c++)0==b[c].textContent.length&&b[c].remove();b=a.querySelectorAll("svg>desc");d=b.length;for(c=0;c<d;c++)0==b[c].textContent.length&&b[c].remove()};_.serializePageAsGroup=function(a){var b=SVGUtils.createGroup();a.cloneChildrenTo(b);b.querySelector(".content").removeAttribute("transform");return b};
_.serializePage=function(a){function b(a,b){var c=document.createElement("jvs:property");c.setAttribute("name",a);c.setAttribute("value",b);d.appendChild(c)}var c=a.cloneNode(!0);c.querySelector(".content").removeAttribute("transform");c.setAttribute("width",a.dataset.width);c.setAttribute("height",a.dataset.height);c.setAttribute("viewBox","0 0 "+a.dataset.width+" "+a.dataset.height);var d=document.createElement("meta");c.appendChild(d);d.setAttribute("id","page-properties");d.setAttribute("xmlns:jvs",
"http://www.janvas.com/ns");b("width",a.dataset.width);b("height",a.dataset.height);b("unitKey",a.unitKey);b("drawingScale",a.drawingScale);b("fixedDecimals",a.fixedDecimals);b("showGrid",a.showGrid);b("showRulers",a.showRulers);b("gridStep",a.gridStep);return c};
_.serializeFontLinks=function(a){for(var b,c,d,e=a.querySelectorAll("[font-family]"),f=[],g=0;g<e.length;g++)d=e[g],b=d.getAttribute("font-family").split(" ").join("+"),c=d.getAttribute("font-style")||"regular",d=d.getAttribute("font-weight")||"",b=window.GoogleFonts.getFontUrlByFontFamilyStyleAndWeight(b,c,d,null),console.log("fontUrl",b),(b=document.head.querySelector('*[href*="'+b+'"]'))&&-1==f.indexOf(b)&&f.push(b);a=a.querySelector("defs");for(g=0;g<f.length;g++)e=f[g].cloneNode(),e.appendChild(document.createTextNode("")),
a.appendChild(e);console.log("defsNode",a)};_.serializeComponents=function(a){for(var b,c,d=a.querySelectorAll("[data-controller-class]"),e=0;e<d.length;e++)a=d[e],b=a.getAttribute("data-type"),"IFrameInForeignObject"==b&&(c=a.getTransform().matrix.decompose(),b=c.translateX,c=c.translateY,a.hasAttribute("x")&&(b+=parseFloat(a.getAttribute("x"))),a.hasAttribute("y")&&(c+=parseFloat(a.getAttribute("y"))),a.setAttribute("x",b),a.setAttribute("y",c),a.setAttribute("transform",""))};
_.createSVGXlinks=function(a){for(var b,c,d=a.querySelectorAll("[data-xlink-href]"),e=0;e<d.length;e++)a=d[e],b=a.getAttribute("data-xlink-href"),a.removeAttribute("data-xlink-href"),a.hasAttribute("data-xlink-target")&&(c=a.getAttribute("data-xlink-target").trim(),a.removeAttribute("data-xlink-target"),""==c&&(c=null)),b=SVGUtils.createXlink(b,c),b.appendChild(a.cloneNode(!0)),console.log("xlink",b),a.parentNode.replaceChild(b,a)};
_.serializeImages=function(a){for(var b=a.querySelectorAll("[data-full-path]"),c=0;c<b.length;c++)a=b[c],a.setAttributeNS(SVGElement.XLINK_NS,"href",a.dataset.fullPath.slice(1)),a.removeAttribute("data-full-path")};function SvgUnserializer(a,b){this.appRef=a;this.options=b||{};this.options.renameDynamicSymbols=!1;this.options.renameDynamicPatterns=!1;this.options.renameDynamicGradients=!0;this.options.renameDynamicMarkers=!1;this.options.renameDynamicFilters=!1}_=SvgUnserializer.prototype;
_.unserialize=function(a){console.log("unserialize",a);this.appRef.createDocument();this.validate(a);this.parseScriptTags(a);this.parseClipPaths(a);this.convertCSSStylePropertiesToAttributes(a);this.convertStylePropertiesToAttributes(a);this.parseFonts(a);this.parseGradients(a);this.parseAnchorElements(a);this.parseGeometryToConvertToPath(a);this.parseDefs(a);this.parseContent(a);this.consolidateMatrix();this.parseText()};
_.unserializeAndPlaceElementListInCurrentLayer=function(a){this.validate(a);this.removeTitleAndDescription(a);this.parseScriptTags(a);this.parseClipPaths(a);this.convertCSSStylePropertiesToAttributes(a);this.convertStylePropertiesToAttributes(a);this.parseFonts(a);this.parseGradients(a);this.parseAnchorElements(a);this.parseGeometryToConvertToPath(a);this.parseDefs(a,!0);this.fixEmptyFillAndStroke(a);a=this.parseContent(a);this.consolidateMatrix();this.parseText();return a};
_.removeTitleAndDescription=function(a){a=a.querySelectorAll("title,desc");for(var b=0;b<a.length;b++)a[b].remove()};
_.fixEmptyFillAndStroke=function(a){var b=a.getAttribute("fill"),c=a.getAttribute("stroke");"currentColor"==b&&(b="#000000");"currentColor"==c&&(c="#000000");var d;if(b){var e=a.querySelectorAll(":scope > path:not([fill]),:scope > line:not([fill]),:scope > ellipse:not([fill]),:scope > rect:not([fill])");for(d=0;d<e.length;d++)e[d].setAttribute("fill",b)}if(c)for(e=a.querySelectorAll(":scope > path:not([stroke]),:scope > line:not([stroke]),:scope > ellipse:not([stroke]),:scope > rect:not([stroke])"),d=
0;d<e.length;d++)e[d].setAttribute("stroke",c)};
_.convertCSSStylePropertiesToAttributes=function(a){var b=a.querySelectorAll("style");console.log("styleList",b);for(var c,d,e,f=0;f<b.length;f++){d=b[f].textContent;c={};d=d.replace(/\/\*(\r|\n|.)*\*\//g,"");d=d.split("}");d.pop();for(var g=d.length,h=0;h<g;h++){var k=d[h].split("{"),l=k[0].trim(),n={};k=k[1].split(";");k.pop();for(var m=k.length,y=0;y<m;y++){var p=k[y].indexOf(":"),K=k[y].substring(0,p).trim();p=k[y].substring(p+1).trim();""!=K&&""!=p&&(n[K]=p)}c[l]=n}console.log("CSS_JSON",c);
b[f].remove();for(e in c)for(d=a.querySelectorAll(e),g=0;g<d.length;g++)d[g].stylePropertiesToAttributes(c[e]),d[g].classList.remove(e)}};
_.validate=function(a){function b(a){for(var d,f,g=[].slice.call(a.children,0),h,k=0;k<g.length;k++)if(f=g[k],console.log("element.nodeName",f.nodeName),h=c[f.nodeName]){if(f.attributes){d=[].slice.call(f.attributes,0);for(var l=0;l<d.length;l++)a=d[l].name,-1==h.indexOf(a)&&-1==c["*"].indexOf(a)&&0!=a.indexOf("data-")&&(console.log("rimozione attributo",a),f.removeAttribute(a))}b(f)}else console.log("rimuovo",f),f.parentElement.removeChild(f)}var c=SVG_TAG_ATTRIBUTES;b(a)};_.parseContent=function(a){return this.appRef.getActiveDocument().getActivePage().getActiveLayer().appendChildren(a.children)};
_.parseText=function(){for(var a,b=this.appRef.getActiveDocument().querySelectorAll("text"),c=0;c<b.length;c++){a=b[c];if(a.hasAttribute("x")&&a.hasAttribute("y")){var d=a.getTransform().matrix.translate(parseFloat(a.getAttribute("x")),parseFloat(a.getAttribute("y")));a.getTransform().setMatrix(d);a.removeAttribute("x");a.removeAttribute("y");a.firstElementChild&&(a.firstElementChild.setAttribute("x","0"),a.firstElementChild.setAttribute("y","0"))}a.parseText();a.consolidateAllStyles()}};
_.parseGeometryToConvertToPath=function(a){a=a.querySelectorAll("polygon,polyline,circle");console.log("parseGeometryToConvertToPath",a);for(var b=0;b<a.length;b++){a[b].getPathData();var c=SVGUtils.createPath();c.setGraphicAttributesByElement(a[b]);c.setPathData(a[b].getPathData());a[b].hasAttribute("transform")&&c.setAttribute("transform",a[b].getAttribute("transform"));a[b].parentElement.replaceChild(c,a[b])}};
_.parseClipPaths=function(a){for(var b,c=a.querySelectorAll("[clip-path]"),d,e,f,g=0;g<c.length;g++)b=c[g],"g"==b.nodeName&&(d=b.getAttribute("clip-path"),e=String.extractIdFromUrl(d),f=a.querySelector('clipPath[id="'+e+'"]'),console.log("urlClipPath",d),f?f.parentElement!=b&&b.appendChild(f):console.log("clip path non esistente idClipPath",e))};_.consolidateMatrix=function(){for(var a=this.appRef.getActiveDocument().querySelectorAll("[transform]"),b=0;b<a.length;b++)a[b].getTransform().setMatrix(a[b].transform.baseVal.consolidate().matrix)};
_.parseDefs=function(a,b){var c=a.querySelector("defs");c?c.remove():c=SVGUtils.createDefs();for(var d=a.querySelectorAll("linearGradient,radialGradient,pattern,marker"),e=0;e<d.length;e++)c.appendChild(d[e]);if(c)if(d=document.querySelector("#PROJECT_DEFS defs"),b){var f=[],g=[],h=c.querySelectorAll(":scope > *");for(e=0;e<h.length;e++){var k=d.querySelector("#"+h[e].getAttribute("id"));k?(f.push(h[e]),g.push(k)):d.appendChild(h[e])}var l=this.appRef.getActiveDocument();l.getAttribute("id")!=a.getAttribute("documentRef")&&
0<g.length&&this.appRef.confirmModalDialog.open(LOCALIZER.translate("Caution"),LOCALIZER.translate("Do you want to replace already defined pattern, symbols and markers ?"),function(){l.getActivePage().replaceElementList_undable(g,f,!1)})}else d.parentElement.replaceChild(c,d);return c};
_.parseFonts=function(a){if(a=a.querySelector("defs")){a=a.querySelectorAll("link");for(var b=0;b<a.length;b++){var c=a[b];if(c.hasAttribute("rel")&&"stylesheet"==c.getAttribute("rel")){var d=c.getAttribute("href");d=d.replace("http:","https:");-1<d.indexOf("//fonts.googleapis.com/css?family")&&(document.head.querySelector('link[href="'+d+'"]')||IncludeCSS(d),c.remove(),c=GetUrlVars(d),d=c.family.split(":")[0].replace(/\+/g," "),console.log("urlVars",c),window.GoogleFonts.selectFontByFamilyName(d))}}}};
_.parseAnchorElements=function(a){var b=a.querySelectorAll("a");console.log("parseAnchorElements a_elements",b);for(var c=0;c<b.length;c++){a=b[c];var d=a.parentElement;var e=a.__getAttribute("xlink:href");console.log("parseAnchorElements xlinkUrl",e);""==e?(a.removeAttribute("xlink:href"),a.removeAttribute("target")):(a.firstElementChild.__setAttribute("data-xlink-href",e),a.hasAttribute("target")&&(e=a.__getAttribute("target"),""==e?a.removeAttribute("target"):a.firstElementChild.__setAttribute("data-xlink-target",
e)));a.remove();a.cloneChildrenTo(d)}};_.parseScriptTags=function(a){var b=this.appRef.getActiveDocument();a=a.querySelectorAll("script");b.scriptList=[];for(var c=0;c<a.length;c++){var d=a[c];if(d.hasAttribute("xlink:href")){var e=d.getAttribute("xlink:href");b.scriptList.push(e)}else d.hasAttribute("src")&&(e=d.getAttribute("src"),b.scriptList.push(e));d.remove()}};
_.convertStylePropertiesToAttributes=function(a){a=a.querySelectorAll("[style]");for(var b=0;b<a.length;b++)a[b]instanceof SVGElement&&a[b].stylePropertiesToAttributes()};
_.parseGradients=function(a){for(var b=a.querySelectorAll("linearGradient[*|href],radialGradient[*|href]"),c,d,e=0;e<b.length;e++)if(c=b[e],d=a.querySelector(c.getAttribute("xlink:href")))d.cloneChildrenTo(c),d.hasAttribute("gradientTransform")&&!c.hasAttribute("gradientTransform")&&c.setAttribute("gradientTransform",d.getAttribute("gradientTransform")),c.removeAttribute("xlink:href")};Extends(Document2DUnserializer_v601,SvgUnserializer);
function Document2DUnserializer_v601(a,b){Document2DUnserializer_v601.superConstructor.call(this,a,b)}_=Document2DUnserializer_v601.prototype;_.unserialize=function(a,b){b||this.appRef.createDocument({maxPages:0});this.validate(a);this.parseScriptTags(a);this.parseAnchorElements(a);this.parseGeometryToConvertToPath(a);this.parseFonts(a);this.parseDefs(a,b);this.parsePages(a);this.consolidateMatrix();this.parseText()};
_.unserializeAndPlaceElementListInCurrentLayer=function(a){this.validate(a);a.rebuildDynamicIDs(this.options);this.parseScriptTags(a);this.parseAnchorElements(a);this.parseGeometryToConvertToPath(a);this.parseFonts(a);this.parseDefs(a,!0);var b=this.appRef.getActiveDocument().getActivePage();a=a.querySelectorAll('[id="content"] > *');b.getActiveLayer().appendChildren(a);this.consolidateMatrix();this.parseText();return a};
_.parseText=function(){for(var a=this.appRef.getActiveDocument().querySelectorAll("text"),b=0;b<a.length;b++)a[b].parseText()};_.parsePages=function(a){for(var b=this.appRef.getActiveDocument(),c=a.querySelectorAll("svg>svg"),d=0;d<c.length;d++)a=c[d],b.appendChild(a),this.parsePage(a);b.setActivePage(b.firstElementChild);this.appRef.pages2DPanel.update()};
_.parsePage=function(a){function b(a){return(a=c.querySelector('[name="'+a+'"]'))?a.getAttribute("value"):null}a.removeAttribute("viewBox");a.setAttribute("width","100%");a.setAttribute("height","100%");a.querySelector(".layers").setAttribute("id",CreateUniqueIDI());a.connectController(SVGPage,{appRef:this.appRef});var c=a.querySelector('meta[id="page-properties"]');a.setUnits(b("unitKey"));a.drawingScale=parseFloat(b("drawingScale"));a.fixedDecimals=parseInt(b("fixedDecimals"));a.showGrid="true"===
b("showGrid")||!1;a.showRulers="true"===b("showRulers")||!0;a.gridStep=parseFloat(b("gridStep"));c.remove()};Extends(Document2DUnserializer_v501,SvgUnserializer);function Document2DUnserializer_v501(a,b){this.appRef=a}_=Document2DUnserializer_v501.prototype;
_.unserialize=function(a){this.appRef.createDocument({maxPages:1});this.validate(a);this.parseScriptTags(a);this.parseAnchorElements(a);this.parseGeometryToConvertToPath(a);this.convertStylePropertiesToAttributes(a);this.parseFonts(a);this.parseDefs(a);this.parseContent(a);this.consolidateMatrix();this.parseText();this.appRef.workspace.updateActivePageBackground();this.appRef.pages2DPanel.update()};
_.parseContent=function(a){var b=this.appRef.getActiveDocument().getActivePage();b.setSize(parseFloat(a.getAttribute("width")),parseFloat(a.getAttribute("height")));var c=a.querySelectorAll(".jvs-layer");console.log("Document2DUnserializer_v501 loadedLayerList",c);for(var d=0;d<c.length;d++){var e=c[d];a=b.createLayer(e.getAttribute("name"),e.getAttribute("jvs-layer-color"));a.appendChildren(e.children);b.getLayersContainer().appendChild(a)}};
_.parseText=function(){console.log("parseText v5");for(var a,b,c,d,e,f=this.appRef.getActiveDocument().querySelectorAll("text"),g=0;g<f.length;g++){e=f[g];d=e.querySelectorAll("tspan");for(var h=0;h<d.length;h++)b=d[h],b.setAttribute("x","0"),(a=b.findCDATANode())?(b.innerHTML="",b.appendChild(a)):b.textContent=b.textContent.trim(),b.style.whiteSpace="pre",c&&(a?c.firstChild.data+="\n":c.textContent+="\n"),c=d[h];console.log("parse textElement",e);e.parseText();e.consolidateAllStyles();e.__setAttribute("data-type",
"TextBox")}};function ValidatePlan(a){var b=GetCookie("planKey");if(b){var c=SendAndLoad(ACCOUNT_MANAGER_URL,"POST",{action:"validatePlan",planKey:b},function(){c.response&&("YES"===c.response.actionResponse?a():ShowBuyPlanDialog())});c.responseType="json"}else ShowBuyPlanDialog()}function ShowPlanActivationErrorDialog(){ShowElement(document.querySelector("#MODAL_DIALOGS #BUY_PLAN_DIALOG"));ShowElement(document.querySelector("#MODAL_DIALOGS #BUY_PLAN_DIALOG #PLAN_ACTIVATION_ERROR"))}
function ShowPlanActivationDialog(a){var b=document.querySelector("#MODAL_DIALOGS #BUY_PLAN_DIALOG"),c=b.querySelector("#PLAN_ACTIVATION_SUCCESS");ShowElement(b);ShowElement(c);c.querySelector(".start-plan-date").innerHTML=a.planStartTimestamp;c.querySelector(".end-plan-date").innerHTML=a.planExpirationTimestamp}
function ShowBuyPlanResponseDialog(a){function b(){console.log("onCheckTransactionResponse xhr",d);d.response&&(console.log("onCheckTransactionResponse response",d.response),"SUCCESS"===d.response.actionResponse?(SetCookie("planKey",d.response.planKey,365),ShowPlanActivationDialog(d.response)):"WAIT"===d.response.actionResponse?24>e?(e++,setTimeout(c,5E3)):ShowPlanActivationErrorDialog():ShowPlanActivationErrorDialog())}function c(){var c={action:"checkTransaction",txn_id:a.transactions[0].related_resources[0].sale.id};
console.log("checkTransaction postData",c);d=SendAndLoad(ACCOUNT_MANAGER_URL,"POST",c,b);d.responseType="json"}ShowElement(document.querySelector("#MODAL_DIALOGS #BUY_PLAN_DIALOG"));ShowElement(document.querySelector("#MODAL_DIALOGS #BUY_PLAN_DIALOG #BUY_PLAN_RESPONSE"));var d;console.log("_data",a);console.log("txn_id",a.transactions[0].related_resources[0].sale.id);var e=0;setTimeout(c,5E3)}
function ShowBuyPlanDialog(){function a(a,b,g){d.arePaypalButtonsAlreadyDrawn=!0;paypal.Button.render({env:PAYPAL_ENVIRONMENT,client:{sandbox:PAYPAL_CLIENT_ID_SANDBOX,production:PAYPAL_CLIENT_ID_PRODUCTION},commit:!0,payment:function(a,d){return d.payment.create({payment:{transactions:[{amount:{total:g,currency:"EUR"},custom:navigator.userAgent,description:b,notify_url:c}]}})},onAuthorize:function(a,b){return b.payment.execute().then(function(a){console.log("payment execute data",a);ShowBuyPlanResponseDialog(a)})}},
"#"+a)}ShowElement(document.querySelector("#MODAL_DIALOGS #BUY_PLAN_DIALOG"));ShowElement(document.querySelector("#MODAL_DIALOGS #BUY_PLAN_DIALOG #BUY_PLAN"));if(!this.arePaypalButtonsAlreadyDrawn){var b=window.location.href.split("/");b.pop();var c=b.join("/")+"/paypal_IPN.php",d=this;a("paypal-button-container-3-months","Janvas Plan 3 Months","12");a("paypal-button-container-6-months","Janvas Plan 6 Months","21");a("paypal-button-container-12-months","Janvas Plan 12 Months","36")}}
function Archivie2D_toolbar(a){a.appRef&&(this.appRef=a.appRef);this.connectEvents()}_=Archivie2D_toolbar.prototype;_.onClick_print=function(){this.appRef.activeEditablePage.is_isolateLayerEditing()?this.appRef.alertModalDialog.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("Please exit from isolate layer editing!")):this.appRef.getActiveDocument().printDocument()};_.onClick_howTo=function(){this.appRef.webViewDialog.open("https://www.janvas.com/XOS_6.2/janvas_website_6.2/index.php")};
_.onClick_buyPlan=function(){ShowBuyPlanDialog()};_.onClick_new=function(){console.log("onClick_exportPNG")};_.onClick_chooseDocumentFromLocalDrive=function(a){this.appRef.chooseDocumentFromLocalDrive(a)};
_.onClick_saveDocumentToLocalDrive=function(a){if(this.appRef.activeEditablePage.is_isolateLayerEditing())this.appRef.alertModalDialog.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("Please exit from isolate layer editing!"));else{var b=this;ValidatePlan(function(){LOCAL_FILE_SYSTEM.saveLocalFile(document.querySelector("#DOCUMENT_TITLE").innerHTML,b.appRef.serializeDocument(b.appRef.getActiveDocument()),"image/svg+xml")})}};
_.onClick_exportHTMLDocumentToLocalDrive=function(a){function b(a){LOCAL_FILE_SYSTEM.saveLocalFile(document.querySelector("#DOCUMENT_TITLE").innerHTML,a,"text/html")}if(this.appRef.activeEditablePage.is_isolateLayerEditing())this.appRef.alertModalDialog.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("Please exit from isolate layer editing!"));else{var c=this;ValidatePlan(function(){c.appRef.serializeDocumentAsHTML(c.appRef.getActiveDocument(),b)})}};
_.onClick_chooseFileToImportFromLocalDrive=function(a){this.appRef.chooseFileToImportFromLocalDrive()};
_.onClick_exportActivePageAsImageToLocalDrive_PNG=function(a){function b(a){LOCAL_FILE_SYSTEM.saveLocalFile(document.querySelector("#DOCUMENT_TITLE").innerHTML,a,"image/png")}if(this.appRef.activeEditablePage.is_isolateLayerEditing())this.appRef.alertModalDialog.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("Please exit from isolate layer editing!"));else{var c=this;ValidatePlan(function(){c.appRef.serializeActivePageAsImage("image/png",1,b)})}};
_.onClick_exportActivePageAsImageToLocalDrive_JPG=function(a){function b(a){LOCAL_FILE_SYSTEM.saveLocalFile(document.querySelector("#DOCUMENT_TITLE").innerHTML,a,"image/jpeg")}if(this.appRef.activeEditablePage.is_isolateLayerEditing())this.appRef.alertModalDialog.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("Please exit from isolate layer editing!"));else{var c=this;ValidatePlan(function(){c.appRef.serializeActivePageAsImage("image/jpeg",1,b)})}};
_.onClick_exportActivePageAsImageToGoogleDrive_PNG=function(a){this.appRef.activeEditablePage.is_isolateLayerEditing()?this.appRef.alertModalDialog.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("Please exit from isolate layer editing!")):this.appRef.exportActivePageAsImageToGoogleDrive()};
_.onClick_exportActivePageAsImageToGoogleDrive_JPG=function(a){this.appRef.activeEditablePage.is_isolateLayerEditing()?this.appRef.alertModalDialog.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("Please exit from isolate layer editing!")):this.appRef.exportActivePageAsImageToGoogleDrive("image/jpeg")};_.onClick_logoutFromGoogleDrive=function(a){googleUserSignOut();var b=this;googleUserSignOut(function(){b.appRef.alertModalDialog.open(LOCALIZER.translate("Logout"),LOCALIZER.translate("You are signed out from Google Drive."))})};
_.onChooseLocalProjectDirectory=function(a){console.log("onChooseProjectDirectory",a);for(var b in a.target.files)console.log(b.name,b.webkitRelativePath);(function(a){var b=new FileReader;b.readAsText(a);b.onload=function(){console.log(b.result)}})(a.target.files[0]);this.appRef.localFileSystem_panel.open(!0)};_.onClick_chooseDocumentFromGoogleDrive=function(){this.appRef.chooseDocumentFromGoogleDrive()};
_.onClick_saveDocumentToGoogleDrive=function(a){this.appRef.activeEditablePage.is_isolateLayerEditing()?this.appRef.alertModalDialog.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("Please exit from isolate layer editing!")):(a=this.appRef.getActiveDocument(),console.log("saveDocument",a.idFile),a.idFile?this.appRef.saveDocumentToGoogleDrive():this.appRef.saveDocumentAsToGoogleDrive())};
_.onClick_saveAsDocumentToGoogleDrive=function(a){this.appRef.activeEditablePage.is_isolateLayerEditing()?this.appRef.alertModalDialog.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("Please exit from isolate layer editing!")):this.appRef.saveDocumentAsToGoogleDrive()};
_.onClick_exportHTMLDocumentToGoogleDrive=function(a){this.appRef.activeEditablePage.is_isolateLayerEditing()?this.appRef.alertModalDialog.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("Please exit from isolate layer editing!")):this.appRef.exportHTMLDocumentToGoogleDrive()};_.onClick_chooseFileToImportFromGoogleDrive=function(a){this.appRef.chooseFileToImportFromGoogleDrive()};function Accessories2D_bar(a){a.appRef&&(this.appRef=a.appRef);this.connectEvents()}_=Accessories2D_bar.prototype;
_.onClickActivateAndUpdate=function(a){console.log("onClickActivateAndUpdate",a.target);a.target.classList.contains("selectable")&&SelectElement(a.target);if("ACCESSORIES_BAR"==a.target.parentElement.getAttribute("id")){a=a.target.querySelectorAll(".panel-repository .panel");console.log("panelList",a);for(var b=0;b<a.length;b++)a[b].update()}};
var GOOGLE_SHEET_TO_JSON_SERVICE_URL="https://script.google.com/macros/s/AKfycbxxdZRI5UwhIvJDLTDVuVF5STH4PuehY0F4qu8DBAYzc758F5Q/exec?",GOOGLE_LOCALIZER_SERVICE_URL="https://script.google.com/macros/s/AKfycbzwQ8iuowB_tKgxnt6utfHcZdFFrv9RXzBKQHBCytRPdMbFfJk/exec?",GOOGLE_LOCALIZER_SHEET_ID="17_l_HiEpXMzhOaW2TcmYdirCgw6EKqPizXz3hnAbkRU",LANGUAGE="EN",GDRIVE_SERVICE,SCOPE="https://www.googleapis.com/auth/drive",CLIENT_ID="224665388995-f6b3p5i0et7c7u14vo092kqa27cg57mm.apps.googleusercontent.com",DISCOVERY_URL=
"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",ACCOUNT_MANAGER_URL="account.php",PAYPAL_CLIENT_ID_SANDBOX="AVhvuhvVc7rbGkrHIZhyWaqeauY4b8MR4ee8lkUeL00b-Hxm68S1fCfYqJHMaFVP4oKSSiIwFn1OgvG7",PAYPAL_CLIENT_ID_PRODUCTION="AXe3DYj_NEnDJbgFI8okn4_MC2JFn3KMtUGNqxj4jIMxml8Ktu4sN-oYMZuqPAoIDU6Ztrm42oPnF63m",PAYPAL_ENVIRONMENT="production";"chrome"!=BROWSER_TYPE&&alert("Janvas works well only with Chrome Browser!");
var DATA={},APPLICATION,LOCALIZER=new Localizer,LOCAL_FILE_SYSTEM=new LocalFileSystem,DOCUMENT_OFFSET={x:107,y:57};console.log("BROWSER_TYPE",BROWSER_TYPE);function init(){APPLICATION=new Janvas2D_app}window.addEventListener("load",init,!1);function Janvas2D_app(){this.activeEditablePage=null;this.onApplicationStart()}_=Janvas2D_app.prototype;
_.onApplicationStart=function(){this.container=document.querySelector("#APPLICATION");this.initEvents();this.initLanguage();this.initTools();this.initPanels();this.initInteraction();this.createDocument();var a=GetUrlVars();a.documentUrl&&this.loadDocumentFromUrl(a.documentUrl);this.onBrowserResize();this.activateTool("selectionGlobal2D_tool");this.activeEditablePage.showSelectionProperties()};
_.initLanguage=function(a){var b=GetCookie("language");b?LANGUAGE=b:SetCookie("language",LANGUAGE,1E3);b="resources/localization/"+LANGUAGE+".js";GOOGLE_LOCALIZER_SERVICE_URL&&(b=GOOGLE_LOCALIZER_SERVICE_URL+"sheetId="+GOOGLE_LOCALIZER_SHEET_ID+"&sheetName=language_strings&columnName="+LANGUAGE+"&callback=onLoadLanguageStrings");LOCALIZER.loadStrings(b,a)};
_.notify=function(a,b,c){"granted"!==Notification.permission?Notification.requestPermission():(new Notification(a,{icon:"https://www.janvas.com/data/janvas_6.2/brend/icons/janvas_32x32.png",body:b})).onclick=function(){window.open(c)}};
_.initEvents=function(){ConnectEvent("resize",window,this.onBrowserResize,this);window.addEventListener("unload",BindFunction(this,this.onExit));window.onbeforeunload=BindFunction(this,this.confirmExit);ConnectEvent("keydown",window,this.onKeyDown,this);ConnectEvent("keyup",window,this.onKeyUp,this);var a=document.querySelector("#STAGE");a.addEventListener("mousewheel",BindFunction(this,this.onMouseWheel),{capture:!1,passive:!0});a.addEventListener("DOMMouseScroll",BindFunction(this,this.onMouseWheel),
{capture:!1,passive:!0});ConnectEvent("paste",window,this.onPaste,this);ConnectEvent("copy",window,this.onCopy,this);ConnectEvent("cut",window,this.onCut,this)};_.onPaste=function(a){console.log("onPaste");var b=document.activeElement;if(!("INPUT"==b.nodeName||"TEXTAREA"==b.nodeName||"DIV"==b.nodeName&&b.hasAttribute("contenteditable")))this.activeEditablePage.onPaste(a)};
_.onCopy=function(a){console.log("onCopy");var b=document.activeElement;if(!("INPUT"==b.nodeName||"TEXTAREA"==b.nodeName||"DIV"==b.nodeName&&b.hasAttribute("contenteditable")))this.activeEditablePage.onCopy(a)};_.onCut=function(a){console.log("onCut");var b=document.activeElement;if(!("INPUT"==b.nodeName||"TEXTAREA"==b.nodeName||"DIV"==b.nodeName&&b.hasAttribute("contenteditable")))this.activeEditablePage.onCut(a)};
_.initPanels=function(){var a={appRef:this};GDRIVE_SERVICE=new GDriveFileSystem_service;this.gdriveSavePanel=document.querySelector("#GDRIVE_SAVE_PANEL").connectController(GDriveSave_panel,a);this.gdriveOpenPanel=document.querySelector("#GDRIVE_OPEN_PANEL").connectController(GDriveOpen_panel,a);this.gdriveImportPanel=document.querySelector("#GDRIVE_IMPORT_PANEL").connectController(GDriveImport_panel,a);this.alertModalDialog=document.querySelector("#ALERT_DIALOG").connectController(Modal_dialog,a);
this.confirmModalDialog=document.querySelector("#CONFIRM_DIALOG").connectController(Modal_dialog,a);this.promptModalDialog=document.querySelector("#PROMPT_DIALOG").connectController(Modal_dialog,a);this.progressPanel=document.querySelector("#PROGRESS_PANEL").connectController(Progress_panel,a);this.webViewDialog=document.querySelector("#WEB_VIEW_PANEL");this.webViewDialog.open=function(a){this.querySelector("iframe").setAttribute("src",a);ShowElement(this)};this.fontLibrary2D_panel=document.querySelector("#FONT_LIBRARY_2D_PANEL").connectController(FontLibrary2D_panel,
a);this.library2DPanel=document.querySelector("#LIBRARY_2D_PANEL").connectController(Library2D_panel,a);this.strokeWidthLibrary2DPanel=document.querySelector("#STROKE_WIDTH_LIBRARY_2D_PANEL").connectController(StrokeWidthLibrary2D_panel,a);this.strokeDashArrayLibrary2DPanel=document.querySelector("#STROKE_DASH_ARRAY_LIBRARY_2D_PANEL").connectController(StrokeDashArrayLibrary2D_panel,a);this.filterLibrary2DPanel=document.querySelector("#FILTER_LIBRARY_2D_PANEL").connectController(FilterLibrary2D_panel,
a);this.markerLibrary2DPanel=document.querySelector("#MARKER_LIBRARY_2D_PANEL").connectController(MarkerLibrary2D_panel,a);this.colorLibrary2DPanel=document.querySelector("#COLOR_LIBRARY_2D_PANEL").connectController(ColorLibrary2D_panel,a);this.gradientLibrary2DPanel=document.querySelector("#GRADIENT_LIBRARY_2D_PANEL").connectController(GradientLibrary2D_panel,a);this.patternLibrary2DPanel=document.querySelector("#PATTERN_LIBRARY_2D_PANEL").connectController(PatternLibrary2D_panel,a);this.shapeLibrary2DPanel=
document.querySelector("#SHAPE_LIBRARY_2D_PANEL").connectController(ShapeLibrary2D_panel,a);this.maskLibrary2DPanel=document.querySelector("#MASK_LIBRARY_2D_PANEL").connectController(MaskLibrary2D_panel,a);this.symbolLibrary2DPanel=document.querySelector("#SYMBOL_LIBRARY_2D_PANEL").connectController(SymbolLibrary2D_panel,a);this.pageTemplateLibrary2Dpanel=document.querySelector("#PAGE_TEMPLATE_LIBRARY_2D_PANEL").connectController(PageTemplateLibrary2D_panel,a);this.pixabayLibrary2DPanel=document.querySelector("#PIXABAY_LIBRARY_2D_PANEL").connectController(PixabayLibrary2D_panel,
a);this.markersEditor2DPanel=document.querySelector("#MARKERS_EDITOR_2D_PANEL").connectController(MarkersEditor2D_panel,a);this.workspace=document.querySelector("#WORKSPACE").connectController(Workspace2D,a);this.documentsContainer=document.querySelector("#DOCUMENTS_CONTAINER");this.interactivity2DPanel=document.querySelector("#INTERACTIVITY_2D_PANEL").connectController(Interactivity2D_panel,a);this.filter2DPanel=document.querySelector("#FILTER_2D_PANEL").connectController(Filter2D_panel,a);this.layers2DPanel=
document.querySelector("#LAYERS_2D_PANEL").connectController(Layers2D_panel,a);this.pages2DPanel=document.querySelector("#PAGES_2D_PANEL").connectController(Pages2D_panel,a);this.page2DPanel=document.querySelector("#PAGE_2D_PANEL").connectController(Page2D_panel,a);this.snaps2DPanel=document.querySelector("#SNAPS_2D_PANEL").connectController(Snaps2D_panel,a);this.activatorsToolbar=document.querySelector("#ACCESSORIES_BAR").connectController(Accessories2D_bar,a);this.transform2DPanel=document.querySelector("#TRANSFORM_2D_PANEL").connectController(Transform2D_panel,
a);this.globalTools2DPanel=document.querySelector("#GLOBAL_TOOLS_2D_PANEL").connectController(Panel,a);this.drawTools2DPanel=document.querySelector("#DRAW_TOOLS_2D_PANEL").connectController(Panel,a);this.pathTools2DPanel=document.querySelector("#PATH_TOOLS_2D_PANEL").connectController(Panel,a);this.utilsTools2DPanel=document.querySelector("#UTILS_TOOLS_2D_PANEL").connectController(Panel,a);this.resources2DPanel=document.querySelector("#RESOURCES_2D_PANEL").connectController(Panel,a);this.fillStroke2DPanel=
document.querySelector("#FILL_STROKE_2D_PANEL").connectController(FillStroke2D_panel,a);this.stroke2DPanel=document.querySelector("#STROKE_2D_PANEL").connectController(Stroke2D_panel,a);this.appearance2DPanel=document.querySelector("#APPEARANCE_2D_PANEL").connectController(Appearance2D_panel,a);this.text2DPanel=document.querySelector("#TEXT_2D_PANEL").connectController(Text2D_panel,a);this.align2DPanel=document.querySelector("#ALIGN_2D_PANEL").connectController(Align2D_panel,a);this.line2DPanel=document.querySelector("#LINE_2D_PANEL").connectController(Line2D_panel,
a);this.rectangle2DPanel=document.querySelector("#RECTANGLE_2D_PANEL").connectController(Rectangle2D_panel,a);this.ellipse2DPanel=document.querySelector("#ELLIPSE_2D_PANEL").connectController(Ellipse2D_panel,a);this.image2DPanel=document.querySelector("#IMAGE_2D_PANEL").connectController(Image2D_panel,a);this.iframe2DPanel=document.querySelector("#IFRAME_2D_PANEL").connectController(IFrame2D_panel,a);this.clipPath2DPanel=document.querySelector("#CLIP_PATH_2D_PANEL").connectController(ClipPath2D_panel,
a);this.mask2DPanel=document.querySelector("#MASK_2D_PANEL").connectController(Mask2D_panel,a);this.path2DPanel=document.querySelector("#PATH_2D_PANEL").connectController(Path2D_panel,a);this.group2DPanel=document.querySelector("#GROUP_2D_PANEL").connectController(Group2D_panel,a);this.use2DPanel=document.querySelector("#USE_2D_PANEL").connectController(Use2D_panel,a);this.arrange2DPanel=document.querySelector("#ARRANGE_2D_PANEL").connectController(Arrange2D_panel,a);this.booleanOperations2DPanel=
document.querySelector("#BOOLEAN_OPERATIONS_2D_PANEL").connectController(BooleanOperations2D_panel,a);this.colorPickerPanel=document.querySelector("#COLOR_PICKER").connectController(ColorPicker,a);this.gradientPropertiesContextPanel=document.querySelector("#GRADIENT_PROPERTIES_CONTEXT_PANEL").connectController(GradientProperties2D_panel,a);this.patternPropertiesContextPanel=document.querySelector("#PATTERN_PROPERTIES_CONTEXT_PANEL").connectController(PatternProperties2D_panel,a);this.contextPanels=
document.querySelector("#CONTEXT_PANELS").connectController(ContextPanels,a);this.edit2DMenu=document.querySelector("#EDIT_2D_CONTEXT_MENU").connectController(Edit2D_ctxMenu,a);this.archivie2DToolbar=document.querySelector("#ARCHIVIE_2D_TOOLBAR").connectController(Archivie2D_toolbar,a);this.isolateLayerEditingToolbar=document.querySelector("#ISOLATE_LAYER_EDITING_TOOLBAR").connectController(IsolateLayerEditing_bar,a);this.localFileSystem_panel=document.querySelector("#LOCAL_FILE_SYSTEM_PANEL").connectController(LocalFileSystem_panel,
a);this.inputProperty2DPanel=document.querySelector("#INPUT_PROPERTY_2D_PANEL").connectController(InputProperty2D_panel,{appRef:this});document.querySelector("#RESOURCES_2D_PANEL").connectEvents(this.edit2DMenu)};
_.initTools=function(){this.tools={};this.tools.panView2D_tool=new PanView2D_tool(this);this.tools.zoomView2D_tool=new ZoomView2D_tool(this);this.tools.selectionGlobal2D_tool=new Selection2D_tool(this,"GLOBAL_SELECTION");this.tools.selectionPoint2D_tool=new Selection2D_tool(this,"POINT_SELECTION");this.tools.selectionByRectArea2D_tool=new SelectionByRectArea2D_tool(this);this.tools.translate2D_tool=new Translate2D_tool(this);this.tools.translatePoint2D_tool=new TranslatePoint2D_tool(this);this.tools.translateControlPoint2D_tool=
new TranslateControlPoint2D_tool(this);this.tools.translateCubicCurve2D_tool=new TranslateSegmentCubic2D_tool(this);this.tools.translateSegmentLineTo2D_tool=new TranslateSegmentLineTo2D_tool(this);this.tools.rotateElement2D_tool=new RotateElement2D_tool(this);this.tools.rotatePoint2D_tool=new RotatePoint2D_tool(this);this.tools.rotate2D_tool=new Rotate2D_tool(this);this.tools.scale2D_tool=new Scale2D_tool(this);this.tools.scaleElement2D_tool=new ScaleElement2D_tool(this);this.tools.scalePoint2D_tool=
new ScalePoint2D_tool(this);this.tools.createGuide2D_tool=new CreateGuide2D_tool(this);this.tools.setOrigin2D_tool=new SetOrigin2D_tool(this);this.tools.eyeDropper2D_tool=new EyeDropper2D_tool(this);this.tools.filling2D_tool=new Filling2D_tool(this);this.tools.editGradientPoints2D_tool=new EditGradientPoints2D_tool(this);this.tools.perspectiveDeform2D_tool=new PerspectiveDeform2D_tool(this);this.tools.drawLine2D_tool=new DrawLine2D_tool(this);this.tools.drawArc2D_tool=new DrawArc2D_tool(this);this.tools.drawRectangle2D_tool=
new DrawRectangle2D_tool(this);this.tools.drawRegularPolygon2D_tool=new DrawRegularPolygon2D_tool(this);this.tools.drawEllipse2D_tool=new DrawEllipse2D_tool(this);this.tools.drawTextBox2D_tool=new DrawTextBox2D_tool(this);this.tools.drawFreehand2D_tool=new DrawFreehand2D_tool(this);this.tools.drawPath2D_tool=new DrawPath2D_tool(this);this.tools.drawForeignObject2D_tool=new DrawForeignObject2D_tool(this);this.tools.splitPath2D_tool=new SplitPath2D_tool(this);this.tools.dividePath2D_tool=new DividePath2D_tool(this);
this.tools.roundPathCorner2D_tool=new RoundPathCorner2D_tool(this);this.tools.convertPathPoint2D_tool=new ConvertPathPoint2D_tool(this);var a=this;ConnectEvent("mousedown",document.querySelectorAll("*[toolName]"),function(b){var c=a.tools.activeTool;b=b.target.getAttribute("toolName");a.activateTool(b);console.log("activateTool",b);c==a.tools.activeTool&&a.contextPanels.showContextPanel(b+"_INFO_PANEL")})};
_.activateTool=function(a){if(this.tools[a]){if(this.tools.activeTool!=this.tools[a]){if(this.previousActiveTool=this.tools.activeTool)this.previousActiveTool.onDeactivate();var b=document.querySelector("li[toolName].selected");b&&DeselectElements([b]);(b=document.querySelector('li[toolName="'+a+'"]'))&&SelectElement(b);this.tools.activeTool=this.tools[a];this.tools.activeTool.onActivate();this.documentsContainer.setAttribute("active-tool",a)}if(this.activeEditablePage.isHTMLTextEditing||this.activeEditablePage.isTextEditing)this.activeEditablePage.isHTMLTextEditing&&
this.activeEditablePage.exitFrom_HTMLTextEditing(),this.activeEditablePage.isTextEditing&&this.activeEditablePage.exitFrom_TextEditing()}else console.log("lo strumento: "+a+" non esiste ")};
_.initInteraction=function(){this.interaction2D=document.querySelector("#INTERACTION_2D");this.interaction2D.bbox2D=this.interaction2D.querySelector("#BBOX_2D");this.interaction2D.bbox2D.connectController(BBox2D_interaction,{appRef:this});this.interaction2D.points2D=this.interaction2D.querySelector("#INTERACTION_POINTS");this.interaction2D.points2D.connectController(Points2D_interaction,{appRef:this});this.interaction2D.elementPreviews=this.interaction2D.querySelector("#ELEMENT_PREVIEWS");this.interaction2D.measureTip=
document.querySelector("#MEASURE_TIP");this.interaction2D.measureTip.line=this.interaction2D.measureTip.querySelector("line");this.interaction2D.measureTip.text=this.interaction2D.measureTip.querySelector("text");this.interaction2D.measureTip.show=function(a,b,c){this.line.updateGeometry(a.x,a.y,b.x,b.y);this.text.setAttribute("x",b.x);this.text.setAttribute("y",b.y-20);this.text.innerHTML=c;ShowElement(this)};this.interaction2D.perspectiveDeform2D=this.interaction2D.querySelector("#PERSPECTIVE_DEFORM_2D").connectController(PerspectiveDeform2D_interaction,
{appRef:this});this.interaction2D.gradientPoints2D=this.interaction2D.querySelector("#GRADIENT_2D_INTERACTION").connectController(Gradient2D_interaction,{appRef:this});this.interaction2D.rotation2D=this.interaction2D.querySelector("#ROTATION_2D").connectController(Rotation2D_interaction,{appRef:this});this.interaction2D.scale2D=this.interaction2D.querySelector("#SCALE_2D").connectController(Scale2D_interaction,{appRef:this});this.interaction2D.segment2D=new Segment2D_interaction({appRef:this});this.interaction2D.smartGuides=
document.querySelector("#SMART_GUIDES").connectController(SmartGuide2D_interaction,{appRef:this});this.interaction2D.smartPoints=document.querySelector("#SMART_POINTS").connectController(SmartPoints2D_interaction,{appRef:this});this.interaction2D.lengthPropertyLabel=this.interaction2D.querySelector("#LENGTH_PROPERTY_LABEL").connectController(LengthPropertyLabel_interaction,{appRef:this})};_.onMouseWheel=function(a){if(!this.activeEditablePage.isTextEditing&&!GMOUSE.isMouseButtonPressed)this.tools.activeTool.onMouseWheel(a)};
_.confirmExit=function(){if(this.getActiveDocument().isChanged())return LOCALIZER.translate("Close the document without saving changes?")};_.onExit=function(){};
_.onKeyDown=function(a){var b=document.activeElement;if(!("INPUT"==b.nodeName||"TEXTAREA"==b.nodeName||"DIV"==b.nodeName&&b.hasAttribute("contenteditable")))if(this.activeEditablePage.isTextEditing)this.activeEditablePage.editableSVGTextElement.onKeyDown(a);else{this.updateKeysState(a);b=a.keyCode;var c=a.metaKey||a.ctrlKey;console.log("keyCode",b);if(c)switch(b){case KeyboardEvent.CODES.keyCode_0:return this.workspace.fitActivePageToView(),a.preventPropagation();case KeyboardEvent.CODES.keyCode_1:return this.workspace.viewActivePageAtScale(1),
a.preventPropagation();case KeyboardEvent.CODES.keyCode_PLUS_A:case KeyboardEvent.CODES.keyCode_PLUS_B:return this.workspace.zoom(1.1),this.activeEditablePage.updateInteraction(),a.preventPropagation();case KeyboardEvent.CODES.keyCode_MINUS_A:case KeyboardEvent.CODES.keyCode_MINUS_B:return this.workspace.zoom(.9),this.activeEditablePage.updateInteraction(),a.preventPropagation();case KeyboardEvent.CODES.keyCode_S:return a.preventPropagation();case KeyboardEvent.CODES.keyCode_P:return this.getActiveDocument().printDocument(),
a.preventPropagation()}else switch(b){case KeyboardEvent.CODES.keyCode_f5:return this.localFileSystem_panel.open(!0),a.preventPropagation();case KeyboardEvent.CODES.keyCode_V:return this.activateTool("selectionGlobal2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_A:return this.activateTool("selectionPoint2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_H:return this.activateTool("panView2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_Z:return this.activateTool("zoomView2D_tool"),
a.preventPropagation();case KeyboardEvent.CODES.keyCode_R:return this.activateTool("drawRectangle2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_E:return this.activateTool("drawEllipse2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_L:return this.activateTool("drawLine2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_T:return this.activateTool("drawTextBox2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_N:return this.activateTool("drawFreehand2D_tool"),
a.preventPropagation();case KeyboardEvent.CODES.keyCode_P:return this.activateTool("drawPath2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_PLUS_A:case KeyboardEvent.CODES.keyCode_PLUS_B:return this.activateTool("dividePath2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_MINUS_A:case KeyboardEvent.CODES.keyCode_MINUS_B:return this.activateTool("removePathSegment2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_C:return this.activateTool("splitPath2D_tool"),
a.preventPropagation();case KeyboardEvent.CODES.keyCode_S:return this.activateTool("convertPathPoint2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_I:return this.activateTool("eyeDropper2D_tool"),a.preventPropagation();case KeyboardEvent.CODES.keyCode_G:return this.activateTool("editGradientPoints2D_tool"),a.preventPropagation()}this.activeEditablePage.onKeyDown(a)}};
_.onKeyUp=function(a){var b=document.activeElement;"INPUT"==b.nodeName||"TEXTAREA"==b.nodeName||"DIV"==b.nodeName&&b.hasAttribute("contenteditable")||this.activeEditablePage.isTextEditing||(this.updateKeysState(a),this.activeEditablePage.onKeyUp(a))};
_.updateKeysState=function(a){console.log("updateKeysState",a);Event.isShiftKeyPressed=a.shiftKey;Event.isAltKeyPressed=a.altKey;Event.isCmdCtrlKeyPressed=a.ctrlKey||a.metaKey;32==a.keyCode&&(Event.isSpaceKeyPressed="keyup"!=a.type);a=this.documentsContainer.classList;Event.isSpaceKeyPressed?a.add("key-pressed-space"):a.remove("key-pressed-space");Event.isCmdCtrlKeyPressed?a.add("key-pressed-cmd"):a.remove("key-pressed-cmd");Event.isAltKeyPressed?a.add("key-pressed-alt"):a.remove("key-pressed-alt")};
_.onBrowserResize=function(a){console.log("onBrowserResize");this.workspace.onResize()};_.disablePagePreviewsRendering=function(){this.pages2DPanel.disablePageRendering();this.page2DPanel.disablePageRendering()};_.enablePagePreviewsRendering=function(){this.pages2DPanel.enablePageRendering();this.page2DPanel.enablePageRendering()};_.getActiveDocument=function(){return this.documentsContainer.querySelector(".document-2D.showed")};_.setActiveDocument=function(a){ShowElement(a)};
_.setDocumentTitle=function(a){document.querySelector("#DOCUMENT_TITLE").innerHTML=a;document.title=a};
_.createDocument=function(a){var b=document.querySelector("#TEMPLATES .document-2D").cloneNode(!0);b.setAttribute("id",CreateUniqueIDI());this.documentsContainer.removeChildren();this.documentsContainer.appendChild(b);b.connectController(Document2D,{appRef:this});this.setDocumentTitle(LOCALIZER.translate("Untitled")||"Untitled");this.setActiveDocument(b);var c=1;a&&(isNaN(a.maxPages)||(c=a.maxPages));for(a=0;a<c;a++){var d=b.addNewPage();b.setActivePage(d)}this.pages2DPanel.update();return b};
_.unserializeDocument=function(a){a.hasAttribute("data-version")?"6.2"==a.dataset.version&&(new Document2DUnserializer_v601(this)).unserialize(a):a.querySelector('g[id="jvs-content"]')?(new Document2DUnserializer_v501(this)).unserialize(a):(new SvgUnserializer(this)).unserialize(a)};_.unserializeAndAddPagesInCurrentDocument=function(a){(new Document2DUnserializer_v601(this)).unserialize(a,!0);console.log("activeDocument.activeEditablePage",this.activeEditablePage);this.activeEditablePage.updateInteraction()};
_.serializeDocument=function(a){a=(new Document2DSerializer(this)).serializeDocument(a);a.dataset.version="6.2";console.log("serializedDoc",a);return(new XMLSerializer).serializeToString(a)};
_.serializeDocumentAsHTML=function(a,b){function c(a){a=(new DOMParser).parseFromString(a,"text/html");var c=a.querySelector(".previews");console.log("pagePreviewsContainer",c);var e=a.querySelector(".document");console.log("documentContainer",e);for(var f,l,n,m=d.querySelectorAll("svg>svg"),y=0;y<m.length;y++)l=m[y],l.setAttribute("width","100%"),l.setAttribute("height","100%"),f=document.createElement("div"),f.classList.add("page"),f.appendChild(l),e.appendChild(f),f=document.createElement("div"),
f.classList.add("page"),n=l.cloneNode(),n.appendChild(n.createUse(l.querySelector(".layers").getAttribute("id"))),f.appendChild(n),c.appendChild(f);a.querySelector("body").appendChild(d);c=d.querySelectorAll("svg defs link");for(y=0;y<c.length;y++)a.querySelector("head").appendChild(c[y]);console.log("htmlDoc",a);a=(new XMLSerializer).serializeToString(a);a=function(a){var b={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return a.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,function(a){return b[a]})}(a);
b(a)}var d=(new Document2DSerializer(this)).serializeDocument(a);d.dataset.version="6.2";console.log("serializedDoc",d);var e=new XMLHttpRequest;e.open("GET","resources/publishing/reader_template.html");e.onload=function(a){console.log("_e",a);200==this.status&&c(a.target.responseText)};e.send()};_.serializeActivePageAsImage=function(a,b,c,d){this.getActiveDocument().getActivePage().getAsImage(a,b,c,d)};
_.loadDocumentFromUrl=function(a){var b=this,c=this.progressPanel;c.setProgressBarValue(1);c.open(!0);var d=PathInfo(a);SendAndLoad(a,null,null,function(a){b.unserializeDocument(a.target.responseXML.querySelector("svg"));b.setDocumentTitle(d.fileName)},function(a){b.alertModalDialog.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occured during loading file")+": "+d.fileName)},function(a){console.log("loading total: "+a.total+"   loaded: "+a.loaded);c.setProgressValues(a.total,a.loaded)})};
_.chooseDocumentFromLocalDrive=function(a){function b(){LOCAL_FILE_SYSTEM.inputFile.callback=function(a){console.log("_e.target.files[0]",a.target.files[0]);var b=a.target.files[0];LOCAL_FILE_SYSTEM.readXMLFile(b,function(a){c.unserializeDocument(a);c.setDocumentTitle(b.name)})};LOCAL_FILE_SYSTEM.chooseLocalFile(".svg")}var c=this;this.getActiveDocument().isChanged()?this.confirmModalDialog.open(LOCALIZER.translate("Caution"),LOCALIZER.translate("Do you want close the current document without saving changes?"),
b):b()};_.chooseFileToImportFromLocalDrive=function(){function a(a){var c=SVGUtils.createSVGImage(a,0,0,null,null,function(a){b.getActiveDocument().getActivePage().centerElementListInDocumentView([c])});c.dataset.mantainAspectRatio=!0;b.getActiveDocument().getActivePage().getActiveLayer().appendChild(c)}var b=this;(function(){LOCAL_FILE_SYSTEM.inputFile.callback=function(b){LOCAL_FILE_SYSTEM.readImageFile(b.target.files[0],function(b){a(b)})};LOCAL_FILE_SYSTEM.chooseLocalFile("image/*")})()};
_.chooseDocumentFromGoogleDrive=function(){function a(){b.gdriveOpenPanel.open(null,["svg","html","php"])}var b=this;this.getActiveDocument().isChanged()?this.confirmModalDialog.open(LOCALIZER.translate("Caution"),LOCALIZER.translate("Do you want close the current document without saving changes?"),a):a()};_.chooseFileToImportFromGoogleDrive=function(){this.gdriveImportPanel.open(null,["jpg","jpeg","png","gif"])};
_.saveDocumentAsToGoogleDrive=function(){function a(a){e.setAsUnchanged();c.setDocumentTitle(a.fileName);e.idFile=a.idFile}function b(){var b=c.serializeDocument(e);d.saveData(b,"image/svg+xml",a)}var c=this,d=this.gdriveSavePanel,e=this.getActiveDocument();this.gdriveSavePanel.open(null,document.querySelector("#DOCUMENT_TITLE").innerHTML,["svg"],function(){whenGoogleUserWillBeAuthorizedCall(function(){ValidatePlan(b)})})};
_.exportHTMLDocumentToGoogleDrive=function(){function a(a){}function b(b){d.saveData(b,"text/html",a)}function c(){f.serializeDocumentAsHTML(e,b)}var d=this.gdriveSavePanel,e=this.getActiveDocument(),f=this;this.gdriveSavePanel.open(null,document.querySelector("#DOCUMENT_TITLE").innerHTML,["html"],function(){whenGoogleUserWillBeAuthorizedCall(function(){ValidatePlan(c)})})};
_.loadDocumentFromGoogleDrive=function(a){var b=this,c=this.progressPanel;c.setProgressBarValue(1);c.open(!0);GDRIVE_SERVICE.getFileContent(a,function(c){b.unserializeDocument(c.target.responseXML.querySelector("svg"));b.setDocumentTitle(a.name);b.getActiveDocument().idFile=a.id},function(c){b.alertModalDialog.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occured during loading file")+": "+a.name)},function(a){console.log("loading total: "+a.total+"   loaded: "+a.loaded);c.setProgressValues(a.total,
a.loaded)})};
_.saveDocumentToGoogleDrive=function(){function a(){f.close();e.alertModalDialog.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The document was not saved, try again."))}function b(){g.setAsUnchanged()}function c(a){f.onLoadingProgress(a)}function d(){var d=e.serializeDocument(g);GDRIVE_SERVICE.updateFileContent(g.idFile,"image/svg+xml",d,b,a,c,!0)}var e=this,f=this.progressPanel;f.setProgressBarValue(1);f.open(!0);var g=this.getActiveDocument();console.log("activeDocument.idFile",g.idFile);
whenGoogleUserWillBeAuthorizedCall(function(){ValidatePlan(d)})};_.importFileFromGoogleDrive=function(a){var b=this,c=this.progressPanel;c.setProgressBarValue(1);c.open(!0);var d=SVGUtils.createSVGImage(a.webContentLink,0,0,null,null,function(a){c.endVirtualProgress();b.getActiveDocument().getActivePage().centerElementListInDocumentView([d])});d.dataset.mantainAspectRatio=!0;this.getActiveDocument().getActivePage().getActiveLayer().appendChild(d);c.open(!0);c.startVirtualProgress(a.size)};
_.exportActivePageAsImageToGoogleDrive=function(a,b){function c(a){}function d(b){console.log("onImageComplete",b);k.saveData(b,a,c)}function e(){h.serializeActivePageAsImage(a,b,d,!0)}b=b||1;a=a||"image/png";var f="png";"image/jpeg"==a&&(f="jpg");var g=document.querySelector("#DOCUMENT_TITLE").innerHTML.split(".")[0]+"."+f,h=this,k=this.gdriveSavePanel;this.gdriveSavePanel.open(null,g,[f],function(){whenGoogleUserWillBeAuthorizedCall(function(){ValidatePlan(e)})})};